name: windefend
applications: ""
definitions:
- name: windows_defender_amsi_trigger_detected
  description: Detects triggering of AMSI by Windows Defender.
  condition: ([EventID] == 1116) && ([Source Name] == ['AMSI'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: microsoft_defender_tamper_protection_trigger
  description: Detects block of attempt to disable real time protection of Microsoft
    Defender by tamper protection
  condition: (([EventID] == 5013)) && (([Value] =~ ['.*.*Windows.*Defender.*DisableAntiSpyware.*=.*0x1.*.*'])
    || ([Value] =~ ['.*.*Real.*Time.*Protection.*DisableRealtimeMonitoring.*=.*.*Current.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: windows_defender_exclusions_added
  description: Detects the Setting of Windows Defender Exclusions
  condition: (([EventID] == 5007)) && (([New Value] =~ ['.*.*Microsoft.*Windows.*Defender.*Exclusions.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: windows_defender_threat_detected
  description: Detects all actions taken by Windows Defender malware detection engines
  condition: (([EventID] == 1006) || ([EventID] == 1116) || ([EventID] == 1015) ||
    ([EventID] == 1117))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: windows_defender_threat_detection_disabled
  description: Detects disabling Windows Defender threat protection
  condition: (([EventID] == 5001) || ([EventID] == 5010) || ([EventID] == 5012) ||
    ([EventID] == 5101)) || (([TargetObject] =~ ['HKEY.*LOCAL.*MACHINE.*SYSTEM.*CurrentControlSet.*Services.*WinDefend'])
    || ([TargetObject] =~ ['HKEY.*LOCAL.*MACHINE.*SOFTWARE.*Microsoft.*Windows.*Defender'])
    || ([TargetObject] =~ ['HKEY.*LOCAL.*MACHINE.*SOFTWARE.*Policies.*Microsoft.*Windows.*Defender']))
    && ([Details] == ['DWORD (0x00000001)'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: windows_defender_malware_detection_history_deletion
  description: Windows Defender logs when the history of detected infections is deleted.
    Log file will contain the message "Windows Defender Antivirus has removed history
    of malware and other potentially unwanted software".
  condition: ([EventID] == 1013) && ([EventType] == 4)
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,001
  exttype: SIEM
