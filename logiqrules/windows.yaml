name: windows
applications: ""
definitions:
- name: blue_mockingbird
  description: Attempts to detect system changes made by Blue Mockingbird
  condition: ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine] =~ ['.*sc.*config.*'])
    && ([CommandLine] =~ ['.*wercplsupporte.dll.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1112,t1047
  exttype: SIEM
- name: blue_mockingbird
  description: Attempts to detect system changes made by Blue Mockingbird
  condition: ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine] =~ ['.*COR.*PROFILER'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1112,t1047
  exttype: SIEM
- name: blue_mockingbird
  description: Attempts to detect system changes made by Blue Mockingbird
  condition: (([TargetObject] =~ ['.*.*CurrentControlSet.*Services.*wercplsupport.*Parameters.*ServiceDll']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1112,t1047
  exttype: SIEM
- name: lockergoga_ransomware
  description: Detects LockerGoga Ransomware command line.
  condition: ([CommandLine] =~ ['.*.*i.*SM.*tgytutrc.*.*s.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,impact,t1486
  exttype: SIEM
- name: octopus_scanner_malware
  description: Detects Octopus Scanner Malware.
  condition: (([TargetFilename] =~ ['.*.*AppData.*Local.*Microsoft.*Cache134.dat'])
    || ([TargetFilename] =~ ['.*.*AppData.*Local.*Microsoft.*ExplorerSync.db']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1195,001
  exttype: SIEM
- name: flowcloud_malware
  description: Detects FlowCloud malware from threat group TA410.
  condition: (([TargetObject] =~ ['HKLM.*HARDWARE.*.*804423C2.*F490.*4ac3.*BFA5.*13DEDE63A71A.*'])
    || ([TargetObject] =~ ['HKLM.*HARDWARE.*.*A5124AF5.*DF23.*49bf.*B0ED.*A18ED3DEA027.*'])
    || ([TargetObject] =~ ['HKLM.*HARDWARE.*.*2DB80286.*1784.*48b5.*A751.*B6ED1F490303.*']))
    || (([TargetObject] =~ ['HKLM.*SYSTEM.*Setup.*PrintResponsor.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1112
  exttype: SIEM
- name: registry_entries_for_azorult_malware
  description: Detects the presence of a registry key created during Azorult execution
  condition: (([EventID] == 12) || ([EventID] == 13)) && ([TargetObject] =~ ['.*SYSTEM.*.*.*'])
    && ([TargetObject] =~ ['.*.*services.*localNETService'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1112
  exttype: SIEM
- name: ursnif
  description: Detects new registry key created by Ursnif malware.
  condition: ([TargetObject] =~ ['.*.*Software.*AppDataLow.*Software.*Microsoft.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1112
  exttype: SIEM
- name: darkside_ransomware_pattern
  description: Detects DarkSide Ransomware and helpers
  condition: (([CommandLine] =~ ['.*=.*char.*.*byte.*.*.*0x.*.*.*']) || ([CommandLine]
    =~ ['.*.*.*work.*worker0.*.*path.*.*'])) || (([ParentCommandLine] =~ ['.*DllHost.exe.*.*Processid.*.*3E5FC7F9.*9A51.*4367.*9063.*A120244FBEC7.*.*']))
    && (([Image] =~ ['.*.*AppData.*Local.*Temp.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: ryuk_ransomware
  description: Detects Ryuk Ransomware command lines
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*stop.*']) && (([CommandLine] =~ ['.*samss.*']) || ([CommandLine] =~ ['.*audioendpointbuilder.*'])
    || ([CommandLine] =~ ['.*unistoresvc.*.*.*.*.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: suspicious_scripting_in_a_wmi_consumer
  description: Detects suspicious scripting in WMI Event Consumers
  condition: ([EventID] == 20) && ([Destination] =~ ['.*new.*object.*']) && ([Destination]
    =~ ['.*net.webclient.*']) && ([Destination] =~ ['.*.downloadstring.*']) || ([Destination]
    =~ ['.*new.*object.*']) && ([Destination] =~ ['.*net.webclient.*']) && ([Destination]
    =~ ['.*.downloadfile.*']) || (([Destination] =~ ['.*.*iex.*.*']) || ([Destination]
    =~ ['.*WScript.shell.*']) || ([Destination] =~ ['.*.*.*nop.*.*']) || ([Destination]
    =~ ['.*.*.*noprofile.*.*']) || ([Destination] =~ ['.*.*.*decode.*.*']) || ([Destination]
    =~ ['.*.*.*enc.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1086,execution,t1059,005
  exttype: SIEM
- name: wmi_event_subscription
  description: Detects creation of WMI event subscription persistence method
  condition: (([EventID] == 19) || ([EventID] == 20) || ([EventID] == 21))
  level: high
  ruletype: EVALUATE
  tags: attack,t1084,persistence,t1546,003
  exttype: SIEM
- name: windows_defender_exclusions_added
  description: Detects the Setting of Windows Defender Exclusions
  condition: (([EventID] == 13)) && (([TargetObject] =~ ['.*.*Microsoft.*Windows.*Defender.*Exclusions.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: windows_defender_threat_detection_disabled
  description: Detects disabling Windows Defender threat protection
  condition: ([EventType] == ['SetValue']) && ([TargetObject] == ['HKLM\SOFTWARE\Policies\Microsoft\Windows
    Defender\DisableAntiSpyware']) && ([Details] == ['DWORD (0x00000001)'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: windows_defender_threat_detection_disabled
  description: Detects disabling Windows Defender threat protection
  condition: ([EventID] == 7036) && message =~ 'Windows.*Defender.*Antivirus.*Service'
    && message =~ 'stopped'
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: ldap_reconnaissance___active_directory_enumeration
  description: Detects possible Active Directory enumeration via LDAP
  condition: ([EventID] == 30) && (([SearchFilter] =~ ['.*.*groupType.*1.2.840.113556.1.4.803.*=2147483648.*.*'])
    || ([SearchFilter] =~ ['.*.*groupType.*1.2.840.113556.1.4.803.*=2147483656.*.*'])
    || ([SearchFilter] =~ ['.*.*groupType.*1.2.840.113556.1.4.803.*=2147483652.*.*'])
    || ([SearchFilter] =~ ['.*.*groupType.*1.2.840.113556.1.4.803.*=2147483650.*.*'])
    || ([SearchFilter] =~ ['.*.*sAMAccountType=805306369.*.*']) || ([SearchFilter]
    =~ ['.*.*sAMAccountType=805306368.*.*']) || ([SearchFilter] =~ ['.*.*sAMAccountType=536870913.*.*'])
    || ([SearchFilter] =~ ['.*.*sAMAccountType=536870912.*.*']) || ([SearchFilter]
    =~ ['.*.*sAMAccountType=268435457.*.*']) || ([SearchFilter] =~ ['.*.*sAMAccountType=268435456.*.*'])
    || ([SearchFilter] =~ ['.*.*objectCategory=groupPolicyContainer.*.*']) || ([SearchFilter]
    =~ ['.*.*objectCategory=organizationalUnit.*.*']) || ([SearchFilter] =~ ['.*.*objectCategory=Computer.*.*'])
    || ([SearchFilter] =~ ['.*.*objectCategory=nTDSDSA.*.*']) || ([SearchFilter] =~
    ['.*.*objectCategory=server.*.*']) || ([SearchFilter] =~ ['.*.*objectCategory=domain.*.*'])
    || ([SearchFilter] =~ ['.*.*objectCategory=person.*.*']) || ([SearchFilter] =~
    ['.*.*objectCategory=group.*.*']) || ([SearchFilter] =~ ['.*.*objectCategory=user.*.*'])
    || ([SearchFilter] =~ ['.*.*objectClass=trustedDomain.*.*']) || ([SearchFilter]
    =~ ['.*.*objectClass=computer.*.*']) || ([SearchFilter] =~ ['.*.*objectClass=server.*.*'])
    || ([SearchFilter] =~ ['.*.*objectClass=group.*.*']) || ([SearchFilter] =~ ['.*.*objectClass=user.*.*'])
    || ([SearchFilter] =~ ['.*.*primaryGroupID=521.*.*']) || ([SearchFilter] =~ ['.*.*primaryGroupID=516.*.*'])
    || ([SearchFilter] =~ ['.*.*primaryGroupID=515.*.*']) || ([SearchFilter] =~ ['.*.*primaryGroupID=512.*.*'])
    || ([SearchFilter] =~ ['.*Domain.*Admins.*'])) && ([EventID] == 30) && (([SearchFilter]
    !~ ['.*.*domainSid=.*.*.*']) || ([SearchFilter] !~ ['.*.*objectSid=.*.*.*']))
    || ([EventID] == 30) && (([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=4194304.*.*'])
    || ([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=2097152.*.*'])
    || ([SearchFilter] =~ ['.*.*.*userAccountControl.*1.2.840.113556.1.4.803.*=1048574.*.*'])
    || ([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=524288.*.*'])
    || ([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=65536.*.*'])
    || ([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=8192.*.*'])
    || ([SearchFilter] =~ ['.*.*userAccountControl.*1.2.840.113556.1.4.803.*=544.*.*'])
    || ([SearchFilter] =~ ['.*.*.*UserAccountControl.*1.2.840.113556.1.4.803.*=2.*.*'])
    || ([SearchFilter] =~ ['.*msDS.*AllowedToActOnBehalfOfOtherIdentity.*']) || ([SearchFilter]
    =~ ['.*msDS.*AllowedToDelegateTo.*']) || ([SearchFilter] =~ ['.*.*accountExpires=9223372036854775807.*.*'])
    || ([SearchFilter] =~ ['.*.*accountExpires=0.*.*']) || ([SearchFilter] =~ ['.*.*adminCount=1.*.*'])
    || ([SearchFilter] =~ ['.*ms.*MCS.*AdmPwd.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1069,002,t1087,t1482
  exttype: SIEM
- name: psexec_tool_execution
  description: Detects PsExec service installation and execution events (service and
    Sysmon)
  condition: ([Image] =~ ['.*.*PSEXESVC.exe']) && ([User] == ['NT AUTHORITY\SYSTEM'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1035,t1569,002,s0029
  exttype: SIEM
- name: psexec_tool_execution
  description: Detects PsExec service installation and execution events (service and
    Sysmon)
  condition: ([PipeName] == ['\PSEXESVC'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1035,t1569,002,s0029
  exttype: SIEM
- name: psexec_tool_execution
  description: Detects PsExec service installation and execution events (service and
    Sysmon)
  condition: ([TargetFilename] =~ ['.*.*PSEXESVC.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1035,t1569,002,s0029
  exttype: SIEM
- name: outlook_c2_macro_creation
  description: Detects the creation of a macro file for Outlook. Goes with win_outlook_c2_registry_key.
    VbaProject.OTM is explicitly mentioned in T1137. Particularly interesting if both
    events Registry & File Creation happens at the same time.
  condition: ([TargetFilename] =~ ['.*.*Microsoft.*Outlook.*VbaProject.OTM'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,command_and_control,t1137,t1008,t1546
  exttype: SIEM
- name: files_dropped_to_program_files_by_non_priviledged_process
  description: Search for dropping of files to Windows/Program Files fodlers by non-priviledged
    processes
  condition: ([IntegrityLevel] == ['Medium']) && (([TargetFilename] =~ ['.*.*Program.*Files.*.*.*'])
    || ([TargetFilename] =~ ['.*.*Program.*Files.*.*x86.*.*.*.*'])) || ([TargetFilename]
    =~ ['.*Windows.*.*.*']) && ([TargetFilename] !~ ['.*temp.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,t1574,010
  exttype: SIEM
- name: suspcious_clr_logs_creation
  description: Detects suspicious .NET assembly executions
  condition: ([TargetFilename] =~ ['.*.*AppData.*Local.*Microsoft.*CLR.*']) && ([TargetFilename]
    =~ ['.*.*UsageLogs.*.*.*']) && (([TargetFilename] =~ ['.*mshta.*']) || ([TargetFilename]
    =~ ['.*cscript.*']) || ([TargetFilename] =~ ['.*wscript.*']) || ([TargetFilename]
    =~ ['.*regsvr32.*']) || ([TargetFilename] =~ ['.*wmic.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: powershell_profile_ps1_modification
  description: Detects a change in profile.ps1 of the Powershell profile
  condition: ([TargetFilename] =~ ['.*.*profile.ps1.*']) && ([TargetFilename] =~ ['.*.*My.*Documents.*PowerShell.*.*.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*System32.*WindowsPowerShell.*v1.0.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1546,013
  exttype: SIEM
- name: dumpert_process_dumper
  description: Detects the use of Dumpert process dumper, which dumps the lsass.exe
    process memory
  condition: ([Imphash] == ['09D278F9DE118EF09163C6140255C690'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: dumpert_process_dumper
  description: Detects the use of Dumpert process dumper, which dumps the lsass.exe
    process memory
  condition: ([TargetFilename] == ['C:\Windows\Temp\dumpert.dmp'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: suspicious_pfx_file_creation
  description: A general detection for processes creating PFX files. This could be
    an indicator of an adversary exporting a local certificate to a PFX file.
  condition: ([TargetFilename] =~ ['.*.pfx'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1552,004
  exttype: SIEM
- name: suspicious_desktopimgdownldr_target_file
  description: Detects a suspicious Microsoft desktopimgdownldr file creation that
    stores a file to a suspicious location or contains a file with a suspicious extension
  condition: ([Image] =~ ['.*svchost.exe']) && ([TargetFilename] =~ ['.*.*Personalization.*LockScreenImage.*.*.*'])
    && ([TargetFilename] !~ ['.*C.*.*Windows.*.*.*']) && (([TargetFilename] !~ ['.*.jpg.*'])
    || ([TargetFilename] !~ ['.*.jpeg.*']) || ([TargetFilename] !~ ['.*.png.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1105
  exttype: SIEM
- name: suspicious_adsi_cache_usage_by_unknown_tool
  description: Detects the usage of ADSI (LDAP) operations by tools. This may also
    detect tools like LDAPFragger.
  condition: ([TargetFilename] =~ ['.*.*Local.*Microsoft.*Windows.*SchCache.*.*.*'])
    && ([TargetFilename] =~ ['.*.sch']) && (([Image] !~ ['C.*.*windows.*system32.*svchost.exe'])
    || ([Image] !~ ['C.*.*windows.*system32.*dllhost.exe']) || ([Image] !~ ['C.*.*windows.*system32.*mmc.exe'])
    || ([Image] !~ ['C.*.*windows.*system32.*WindowsPowerShell.*v1.0.*powershell.exe'])
    || ([Image] !~ ['C.*.*Windows.*CCM.*CcmExec.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1071,t1001,003,command_and_control
  exttype: SIEM
- name: file_created_with_system_process_name
  description: Detects the creation of a executable with a system process name in
    a suspicious folder
  condition: (([TargetFilename] =~ ['.*.*svchost.exe']) || ([TargetFilename] =~ ['.*.*rundll32.exe'])
    || ([TargetFilename] =~ ['.*.*services.exe']) || ([TargetFilename] =~ ['.*.*powershell.exe'])
    || ([TargetFilename] =~ ['.*.*regsvr32.exe']) || ([TargetFilename] =~ ['.*.*spoolsv.exe'])
    || ([TargetFilename] =~ ['.*.*lsass.exe']) || ([TargetFilename] =~ ['.*.*smss.exe'])
    || ([TargetFilename] =~ ['.*.*csrss.exe']) || ([TargetFilename] =~ ['.*.*conhost.exe'])
    || ([TargetFilename] =~ ['.*.*wininit.exe']) || ([TargetFilename] =~ ['.*.*lsm.exe'])
    || ([TargetFilename] =~ ['.*.*winlogon.exe']) || ([TargetFilename] =~ ['.*.*explorer.exe'])
    || ([TargetFilename] =~ ['.*.*taskhost.exe']) || ([TargetFilename] =~ ['.*.*Taskmgr.exe'])
    || ([TargetFilename] =~ ['.*.*taskmgr.exe']) || ([TargetFilename] =~ ['.*.*sihost.exe'])
    || ([TargetFilename] =~ ['.*.*RuntimeBroker.exe']) || ([TargetFilename] =~ ['.*.*runtimebroker.exe'])
    || ([TargetFilename] =~ ['.*.*smartscreen.exe']) || ([TargetFilename] =~ ['.*.*dllhost.exe'])
    || ([TargetFilename] =~ ['.*.*audiodg.exe']) || ([TargetFilename] =~ ['.*.*wlanext.exe']))
    && (([TargetFilename] !~ ['C.*.*Windows.*System32.*.*.*']) || ([TargetFilename]
    !~ ['C.*.*Windows.*system32.*.*.*']) || ([TargetFilename] !~ ['C.*.*Windows.*SysWow64.*.*.*'])
    || ([TargetFilename] !~ ['C.*.*Windows.*SysWOW64.*.*.*']) || ([TargetFilename]
    !~ ['C.*.*Windows.*winsxs.*.*.*']) || ([TargetFilename] !~ ['C.*.*Windows.*WinSxS.*.*.*'])
    || ([TargetFilename] !~ ['.*SystemRoot.*System32.*.*.*'])) && (([Image] !~ ['.*.*Windows.*System32.*dism.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,005
  exttype: SIEM
- name: redmimicry_winnti_playbook_dropped_file
  description: Detects actions caused by the RedMimicry Winnti playbook
  condition: (([TargetFilename] =~ ['.*gthread.*3.6.dll.*']) || ([TargetFilename]
    =~ ['.*sigcmm.*2.4.dll.*']) || ([TargetFilename] =~ ['.*.*Windows.*Temp.*tmp.bat.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027
  exttype: SIEM
- name: malicious_powershell_commandlet_names
  description: Detects the creation of known powershell scripts for exploitation
  condition: (([TargetFilename] =~ ['.*.*Invoke.*DllInjection.ps1']) || ([TargetFilename]
    =~ ['.*.*Invoke.*WmiCommand.ps1']) || ([TargetFilename] =~ ['.*.*Get.*GPPPassword.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*Keystrokes.ps1']) || ([TargetFilename] =~ ['.*.*Get.*VaultCredential.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*CredentialInjection.ps1']) || ([TargetFilename]
    =~ ['.*.*Invoke.*Mimikatz.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*NinjaCopy.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*TokenManipulation.ps1']) || ([TargetFilename]
    =~ ['.*.*Out.*Minidump.ps1']) || ([TargetFilename] =~ ['.*.*VolumeShadowCopyTools.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*ReflectivePEInjection.ps1']) || ([TargetFilename]
    =~ ['.*.*Get.*TimedScreenshot.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*UserHunter.ps1'])
    || ([TargetFilename] =~ ['.*.*Find.*GPOLocation.ps1']) || ([TargetFilename] =~
    ['.*.*Invoke.*ACLScanner.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*DowngradeAccount.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*ServiceUnquoted.ps1']) || ([TargetFilename]
    =~ ['.*.*Get.*ServiceFilePermission.ps1']) || ([TargetFilename] =~ ['.*.*Get.*ServicePermission.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*ServiceAbuse.ps1']) || ([TargetFilename]
    =~ ['.*.*Install.*ServiceBinary.ps1']) || ([TargetFilename] =~ ['.*.*Get.*RegAutoLogon.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*VulnAutoRun.ps1']) || ([TargetFilename] =~
    ['.*.*Get.*VulnSchTask.ps1']) || ([TargetFilename] =~ ['.*.*Get.*UnattendedInstallFile.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*WebConfig.ps1']) || ([TargetFilename] =~ ['.*.*Get.*ApplicationHost.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*RegAlwaysInstallElevated.ps1']) || ([TargetFilename]
    =~ ['.*.*Get.*Unconstrained.ps1']) || ([TargetFilename] =~ ['.*.*Add.*RegBackdoor.ps1'])
    || ([TargetFilename] =~ ['.*.*Add.*ScrnSaveBackdoor.ps1']) || ([TargetFilename]
    =~ ['.*.*Gupt.*Backdoor.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*ADSBackdoor.ps1'])
    || ([TargetFilename] =~ ['.*.*Enabled.*DuplicateToken.ps1']) || ([TargetFilename]
    =~ ['.*.*Invoke.*PsUaCme.ps1']) || ([TargetFilename] =~ ['.*.*Remove.*Update.ps1'])
    || ([TargetFilename] =~ ['.*.*Check.*VM.ps1']) || ([TargetFilename] =~ ['.*.*Get.*LSASecret.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*PassHashes.ps1']) || ([TargetFilename] =~ ['.*.*Show.*TargetScreen.ps1'])
    || ([TargetFilename] =~ ['.*.*Port.*Scan.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*PoshRatHttp.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*PowerShellTCP.ps1']) || ([TargetFilename]
    =~ ['.*.*Invoke.*PowerShellWMI.ps1']) || ([TargetFilename] =~ ['.*.*Add.*Exfiltration.ps1'])
    || ([TargetFilename] =~ ['.*.*Add.*Persistence.ps1']) || ([TargetFilename] =~
    ['.*.*Do.*Exfiltration.ps1']) || ([TargetFilename] =~ ['.*.*Start.*CaptureServer.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*ShellCode.ps1']) || ([TargetFilename] =~
    ['.*.*Get.*ChromeDump.ps1']) || ([TargetFilename] =~ ['.*.*Get.*ClipboardContents.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*FoxDump.ps1']) || ([TargetFilename] =~ ['.*.*Get.*IndexedItem.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*Screenshot.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*Inveigh.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*NetRipper.ps1']) || ([TargetFilename] =~
    ['.*.*Invoke.*EgressCheck.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*PostExfil.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*PSInject.ps1']) || ([TargetFilename] =~
    ['.*.*Invoke.*RunAs.ps1']) || ([TargetFilename] =~ ['.*.*MailRaider.ps1']) ||
    ([TargetFilename] =~ ['.*.*New.*HoneyHash.ps1']) || ([TargetFilename] =~ ['.*.*Set.*MacAttribute.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*DCSync.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*PowerDump.ps1'])
    || ([TargetFilename] =~ ['.*.*Exploit.*Jboss.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*ThunderStruck.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*VoiceTroll.ps1']) || ([TargetFilename] =~
    ['.*.*Set.*Wallpaper.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*InveighRelay.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*PsExec.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*SSHCommand.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*SecurityPackages.ps1']) || ([TargetFilename]
    =~ ['.*.*Install.*SSP.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*BackdoorLNK.ps1'])
    || ([TargetFilename] =~ ['.*.*PowerBreach.ps1']) || ([TargetFilename] =~ ['.*.*Get.*SiteListPassword.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*System.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*BypassUAC.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*Tater.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*WScriptBypassUAC.ps1'])
    || ([TargetFilename] =~ ['.*.*PowerUp.ps1']) || ([TargetFilename] =~ ['.*.*PowerView.ps1'])
    || ([TargetFilename] =~ ['.*.*Get.*RickAstley.ps1']) || ([TargetFilename] =~ ['.*.*Find.*Fruit.ps1'])
    || ([TargetFilename] =~ ['.*.*HTTP.*Login.ps1']) || ([TargetFilename] =~ ['.*.*Find.*TrustedDocuments.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*Paranoia.ps1']) || ([TargetFilename] =~
    ['.*.*Invoke.*WinEnum.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*ARPScan.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*PortScan.ps1']) || ([TargetFilename] =~
    ['.*.*Invoke.*ReverseDNSLookup.ps1']) || ([TargetFilename] =~ ['.*.*Invoke.*SMBScanner.ps1'])
    || ([TargetFilename] =~ ['.*.*Invoke.*Mimikittenz.ps1']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: startup_folder_file_write
  description: A General detection for files being created in the Windows startup
    directory. This could be an indicator of persistence.
  condition: ([TargetFilename] =~ ['.*ProgramData.*Microsoft.*Windows.*Start.*Menu.*Programs.*StartUp.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,persistence,t1547,001
  exttype: SIEM
- name: typical_hivenightmare_sam_file_export
  description: Detects files written by the different tools that exploit HiveNightmare
  condition: (([TargetFilename] =~ ['.*.*hive.*sam.*.*']) || ([TargetFilename] =~
    ['.*.*SAM.*2021.*.*']) || ([TargetFilename] =~ ['.*.*SAM.*2022.*.*']) || ([TargetFilename]
    =~ ['.*.*SAM.*haxx.*']) || ([TargetFilename] =~ ['.*.*Sam.save.*'])) || (([TargetFilename]
    =~ ['C.*.*windows.*temp.*sam']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1552,001
  exttype: SIEM
- name: windows_webshell_creation
  description: Possible webshell file creation on a static web site
  condition: ([TargetFilename] =~ ['.*.*inetpub.*wwwroot.*.*.*']) && (([TargetFilename]
    =~ ['.*.asp.*']) || ([TargetFilename] =~ ['.*.ashx.*']) || ([TargetFilename] =~
    ['.*.ph.*'])) && (([TargetFilename] !~ ['.*.*AppData.*Local.*Temp.*.*.*']) ||
    ([TargetFilename] !~ ['.*.*Windows.*Temp.*.*.*'])) || (([TargetFilename] =~ ['.*.*www.*.*.*'])
    || ([TargetFilename] =~ ['.*.*htdocs.*.*.*']) || ([TargetFilename] =~ ['.*.*html.*.*.*']))
    && ([TargetFilename] =~ ['.*.ph.*']) && (([TargetFilename] !~ ['.*.*AppData.*Local.*Temp.*.*.*'])
    || ([TargetFilename] !~ ['.*.*Windows.*Temp.*.*.*'])) || ([TargetFilename] =~
    ['.*.jsp']) || ([TargetFilename] =~ ['.*.*cgi.*bin.*.*.*']) && ([TargetFilename]
    =~ ['.*.pl.*']) && (([TargetFilename] !~ ['.*.*AppData.*Local.*Temp.*.*.*']) ||
    ([TargetFilename] !~ ['.*.*Windows.*Temp.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1100,t1505,003
  exttype: SIEM
- name: microsoft_office_add_in_loading
  description: Detects add-ins that load when Microsoft Word or Excel starts (.wll/.xll
    are simply .dll fit for Word or Excel).
  condition: ([TargetFilename] =~ ['.*.*Microsoft.*Word.*Startup.*.*.*']) && ([TargetFilename]
    =~ ['.*.wll']) || ([TargetFilename] =~ ['.*.*Microsoft.*Excel.*Startup.*.*.*'])
    && ([TargetFilename] =~ ['.*.xll']) || ([TargetFilename] =~ ['.*.*Microsoft.*Addins.*.*.*'])
    && (([TargetFilename] =~ ['.*.xlam']) || ([TargetFilename] =~ ['.*.xla']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1137,006
  exttype: SIEM
- name: quarkspwdump_dump_file
  description: Detects a dump file written by QuarksPwDump password dumper
  condition: ([TargetFilename] =~ ['.*.*AppData.*Local.*Temp.*SAM.*.*']) && ([TargetFilename]
    =~ ['.*.dmp.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002
  exttype: SIEM
- name: pcre_net_package_temp_files
  description: Detects processes creating temp files related to PCRE.NET package
  condition: ([TargetFilename] =~ ['.*.*AppData.*Local.*Temp.*ba9ea7344a4a5f591d6e5dc32a13494b.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059
  exttype: SIEM
- name: suspicious_desktop_ini_action
  description: Detects unusual processes accessing desktop.ini, which can be leveraged
    to alter how Explorer displays a folder's content (i.e. renaming files) without
    changing them on disk.
  condition: ([TargetFilename] =~ ['.*.*desktop.ini']) && (([Image] !~ ['C.*.*Windows.*explorer.exe'])
    || ([Image] !~ ['C.*.*Windows.*System32.*msiexec.exe']) || ([Image] !~ ['C.*.*Windows.*System32.*mmc.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1023,t1547,009
  exttype: SIEM
- name: suspicious_procexp152_sys_file_created_in_tmp
  description: Detects the creation of the PROCEXP152.sys file in the application-data
    local temporary folder. This driver is used by Sysinternals Process Explorer but
    also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs),
    which uses KDU.
  condition: ([TargetFilename] =~ ['.*.*AppData.*Local.*Temp.*.*.*']) && ([TargetFilename]
    =~ ['.*PROCEXP152.sys']) && (([Image] !~ ['.*.*procexp64.exe.*']) || ([Image]
    !~ ['.*.*procexp.exe.*']) || ([Image] !~ ['.*.*procmon64.exe.*']) || ([Image]
    !~ ['.*.*procmon.exe.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,t1089,t1562,001,defense_evasion
  exttype: SIEM
- name: cve_2021_1675_print_spooler_exploitation_filename_pattern
  description: Detects the default filename used in PoC code against print spooler
    vulnerability CVE-2021-1675
  condition: (([TargetFilename] =~ ['.*C.*.*Windows.*System32.*spool.*drivers.*x64.*3.*old.*1.*123.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*System32.*spool.*drivers.*x64.*3.*New.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,privilege_escalation
  exttype: SIEM
- name: powerup_write_hijack_dll
  description: "Powerup tool's Write Hijack DLL exploits DLL hijacking for privilege
    escalation.\nIn it's default mode, it builds a self deleting .bat file which executes
    malicious command. \nThe detection rule relies on creation of the malicious bat
    file (debug.bat by default).\n"
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([TargetFilename] =~ ['.*.bat'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,defense_evasion,t1574,001
  exttype: SIEM
- name: cred_dump_tools_dropped_files
  description: Files with well-known filenames (parts of credential dump software
    or files produced by them) creation
  condition: (([TargetFilename] =~ ['.*.*pwdump.*']) || ([TargetFilename] =~ ['.*.*kirbi.*'])
    || ([TargetFilename] =~ ['.*.*pwhashes.*']) || ([TargetFilename] =~ ['.*.*wce.*ccache.*'])
    || ([TargetFilename] =~ ['.*.*wce.*krbtkts.*']) || ([TargetFilename] =~ ['.*.*fgdump.*log.*']))
    && (([TargetFilename] =~ ['.*.*test.pwd']) || ([TargetFilename] =~ ['.*.*lsremora64.dll'])
    || ([TargetFilename] =~ ['.*.*lsremora.dll']) || ([TargetFilename] =~ ['.*.*fgexec.exe'])
    || ([TargetFilename] =~ ['.*.*wceaux.dll']) || ([TargetFilename] =~ ['.*.*SAM.out'])
    || ([TargetFilename] =~ ['.*.*SECURITY.out']) || ([TargetFilename] =~ ['.*.*SYSTEM.out'])
    || ([TargetFilename] =~ ['.*.*NTDS.out']) || ([TargetFilename] =~ ['.*.*DumpExt.dll'])
    || ([TargetFilename] =~ ['.*.*DumpSvc.exe']) || ([TargetFilename] =~ ['.*.*cachedump64.exe'])
    || ([TargetFilename] =~ ['.*.*cachedump.exe']) || ([TargetFilename] =~ ['.*.*pstgdump.exe'])
    || ([TargetFilename] =~ ['.*.*servpw.exe']) || ([TargetFilename] =~ ['.*.*servpw64.exe'])
    || ([TargetFilename] =~ ['.*.*pwdump.exe']) || ([TargetFilename] =~ ['.*.*procdump64.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,002,003,004,005
  exttype: SIEM
- name: detection_of_safetykatz
  description: Detects possible SafetyKatz Behaviour
  condition: ([TargetFilename] =~ ['.*.*Temp.*debug.bin'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: rclone_config_file_creation
  description: Detects Rclone config file being created
  condition: ([EventID] == 11) && ([TargetFilename] =~ ['.*.*.*Users.*.*.*']) && ([TargetFilename]
    =~ ['.*.*.config.*rclone.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1567,002
  exttype: SIEM
- name: cve_2021_26858_exchange_exploitation
  description: Detects possible successful exploitation for vulnerability described
    in CVE-2021-26858 by looking for | creation of non-standard files on disk by Exchange
    Serverâ€™s Unified Messaging service | which could indicate dropping web shells
    or other malicious content
  condition: ([Image] =~ ['.*UMWorkerProcess.exe']) && (([TargetFilename] !~ ['.*CacheCleanup.bin'])
    || ([TargetFilename] !~ ['.*.txt']) || ([TargetFilename] !~ ['.*.LOG']) || ([TargetFilename]
    !~ ['.*.cfg']) || ([TargetFilename] !~ ['.*cleanup.bin']))
  level: critical
  ruletype: EVALUATE
  tags: attack,t1203,execution
  exttype: SIEM
- name: hijack_legit_rdp_session_to_move_laterally
  description: Detects the usage of tsclient share to place a backdoor on the RDP
    source machine's startup folder
  condition: ([Image] =~ ['.*.*mstsc.exe']) && ([TargetFilename] =~ ['.*.*Microsoft.*Windows.*Start.*Menu.*Programs.*Startup.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: outlook_form_installation
  description: Detects the creation of new Outlook form which can contain malicious
    code
  condition: ([Image] == ['\outlook.exe']) && ([TargetFilename] =~ ['.*.*appdata.*local.*microsoft.*FORMS.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1137,003
  exttype: SIEM
- name: wmi_persistence___script_event_consumer_file_write
  description: Detects file writes of WMI script event consumer
  condition: ([Image] == ['C:\WINDOWS\system32\wbem\scrcons.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1084,t1546,003,persistence
  exttype: SIEM
- name: lsass_memory_dump_file_creation
  description: LSASS memory dump creation using operating systems utilities. Procdump
    will use process name in output file if no name is specified
  condition: ([TargetFilename] =~ ['.*lsass.*']) && ([TargetFilename] =~ ['.*dmp'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: abusable_invoke_athremotefxvgpudisablementcommand
  description: RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host
    executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).
  condition: ([CommandLine] =~ ['.*Invoke.*ATHRemoteFXvGPUDisablementCommand.*.*'])
    && (([CommandLine] =~ ['.*.*ModuleName.*.*']) || ([CommandLine] =~ ['.*.*ModulePath.*.*'])
    || ([CommandLine] =~ ['.*.*ScriptBlock.*.*']) || ([CommandLine] =~ ['.*.*RemoteFXvGPUDisablementFilePath.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: meterpreter_or_cobalt_strike_getsystem_service_installation
  description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting
    a specific service installation
  condition: ([ServiceFileName] =~ ['.*cmd.*']) && ([ServiceFileName] =~ ['.*.*c.*'])
    && ([ServiceFileName] =~ ['.*echo.*']) && ([ServiceFileName] =~ ['.*.*pipe.*.*.*'])
    || ([ServiceFileName] =~ ['.*.*COMSPEC.*.*']) && ([ServiceFileName] =~ ['.*.*c.*'])
    && ([ServiceFileName] =~ ['.*echo.*']) && ([ServiceFileName] =~ ['.*.*pipe.*.*.*'])
    || ([ServiceFileName] =~ ['.*cmd.exe.*']) && ([ServiceFileName] =~ ['.*.*c.*'])
    && ([ServiceFileName] =~ ['.*echo.*']) && ([ServiceFileName] =~ ['.*.*pipe.*.*.*'])
    || ([ServiceFileName] =~ ['.*rundll32.*']) && ([ServiceFileName] =~ ['.*.dll.*a.*'])
    && ([ServiceFileName] =~ ['.*.*p.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1134,001,002
  exttype: SIEM
- name: netntlm_downgrade_attack
  description: Detects NetNTLM downgrade attack
  condition: ([TargetObject] =~ ['.*SYSTEM.*.*.*']) && ([TargetObject] =~ ['.*ControlSet.*'])
    && ([TargetObject] =~ ['.*.*Control.*Lsa.*']) && (([TargetObject] =~ ['.*.*lmcompatibilitylevel'])
    || ([TargetObject] =~ ['.*.*NtlmMinClientSec']) || ([TargetObject] =~ ['.*.*RestrictSendingNTLMTraffic']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001,t1112
  exttype: SIEM
- name: tap_driver_installation
  description: Well-known TAP software installation. Possible preparation for data
    exfiltration using tunnelling techniques
  condition: ([ImagePath] =~ ['.*tap0901.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,t1048
  exttype: SIEM
- name: detected_windows_software_discovery
  description: Adversaries may attempt to enumerate software for a variety of reasons,
    such as figuring out what security measures are present or if the compromised
    system has a version of software that is vulnerable.
  condition: ([Image] =~ ['.*.*reg.exe']) && ([CommandLine] =~ ['.*query.*']) && ([CommandLine]
    =~ ['.*.*software.*.*.*']) && ([CommandLine] =~ ['.*.*v.*']) && ([CommandLine]
    =~ ['.*svcversion.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1518
  exttype: SIEM
- name: suspicious_werfault_exe_network_connection_outbound
  description: Adversaries can migrate cobalt strike/metasploit/C2 beacons on compromised
    systems to legitimate werfault.exe process to avoid detection.
  condition: ([Image] == ['werfault.exe']) && ([ParentImage] == ['svchost.exe']) &&
    (([DestinationIp] !~ ['104.42.151.234']) || ([DestinationIp] !~ ['104.43.193.48'])
    || ([DestinationIp] !~ ['52.255.188.83']) || ([DestinationIp] !~ ['13.64.90.137'])
    || ([DestinationIp] !~ ['168.61.161.212']) || ([DestinationIp] !~ ['13.88.21.125'])
    || ([DestinationIp] !~ ['40.88.32.150']) || ([DestinationIp] !~ ['52.147.198.201'])
    || ([DestinationIp] !~ ['52.239.207.100']) || ([DestinationIp] !~ ['52.176.224.96'])
    || ([DestinationIp] !~ ['2607.*7700.*0.*24.*0.*1.*287e.*1894']) || ([DestinationIp]
    !~ ['10..*']) || ([DestinationIp] !~ ['192.168..*']) || ([DestinationIp] !~ ['127..*']))
    && (([DestinationHostname] !~ ['.*.windowsupdate.com.*']) || ([DestinationHostname]
    !~ ['.*.microsoft.com.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,command_and_control,t1571
  exttype: SIEM
- name: mshta_suspicious_execution_01
  description: Detection for mshta.exe suspicious execution patterns sometimes involving
    file polyglotism
  condition: ([Image] =~ ['.*.*mshta.exe']) && (([CommandLine] =~ ['.*vbscript.*'])
    || ([CommandLine] =~ ['.*.jpg.*']) || ([CommandLine] =~ ['.*.png.*']) || ([CommandLine]
    =~ ['.*.lnk.*']) || ([CommandLine] =~ ['.*.xls.*']) || ([CommandLine] =~ ['.*.doc.*'])
    || ([CommandLine] =~ ['.*.zip.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1140,t1218,005
  exttype: SIEM
- name: mimikatz_use
  description: This method detects mimikatz keywords in different Eventlogs (some
    of them only appear in older Mimikatz version that are however still used by different
    threat groups)
  condition: message =~ 'mimikatz' || message =~ 'mimilib' || message =~ '.*3.*eo.oe'
    || message =~ 'eo.oe.kiwi' || message =~ 'privilege.*.*debug' || message =~ 'sekurlsa.*.*logonpasswords'
    || message =~ 'lsadump.*.*sam' || message =~ 'mimidrv.sys' || message =~ '.*p.*.*d.*'
    || message =~ '.*s.*.*l.*'
  level: critical
  ruletype: EVALUATE
  tags: attack,s0002,t1003,lateral_movement,credential_access,car,2013-07-001,2019-04-004,002,004,001,006
  exttype: SIEM
- name: moriya_rootkit
  description: Detects the use of Moriya rootkit as described in the securelist's
    Operation TunnelSnake report
  condition: ([TargetFilename] == ['C:\Windows\System32\drivers\MoriyaStreamWatchmen.sys'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1543,003
  exttype: SIEM
- name: credential_dumping_tools_service_execution
  description: Detects well-known credential dumping tools execution via service execution
    events
  condition: (([ServiceName] =~ ['.*fgexec.*']) || ([ServiceName] =~ ['.*wceservice.*'])
    || ([ServiceName] =~ ['.*wce.*service.*']) || ([ServiceName] =~ ['.*pwdump.*'])
    || ([ServiceName] =~ ['.*gsecdump.*']) || ([ServiceName] =~ ['.*cachedump.*'])
    || ([ServiceName] =~ ['.*mimikatz.*']) || ([ServiceName] =~ ['.*mimidrv.*']))
    || (([ImagePath] =~ ['.*fgexec.*']) || ([ImagePath] =~ ['.*dumpsvc.*']) || ([ImagePath]
    =~ ['.*cachedump.*']) || ([ImagePath] =~ ['.*mimidrv.*']) || ([ImagePath] =~ ['.*gsecdump.*'])
    || ([ImagePath] =~ ['.*servpw.*']) || ([ImagePath] =~ ['.*pwdump.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,execution,t1003,001,002,004,005,006,t1035,t1569,s0005
  exttype: SIEM
- name: mmc20_lateral_movement
  description: Detects MMC20.Application Lateral Movement; specifically looks for
    the spawning of the parent MMC.exe with a command line of "-Embedding" as a child
    of svchost.exe
  condition: ([ParentImage] =~ ['.*.*svchost.exe']) && ([Image] =~ ['.*.*mmc.exe'])
    && ([CommandLine] =~ ['.*.*Embedding.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1175,t1021,003
  exttype: SIEM
- name: root_certificate_installed
  description: Adversaries may install a root certificate on a compromised system
    to avoid warnings when connecting to adversary controlled web servers.
  condition: ([CommandLine] =~ ['.*root.*']) && ([Image] =~ ['.*.*certutil.exe'])
    && ([CommandLine] =~ ['.*.*addstore.*']) || ([Image] =~ ['.*.*CertMgr.exe']) &&
    ([CommandLine] =~ ['.*.*add.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1553,004
  exttype: SIEM
- name: mounted_windows_admin_shares_with_net_exe
  description: Detects when an admin share is mounted using net.exe
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*.*use.*.*']) && ([CommandLine] =~ ['.*.*.*.*.*.*.*.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1021,002
  exttype: SIEM
- name: zip_a_folder_with_powershell_for_staging_in_temp
  description: Use living off the land tools to zip a file and stage it in the Windows
    temporary folder for later exfiltration
  condition: ([CommandLine] =~ ['.*Compress.*Archive.*.*']) && ([CommandLine] =~ ['.*.*.*Path.*.*'])
    && ([CommandLine] =~ ['.*.*.*DestinationPath.*.*']) && ([CommandLine] =~ ['.*.*env.*TEMP.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1074,001
  exttype: SIEM
- name: rdp_over_reverse_ssh_tunnel
  description: Detects svchost hosting RDP termsvcs communicating with the loopback
    address and on TCP port 3389
  condition: ([Image] =~ ['.*.*svchost.exe']) && ([Initiated] == ['true']) && ([SourcePort]
    == 3389) && (([DestinationIp] =~ ['127..*'])) || (([DestinationIp] =~ ['.*.*1']))
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1572,lateral_movement,t1021,001,t1076,car,2013-07-002
  exttype: SIEM
- name: notepad_making_network_connection
  description: Detects suspicious network connection by Notepad
  condition: ([Image] =~ ['.*.*notepad.exe']) && ([DestinationPort] == ['9100'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,execution,defense_evasion,t1055
  exttype: SIEM
- name: dllhost_internet_connection
  description: Detects Dllhost that communicates with public IP addresses
  condition: ([Image] =~ ['.*.*dllhost.exe']) && ([Initiated] == ['true']) && (([DestinationIp]
    !~ ['10..*']) || ([DestinationIp] !~ ['192.168..*']) || ([DestinationIp] !~ ['172.16..*'])
    || ([DestinationIp] !~ ['172.17..*']) || ([DestinationIp] !~ ['172.18..*']) ||
    ([DestinationIp] !~ ['172.19..*']) || ([DestinationIp] !~ ['172.20..*']) || ([DestinationIp]
    !~ ['172.21..*']) || ([DestinationIp] !~ ['172.22..*']) || ([DestinationIp] !~
    ['172.23..*']) || ([DestinationIp] !~ ['172.24..*']) || ([DestinationIp] !~ ['172.25..*'])
    || ([DestinationIp] !~ ['172.26..*']) || ([DestinationIp] !~ ['172.27..*']) ||
    ([DestinationIp] !~ ['172.28..*']) || ([DestinationIp] !~ ['172.29..*']) || ([DestinationIp]
    !~ ['172.30..*']) || ([DestinationIp] !~ ['172.31..*']) || ([DestinationIp] !~
    ['127..*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,execution,t1559,001,t1175
  exttype: SIEM
- name: regsvr32_network_activity
  description: Detects network connections and DNS queries initiated by Regsvr32.exe
  condition: ([Image] =~ ['.*.*regsvr32.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1559,001,t1175,defense_evasion,t1218,010,t1117
  exttype: SIEM
- name: regsvr32_network_activity
  description: Detects network connections and DNS queries initiated by Regsvr32.exe
  condition: ([Image] =~ ['.*.*regsvr32.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1559,001,t1175,defense_evasion,t1218,010,t1117
  exttype: SIEM
- name: microsoft_binary_suspicious_communication_endpoint
  description: Detects an executable in the Windows folder accessing suspicious domains
  condition: ([Initiated] == ['true']) && (([DestinationHostname] =~ ['.*dl.dropboxusercontent.com'])
    || ([DestinationHostname] =~ ['.*.pastebin.com']) || ([DestinationHostname] =~
    ['.*.githubusercontent.com'])) && ([Image] =~ ['C.*.*Windows.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1105
  exttype: SIEM
- name: suspicious_typical_malware_back_connect_ports
  description: Detects programs that connect to typical malware back connect ports
    based on statistical analysis from two different sandbox system databases
  condition: ([Initiated] == ['true']) && (([DestinationPort] =~ ['4443']) || ([DestinationPort]
    =~ ['2448']) || ([DestinationPort] =~ ['8143']) || ([DestinationPort] =~ ['1777'])
    || ([DestinationPort] =~ ['1443']) || ([DestinationPort] =~ ['243']) || ([DestinationPort]
    =~ ['65535']) || ([DestinationPort] =~ ['13506']) || ([DestinationPort] =~ ['3360'])
    || ([DestinationPort] =~ ['200']) || ([DestinationPort] =~ ['198']) || ([DestinationPort]
    =~ ['49180']) || ([DestinationPort] =~ ['13507']) || ([DestinationPort] =~ ['6625'])
    || ([DestinationPort] =~ ['4444']) || ([DestinationPort] =~ ['4438']) || ([DestinationPort]
    =~ ['1904']) || ([DestinationPort] =~ ['13505']) || ([DestinationPort] =~ ['13504'])
    || ([DestinationPort] =~ ['12102']) || ([DestinationPort] =~ ['9631']) || ([DestinationPort]
    =~ ['5445']) || ([DestinationPort] =~ ['2443']) || ([DestinationPort] =~ ['777'])
    || ([DestinationPort] =~ ['13394']) || ([DestinationPort] =~ ['13145']) || ([DestinationPort]
    =~ ['12103']) || ([DestinationPort] =~ ['5552']) || ([DestinationPort] =~ ['3939'])
    || ([DestinationPort] =~ ['3675']) || ([DestinationPort] =~ ['666']) || ([DestinationPort]
    =~ ['473']) || ([DestinationPort] =~ ['5649']) || ([DestinationPort] =~ ['4455'])
    || ([DestinationPort] =~ ['4433']) || ([DestinationPort] =~ ['1817']) || ([DestinationPort]
    =~ ['100']) || ([DestinationPort] =~ ['65520']) || ([DestinationPort] =~ ['1960'])
    || ([DestinationPort] =~ ['1515']) || ([DestinationPort] =~ ['743']) || ([DestinationPort]
    =~ ['700']) || ([DestinationPort] =~ ['14154']) || ([DestinationPort] =~ ['14103'])
    || ([DestinationPort] =~ ['14102']) || ([DestinationPort] =~ ['12322']) || ([DestinationPort]
    =~ ['10101']) || ([DestinationPort] =~ ['7210']) || ([DestinationPort] =~ ['4040'])
    || ([DestinationPort] =~ ['9943'])) && ([Image] !~ ['.*.*Program.*Files.*']) ||
    (([DestinationIp] !~ ['10..*']) || ([DestinationIp] !~ ['192.168..*']) || ([DestinationIp]
    !~ ['172.16..*']) || ([DestinationIp] !~ ['172.17..*']) || ([DestinationIp] !~
    ['172.18..*']) || ([DestinationIp] !~ ['172.19..*']) || ([DestinationIp] !~ ['172.20..*'])
    || ([DestinationIp] !~ ['172.21..*']) || ([DestinationIp] !~ ['172.22..*']) ||
    ([DestinationIp] !~ ['172.23..*']) || ([DestinationIp] !~ ['172.24..*']) || ([DestinationIp]
    !~ ['172.25..*']) || ([DestinationIp] !~ ['172.26..*']) || ([DestinationIp] !~
    ['172.27..*']) || ([DestinationIp] !~ ['172.28..*']) || ([DestinationIp] !~ ['172.29..*'])
    || ([DestinationIp] !~ ['172.30..*']) || ([DestinationIp] !~ ['172.31..*']) ||
    ([DestinationIp] !~ ['127..*'])) && ([DestinationIsIpv6] == ['false'])
  level: medium
  ruletype: EVALUATE
  tags: attack,command_and_control,t1571,t1043
  exttype: SIEM
- name: silenttrinity_stager_msbuild_activity
  description: Detects a possible remote connections to Silenttrinity c2
  condition: ([ParentImage] =~ ['.*.*msbuild.exe']) && (([DestinationPort] =~ ['80'])
    || ([DestinationPort] =~ ['443'])) && ([Initiated] == ['true'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1127,001
  exttype: SIEM
- name: suspicious_outbound_rdp_connections
  description: Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible
    lateral movement
  condition: ([DestinationPort] == 3389) && ([Initiated] == ['true']) && (([Image]
    !~ ['.*.*mstsc.exe']) || ([Image] !~ ['.*.*RTSApp.exe']) || ([Image] !~ ['.*.*RTS2App.exe'])
    || ([Image] !~ ['.*.*RDCMan.exe']) || ([Image] !~ ['.*.*ws.*TunnelService.exe'])
    || ([Image] !~ ['.*.*RSSensor.exe']) || ([Image] !~ ['.*.*RemoteDesktopManagerFree.exe'])
    || ([Image] !~ ['.*.*RemoteDesktopManager.exe']) || ([Image] !~ ['.*.*RemoteDesktopManager64.exe'])
    || ([Image] !~ ['.*.*mRemoteNG.exe']) || ([Image] !~ ['.*.*mRemote.exe']) || ([Image]
    !~ ['.*.*Terminals.exe']) || ([Image] !~ ['.*.*spiceworks.*finder.exe']) || ([Image]
    !~ ['.*.*FSDiscovery.exe']) || ([Image] !~ ['.*.*FSAssessment.exe']) || ([Image]
    !~ ['.*.*MobaRTE.exe']) || ([Image] !~ ['.*.*chrome.exe']) || ([Image] !~ ['.*.*thor.exe'])
    || ([Image] !~ ['.*.*thor64.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1021,001,t1076,car,2013-07-002
  exttype: SIEM
- name: powershell_network_connections
  description: Detects a Powershell process that opens network connections - check
    for suspicious target ports and target systems - adjust to your environment (e.g.
    extend filters with company's ip range')
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([Initiated] == ['true']) && ([DestinationIsIpv6]
    == ['false']) && (([DestinationIp] !~ ['10..*']) || ([DestinationIp] !~ ['192.168..*'])
    || ([DestinationIp] !~ ['172.16..*']) || ([DestinationIp] !~ ['172.17..*']) ||
    ([DestinationIp] !~ ['172.18..*']) || ([DestinationIp] !~ ['172.19..*']) || ([DestinationIp]
    !~ ['172.20..*']) || ([DestinationIp] !~ ['172.21..*']) || ([DestinationIp] !~
    ['172.22..*']) || ([DestinationIp] !~ ['172.23..*']) || ([DestinationIp] !~ ['172.24..*'])
    || ([DestinationIp] !~ ['172.25..*']) || ([DestinationIp] !~ ['172.26..*']) ||
    ([DestinationIp] !~ ['172.27..*']) || ([DestinationIp] !~ ['172.28..*']) || ([DestinationIp]
    !~ ['172.29..*']) || ([DestinationIp] !~ ['172.30..*']) || ([DestinationIp] !~
    ['172.31..*']) || ([DestinationIp] !~ ['127.0.0.1.*'])) && ([DestinationIsIpv6]
    == ['false']) && ([User] == ['NT AUTHORITY\SYSTEM']) && ([User] !~ ['.*AUT.*'])
    && ([User] !~ ['.*.*NT.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: suspicious_outbound_kerberos_connection
  description: Detects suspicious outbound network activity via kerberos default port
    indicating possible lateral movement or first stage PrivEsc via delegation.
  condition: ([DestinationPort] == 88) && ([Initiated] == ['true']) && (([Image] !~
    ['.*.*lsass.exe']) || ([Image] !~ ['.*.*opera.exe']) || ([Image] !~ ['.*.*chrome.exe'])
    || ([Image] !~ ['.*.*firefox.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1558,t1208,lateral_movement,t1550,003,t1097
  exttype: SIEM
- name: remote_powershell_session
  description: Detects remote PowerShell connections by monitoring network outbound
    connections to ports 5985 or 5986 from a non-network service account.
  condition: (([DestinationPort] == 5985) || ([DestinationPort] == 5986)) && ([User]
    == ['NT AUTHORITY\NETWORK SERVICE'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086,lateral_movement,t1021,006,t1028
  exttype: SIEM
- name: microsoft_binary_github_communication
  description: Detects an executable in the Windows folder accessing github.com
  condition: ([Initiated] == ['true']) && (([DestinationHostname] =~ ['.*.github.com'])
    || ([DestinationHostname] =~ ['.*.githubusercontent.com'])) && ([Image] =~ ['C.*.*Windows.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1105,exfiltration,t1567,001,t1048
  exttype: SIEM
- name: rundll32_internet_connection
  description: Detects a rundll32 that communicates with public IP addresses
  condition: ([Image] =~ ['.*.*rundll32.exe']) && ([Initiated] == ['true']) && (([DestinationIp]
    !~ ['10..*']) || ([DestinationIp] !~ ['192.168..*']) || ([DestinationIp] !~ ['172.16..*'])
    || ([DestinationIp] !~ ['172.17..*']) || ([DestinationIp] !~ ['172.18..*']) ||
    ([DestinationIp] !~ ['172.19..*']) || ([DestinationIp] !~ ['172.20..*']) || ([DestinationIp]
    !~ ['172.21..*']) || ([DestinationIp] !~ ['172.22..*']) || ([DestinationIp] !~
    ['172.23..*']) || ([DestinationIp] !~ ['172.24..*']) || ([DestinationIp] !~ ['172.25..*'])
    || ([DestinationIp] !~ ['172.26..*']) || ([DestinationIp] !~ ['172.27..*']) ||
    ([DestinationIp] !~ ['172.28..*']) || ([DestinationIp] !~ ['172.29..*']) || ([DestinationIp]
    !~ ['172.30..*']) || ([DestinationIp] !~ ['172.31..*']) || ([DestinationIp] !~
    ['127..*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011,t1085,execution
  exttype: SIEM
- name: suspicious_program_location_with_network_connections
  description: Detects programs with network connections running in suspicious files
    system locations
  condition: (([Image] =~ ['.*.*Users.*All.*Users.*.*.*']) || ([Image] =~ ['.*.*Users.*Default.*.*.*'])
    || ([Image] =~ ['.*.*Users.*Public.*.*.*']) || ([Image] =~ ['.*.*Users.*Contacts.*.*.*'])
    || ([Image] =~ ['.*.*Users.*Searches.*.*.*']) || ([Image] =~ ['.*.*config.*systemprofile.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*Fonts.*.*.*']) || ([Image] =~ ['.*.*Windows.*IME.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*addins.*.*.*'])) || (([Image] =~ ['.*.*.*Recycle.bin']))
    || (([Image] =~ ['C.*.*Perflogs.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: wuauclt_network_connection
  description: Detects the use of the Windows Update Client binary (wuauclt.exe) to
    proxy execute code and making a network connections. One could easily make the
    DLL spawn a new process and inject to it to proxy the network connection and bypass
    this rule.
  condition: ([Image] =~ ['.*wuauclt.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: cmstp_execution_registry_event
  description: Detects various indicators of Microsoft Connection Manager Profile
    Installer execution
  condition: ([TargetObject] =~ ['.*.*cmmgr32.exe.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1191,t1218,003,g0069,car,2019-04-001
  exttype: SIEM
- name: uac_bypass_via_sdclt
  description: Detects changes to HKCU:\Software\Classes\exefile\shell\runas\command\isolatedCommand
  condition: ([TargetObject] =~ ['HKU.*.*.*']) && ([TargetObject] =~ ['.*.*Classes.*exefile.*shell.*runas.*command.*isolatedCommand'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1088,t1548,002,car,2019-04-001
  exttype: SIEM
- name: registry_persistence_via_explorer_run_key
  description: Detects a possible persistence mechanism using RUN key for Windows
    Explorer and pointing to a suspicious folder
  condition: ([TargetObject] =~ ['.*.*Microsoft.*Windows.*CurrentVersion.*Policies.*Explorer.*Run'])
    && (([Details] =~ ['C.*.*Windows.*Temp.*.*.*']) || ([Details] =~ ['C.*.*ProgramData.*.*.*'])
    || ([Details] =~ ['C.*.*.*Recycle.bin.*.*.*']) || ([Details] =~ ['C.*.*Temp.*.*.*'])
    || ([Details] =~ ['C.*.*Users.*Public.*.*.*']) || ([Details] =~ ['C.*.*Users.*Default.*.*.*']))
    || (([Details] =~ ['.*.*AppData.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1060,t1547,001
  exttype: SIEM
- name: disable_security_events_logging_adding_reg_key_minint
  description: Detects the addition of a key 'MiniNt' to the registry. Upon a reboot,
    Windows Event Log service will stopped write events.
  condition: ([TargetObject] == ['HKLM\SYSTEM\CurrentControlSet\Control\MiniNt'])
    && ([EventType] == ['CreateKey']) || ([NewName] == ['HKLM\SYSTEM\CurrentControlSet\Control\MiniNt'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001,t1112
  exttype: SIEM
- name: new_dll_added_to_appcertdlls_registry_key
  description: Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs
    value in the Registry key can be abused to obtain persistence and privilege escalation
    by causing a malicious DLL to be loaded and run in the context of separate processes
    on the computer.
  condition: ([TargetObject] == ['HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCertDlls'])
    || ([NewName] == ['HKLM\SYSTEM\CurentControlSet\Control\Session Manager\AppCertDlls'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1182,t1546,009
  exttype: SIEM
- name: rdp_registry_modification
  description: Detects potential malicious modification of the property value of fDenyTSConnections
    and UserAuthentication to enable remote desktop connections.
  condition: (([TargetObject] =~ ['.*.*CurrentControlSet.*Control.*Terminal.*Server.*WinStations.*RDP.*Tcp.*UserAuthentication'])
    || ([TargetObject] =~ ['.*.*CurrentControlSet.*Control.*Terminal.*Server.*fDenyTSConnections']))
    && ([Details] == ['DWORD (0x00000000)'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: disable_microsoft_office_security_features
  description: Disable Microsoft Office Security Features by registry
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Office.*.*.*'])
    && (([TargetObject] =~ ['.*VBAWarnings']) || ([TargetObject] =~ ['.*DisableInternetFilesInPV'])
    || ([TargetObject] =~ ['.*DisableUnsafeLocationsInPV']) || ([TargetObject] =~
    ['.*DisableAttachementsInPV'])) && ([Details] == ['DWORD (0x00000001)'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: logon_scripts__userinitmprlogonscript__registry
  description: Detects creation or execution of UserInitMprLogonScript persistence
    method
  condition: ([TargetObject] =~ ['.*UserInitMprLogonScript.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1037,001,persistence,lateral_movement
  exttype: SIEM
- name: portproxy_registry_key
  description: Detects the modification of PortProxy registry key which is used for
    port forwarding. For command execution see rule win_netsh_port_fwd.yml.
  condition: ([TargetObject] == ['HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PortProxy\v4tov4\tcp'])
  level: medium
  ruletype: EVALUATE
  tags: attack,lateral_movement,defense_evasion,command_and_control,t1090
  exttype: SIEM
- name: disable_tamper_protection_on_windows_defender
  description: Detects disabling Windows Defender Tamper Protection
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*HKLM.*SOFTWARE.*Microsoft.*Windows.*Defender.*Features.*TamperProtection.*'])
    && ([Details] == ['DWORD (0)'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: windows_credential_editor_registry
  description: Detects the use of Windows Credential Editor (WCE)
  condition: ([TargetObject] =~ ['.*Services.*WCESERVICE.*Start.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,s0005
  exttype: SIEM
- name: new_taskcache_entry
  description: Monitor the creation of a new key under 'TaskCache' when a new scheduled
    task is registered
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Schedule.*TaskCache.*Tree.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1053,005
  exttype: SIEM
- name: vbscript_payload_stored_in_registry
  description: Detects VBScript content stored into registry keys as seen being used
    by UNC2452 group
  condition: ([TargetObject] =~ ['.*Software.*Microsoft.*Windows.*CurrentVersion.*'])
    && (([Details] =~ ['.*vbscript.*']) || ([Details] =~ ['.*jscript.*']) || ([Details]
    =~ ['.*mshtml.*']) || ([Details] =~ ['.*mshtml.*.*']) || ([Details] =~ ['.*mshtml.*.*'])
    || ([Details] =~ ['.*RunHTMLApplication.*']) || ([Details] =~ ['.*Execute.*.*'])
    || ([Details] =~ ['.*CreateObject.*']) || ([Details] =~ ['.*RegRead.*']) || ([Details]
    =~ ['.*window.close.*'])) && ([TargetObject] !~ ['.*Software.*Microsoft.*Windows.*CurrentVersion.*Run.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: suspicious_keyboard_layout_load
  description: Detects the keyboard preload installation with a suspicious keyboard
    layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems
    maintained by US staff only
  condition: (([TargetObject] =~ ['.*.*Keyboard.*Layout.*Preload.*.*.*']) || ([TargetObject]
    =~ ['.*.*Keyboard.*Layout.*Substitutes.*.*.*'])) && (([Details] =~ ['.*00000429.*'])
    || ([Details] =~ ['.*00050429.*']) || ([Details] =~ ['.*0000042a.*']))
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: uac_bypass_via_wsreset
  description: Unfixed method for UAC bypass from windows 10. WSReset.exe file associated
    with the Windows Store. It will run a binary file contained in a low-privilege
    registry.
  condition: (([TargetObject] =~ ['.*.*AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2.*Shell.*open.*command']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1548,002
  exttype: SIEM
- name: pandemic_registry_key
  description: Detects Pandemic Windows Implant
  condition: ([TargetObject] =~ ['.*.*SYSTEM.*CurrentControlSet.*services.*null.*Instance.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1105
  exttype: SIEM
- name: pandemic_registry_key
  description: Detects Pandemic Windows Implant
  condition: ([CommandLine] =~ ['.*loaddll.*.*a.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1105
  exttype: SIEM
- name: wdigest_credguard_registry_modification
  description: Detects potential malicious modification of the property value of IsCredGuardEnabled
    from HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest to disable
    Cred Guard on a system. This is usually used with UseLogonCredential to manipulate
    the caching credentials.
  condition: ([TargetObject] =~ ['.*.*IsCredGuardEnabled'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: volume_shadow_copy_service_keys
  description: Detects the volume shadow copy service initialization and processing.
    Registry keys such as HKLM\\System\\CurrentControlSet\\Services\\VSS\\Diag\\VolSnap\\Volume
    are captured.
  condition: ([TargetObject] =~ ['.*System.*CurrentControlSet.*Services.*VSS.*'])
    && ([TargetObject] !~ ['.*System.*CurrentControlSet.*Services.*VSS.*Start.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002
  exttype: SIEM
- name: creation_of_a_local_hidden_user_account_by_registry
  description: Sysmon registry detection of a local hidden user account.
  condition: ([TargetObject] =~ ['HKLM.*SAM.*SAM.*Domains.*Account.*Users.*Names.*.*.*'])
    && ([TargetObject] =~ ['.*.*']) && ([Image] =~ ['.*lsass.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1136,001
  exttype: SIEM
- name: oceanlotus_registry_activity
  description: Detects registry keys created in OceanLotus (also known as APT32) attacks
  condition: (([TargetObject] =~ ['HKCR.*CLSID.*.*E08A0F4B.*1F65.*4D4D.*9A09.*BD4625B9C5A1.*.*Model']))
    && (([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppXbf13d4ea2945444d8b13e2121cb6b663.*Application'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppXbf13d4ea2945444d8b13e2121cb6b663.*DefaultIcon'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppX70162486c7554f7f80f481985d67586d.*Application'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppX70162486c7554f7f80f481985d67586d.*DefaultIcon'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppX37cc7fdccd644b4f85f4b22d5a3f105a.*Application'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*App.*AppX37cc7fdccd644b4f85f4b22d5a3f105a.*DefaultIcon']))
    || (([TargetObject] =~ ['HKU.*.*.*'])) && (([TargetObject] =~ ['.*.*Classes.*AppXc52346ec40fb4061ad96be0e6cb7d16a.*.*.*'])
    || ([TargetObject] =~ ['.*.*Classes.*AppX3bbba44c6cae4d9695755183472171e2.*.*.*'])
    || ([TargetObject] =~ ['.*.*Classes.*CLSID.*.*E3517E26.*8E93.*458D.*A6DF.*8030BC80528B.*.*.*.*'])
    || ([TargetObject] =~ ['.*.*Classes.*CLSID.*.*E08A0F4B.*1F65.*4D4D.*9A09.*BD4625B9C5A1.*.*Model.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: redmimicry_winnti_playbook_registry_manipulation
  description: Detects actions caused by the RedMimicry Winnti playbook
  condition: ([TargetObject] =~ ['.*HKLM.*SOFTWARE.*Microsoft.*HTMLHelp.*data.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: sysinternals_sdelete_registry_keys
  description: A General detection to trigger for the creation or modification of
    .*\Software\Sysinternals\SDelete registry keys. Indicators of the use of Sysinternals
    SDelete tool.
  condition: ([TargetObject] =~ ['.*.*Software.*Sysinternals.*SDelete.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,004
  exttype: SIEM
- name: stealthy_vsto_persistence
  description: Detects persistence via Visual Studio Tools for Office (VSTO) add-ins
    in Office applications.
  condition: ([EventType] == ['SetValue']) && (([TargetObject] =~ ['.*.*Software.*Microsoft.*Office.*Outlook.*Addins.*.*.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Office.*Word.*Addins.*.*.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Office.*Excel.*Addins.*.*.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Office.*Powerpoint.*Addins.*.*.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*VSTO.*Security.*Inclusion.*.*.*']))
    && ([Image] !~ ['.*.*msiexec.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1137,006,persistence
  exttype: SIEM
- name: windows_registry_persistence_com_search_order_hijacking
  description: Detects potential COM object hijacking leveraging the COM Search Order
  condition: ([TargetObject] =~ ['.*HKU.*.*.*']) && ([TargetObject] =~ ['.*.*Classes.*CLSID.*.*.*'])
    && ([TargetObject] =~ ['.*.*InProcServer32.*.*Default.*.*']) && (([Details] !~
    ['.*.*.*systemroot.*.*.*system32.*.*.*']) || ([Details] !~ ['.*.*.*systemroot.*.*.*SysWow64.*.*.*']))
    || ([Details] !~ ['.*.*AppData.*Local.*Microsoft.*OneDrive.*.*.*']) && (([Details]
    !~ ['.*.*FileCoAuthLib64.dll.*']) || ([Details] !~ ['.*.*FileSyncShell64.dll.*'])
    || ([Details] !~ ['.*.*FileSyncApi64.dll.*'])) || ([Details] !~ ['.*.*AppData.*Local.*Microsoft.*TeamsMeetingAddin.*.*.*'])
    && ([Details] !~ ['.*.*Microsoft.Teams.AddinLoader.dll.*']) || ([Details] !~ ['.*.*AppData.*Roaming.*Dropbox.*.*.*'])
    && ([Details] !~ ['.*.*DropboxExt64..*.dll.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1038,t1574,001
  exttype: SIEM
- name: run_once_task_configuration_in_registry
  description: Rule to detect the configuration of Run Once registry key. Configured
    payload can be run by runonce.exe /AlternateShellStartup
  condition: ([TargetObject] =~ ['HKLM.*SOFTWARE.*Microsoft.*Active.*Setup.*Installed.*Components.*'])
    && ([TargetObject] =~ ['.*.*StubPath'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: winekey_registry_modification
  description: Detects potential malicious modification of run keys by winekey or
    team9 backdoor
  condition: (([TargetObject] =~ ['.*Software.*Microsoft.*Windows.*CurrentVersion.*Run.*Backup.*Mgr']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1547
  exttype: SIEM
- name: com_hijack_via_sdclt
  description: Detects changes to 'HKCU\Software\Classes\Folder\shell\open\command\DelegateExecute'
  condition: (([TargetObject] =~ ['HKCU.*Software.*Classes.*Folder.*shell.*open.*command.*DelegateExecute']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1546,t1548
  exttype: SIEM
- name: registry_persistence_mechanisms
  description: Detects persistence registry keys
  condition: (([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*']))
    && ([TargetObject] =~ ['.*.*Image.*File.*Execution.*Options.*.*.*']) && ([TargetObject]
    =~ ['.*.*GlobalFlag.*']) || ([TargetObject] =~ ['.*SilentProcessExit.*.*.*'])
    && ([TargetObject] =~ ['.*.*ReportingMode.*']) || ([TargetObject] =~ ['.*SilentProcessExit.*.*.*'])
    && ([TargetObject] =~ ['.*.*MonitorProcess.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,persistence,defense_evasion,t1183,t1546,012,car,2013-01-002
  exttype: SIEM
- name: narrator_s_feedback_hub_persistence
  description: Detects abusing Windows 10 Narrator's Feedback-Hub
  condition: ([EventType] == ['DeleteValue']) && ([TargetObject] =~ ['.*.*AppXypsaf9f1qserqevf0sws76dx4k9a5206.*Shell.*open.*command.*DelegateExecute'])
    || ([TargetObject] =~ ['.*.*AppXypsaf9f1qserqevf0sws76dx4k9a5206.*Shell.*open.*command.*.*Default.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1060,t1547,001
  exttype: SIEM
- name: uac_bypass_via_event_viewer
  description: Detects UAC bypass method using Windows event viewer
  condition: ([TargetObject] =~ ['HKU.*.*.*']) && ([TargetObject] =~ ['.*.*mscfile.*shell.*open.*command'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1088,t1548,002,car,2019-04-001
  exttype: SIEM
- name: uac_bypass_via_event_viewer
  description: Detects UAC bypass method using Windows event viewer
  condition: ([ParentImage] =~ ['.*.*eventvwr.exe']) && ([Image] !~ ['.*.*mmc.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1088,t1548,002,car,2019-04-001
  exttype: SIEM
- name: printernightmare_mimimkatz_driver_name
  description: Detects static QMS 810 and mimikatz driver name used by Mimikatz as
    exploited in CVE-2021-1675 and CVE-2021-34527
  condition: (([TargetObject] =~ ['.*.*Control.*Print.*Environments.*Windows.*x64.*Drivers.*Version.*3.*QMS.*810.*.*.*'])
    || ([TargetObject] =~ ['.*.*Control.*Print.*Environments.*Windows.*x64.*Drivers.*Version.*3.*mimikatz.*']))
    || ([TargetObject] =~ ['.*legitprinter.*']) && ([TargetObject] =~ ['.*.*Control.*Print.*Environments.*Windows.*'])
    || (([TargetObject] =~ ['.*.*Control.*Print.*Environments.*']) || ([TargetObject]
    =~ ['.*.*CurrentVersion.*Print.*Printers.*'])) && (([TargetObject] =~ ['.*Gentil.*Kiwi.*'])
    || ([TargetObject] =~ ['.*mimikatz.*printer.*']) || ([TargetObject] =~ ['.*Kiwi.*Legit.*Printer.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: suspicious_service_installed
  description: Detects installation of NalDrv or PROCEXP152 services via registry-keys
    to non-system32 folders. Both services are used in the tool Ghost-In-The-Logs
    (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)
  condition: (([TargetObject] =~ ['HKLM.*System.*CurrentControlSet.*Services.*NalDrv.*ImagePath'])
    || ([TargetObject] =~ ['HKLM.*System.*CurrentControlSet.*Services.*PROCEXP152.*ImagePath']))
    && (([Image] !~ ['.*.*procexp64.exe']) || ([Image] !~ ['.*.*procexp.exe']) ||
    ([Image] !~ ['.*.*procmon64.exe']) || ([Image] !~ ['.*.*procmon.exe'])) && (([Details]
    !~ ['.*.*WINDOWS.*system32.*Drivers.*PROCEXP152.SYS.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,t1089,t1562,001,defense_evasion
  exttype: SIEM
- name: security_support_provider__ssp__added_to_lsa_configuration
  description: Detects the addition of a SSP to the registry. Upon a reboot or API
    call, SSP DLLs gain access to encrypted and plaintext passwords stored in Windows.
  condition: (([TargetObject] =~ ['HKLM.*System.*CurrentControlSet.*Control.*Lsa.*Security.*Packages'])
    || ([TargetObject] =~ ['HKLM.*System.*CurrentControlSet.*Control.*Lsa.*OSConfig.*Security.*Packages']))
    && ([Image] == ['C:\Windows\system32\msiexec.exe']) || ([Image] == ['C:\Windows\syswow64\MsiExec.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1101,t1547,005
  exttype: SIEM
- name: persistent_outlook_landing_pages
  description: Detects the manipulation of persistent URLs which could execute malicious
    code
  condition: (([TargetObject] =~ ['.*Software.*Microsoft.*Office.*.*.*']) || ([TargetObject]
    =~ ['.*.*Outlook.*Today.*.*.*'])) && (([TargetObject] =~ ['.*Stamp'])) && ([Details]
    == ['DWORD (0x00000001)']) || (([TargetObject] =~ ['.*UserDefinedUrl']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1112
  exttype: SIEM
- name: path_to_screensaver_binary_modified
  description: Detects value modification of registry key containing path to binary
    used as screensaver.
  condition: ([TargetObject] =~ ['.*.*Control.*Panel.*Desktop.*SCRNSAVE.EXE']) &&
    (([Image] !~ ['.*.*rundll32.exe']) || ([Image] !~ ['.*.*explorer.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1546,002
  exttype: SIEM
- name: disable_pua_protection_on_windows_defender
  description: Detects disabling Windows Defender PUA protection
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*HKLM.*SOFTWARE.*Policies.*Microsoft.*Windows.*Defender.*PUAProtection.*'])
    && ([Details] == ['DWORD (0x00000000)'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: removal_amsi_provider_reg_key
  description: Remove the AMSI Provider registry key in HKLM\Software\Microsoft\AMSI
    to disable AMSI inspection
  condition: ([EventType] == ['DeleteKey']) && (([TargetObject] =~ ['.*.*2781761E.*28E0.*4109.*99FE.*B9D127C57AFE.*'])
    || ([TargetObject] =~ ['.*.*A7C452EF.*8E9F.*42EB.*9F2B.*245613CA0DC9.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: powershell_as_a_service_in_registry
  description: Detects that a powershell code is written to the registry as a service.
  condition: ([TargetObject] =~ ['.*.*Services.*.*.*']) && ([TargetObject] =~ ['.*.*ImagePath'])
    && (([Details] =~ ['.*powershell.*']) || ([Details] =~ ['.*pwsh.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1569,002
  exttype: SIEM
- name: possible_privilege_escalation_via_service_permissions_weakness
  description: Detect modification of services configuration (ImagePath, FailureCommand
    and ServiceDLL) in registry by processes with Medium integrity level
  condition: ([IntegrityLevel] == ['Medium']) && ([TargetObject] =~ ['.*.*services.*.*.*'])
    && (([TargetObject] =~ ['.*.*ImagePath']) || ([TargetObject] =~ ['.*.*FailureCommand'])
    || ([TargetObject] =~ ['.*.*Parameters.*ServiceDll']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1058,t1574,011
  exttype: SIEM
- name: suspicious_run_key_from_download
  description: Detects the suspicious RUN keys created by software located in Download
    or temporary Outlook/Internet Explorer directories
  condition: (([Image] =~ ['.*.*Downloads.*.*.*']) || ([Image] =~ ['.*.*Temporary.*Internet.*Files.*Content.Outlook.*.*.*'])
    || ([Image] =~ ['.*.*Local.*Settings.*Temporary.*Internet.*Files.*.*.*'])) &&
    ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*Run.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1060,t1547,001
  exttype: SIEM
- name: suspicious_new_printer_ports_in_registry__cve_2020_1048_
  description: Detects a new and suspicious printer port creation in Registry that
    could be an attempt to exploit CVE-2020-1048
  condition: ([TargetObject] =~ ['HKLM.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Ports.*'])
    && (([Details] =~ ['.*.dll.*']) || ([Details] =~ ['.*.exe.*']) || ([Details] =~
    ['.*.bat.*']) || ([Details] =~ ['.*.com.*']) || ([Details] =~ ['.*C.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,execution,defense_evasion,t1112
  exttype: SIEM
- name: dns_serverlevelplugindll_install
  description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter
    in Registry, which can be used to execute code in context of the DNS server (restart
    required)
  condition: ([TargetObject] =~ ['.*.*services.*DNS.*Parameters.*ServerLevelPluginDll'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1073,t1574,002,t1112
  exttype: SIEM
- name: dns_serverlevelplugindll_install
  description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter
    in Registry, which can be used to execute code in context of the DNS server (restart
    required)
  condition: ([Image] =~ ['.*.*dnscmd.exe']) && ([CommandLine] =~ ['.*.*config.*'])
    && ([CommandLine] =~ ['.*.*serverlevelplugindll.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1073,t1574,002,t1112
  exttype: SIEM
- name: silentprocessexit_monitor_registrytion_for_lsass
  description: Detects changes to the Registry in which a monitor program gets registered
    to dump process memory of the lsass.exe process memory
  condition: ([TargetObject] =~ ['.*Microsoft.*Windows.*NT.*CurrentVersion.*SilentProcessExit.*lsass.exe.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,007
  exttype: SIEM
- name: execution_dll_of_choice_using_wab_exe
  description: This rule detects that the path to the DLL written in the registry
    is different from the default one. Launched WAB.exe tries to load the DLL from
    Registry.
  condition: ([TargetObject] =~ ['.*.*Software.*Microsoft.*WAB.*DLLPath']) && ([Details]
    == ['%CommonProgramFiles%\System\wab32.dll'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: disable_exploit_guard_network_protection_on_windows_defender
  description: Detects disabling Windows Defender Exploit Guard Network Protection
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*HKLM.*SOFTWARE.*Policies.*Microsoft.*Windows.*Defender.*Security.*Center.*App.*and.*Browser.*protection.*DisallowExploitProtectionOverride.*'])
    && ([Details] == ['DWORD (00000001)'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: atbroker_registry_change
  description: Detects creation/modification of Assisitive Technology applications
    and persistence with usage of ATs
  condition: ([TargetObject] =~ ['.*Software.*Microsoft.*Windows.*NT.*CurrentVersion.*Accessibility.*ATs.*'])
    || ([TargetObject] =~ ['.*Software.*Microsoft.*Windows.*NT.*CurrentVersion.*Accessibility.*Configuration.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,persistence,t1547
  exttype: SIEM
- name: silentprocessexit_monitor_registrytion
  description: Detects changes to the Registry in which a monitor program gets registered
    to monitor the exit of another process
  condition: ([TargetObject] =~ ['.*Microsoft.*Windows.*NT.*CurrentVersion.*SilentProcessExit.*'])
    && ([Details] =~ ['.*MonitorProcess.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1546,012
  exttype: SIEM
- name: sticky_key_like_backdoor_usage
  description: Detects the usage and installation of a backdoor that uses an option
    to register a malicious debugger for built-in tools that are accessible in the
    login screen
  condition: (([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*sethc.exe.*Debugger'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*utilman.exe.*Debugger'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*osk.exe.*Debugger'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*Magnify.exe.*Debugger'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*Narrator.exe.*Debugger'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Image.*File.*Execution.*Options.*DisplaySwitch.exe.*Debugger']))
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,persistence,t1015,t1546,008,car,2014-11-003,2014-11-008
  exttype: SIEM
- name: sticky_key_like_backdoor_usage
  description: Detects the usage and installation of a backdoor that uses an option
    to register a malicious debugger for built-in tools that are accessible in the
    login screen
  condition: ([ParentImage] =~ ['.*.*winlogon.exe']) && ([Image] =~ ['.*.*cmd.exe'])
    && (([CommandLine] =~ ['.*sethc.exe.*']) || ([CommandLine] =~ ['.*utilman.exe.*'])
    || ([CommandLine] =~ ['.*osk.exe.*']) || ([CommandLine] =~ ['.*Magnify.exe.*'])
    || ([CommandLine] =~ ['.*Narrator.exe.*']) || ([CommandLine] =~ ['.*DisplaySwitch.exe.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,persistence,t1015,t1546,008,car,2014-11-003,2014-11-008
  exttype: SIEM
- name: new_run_key_pointing_to_suspicious_folder
  description: Detects suspicious new RUN key element pointing to an executable in
    a suspicious folder
  condition: (([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*Run.*.*.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*RunOnce.*.*.*']))
    && (([Details] =~ ['.*C.*.*Windows.*Temp.*.*.*']) || ([Details] =~ ['.*C.*.*.*Recycle.bin.*.*.*'])
    || ([Details] =~ ['.*C.*.*Temp.*.*.*']) || ([Details] =~ ['.*C.*.*Users.*Public.*.*.*'])
    || ([Details] =~ ['.*C.*.*Users.*Default.*.*.*']) || ([Details] =~ ['.*C.*.*Users.*Desktop.*.*.*']))
    || (([Details] =~ ['.*Public.*.*.*.*']) || ([Details] =~ ['wscript.*']) || ([Details]
    =~ ['cscript.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1060,t1547,001
  exttype: SIEM
- name: wdigest_enable_uselogoncredential
  description: Detects potential malicious modification of the property value of UseLogonCredential
    from HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest to enable
    clear-text credentials
  condition: ([TargetObject] =~ ['.*WDigest.*UseLogonCredential'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: cobaltstrike_service_installations_in_registry
  description: Detects known malicious service installs that appear in cases in which
    a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch
    this by system log 7045 (https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_cobaltstrike_service_installs.yml)
    In some SIEM you can catch those events also in HKLM\System\ControlSet001\Services
    or HKLM\System\ControlSet002\Services, however, this rule is based on a regular
    sysmon's events.
  condition: ([EventType] == ['SetValue']) && ([TargetObject] =~ ['.*HKLM.*System.*CurrentControlSet.*Services.*'])
    && ([Details] =~ ['.*ADMIN.*.*']) && ([Details] =~ ['.*.exe.*']) || ([Details]
    =~ ['.*.*COMSPEC.*.*']) && ([Details] =~ ['.*start.*']) && ([Details] =~ ['.*powershell.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,privilege_escalation,lateral_movement,t1021,002,t1543,003,t1569
  exttype: SIEM
- name: registry_persistence_mechanism_via_windows_telemetry
  description: Detects persistence method using windows telemetry
  condition: ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*AppCompatFlags.*TelemetryController.*.*.*'])
    && ([TargetObject] =~ ['.*.*Command.*']) && ([Details] =~ ['.*.exe.*']) && (([Details]
    !~ ['.*.*system32.*CompatTelRunner.exe.*']) || ([Details] !~ ['.*.*system32.*DeviceCensus.exe.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1053,005
  exttype: SIEM
- name: dhcp_callout_dll_installation
  description: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled
    parameter in Registry, which can be used to execute code in context of the DHCP
    server (restart required)
  condition: (([TargetObject] =~ ['.*.*Services.*DHCPServer.*Parameters.*CalloutDlls'])
    || ([TargetObject] =~ ['.*.*Services.*DHCPServer.*Parameters.*CalloutEnabled']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1073,t1574,002,t1112
  exttype: SIEM
- name: dll_load_via_lsass
  description: Detects a method to load DLL via LSASS process using an undocumented
    Registry key
  condition: (([TargetObject] =~ ['.*.*CurrentControlSet.*Services.*NTDS.*DirectoryServiceExtPt.*'])
    || ([TargetObject] =~ ['.*.*CurrentControlSet.*Services.*NTDS.*LsaDbExtPt.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,persistence,t1177,t1547,008
  exttype: SIEM
- name: removal_of_potential_com_hijacking_registry_keys
  description: A General detection to trigger for processes removing .*\shell\open\command
    registry keys. Registry keys that might have been used for COM hijacking activities.
  condition: ([EventType] == ['DeleteKey']) && ([TargetObject] =~ ['.*.*shell.*open.*command'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: office_application_startup___office_test
  description: Detects the addition of office test registry that allows a user to
    specify an arbitrary DLL that will be executed every time an Office application
    is started
  condition: (([TargetObject] =~ ['HKEY.*CURRENT.*USER.*Software.*Microsoft.*Office.*test.*Special.*Perf'])
    || ([TargetObject] =~ ['HKEY.*LOCAL.*MACHINE.*Software.*Microsoft.*Office.*test.*Special.*Perf']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1137,002
  exttype: SIEM
- name: suspicious_printer_driver_empty_manufacturer
  description: Detects a suspicious printer driver installation with an empty Manufacturer
    value
  condition: ([TargetObject] =~ ['.*.*Control.*Print.*Environments.*Windows.*x64.*Drivers.*'])
    && ([TargetObject] =~ ['.*.*Manufacturer.*']) && ([Details] == ['(Empty)'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation
  exttype: SIEM
- name: suspicious_camera_and_microphone_access
  description: Detects Processes accessing the camera and microphone from suspicious
    folder
  condition: ([TargetObject] =~ ['.*.*Software.*Microsoft.*Windows.*CurrentVersion.*CapabilityAccessManager.*ConsentStore.*.*.*'])
    && ([TargetObject] =~ ['.*.*NonPackaged.*']) && (([TargetObject] =~ ['.*microphone.*'])
    || ([TargetObject] =~ ['.*webcam.*'])) && (([TargetObject] =~ ['.*.*C.*.*Windows.*Temp.*.*'])
    || ([TargetObject] =~ ['.*.*C.*.*.*Recycle.bin.*.*']) || ([TargetObject] =~ ['.*.*C.*.*Temp.*.*'])
    || ([TargetObject] =~ ['.*.*C.*.*Users.*Public.*.*']) || ([TargetObject] =~ ['.*.*C.*.*Users.*Default.*.*'])
    || ([TargetObject] =~ ['.*.*C.*.*Users.*Desktop.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,collection,t1125,t1123
  exttype: SIEM
- name: autorun_keys_modification
  description: Detects modification of autostart extensibility point (ASEP) in registry.
  condition: (([TargetObject] =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Windows.*CE.*Services.*AutoStart.*'])
    || ([TargetObject] =~ ['.*.*Software.*Wow6432Node.*Microsoft.*Command.*Processor.*Autorun.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Active.*Setup.*Installed.*Components.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CE.*Services.*AutoStartOnDisconnect.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CE.*Services.*AutoStartOnConnect.*'])
    || ([TargetObject] =~ ['.*.*SYSTEM.*Setup.*CmdLine.*']) || ([TargetObject] =~
    ['.*.*Software.*Microsoft.*Ctf.*LangBarAddin.*']) || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Command.*Processor.*Autorun.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Active.*Setup.*Installed.*Components.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Classes.*Protocols.*Handler.*']) || ([TargetObject]
    =~ ['.*.*SOFTWARE.*Classes.*Protocols.*Filter.*']) || ([TargetObject] =~ ['.*.*SOFTWARE.*Classes.*Htmlfile.*Shell.*Open.*Command.*.*Default.*.*'])
    || ([TargetObject] =~ ['.*.*Environment.*UserInitMprLogonScript.*']) || ([TargetObject]
    =~ ['.*.*SOFTWARE.*Policies.*Microsoft.*Windows.*Control.*Panel.*Desktop.*Scrnsave.exe.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Internet.*Explorer.*UrlSearchHooks.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Internet.*Explorer.*Desktop.*Components.*'])
    || ([TargetObject] =~ ['.*.*Software.*Classes.*Clsid.*.*AB8902B4.*09CA.*4bb6.*B78D.*A8F59079A8D5.*.*Inprocserver32.*'])
    || ([TargetObject] =~ ['.*.*Control.*Panel.*Desktop.*Scrnsave.exe.*'])) || ([TargetObject]
    =~ ['.*.*System.*CurrentControlSet.*Control.*Session.*Manager.*']) && (([TargetObject]
    =~ ['.*.*SetupExecute.*']) || ([TargetObject] =~ ['.*.*S0InitialCommand.*']) ||
    ([TargetObject] =~ ['.*.*KnownDlls.*']) || ([TargetObject] =~ ['.*.*Execute.*'])
    || ([TargetObject] =~ ['.*.*BootExecute.*']) || ([TargetObject] =~ ['.*.*AppCertDlls.*']))
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*'])
    && (([TargetObject] =~ ['.*.*ShellServiceObjectDelayLoad.*']) || ([TargetObject]
    =~ ['.*.*Run.*']) || ([TargetObject] =~ ['.*.*Policies.*System.*Shell.*']) ||
    ([TargetObject] =~ ['.*.*Policies.*Explorer.*Run.*']) || ([TargetObject] =~ ['.*.*Group.*Policy.*Scripts.*Startup.*'])
    || ([TargetObject] =~ ['.*.*Group.*Policy.*Scripts.*Shutdown.*']) || ([TargetObject]
    =~ ['.*.*Group.*Policy.*Scripts.*Logon.*']) || ([TargetObject] =~ ['.*.*Group.*Policy.*Scripts.*Logoff.*'])
    || ([TargetObject] =~ ['.*.*Explorer.*ShellServiceObjects.*']) || ([TargetObject]
    =~ ['.*.*Explorer.*ShellIconOverlayIdentifiers.*']) || ([TargetObject] =~ ['.*.*Explorer.*ShellExecuteHooks.*'])
    || ([TargetObject] =~ ['.*.*Explorer.*SharedTaskScheduler.*']) || ([TargetObject]
    =~ ['.*.*Explorer.*Browser.*Helper.*Objects.*']) || ([TargetObject] =~ ['.*.*Authentication.*PLAP.*Providers.*'])
    || ([TargetObject] =~ ['.*.*Authentication.*Credential.*Providers.*']) || ([TargetObject]
    =~ ['.*.*Authentication.*Credential.*Provider.*Filters.*'])) || ([TargetObject]
    =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*']) && (([TargetObject]
    =~ ['.*.*Winlogon.*VmApplet.*']) || ([TargetObject] =~ ['.*.*Winlogon.*Userinit.*'])
    || ([TargetObject] =~ ['.*.*Winlogon.*Taskman.*']) || ([TargetObject] =~ ['.*.*Winlogon.*Shell.*'])
    || ([TargetObject] =~ ['.*.*Winlogon.*GpExtensions.*']) || ([TargetObject] =~
    ['.*.*Winlogon.*AppSetup.*']) || ([TargetObject] =~ ['.*.*Winlogon.*AlternateShells.*AvailableShells.*'])
    || ([TargetObject] =~ ['.*.*Windows.*IconServiceLib.*']) || ([TargetObject] =~
    ['.*.*Windows.*Appinit.*Dlls.*']) || ([TargetObject] =~ ['.*.*Image.*File.*Execution.*Options.*'])
    || ([TargetObject] =~ ['.*.*Font.*Drivers.*']) || ([TargetObject] =~ ['.*.*Drivers32.*'])
    || ([TargetObject] =~ ['.*.*Windows.*Run.*']) || ([TargetObject] =~ ['.*.*Windows.*Load.*']))
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Windows.*CurrentVersion.*'])
    && (([TargetObject] =~ ['.*.*ShellServiceObjectDelayLoad.*']) || ([TargetObject]
    =~ ['.*.*Run.*']) || ([TargetObject] =~ ['.*.*Explorer.*ShellServiceObjects.*'])
    || ([TargetObject] =~ ['.*.*Explorer.*ShellIconOverlayIdentifiers.*']) || ([TargetObject]
    =~ ['.*.*Explorer.*ShellExecuteHooks.*']) || ([TargetObject] =~ ['.*.*Explorer.*SharedTaskScheduler.*'])
    || ([TargetObject] =~ ['.*.*Explorer.*Browser.*Helper.*Objects.*'])) || ([TargetObject]
    =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Windows.*NT.*CurrentVersion.*']) &&
    (([TargetObject] =~ ['.*.*Windows.*Appinit.*Dlls.*']) || ([TargetObject] =~ ['.*.*Image.*File.*Execution.*Options.*'])
    || ([TargetObject] =~ ['.*.*Drivers32.*'])) || ([TargetObject] =~ ['.*.*Software.*Wow6432Node.*Microsoft.*Office.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Office.*']) && (([TargetObject]
    =~ ['.*.*Word.*Addins.*']) || ([TargetObject] =~ ['.*.*PowerPoint.*Addins.*'])
    || ([TargetObject] =~ ['.*.*Outlook.*Addins.*']) || ([TargetObject] =~ ['.*.*Onenote.*Addins.*'])
    || ([TargetObject] =~ ['.*.*Excel.*Addins.*']) || ([TargetObject] =~ ['.*.*Access.*Addins.*'])
    || ([TargetObject] =~ ['.*test.*Special.*Perf.*'])) || ([TargetObject] =~ ['.*.*Software.*Wow6432Node.*Microsoft.*Internet.*Explorer.*'])
    || ([TargetObject] =~ ['.*.*Software.*Microsoft.*Internet.*Explorer.*']) && (([TargetObject]
    =~ ['.*.*Toolbar.*']) || ([TargetObject] =~ ['.*.*Extensions.*']) || ([TargetObject]
    =~ ['.*.*Explorer.*Bars.*'])) || ([TargetObject] =~ ['.*.*Software.*Wow6432Node.*Classes.*'])
    && (([TargetObject] =~ ['.*.*Folder.*ShellEx.*ExtShellFolderViews.*']) || ([TargetObject]
    =~ ['.*.*Folder.*ShellEx.*DragDropHandlers.*']) || ([TargetObject] =~ ['.*.*Folder.*ShellEx.*ColumnHandlers.*'])
    || ([TargetObject] =~ ['.*.*Directory.*Shellex.*DragDropHandlers.*']) || ([TargetObject]
    =~ ['.*.*Directory.*Shellex.*CopyHookHandlers.*']) || ([TargetObject] =~ ['.*.*CLSID.*.*AC757296.*3522.*4E11.*9862.*C17BE5A1767E.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*ABE3B9A4.*257D.*4B97.*BD1A.*294AF496222E.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*7ED96837.*96F0.*4812.*B211.*F13C24117ED3.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*083863F1.*70DE.*11d0.*BD40.*00A0C911CE86.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*AllFileSystemObjects.*ShellEx.*DragDropHandlers.*'])
    || ([TargetObject] =~ ['.*.*ShellEx.*PropertySheetHandlers.*']) || ([TargetObject]
    =~ ['.*.*ShellEx.*ContextMenuHandlers.*'])) || ([TargetObject] =~ ['.*.*Software.*Classes.*'])
    && (([TargetObject] =~ ['.*.*Folder.*ShellEx.*ExtShellFolderViews.*']) || ([TargetObject]
    =~ ['.*.*Folder.*ShellEx.*DragDropHandlers.*']) || ([TargetObject] =~ ['.*.*Folder.*Shellex.*ColumnHandlers.*'])
    || ([TargetObject] =~ ['.*.*Filter.*']) || ([TargetObject] =~ ['.*.*Exefile.*Shell.*Open.*Command.*.*Default.*.*'])
    || ([TargetObject] =~ ['.*.*Directory.*Shellex.*DragDropHandlers.*']) || ([TargetObject]
    =~ ['.*.*Directory.*Shellex.*CopyHookHandlers.*']) || ([TargetObject] =~ ['.*.*CLSID.*.*AC757296.*3522.*4E11.*9862.*C17BE5A1767E.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*ABE3B9A4.*257D.*4B97.*BD1A.*294AF496222E.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*7ED96837.*96F0.*4812.*B211.*F13C24117ED3.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*CLSID.*.*083863F1.*70DE.*11d0.*BD40.*00A0C911CE86.*.*Instance.*'])
    || ([TargetObject] =~ ['.*.*Classes.*AllFileSystemObjects.*ShellEx.*DragDropHandlers.*'])
    || ([TargetObject] =~ ['.*.*.exe.*']) || ([TargetObject] =~ ['.*.*.cmd.*']) ||
    ([TargetObject] =~ ['.*.*ShellEx.*PropertySheetHandlers.*']) || ([TargetObject]
    =~ ['.*.*ShellEx.*ContextMenuHandlers.*'])) || ([TargetObject] =~ ['.*.*Software.*Policies.*Microsoft.*Windows.*System.*Scripts.*'])
    && (([TargetObject] =~ ['.*.*Startup.*']) || ([TargetObject] =~ ['.*.*Shutdown.*'])
    || ([TargetObject] =~ ['.*.*Logon.*']) || ([TargetObject] =~ ['.*.*Logoff.*']))
    || ([TargetObject] =~ ['.*.*System.*CurrentControlSet.*Services.*WinSock2.*Parameters.*'])
    && (([TargetObject] =~ ['.*.*Protocol.*Catalog9.*Catalog.*Entries.*']) || ([TargetObject]
    =~ ['.*.*NameSpace.*Catalog5.*Catalog.*Entries.*'])) || ([TargetObject] =~ ['.*.*SYSTEM.*CurrentControlSet.*Control.*'])
    && (([TargetObject] =~ ['.*.*Terminal.*Server.*WinStations.*RDP.*Tcp.*InitialProgram.*'])
    || ([TargetObject] =~ ['.*.*Terminal.*Server.*Wds.*rdpwd.*StartupPrograms.*'])
    || ([TargetObject] =~ ['.*.*SecurityProviders.*SecurityProviders.*']) || ([TargetObject]
    =~ ['.*.*SafeBoot.*AlternateShell.*']) || ([TargetObject] =~ ['.*.*Print.*Providers.*'])
    || ([TargetObject] =~ ['.*.*Print.*Monitors.*']) || ([TargetObject] =~ ['.*.*NetworkProvider.*Order.*'])
    || ([TargetObject] =~ ['.*.*Lsa.*Notification.*Packages.*']) || ([TargetObject]
    =~ ['.*.*Lsa.*Authentication.*Packages.*']) || ([TargetObject] =~ ['.*.*BootVerificationProgram.*ImagePath.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1547,001,t1060
  exttype: SIEM
- name: hybridconnectionmanager_service_installation
  description: Detects the installation of the Azure Hybrid Connection Manager service
    to allow remote code execution from Azure function.
  condition: ([TargetObject] =~ ['.*.*Services.*HybridConnectionManager.*']) || ([Details]
    =~ ['.*Microsoft.HybridConnectionManager.Listener.exe.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence
  exttype: SIEM
- name: persistent_outlook_landing_pages
  description: Detects the manipulation of persistent URLs which can be malicious
  condition: (([TargetObject] =~ ['.*Software.*Microsoft.*Office.*.*.*']) || ([TargetObject]
    =~ ['.*Outlook.*WebView.*.*.*'])) && ([TargetObject] =~ ['.*URL']) && (([TargetObject]
    =~ ['.*Calendar.*']) || ([TargetObject] =~ ['.*Inbox.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1112
  exttype: SIEM
- name: new_application_in_appcompat
  description: A General detection for a new application in AppCompat. This indicates
    an application executing for the first time on an endpoint.
  condition: ([TargetObject] =~ ['.*.*AppCompatFlags.*Compatibility.*Assistant.*Store.*.*.*'])
  level: informational
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: usage_of_sysinternals_tools
  description: Detects the usage of Sysinternals Tools due to accepteula key being
    added to Registry
  condition: ([TargetObject] =~ ['.*.*EulaAccepted'])
  level: low
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: usage_of_sysinternals_tools
  description: Detects the usage of Sysinternals Tools due to accepteula key being
    added to Registry
  condition: ([CommandLine] =~ ['.*.*.*accepteula.*'])
  level: low
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: windows_registry_trust_record_modification
  description: Alerts on trust record modification within the registry, indicating
    usage of macros
  condition: ([TargetObject] =~ ['.*TrustRecords.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,initial_access,t1193,t1566,001
  exttype: SIEM
- name: windows_registry_persistence_com_key_linking
  description: Detects COM object hijacking via TreatAs subkey
  condition: ([EventType] == ['CreateKey']) && ([TargetObject] =~ ['.*HKU.*.*.*'])
    && ([TargetObject] =~ ['.*.*Classes.*CLSID.*.*.*']) && ([TargetObject] =~ ['.*.*TreatAs.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1122,t1546,015
  exttype: SIEM
- name: new_dll_added_to_appinit_dlls_registry_key
  description: DLLs that are specified in the AppInit_DLLs value in the Registry key
    HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll
    into every process that loads user32.dll
  condition: (([TargetObject] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Windows.*AppInit.*Dlls'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Windows.*NT.*CurrentVersion.*Windows.*AppInit.*Dlls']))
    || (([NewName] =~ ['.*.*SOFTWARE.*Microsoft.*Windows.*NT.*CurrentVersion.*Windows.*AppInit.*Dlls'])
    || ([NewName] =~ ['.*.*SOFTWARE.*Wow6432Node.*Microsoft.*Windows.*NT.*CurrentVersion.*Windows.*AppInit.*Dlls']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1103,t1546,010
  exttype: SIEM
- name: enabling_cor_profiler_environment_variables
  description: This rule detects cor_enable_profiling and cor_profiler environment
    variables being set and configured.
  condition: (([TargetObject] =~ ['.*.*COR.*ENABLE.*PROFILING']) || ([TargetObject]
    =~ ['.*.*COR.*PROFILER']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,defense_evasion,t1574,012
  exttype: SIEM
- name: rdp_sensitive_settings_changed
  description: Detects changes to RDP terminal service sensitive settings
  condition: (([TargetObject] =~ ['.*.*services.*TermService.*Parameters.*ServiceDll.*'])
    || ([TargetObject] =~ ['.*.*Control.*Terminal.*Server.*fSingleSessionPerUser.*'])
    || ([TargetObject] =~ ['.*.*Control.*Terminal.*Server.*fDenyTSConnections.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: outlook_c2_registry_key
  description: Detects the modification of Outlook Security Setting to allow unprompted
    execution. Goes with win_outlook_c2_macro_creation.yml and is particularly interesting
    if both events occur near to each other.
  condition: ([TargetObject] == ['HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Outlook\Security\Level'])
    && ([Details] =~ ['.*0x00000001.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,command_and_control,t1137,t1008,t1546
  exttype: SIEM
- name: complus_etwenabled_registry_modification
  description: Potential adversaries stopping ETW providers recording loaded .NET
    assemblies.
  condition: ([TargetObject] =~ ['.*SOFTWARE.*Microsoft.*.NETFramework.*ETWEnabled'])
    && ([Details] == ['DWORD (0x00000000)'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: office_security_settings_changed
  description: Detects registry changes to Office macro settings
  condition: (([TargetObject] =~ ['.*.*Security.*Trusted.*Documents.*TrustRecords'])
    || ([TargetObject] =~ ['.*.*Security.*AccessVBOM']) || ([TargetObject] =~ ['.*.*Security.*VBAWarnings']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: leviathan_registry_key_activity
  description: Detects registry key used by Leviathan APT in Malaysian focused campaign
  condition: ([TargetObject] == ['HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\ntkd'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1060,t1547,001
  exttype: SIEM
- name: suspicious_driver_load_from_temp
  description: Detects a driver load from a temporary directory
  condition: ([ImageLoaded] =~ ['.*.*Temp.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1050,t1543,003
  exttype: SIEM
- name: windivert_driver_load
  description: Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection
    package for Windows
  condition: (([ImageLoaded] =~ ['.*.*WinDivert.sys.*']) || ([ImageLoaded] =~ ['.*.*WinDivert64.sys.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,collection,defense_evasion,t1599,001,t1557
  exttype: SIEM
- name: vulnerable_dell_bios_update_driver_load
  description: Detects the load of the vulnerable Dell BIOS update driver as reported
    in CVE-2021-21551
  condition: ([ImageLoaded] =~ ['.*.*DBUtil.*2.*3.Sys.*']) || (([Hashes] =~ ['.*0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5.*'])
    || ([Hashes] =~ ['.*c948ae14761095e4d76b55d9de86412258be7afd.*']) || ([Hashes]
    =~ ['.*c996d7971c49252c582171d9380360f2.*']) || ([Hashes] =~ ['.*ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1.*'])
    || ([Hashes] =~ ['.*10b30bdee43b3a2ec4aa63375577ade650269d25.*']) || ([Hashes]
    =~ ['.*d2fd132ab7bbc6bbb87a84f026fa0244.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation
  exttype: SIEM
- name: raw_disk_access_using_illegitimate_tools
  description: Raw disk access using illegitimate tools, possible defence evasion
  condition: ([Device] !~ ['.*floppy.*']) && (([Image] !~ ['.*.*wmiprvse.exe']) ||
    ([Image] !~ ['.*.*sdiagnhost.exe']) || ([Image] !~ ['.*.*searchindexer.exe'])
    || ([Image] !~ ['.*.*csrss.exe']) || ([Image] !~ ['.*.*defrag.exe']) || ([Image]
    !~ ['.*.*smss.exe']) || ([Image] !~ ['.*.*vssvc.exe']) || ([Image] !~ ['.*.*compattelrunner.exe'])
    || ([Image] !~ ['.*.*wininit.exe']) || ([Image] !~ ['.*.*autochk.exe']) || ([Image]
    !~ ['.*.*taskhost.exe']) || ([Image] !~ ['.*.*dfsrs.exe']) || ([Image] !~ ['.*.*vds.exe'])
    || ([Image] !~ ['.*.*lsass.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1006
  exttype: SIEM
- name: alternate_powershell_hosts
  description: Detects alternate PowerShell hosts potentially bypassing detections
    looking for powershell.exe
  condition: ([Description] == ['System.Management.Automation']) && ([ImageLoaded]
    =~ ['.*System.Management.Automation.*']) && ([Image] !~ ['.*.*powershell.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: active_directory_kerberos_dll_loaded_via_office_applications
  description: Detects Kerberos DLL being loaded by an Office Product
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['.*.*kerberos.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: time_travel_debugging_utility_usage
  description: Detects usage of Time Travel Debugging Utility. Adversaries can execute
    malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
  condition: (([ImageLoaded] =~ ['.*.*ttdrecord.dll']) || ([ImageLoaded] =~ ['.*.*ttdwriter.dll'])
    || ([ImageLoaded] =~ ['.*.*ttdloader.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,credential_access,t1218,t1003,001
  exttype: SIEM
- name: time_travel_debugging_utility_usage
  description: Detects usage of Time Travel Debugging Utility. Adversaries can execute
    malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
  condition: (([ParentImage] =~ ['.*.*tttracer.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,credential_access,t1218,t1003,001
  exttype: SIEM
- name: abusing_azure_browser_sso
  description: Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens
    for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure
    AD and a user logs in with their Azure AD account) wanting to perform SSO authentication
    in the browser. An attacker can use this to authenticate to Azure AD in a browser
    as that user.
  condition: ([ImageLoaded] =~ ['.*MicrosoftAccountTokenProvider.dll']) && (([Image]
    !~ ['.*BackgroundTaskHost.exe']) || ([Image] !~ ['.*devenv.exe']) || ([Image]
    !~ ['.*iexplore.exe']) || ([Image] !~ ['.*MicrosoftEdge.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1073,t1574,002
  exttype: SIEM
- name: wmi_script_host_process_image_loaded
  description: Detects signs of the WMI script host process %SystemRoot%\system32\wbem\scrcons.exe
    functionality being used via images being loaded by a process.
  condition: ([Image] =~ ['.*.*scrcons.exe']) && (([ImageLoaded] =~ ['.*.*vbscript.dll'])
    || ([ImageLoaded] =~ ['.*.*wbemdisp.dll']) || ([ImageLoaded] =~ ['.*.*wshom.ocx'])
    || ([ImageLoaded] =~ ['.*.*scrrun.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,privilege_escalation,persistence,t1546,003
  exttype: SIEM
- name: dotnet_dll_loaded_via_office_applications
  description: Detects any assembly DLL being loaded by an Office Product
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['C.*.*Windows.*assembly.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: vba_dll_loaded_via_microsoft_word
  description: Detects DLL's Loaded Via Word Containing VBA Macros
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['.*.*VBE7.DLL']) || ([ImageLoaded] =~ ['.*.*VBEUI.DLL']) || ([ImageLoaded]
    =~ ['.*.*VBE7INTL.DLL']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: clr_dll_loaded_via_scripting_applications
  description: Detects CLR DLL being loaded by an scripting applications
  condition: (([Image] =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe'])
    || ([Image] =~ ['.*.*mshta.exe'])) && (([ImageLoaded] =~ ['.*.*clr.dll']) || ([ImageLoaded]
    =~ ['.*.*mscoree.dll']) || ([ImageLoaded] =~ ['.*.*mscorlib.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,privilege_escalation,t1055
  exttype: SIEM
- name: uipromptforcredentials_dlls
  description: Detects potential use of UIPromptForCredentials functions by looking
    for some of the DLLs needed for it.
  condition: (([ImageLoaded] =~ ['.*.*credui.dll']) || ([ImageLoaded] =~ ['.*.*wincredui.dll']))
    || (([OriginalFileName] =~ ['credui.dll']) || ([OriginalFileName] =~ ['wincredui.dll']))
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,collection,t1056,002
  exttype: SIEM
- name: windows_spooler_service_suspicious_binary_load
  description: Detect DLL Load from Spooler Service backup folder
  condition: ([Image] =~ ['.*spoolsv.exe']) && ([ImageLoaded] =~ ['.*.*Windows.*System32.*spool.*drivers.*x64.*3.*.*.*'])
    && ([ImageLoaded] =~ ['.*.dll'])
  level: informational
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,privilege_escalation,t1574
  exttype: SIEM
- name: svchost_dll_search_order_hijack
  description: IKEEXT and SessionEnv service, as they call LoadLibrary on files that
    do not exist within C:\Windows\System32\ by default. An attacker can place their
    malicious logic within the PROCESS_ATTACH block of their library and restart the
    aforementioned services "svchost.exe -k netsvcs" to gain code execution on a remote
    machine.
  condition: (([Image] =~ ['.*.*svchost.exe'])) && (([ImageLoaded] =~ ['.*.*tsmsisrv.dll'])
    || ([ImageLoaded] =~ ['.*.*tsvipsrv.dll']) || ([ImageLoaded] =~ ['.*.*wlbsctrl.dll']))
    && (([ImageLoaded] !~ ['C.*.*Windows.*WinSxS.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,t1073,t1574,002,t1038,001
  exttype: SIEM
- name: gac_dll_loaded_via_office_applications
  description: Detects any GAC DLL being loaded by an Office Product
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['C.*.*Windows.*Microsoft.NET.*assembly.*GAC.*MSIL.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: load_of_dbghelp_dbgcore_dll_from_suspicious_process
  description: Detects the load of dbghelp/dbgcore DLL (used to make memory dumps)
    by suspicious processes. Tools like ProcessHacker and some attacker tradecract
    use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example,
    SilentTrynity C2 Framework has a module that leverages this API to dump the contents
    of Lsass.exe and transfer it over the network back to the attacker's machine.
  condition: (([ImageLoaded] =~ ['.*.*dbghelp.dll']) || ([ImageLoaded] =~ ['.*.*dbgcore.dll']))
    && (([Image] =~ ['.*.*msbuild.exe']) || ([Image] =~ ['.*.*cmd.exe']) || ([Image]
    =~ ['.*.*svchost.exe']) || ([Image] =~ ['.*.*rundll32.exe']) || ([Image] =~ ['.*.*powershell.exe'])
    || ([Image] =~ ['.*.*word.exe']) || ([Image] =~ ['.*.*excel.exe']) || ([Image]
    =~ ['.*.*powerpnt.exe']) || ([Image] =~ ['.*.*outlook.exe']) || ([Image] =~ ['.*.*monitoringhost.exe'])
    || ([Image] =~ ['.*.*wmic.exe']) || ([Image] =~ ['.*.*bash.exe']) || ([Image]
    =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*mshta.exe'])
    || ([Image] =~ ['.*.*regsvr32.exe']) || ([Image] =~ ['.*.*schtasks.exe']) || ([Image]
    =~ ['.*.*dnx.exe']) || ([Image] =~ ['.*.*regsvcs.exe']) || ([Image] =~ ['.*.*sc.exe'])
    || ([Image] =~ ['.*.*scriptrunner.exe'])) && ([Image] !~ ['.*Visual.*Studio.*'])
    || (([ImageLoaded] =~ ['.*.*dbghelp.dll']) || ([ImageLoaded] =~ ['.*.*dbgcore.dll']))
    && ([Signed] == ['FALSE']) && ([Image] !~ ['.*Visual.*Studio.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: windows_management_instrumentation_dll_loaded_via_microsoft_word
  description: Detects DLL's Loaded Via Word Containing VBA Macros Executing WMI Commands
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['.*.*wmiutils.dll']) || ([ImageLoaded] =~ ['.*.*wbemcomn.dll']) || ([ImageLoaded]
    =~ ['.*.*wbemprox.dll']) || ([ImageLoaded] =~ ['.*.*wbemdisp.dll']) || ([ImageLoaded]
    =~ ['.*.*wbemsvc.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047
  exttype: SIEM
- name: unsigned_image_loaded_into_lsass_process
  description: Loading unsigned image (DLL, EXE) into LSASS process
  condition: ([Image] =~ ['.*.*lsass.exe']) && ([Signed] == ['false'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: powershell_execution
  description: Detects execution of PowerShell
  condition: ([Description] == ['System.Management.Automation']) && ([ImageLoaded]
    =~ ['.*System.Management.Automation.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: wmi_persistence___command_line_event_consumer
  description: Detects WMI command line event consumers
  condition: ([Image] == ['C:\Windows\System32\wbem\WmiPrvSE.exe']) && ([ImageLoaded]
    =~ ['.*.*wbemcons.dll'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1084,t1546,003,persistence
  exttype: SIEM
- name: pcre_net_package_image_load
  description: Detects processes loading modules related to PCRE.NET package
  condition: ([ImageLoaded] =~ ['.*.*AppData.*Local.*Temp.*ba9ea7344a4a5f591d6e5dc32a13494b.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059
  exttype: SIEM
- name: suspicious_system_drawing_load
  description: A General detection for processes loading System.Drawing.ni.dll. This
    could be an indicator of potential Screen Capture.
  condition: ([ImageLoaded] =~ ['.*.*System.Drawing.ni.dll']) && ([Image] !~ ['.*.*WmiPrvSE.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1113
  exttype: SIEM
- name: uac_bypass_with_fake_dll
  description: Attempts to load dismcore.dll after dropping it
  condition: (([Image] =~ ['.*.*dism.exe'])) && (([ImageLoaded] =~ ['.*.*dismcore.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,privilege_escalation,t1548,002,t1574
  exttype: SIEM
- name: suspicious_wsman_provider_image_loads
  description: Detects signs of potential use of the WSMAN provider from uncommon
    processes locally and remote execution.
  condition: (([ImageLoaded] =~ ['.*.*WsmSvc.dll']) || ([ImageLoaded] =~ ['.*.*WsmAuto.dll'])
    || ([ImageLoaded] =~ ['.*.*Microsoft.WSMan.Management.ni.dll'])) || (([OriginalFileName]
    =~ ['WsmSvc.dll']) || ([OriginalFileName] =~ ['WSMANAUTOMATION.DLL']) || ([OriginalFileName]
    =~ ['Microsoft.WSMan.Management.dll'])) && ([Image] !~ ['.*.*powershell.exe'])
    || ([Image] =~ ['.*.*svchost.exe']) && ([OriginalFileName] == ['WsmWmiPl.dll'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,lateral_movement,t1021,003
  exttype: SIEM
- name: possible_process_hollowing_image_loading
  description: Detects Loading of samlib.dll, WinSCard.dll from untypical process
    e.g. through process hollowing by Mimikatz
  condition: (([Image] =~ ['.*.*notepad.exe'])) && (([ImageLoaded] =~ ['.*.*samlib.dll'])
    || ([ImageLoaded] =~ ['.*.*WinSCard.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1073,t1574,002
  exttype: SIEM
- name: wmi_modules_loaded
  description: Detects non wmiprvse loading WMI modules
  condition: (([ImageLoaded] =~ ['.*.*wmiclnt.dll']) || ([ImageLoaded] =~ ['.*.*WmiApRpl.dll'])
    || ([ImageLoaded] =~ ['.*.*wmiprov.dll']) || ([ImageLoaded] =~ ['.*.*wmiutils.dll'])
    || ([ImageLoaded] =~ ['.*.*wbemcomn.dll']) || ([ImageLoaded] =~ ['.*.*wbemprox.dll'])
    || ([ImageLoaded] =~ ['.*.*WMINet.*Utils.dll']) || ([ImageLoaded] =~ ['.*.*wbemsvc.dll'])
    || ([ImageLoaded] =~ ['.*.*fastprox.dll'])) && (([Image] !~ ['.*.*WmiPrvSE.exe'])
    || ([Image] !~ ['.*.*WmiApSrv.exe']) || ([Image] !~ ['.*.*svchost.exe']) || ([Image]
    !~ ['.*.*DeviceCensus.exe']) || ([Image] !~ ['.*.*CompatTelRunner.exe']) || ([Image]
    !~ ['.*.*sdiagnhost.exe']) || ([Image] !~ ['.*.*SIHClient.exe']) || ([Image] !~
    ['.*.*ngentask.exe']) || ([Image] !~ ['.*.*windows.*system32.*taskhostw.exe'])
    || ([Image] !~ ['.*.*windows.*system32.*MoUsoCoreWorker.exe']) || ([Image] !~
    ['.*.*windows.*system32.*wbem.*WMIADAP.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047
  exttype: SIEM
- name: wmic_loading_scripting_libraries
  description: Detects threat actors proxy executing code and bypassing application
    controls by leveraging wmic and the `/FORMAT` argument switch to download and
    execute an XSL file (i.e js, vbs, etc).
  condition: ([Image] =~ ['.*.*wmic.exe']) && (([ImageLoaded] =~ ['.*.*jscript.dll'])
    || ([ImageLoaded] =~ ['.*.*vbscript.dll']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1220
  exttype: SIEM
- name: clr_dll_loaded_via_office_applications
  description: Detects CLR DLL being loaded by an Office Product
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['.*.*clr.dll.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: python_py2exe_image_load
  description: Detects the image load of Python Core indicative of a Python script
    bundled with Py2Exe.
  condition: ([Description] == ['Python Core'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027,002
  exttype: SIEM
- name: image_load_of_vss_ps_dll_by_uncommon_executable
  description: Detects the image load of vss_ps.dll by uncommon executables using
    OriginalFileName datapoint
  condition: (([ImageLoaded] =~ ['.*.*vss.*ps.dll'])) && (([Image] !~ ['.*.*svchost.exe'])
    || ([Image] !~ ['.*.*msiexec.exe']) || ([Image] !~ ['.*.*vssvc.exe']) || ([Image]
    !~ ['.*.*srtasks.exe']) || ([Image] !~ ['.*.*tiworker.exe']) || ([Image] !~ ['.*.*dllhost.exe'])
    || ([Image] !~ ['.*.*searchindexer.exe']) || ([Image] !~ ['.*dismhost.exe']) ||
    ([Image] !~ ['.*taskhostw.exe']) || ([Image] !~ ['.*.*clussvc.exe'])) && ([Image]
    !~ ['.*c.*.*windows.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,impact,t1490
  exttype: SIEM
- name: active_directory_parsing_dll_loaded_via_office_applications
  description: Detects DSParse DLL being loaded by an Office Product
  condition: (([Image] =~ ['.*.*winword.exe']) || ([Image] =~ ['.*.*powerpnt.exe'])
    || ([Image] =~ ['.*.*excel.exe']) || ([Image] =~ ['.*.*outlook.exe'])) && (([ImageLoaded]
    =~ ['.*.*dsparse.dll.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: in_memory_powershell
  description: Detects loading of essential DLL used by PowerShell, but not by the
    process powershell.exe. Detects meterpreter's "load powershell" extension.
  condition: (([ImageLoaded] =~ ['.*.*System.Management.Automation.Dll']) || ([ImageLoaded]
    =~ ['.*.*System.Management.Automation.ni.Dll'])) && (([Image] !~ ['.*.*powershell.exe'])
    || ([Image] !~ ['.*.*powershell.*ise.exe']) || ([Image] !~ ['.*.*WINDOWS.*System32.*sdiagnhost.exe'])
    || ([Image] !~ ['.*.*mscorsvw.exe']) || ([Image] !~ ['.*.*WINDOWS.*System32.*RemoteFXvGPUDisablement.exe'])
    || ([Image] !~ ['.*.*sqlps.exe']) || ([Image] !~ ['.*.*wsmprovhost.exe']) || ([Image]
    !~ ['.*.*winrshost.exe']) || ([Image] !~ ['.*.*syncappvpublishingserver.exe'])
    || ([Image] !~ ['.*.*runscripthelper.exe']) || ([Image] !~ ['.*.*ServerManager.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1086,t1059,001,execution
  exttype: SIEM
- name: fax_service_dll_search_order_hijack
  description: The Fax service attempts to load ualapi.dll, which is non-existent.
    An attacker can then (side)load their own malicious DLL using this service.
  condition: (([Image] =~ ['.*fxssvc.exe'])) && (([ImageLoaded] =~ ['.*ualapi.dll']))
    && (([ImageLoaded] !~ ['C.*.*Windows.*WinSxS.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,t1073,t1038,t1574,001,002
  exttype: SIEM
- name: suspicious_esentutl_use
  description: Detects flags often used with the LOLBAS Esentutl for malicious activity.
    It could be used in rare cases by administrators to access locked files or during
    maintenance.
  condition: ([CommandLine] =~ ['.*.*.*vss.*.*']) && ([CommandLine] =~ ['.*.*.*y.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,s0404,t1218
  exttype: SIEM
- name: mimikatz_detection_lsass_access
  description: Detects process access to LSASS which is typical for Mimikatz (0x1000
    PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION "only old
    versions", 0x0010 PROCESS_VM_READ)
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && (([GrantedAccess] =~ ['0x1410'])
    || ([GrantedAccess] =~ ['0x1010']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1003,s0002,credential_access,car,2019-04-004
  exttype: SIEM
- name: activity_related_to_ntds_dit_domain_hash_retrieval
  description: Detects suspicious commands that could be related to activity that
    uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely
  condition: (([CommandLine] =~ ['vssadmin.exe.*Delete.*Shadows']) || ([CommandLine]
    =~ ['vssadmin.*create.*shadow.*.*for=C.*']) || ([CommandLine] =~ ['copy.*.*.*.*.*GLOBALROOT.*Device.*.*.*.*windows.*ntds.*ntds.dit'])
    || ([CommandLine] =~ ['copy.*.*.*.*.*GLOBALROOT.*Device.*.*.*.*config.*SAM'])
    || ([CommandLine] =~ ['vssadmin.*delete.*shadows.*.*for=C.*']) || ([CommandLine]
    =~ ['reg.*SAVE.*HKLM.*SYSTEM.*']) || ([CommandLine] =~ ['esentutl.exe.*.*y.*.*vss.*.*.*ntds.dit.*'])
    || ([CommandLine] =~ ['esentutl.exe.*.*y.*.*vss.*.*.*SAM']) || ([CommandLine]
    =~ ['esentutl.exe.*.*y.*.*vss.*.*.*SYSTEM']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003
  exttype: SIEM
- name: cobaltstrike_process_injection
  description: Detects a possible remote threat creation with certain characteristics
    which are typical for Cobalt Strike beacons
  condition: (([TargetProcessAddress] =~ ['.*0B80']) || ([TargetProcessAddress] =~
    ['.*0C7C']) || ([TargetProcessAddress] =~ ['.*0C88']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1055,001
  exttype: SIEM
- name: suspicious_remote_thread_created
  description: Offensive tradecraft is switching away from using APIs like "CreateRemoteThread",
    however, this is still largely observed in the wild. This rule aims to detect
    suspicious processes (those we would not expect to behave in this way like word.exe
    or outlook.exe) creating remote threads on other processes. It is a generalistic
    rule, but it should have a low FP ratio due to the selected range of processes.
  condition: (([SourceImage] =~ ['.*.*bash.exe']) || ([SourceImage] =~ ['.*.*cvtres.exe'])
    || ([SourceImage] =~ ['.*.*defrag.exe']) || ([SourceImage] =~ ['.*.*dnx.exe'])
    || ([SourceImage] =~ ['.*.*esentutl.exe']) || ([SourceImage] =~ ['.*.*excel.exe'])
    || ([SourceImage] =~ ['.*.*expand.exe']) || ([SourceImage] =~ ['.*.*explorer.exe'])
    || ([SourceImage] =~ ['.*.*find.exe']) || ([SourceImage] =~ ['.*.*findstr.exe'])
    || ([SourceImage] =~ ['.*.*forfiles.exe']) || ([SourceImage] =~ ['.*.*git.exe'])
    || ([SourceImage] =~ ['.*.*gpupdate.exe']) || ([SourceImage] =~ ['.*.*hh.exe'])
    || ([SourceImage] =~ ['.*.*iexplore.exe']) || ([SourceImage] =~ ['.*.*installutil.exe'])
    || ([SourceImage] =~ ['.*.*lync.exe']) || ([SourceImage] =~ ['.*.*makecab.exe'])
    || ([SourceImage] =~ ['.*.*mDNSResponder.exe']) || ([SourceImage] =~ ['.*.*monitoringhost.exe'])
    || ([SourceImage] =~ ['.*.*msbuild.exe']) || ([SourceImage] =~ ['.*.*mshta.exe'])
    || ([SourceImage] =~ ['.*.*msiexec.exe']) || ([SourceImage] =~ ['.*.*mspaint.exe'])
    || ([SourceImage] =~ ['.*.*outlook.exe']) || ([SourceImage] =~ ['.*.*ping.exe'])
    || ([SourceImage] =~ ['.*.*powerpnt.exe']) || ([SourceImage] =~ ['.*.*powershell.exe'])
    || ([SourceImage] =~ ['.*.*provtool.exe']) || ([SourceImage] =~ ['.*.*python.exe'])
    || ([SourceImage] =~ ['.*.*regsvr32.exe']) || ([SourceImage] =~ ['.*.*robocopy.exe'])
    || ([SourceImage] =~ ['.*.*runonce.exe']) || ([SourceImage] =~ ['.*.*sapcimc.exe'])
    || ([SourceImage] =~ ['.*.*schtasks.exe']) || ([SourceImage] =~ ['.*.*smartscreen.exe'])
    || ([SourceImage] =~ ['.*.*spoolsv.exe']) || ([SourceImage] =~ ['.*.*tstheme.exe'])
    || ([SourceImage] =~ ['.*.*userinit.exe']) || ([SourceImage] =~ ['.*.*vssadmin.exe'])
    || ([SourceImage] =~ ['.*.*vssvc.exe']) || ([SourceImage] =~ ['.*.*w3wp.exe'])
    || ([SourceImage] =~ ['.*.*winlogon.exe']) || ([SourceImage] =~ ['.*.*winscp.exe'])
    || ([SourceImage] =~ ['.*.*wmic.exe']) || ([SourceImage] =~ ['.*.*word.exe'])
    || ([SourceImage] =~ ['.*.*wscript.exe'])) && ([SourceImage] !~ ['.*Visual.*Studio.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,defense_evasion,t1055
  exttype: SIEM
- name: cactustorch_remote_thread_creation
  description: Detects remote thread creation from CACTUSTORCH as described in references.
  condition: ([EventID] == 8) && (([SourceImage] =~ ['.*.*System32.*cscript.exe'])
    || ([SourceImage] =~ ['.*.*System32.*wscript.exe']) || ([SourceImage] =~ ['.*.*System32.*mshta.exe'])
    || ([SourceImage] =~ ['.*.*winword.exe']) || ([SourceImage] =~ ['.*.*excel.exe']))
    && ([TargetImage] =~ ['.*.*SysWOW64.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1093,t1055,012,execution,t1064,t1059,005,007,t1218
  exttype: SIEM
- name: accessing_winapi_in_powershell__code_injection_
  description: Detecting Code injection with PowerShell in another process
  condition: ([SourceImage] =~ ['.*.*powershell.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: createremotethread_api_and_loadlibrary
  description: Detects potential use of CreateRemoteThread api and LoadLibrary function
    to inject DLL into a process
  condition: ([StartModule] =~ ['.*.*kernel32.dll']) && ([StartFunction] == ['LoadLibraryA'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1055,001
  exttype: SIEM
- name: powershell_rundll32_remote_thread_creation
  description: Detects PowerShell remote thread creation in Rundll32.exe
  condition: ([EventID] == 8) && ([SourceImage] =~ ['.*.*powershell.exe']) && ([TargetImage]
    =~ ['.*.*rundll32.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1085,t1218,011,t1086,t1059,001
  exttype: SIEM
- name: password_dumper_remote_thread_in_lsass
  description: Detects password dumper activity by monitoring remote thread creation
    EventID 8 in combination with the lsass.exe process as TargetImage. The process
    in field Process is the malicious program. A single execution can lead to hundreds
    of events.
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([StartModule] == [''])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,s0005,001
  exttype: SIEM
- name: windows_powershell_web_request
  description: Detects the use of various web request methods (including aliases)
    via Windows PowerShell
  condition: (([CommandLine] =~ ['.*Invoke.*WebRequest.*']) || ([CommandLine] =~ ['.*iwr.*.*'])
    || ([CommandLine] =~ ['.*wget.*.*']) || ([CommandLine] =~ ['.*curl.*.*']) || ([CommandLine]
    =~ ['.*Net.WebClient.*']) || ([CommandLine] =~ ['.*Start.*BitsTransfer.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: sysinternals_sdelete_file_deletion
  description: A General detection to trigger for the deletion of files by Sysinternals
    SDelete. It looks for the common name pattern used to rename files.
  condition: (([TargetFilename] =~ ['.*.AAA']) || ([TargetFilename] =~ ['.*.ZZZ']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,004
  exttype: SIEM
- name: windows_spooler_service_suspicious_file_deletion
  description: Detect DLL deletions from Spooler Service driver folder
  condition: ([Image] =~ ['.*spoolsv.exe']) && ([TargetFilename] =~ ['.*C.*.*Windows.*System32.*spool.*drivers.*x64.*3.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,privilege_escalation,t1574
  exttype: SIEM
- name: ta505_dropper_load_pattern
  description: Detects mshta loaded by wmiprvse as parent as used by TA505 malicious
    documents
  condition: ([Image] =~ ['.*.*mshta.exe']) && ([ParentImage] =~ ['.*.*wmiprvse.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,g0092
  exttype: SIEM
- name: suspicious_mshta_process_patterns
  description: Detects suspicious mshta process patterns
  condition: ([Image] =~ ['.*.*mhsta.exe']) && (([ParentImage] =~ ['.*.*cmd.exe'])
    || ([ParentImage] =~ ['.*.*powershell.exe'])) || (([CommandLine] =~ ['.*.*AppData.*Local.*'])
    || ([CommandLine] =~ ['.*C.*.*Windows.*Temp.*']) || ([CommandLine] =~ ['.*C.*.*Users.*Public.*']))
    || (([Image] !~ ['.*C.*.*Windows.*System32.*']) || ([Image] !~ ['.*C.*.*Windows.*SysWOW64.*']))
    || (([CommandLine] !~ ['.*.htm.*']) || ([CommandLine] !~ ['.*.hta.*'])) && (([CommandLine]
    !~ ['.*mshta.exe']) || ([CommandLine] !~ ['.*mshta']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: regsvr32_anomaly
  description: Detects various anomalies in relation to regsvr32.exe
  condition: ([Image] =~ ['.*.*regsvr32.exe']) && ([CommandLine] =~ ['.*.*Temp.*.*.*'])
    || ([Image] =~ ['.*.*regsvr32.exe']) && ([ParentImage] =~ ['.*.*powershell.exe'])
    || ([Image] =~ ['.*.*regsvr32.exe']) && ([ParentImage] =~ ['.*.*cmd.exe']) ||
    ([Image] =~ ['.*.*regsvr32.exe']) && ([CommandLine] =~ ['.*.*i.*.*']) && (([CommandLine]
    =~ ['.*http.*']) || ([CommandLine] =~ ['.*ftp.*'])) && ([CommandLine] =~ ['.*scrobj.dll'])
    || ([Image] =~ ['.*.*wscript.exe']) && ([ParentImage] =~ ['.*.*regsvr32.exe'])
    || ([Image] =~ ['.*.*EXCEL.EXE']) && ([CommandLine] =~ ['.*...*...*...*Windows.*System32.*regsvr32.exe.*.*'])
    || ([ParentImage] =~ ['.*.*mshta.exe']) && ([Image] =~ ['.*.*regsvr32.exe']) ||
    ([Image] =~ ['.*.*regsvr32.exe']) && (([CommandLine] =~ ['.*.*AppData.*Local.*'])
    || ([CommandLine] =~ ['.*C.*.*Users.*Public.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,010,execution,t1117,car,2019-04-002,2019-04-003
  exttype: SIEM
- name: shadow_copies_access_via_symlink
  description: Shadow Copies storage symbolic link creation using operating systems
    utilities
  condition: ([CommandLine] =~ ['.*mklink.*']) && ([CommandLine] =~ ['.*HarddiskVolumeShadowCopy.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002,003
  exttype: SIEM
- name: crackmapexecwin
  description: Detects CrackMapExecWin Activity as Described by NCSC
  condition: (([Image] =~ ['.*.*crackmapexec.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0035
  exttype: SIEM
- name: bitsadmin_download
  description: Detects usage of bitsadmin downloading a file
  condition: (([Image] =~ ['.*.*bitsadmin.exe'])) && (([CommandLine] =~ ['.*.*.*create.*.*'])
    || ([CommandLine] =~ ['.*.*.*addfile.*.*'])) && (([CommandLine] =~ ['.*http.*']))
    || (([CommandLine] =~ ['.*.*.*transfer.*.*'])) || (([CommandLine] =~ ['.*copy.*bitsadmin.exe.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,persistence,t1197,s0190,t1036,003
  exttype: SIEM
- name: wmi_persistence___script_event_consumer
  description: Detects WMI script event consumers
  condition: ([Image] == ['C:\WINDOWS\system32\wbem\scrcons.exe']) && ([ParentImage]
    == ['C:\Windows\System32\svchost.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1546,003,t1047
  exttype: SIEM
- name: suspicious_rdp_redirect_using_tscon
  description: Detects a suspicious RDP session redirect using tscon.exe
  condition: ([CommandLine] =~ ['.*.*.*dest.*rdp.*tcp.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1563,002,t1076,t1021,001,car,2013-07-002
  exttype: SIEM
- name: psr_exe_capture_screenshots
  description: The psr.exe captures desktop screenshots and saves them on the local
    machine
  condition: ([Image] =~ ['.*.*Psr.exe']) && ([CommandLine] =~ ['.*.*start.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1113
  exttype: SIEM
- name: process_dump_via_rundll32_and_comsvcs_dll
  description: Detects a process memory dump performed via ordinal function 24 in
    comsvcs.dll
  condition: (([CommandLine] =~ ['.*comsvcs.dll.*.*24.*']) || ([CommandLine] =~ ['.*comsvcs.dll.*MiniDump.*'])
    || ([CommandLine] =~ ['.*comsvcs.dll.*MiniDump.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,credential_access,t1003,car,2013-05-009,001
  exttype: SIEM
- name: disabled_ie_security_features
  description: Detects command lines that indicate unwanted modifications to registry
    keys that disable important Internet Explorer security features
  condition: ([CommandLine] =~ ['.*.*.*name.*IEHarden.*.*']) && ([CommandLine] =~
    ['.*.*.*value.*0.*.*']) || ([CommandLine] =~ ['.*.*.*name.*DEPOff.*.*']) && ([CommandLine]
    =~ ['.*.*.*value.*1.*.*']) || ([CommandLine] =~ ['.*.*.*name.*DisableFirstRunCustomize.*.*'])
    && ([CommandLine] =~ ['.*.*.*value.*2.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001,t1089
  exttype: SIEM
- name: suspicious_desktopimgdownldr_command
  description: Detects a suspicious Microsoft desktopimgdownldr execution with parameters
    used to download files from the Internet
  condition: ([CommandLine] =~ ['.*.*.*lockscreenurl.*.*']) && (([CommandLine] !~
    ['.*.jpg.*']) || ([CommandLine] !~ ['.*.jpeg.*']) || ([CommandLine] !~ ['.*.png.*']))
    || ([CommandLine] =~ ['.*reg.*delete.*']) && ([CommandLine] =~ ['.*.*PersonalizationCSP.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1105
  exttype: SIEM
- name: droppers_exploiting_cve_2017_11882
  description: Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and
    other sub processes like mshta.exe
  condition: ([ParentImage] =~ ['.*.*EQNEDT32.EXE'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1203,t1204,002,initial_access,t1566,001,t1193
  exttype: SIEM
- name: empire_powershell_launch_parameters
  description: Detects suspicious powershell command line parameters used in Empire
  condition: (([CommandLine] =~ ['.*.*.*NoP.*.*sta.*.*NonI.*.*W.*Hidden.*.*Enc.*.*'])
    || ([CommandLine] =~ ['.*.*.*noP.*.*sta.*.*w.*1.*.*enc.*.*']) || ([CommandLine]
    =~ ['.*.*.*NoP.*.*NonI.*.*W.*Hidden.*.*enc.*.*']) || ([CommandLine] =~ ['.*.*.*noP.*.*sta.*.*w.*1.*.*enc.*'])
    || ([CommandLine] =~ ['.*.*.*enc.*.*SQB.*']) || ([CommandLine] =~ ['.*.*.*nop.*.*exec.*bypass.*.*EncodedCommand.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: possible_app_whitelisting_bypass_via_windbg_cdb_as_a_shellcode_runner
  description: Launch 64-bit shellcode from a debugger script file using cdb.exe.
  condition: ([Image] =~ ['.*.*cdb.exe']) && ([CommandLine] =~ ['.*.*cf.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1106,defense_evasion,t1218,t1127
  exttype: SIEM
- name: conti_volume_shadow_listing
  description: Detects a command used by conti to find volume shadow backups
  condition: ([CommandLine] =~ ['.*vssadmin.*list.*shadows.*']) && ([CommandLine]
    =~ ['.*log.txt.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: capture_a_network_trace_with_netsh_exe
  description: Detects capture a network trace via netsh.exe trace functionality
  condition: ([CommandLine] =~ ['.*netsh.*']) && ([CommandLine] =~ ['.*trace.*'])
    && ([CommandLine] =~ ['.*start.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,credential_access,t1040
  exttype: SIEM
- name: tap_installer_execution
  description: Well-known TAP software installation. Possible preparation for data
    exfiltration using tunneling techniques
  condition: ([Image] =~ ['.*.*tapinstall.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,t1048
  exttype: SIEM
- name: regsvr32_command_line_without_dll
  description: Detects a regsvr.exe execution that doesn't contain a DLL in the command
    line
  condition: ([ParentImage] =~ ['.*.*regsvr32.exe']) && (([CommandLine] !~ ['.*.dll.*'])
    || ([CommandLine] !~ ['.*.ocx.*']) || ([CommandLine] !~ ['.*.cpl.*']) || ([CommandLine]
    !~ ['.*.ax.*']) || ([CommandLine] !~ ['.*.bav.*']) || ([CommandLine] !~ ['.*.ppl.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution
  exttype: SIEM
- name: fsutil_suspicious_invocation
  description: Detects suspicious parameters of fsutil (deleting USN journal, configuring
    it with small size, etc). Might be used by ransomwares during the attack (seen
    by NotPetya and others).
  condition: ([Image] =~ ['.*.*fsutil.exe']) || ([OriginalFileName] == ['fsutil.exe'])
    && (([CommandLine] =~ ['.*deletejournal.*']) || ([CommandLine] =~ ['.*createjournal.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070
  exttype: SIEM
- name: recon_information_for_export_with_command_prompt
  description: Once established within a system or network, an adversary may use automated
    techniques for collecting internal data.
  condition: (([Image] =~ ['.*.*tree.com']) || ([Image] =~ ['.*.*WMIC.exe']) || ([Image]
    =~ ['.*.*doskey.exe']) || ([Image] =~ ['.*.*sc.exe'])) && ([ParentCommandLine]
    =~ ['.*.*.*.*.*TEMP.*.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1119
  exttype: SIEM
- name: cmdkey_cached_credentials_recon
  description: Detects usage of cmdkey to look for cached credentials
  condition: ([Image] =~ ['.*.*cmdkey.exe']) && ([CommandLine] =~ ['.*.*.*list.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,005
  exttype: SIEM
- name: suspicious_rundll32_activity
  description: Detects suspicious process related to rundll32 based on arguments
  condition: (([CommandLine] =~ ['.*javascript.*.*']) || ([CommandLine] =~ ['.*.RegisterXLL.*']))
    || ([CommandLine] =~ ['.*url.dll.*']) && ([CommandLine] =~ ['.*OpenURL.*']) ||
    ([CommandLine] =~ ['.*url.dll.*']) && ([CommandLine] =~ ['.*OpenURLA.*']) || ([CommandLine]
    =~ ['.*url.dll.*']) && ([CommandLine] =~ ['.*FileProtocolHandler.*']) || ([CommandLine]
    =~ ['.*zipfldr.dll.*']) && ([CommandLine] =~ ['.*RouteTheCall.*']) || ([CommandLine]
    =~ ['.*shell32.dll.*']) && ([CommandLine] =~ ['.*Control.*RunDLL.*']) || ([CommandLine]
    =~ ['.*shell32.dll.*']) && ([CommandLine] =~ ['.*ShellExec.*RunDLL.*']) || ([CommandLine]
    =~ ['.*mshtml.dll.*']) && ([CommandLine] =~ ['.*PrintHTML.*']) || ([CommandLine]
    =~ ['.*advpack.dll.*']) && ([CommandLine] =~ ['.*LaunchINFSection.*']) || ([CommandLine]
    =~ ['.*advpack.dll.*']) && ([CommandLine] =~ ['.*RegisterOCX.*']) || ([CommandLine]
    =~ ['.*ieadvpack.dll.*']) && ([CommandLine] =~ ['.*LaunchINFSection.*']) || ([CommandLine]
    =~ ['.*ieadvpack.dll.*']) && ([CommandLine] =~ ['.*RegisterOCX.*']) || ([CommandLine]
    =~ ['.*ieframe.dll.*']) && ([CommandLine] =~ ['.*OpenURL.*']) || ([CommandLine]
    =~ ['.*shdocvw.dll.*']) && ([CommandLine] =~ ['.*OpenURL.*']) || ([CommandLine]
    =~ ['.*syssetup.dll.*']) && ([CommandLine] =~ ['.*SetupInfObjectInstallAction.*.*'])
    || ([CommandLine] =~ ['.*setupapi.dll.*']) && ([CommandLine] =~ ['.*InstallHinfSection.*'])
    || ([CommandLine] =~ ['.*pcwutl.dll.*']) && ([CommandLine] =~ ['.*LaunchApplication.*'])
    || ([CommandLine] =~ ['.*dfshim.dll.*']) && ([CommandLine] =~ ['.*ShOpenVerbApplication.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1218,011,t1085
  exttype: SIEM
- name: cabinet_file_expansion
  description: Adversaries can use the inbuilt expand utility to decompress cab files
    as seen in recent Iranian MeteorExpress attack
  condition: (([Image] =~ ['.*.*expand.exe'])) && (([CommandLine] =~ ['.*.cab.*'])
    || ([CommandLine] =~ ['.*.*F.*.*']) || ([CommandLine] =~ ['.*C.*.*ProgramData.*.*.*'])
    || ([CommandLine] =~ ['.*C.*.*Public.*.*.*']) || ([CommandLine] =~ ['.*.*AppData.*Local.*Temp.*.*.*'])
    || ([CommandLine] =~ ['.*.*AppData.*Roaming.*Temp.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1218
  exttype: SIEM
- name: domain_trust_discovery
  description: Identifies execution of nltest.exe and dsquery.exe for domain trust
    discovery. This technique is used by attackers to enumerate Active Directory trusts.
  condition: ([Image] =~ ['.*.*nltest.exe']) && (([CommandLine] =~ ['.*domain.*trusts.*'])
    || ([CommandLine] =~ ['.*all.*trusts.*']) || ([CommandLine] =~ ['.*.*dclist.*']))
    || ([Image] =~ ['.*.*dsquery.exe']) && ([CommandLine] =~ ['.*trustedDomain.*'])
    || ([Image] =~ ['.*.*dsquery.exe']) && ([CommandLine] =~ ['.*.*filter.*']) &&
    ([CommandLine] =~ ['.*trustedDomain.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1482
  exttype: SIEM
- name: suspicious_svchost_process
  description: Detects a suspicious svchost process start
  condition: ([Image] =~ ['.*.*svchost.exe']) && (([ParentImage] !~ ['.*.*services.exe'])
    || ([ParentImage] !~ ['.*.*MsMpEng.exe']) || ([ParentImage] !~ ['.*.*Mrt.exe'])
    || ([ParentImage] !~ ['.*.*rpcnet.exe']) || ([ParentImage] !~ ['.*.*svchost.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,005
  exttype: SIEM
- name: suspicious_serv_u_process_pattern
  description: Detects a suspicious process pattern which could be a sign of an exploited
    Serv-U service
  condition: ([ParentImage] =~ ['.*.*Serv.*U.exe']) && (([Image] =~ ['.*.*cmd.exe'])
    || ([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*wscript.exe']) ||
    ([Image] =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~
    ['.*.*bash.exe']) || ([Image] =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*regsvr32.exe'])
    || ([Image] =~ ['.*.*wmic.exe']) || ([Image] =~ ['.*.*mshta.exe']) || ([Image]
    =~ ['.*.*rundll32.exe']) || ([Image] =~ ['.*.*msiexec.exe']) || ([Image] =~ ['.*.*forfiles.exe'])
    || ([Image] =~ ['.*.*scriptrunner.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access
  exttype: SIEM
- name: purplesharp_indicator
  description: Detect
  condition: (([CommandLine] =~ ['.*xyz123456.exe.*']) || ([CommandLine] =~ ['.*PurpleSharp.*']))
    || (([OriginalFileName] =~ ['PurpleSharp.exe']))
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: suspicious_debugger_registration_cmdline
  description: Detects the registration of a debugger for a program that is available
    in the logon screen (sticky key backdoor).
  condition: ([CommandLine] =~ ['.*.*CurrentVersion.*Image.*File.*Execution.*Options.*.*.*'])
    && (([CommandLine] =~ ['.*sethc.exe.*']) || ([CommandLine] =~ ['.*utilman.exe.*'])
    || ([CommandLine] =~ ['.*osk.exe.*']) || ([CommandLine] =~ ['.*magnify.exe.*'])
    || ([CommandLine] =~ ['.*narrator.exe.*']) || ([CommandLine] =~ ['.*displayswitch.exe.*'])
    || ([CommandLine] =~ ['.*atbroker.exe.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1546,008,t1015
  exttype: SIEM
- name: smb_relay_attack_tools
  description: Detects different hacktools used for relay attacks on Windows for privilege
    escalation
  condition: (([Image] =~ ['.*PetitPotam.*']) || ([Image] =~ ['.*RottenPotato.*'])
    || ([Image] =~ ['.*HotPotato.*']) || ([Image] =~ ['.*JuicyPotato.*']) || ([Image]
    =~ ['.*.*just.*dce.*.*']) || ([Image] =~ ['.*Juicy.*Potato.*']) || ([Image] =~
    ['.*.*temp.*rot.exe.*']) || ([Image] =~ ['.*.*Potato.exe.*']) || ([Image] =~ ['.*.*SpoolSample.exe.*'])
    || ([Image] =~ ['.*.*Responder.exe.*']) || ([Image] =~ ['.*.*smbrelayx.*']) ||
    ([Image] =~ ['.*.*ntlmrelayx.*'])) || (([CommandLine] =~ ['.*Invoke.*Tater.*'])
    || ([CommandLine] =~ ['.*.*smbrelay.*']) || ([CommandLine] =~ ['.*.*ntlmrelay.*'])
    || ([CommandLine] =~ ['.*cme.*smb.*.*']) || ([CommandLine] =~ ['.*.*.*ntlm.*NTLMhash.*.*'])
    || ([CommandLine] =~ ['.*Invoke.*PetitPotam.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1557,001
  exttype: SIEM
- name: adfind_usage_detection
  description: AdFind continues to be seen across majority of breaches. It is used
    to domain trust discovery to plan out subsequent steps in the attack chain.
  condition: (([CommandLine] =~ ['.*domainlist.*']) || ([CommandLine] =~ ['.*trustdmp.*'])
    || ([CommandLine] =~ ['.*dcmodes.*']) || ([CommandLine] =~ ['.*adinfo.*']) ||
    ([CommandLine] =~ ['.*.*dclist.*.*']) || ([CommandLine] =~ ['.*computer.*pwdnotreqd.*'])
    || ([CommandLine] =~ ['.*objectcategory=.*']) || ([CommandLine] =~ ['.*.*subnets.*.*f.*'])
    || ([CommandLine] =~ ['.*name=.*Domain.*Admins.*.*']) || ([CommandLine] =~ ['.*.*sc.*u.*.*'])
    || ([CommandLine] =~ ['.*domainncs.*']) || ([CommandLine] =~ ['.*dompol.*']) ||
    ([CommandLine] =~ ['.*.*oudmp.*.*']) || ([CommandLine] =~ ['.*subnetdmp.*']) ||
    ([CommandLine] =~ ['.*gpodmp.*']) || ([CommandLine] =~ ['.*fspdmp.*']) || ([CommandLine]
    =~ ['.*users.*noexpire.*']) || ([CommandLine] =~ ['.*computers.*active.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,discovery,t1482,t1018
  exttype: SIEM
- name: encoded_frombase64string
  description: Detects a base64 encoded FromBase64String keyword in a process command
    line
  condition: (([CommandLine] =~ ['.*OjpGcm9tQmFzZTY0U3RyaW5n.*']) || ([CommandLine]
    =~ ['.*o6RnJvbUJhc2U2NFN0cmluZ.*']) || ([CommandLine] =~ ['.*6OkZyb21CYXNlNjRTdHJpbm.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1140,execution,t1059,001,t1086
  exttype: SIEM
- name: microsoft_workflow_compiler
  description: Detects invocation of Microsoft Workflow Compiler, which may permit
    the execution of arbitrary unsigned code.
  condition: ([Image] =~ ['.*.*Microsoft.Workflow.Compiler.exe']) || ([OriginalFileName]
    == ['Microsoft.Workflow.Compiler.exe']) && ([CommandLine] =~ ['.*.xml.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1127,t1218
  exttype: SIEM
- name: greenbug_campaign_indicators
  description: Detects tools and process executions as observed in a Greenbug campaign
    in May 2020
  condition: ([CommandLine] =~ ['.*bitsadmin.*']) && ([CommandLine] =~ ['.*.*transfer.*'])
    && ([CommandLine] =~ ['.*CSIDL.*APPDATA.*']) || (([CommandLine] =~ ['.*CSIDL.*SYSTEM.*DRIVE.*']))
    || (([CommandLine] =~ ['.*.*msf.ps1.*']) || ([CommandLine] =~ ['.*8989.*.*e.*cmd.exe.*'])
    || ([CommandLine] =~ ['.*system.Data.SqlClient.SqlDataAdapter.*.*cmd.*.*.*.*void.*.*da.fill.*'])
    || ([CommandLine] =~ ['.*.*nop.*.*w.*hidden.*.*c.*.*k=new.*object.*']) || ([CommandLine]
    =~ ['.*.*Net.CredentialCache.*.*.*DefaultCredentials.*IEX.*.*']) || ([CommandLine]
    =~ ['.*.*.*nop.*.*w.*hidden.*.*c.*.*m=new.*object.*net.webclient.*.*m.*']) ||
    ([CommandLine] =~ ['.*.*noninteractive.*.*executionpolicy.*bypass.*whoami.*'])
    || ([CommandLine] =~ ['.*.*noninteractive.*.*executionpolicy.*bypass.*netstat.*.*a.*'])
    || ([CommandLine] =~ ['.*L3NlcnZlc.*'])) || (([Image] =~ ['.*.*adobe.*Adobe.exe'])
    || ([Image] =~ ['.*.*oracle.*local.exe']) || ([Image] =~ ['.*.*revshell.exe'])
    || ([Image] =~ ['.*infopagesbackup.*ncat.exe']) || ([Image] =~ ['.*CSIDL.*SYSTEM.*cmd.exe'])
    || ([Image] =~ ['.*.*programdata.*oracle.*java.exe']) || ([Image] =~ ['.*CSIDL.*COMMON.*APPDATA.*comms.*comms.exe'])
    || ([Image] =~ ['.*.*Programdata.*VMware.*Vmware.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0049,execution,t1059,001,t1086,command_and_control,t1105,defense_evasion,t1036,005
  exttype: SIEM
- name: netsh_rdp_port_forwarding
  description: Detects netsh commands that configure a port forwarding of port 3389
    used for RDP
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*i.*']) && ([CommandLine]
    =~ ['.*.*p.*']) && ([CommandLine] =~ ['.*=3389.*']) && ([CommandLine] =~ ['.*.*c.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,defense_evasion,command_and_control,t1090
  exttype: SIEM
- name: powershell_reverse_shell_connection
  description: Detects the Nishang Invoke-PowerShellTcpOneLine reverse shell
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([CommandLine] =~ ['.*new.*object.*system.net.sockets.tcpclient.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: rar_with_password_or_compression_level
  description: Detects the use of rar.exe, on the command line, to create an archive
    with password protection or with a specific compression level. This is pretty
    indicative of malicious actions.
  condition: (([CommandLine] =~ ['.*.*.*hp.*'])) && (([CommandLine] =~ ['.*.*.*m.*'])
    || ([CommandLine] =~ ['.*.*a.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1560,001,exfiltration,t1002
  exttype: SIEM
- name: hiding_files_with_attrib_exe
  description: Detects usage of attrib.exe to hide files from users.
  condition: ([Image] =~ ['.*.*attrib.exe']) && ([CommandLine] =~ ['.*.*.*h.*.*'])
    && ([CommandLine] !~ ['.*.*desktop.ini.*.*']) || ([ParentImage] !~ ['.*.*cmd.exe'])
    && ([CommandLine] !~ ['.*R.*.*H.*.*S.*.*A.*.*.*.*.cui']) && ([ParentCommandLine]
    !~ ['C.*.*WINDOWS.*system32.*.*.*.bat'])
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1564,001,t1158
  exttype: SIEM
- name: copy_from_admin_share
  description: Detects a suspicious copy command to or from an Admin share
  condition: (([Image] =~ ['.*.*robocopy.exe']) || ([Image] =~ ['.*.*xcopy.exe']))
    || ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine] =~ ['.*copy.*']) || ([Image]
    =~ ['.*.*powershell.*']) && (([CommandLine] =~ ['.*copy.*item.*']) || ([CommandLine]
    =~ ['.*copy.*']) || ([CommandLine] =~ ['.*cpi.*.*']) || ([CommandLine] =~ ['.*.*cp.*.*']))
    && ([CommandLine] =~ ['.*.*.*.*.*.*.*']) && ([CommandLine] =~ ['.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,collection,exfiltration,t1039,t1105,t1048,t1021,002
  exttype: SIEM
- name: suspicious_shells_spawn_by_sql_server
  description: Detects suspicious shell spawn from MSSQL process, this might be sight
    of RCE or SQL Injection
  condition: ([ParentImage] =~ ['.*.*sqlservr.exe']) && (([Image] =~ ['.*.*cmd.exe'])
    || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~ ['.*.*bash.exe']) || ([Image] =~
    ['.*.*powershell.exe']) || ([Image] =~ ['.*.*bitsadmin.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,t1100,t1505,003,t1190,initial_access,persistence,privilege_escalation
  exttype: SIEM
- name: suspicious_rasdial_activity
  description: Detects suspicious process related to rasdial.exe
  condition: (([Image] =~ ['.*rasdial.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1059,t1064
  exttype: SIEM
- name: execution_from_suspicious_folder
  description: Detects a suspicious execution from an uncommon folder
  condition: (([Image] =~ ['.*.*.*Recycle.bin.*.*.*']) || ([Image] =~ ['.*.*config.*systemprofile.*.*.*'])
    || ([Image] =~ ['.*.*Intel.*Logs.*.*.*']) || ([Image] =~ ['.*.*RSA.*MachineKeys.*.*.*'])
    || ([Image] =~ ['.*.*Users.*All.*Users.*.*.*']) || ([Image] =~ ['.*.*Users.*Default.*.*.*'])
    || ([Image] =~ ['.*.*Users.*NetworkService.*.*.*']) || ([Image] =~ ['.*.*Users.*Public.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*addins.*.*.*']) || ([Image] =~ ['.*.*Windows.*debug.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*Fonts.*.*.*']) || ([Image] =~ ['.*.*Windows.*Help.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*IME.*.*.*']) || ([Image] =~ ['.*.*Windows.*Media.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*repair.*.*.*']) || ([Image] =~ ['.*.*Windows.*security.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*system32.*config.*systemprofile.*.*.*']) || ([Image]
    =~ ['.*.*Windows.*System32.*Tasks.*.*.*']) || ([Image] =~ ['.*.*Windows.*Tasks.*.*.*']))
    || ([Image] =~ ['C.*.*Perflogs.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: rubeus_hack_tool
  description: Detects command line parameters used by Rubeus hack tool
  condition: (([CommandLine] =~ ['.*.*asreproast.*.*']) || ([CommandLine] =~ ['.*.*dump.*.*service.*krbtgt.*.*'])
    || ([CommandLine] =~ ['.*.*kerberoast.*.*']) || ([CommandLine] =~ ['.*.*createnetonly.*.*program.*.*'])
    || ([CommandLine] =~ ['.*.*ptt.*.*ticket.*.*']) || ([CommandLine] =~ ['.*.*.*impersonateuser.*.*'])
    || ([CommandLine] =~ ['.*.*renew.*.*ticket.*.*']) || ([CommandLine] =~ ['.*.*asktgt.*.*user.*.*'])
    || ([CommandLine] =~ ['.*.*harvest.*.*interval.*.*']) || ([CommandLine] =~ ['.*.*s4u.*.*user.*.*'])
    || ([CommandLine] =~ ['.*.*s4u.*.*ticket.*.*']) || ([CommandLine] =~ ['.*.*hash.*.*password.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,t1558,003,lateral_movement,t1550,t1097
  exttype: SIEM
- name: suspicious_usage_of_the_manage_bde_wsf_script
  description: Detects a usage of the manage-bde.wsf script that may indicate an attempt
    of proxy execution from script
  condition: ([CommandLine] =~ ['.*cscript.*']) && ([CommandLine] =~ ['.*manage.*bde.wsf.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: devtoolslauncher_exe_executes_specified_binary
  description: The Devtoolslauncher.exe executes other binary
  condition: ([Image] =~ ['.*.*devtoolslauncher.exe']) && ([CommandLine] =~ ['.*LaunchForDeploy.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,execution
  exttype: SIEM
- name: anydesk_silent_installation
  description: AnyDesk Remote Desktop silent installation can be used by attacker
    to gain remote access.
  condition: ([CommandLine] =~ ['.*.*.*install.*']) && ([CommandLine] =~ ['.*.*.*start.*with.*win.*'])
    && ([CommandLine] =~ ['.*.*.*silent.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1219
  exttype: SIEM
- name: crackmapexec_powershell_obfuscation
  description: The CrachMapExec pentesting framework implements a PowerShell obfuscation
    with some static strings detected by this rule.
  condition: ([CommandLine] =~ ['.*powershell.exe.*']) && (([CommandLine] =~ ['.*join.*split.*'])
    || ([CommandLine] =~ ['.*.*.*.*ShellId.*1.*.*.*ShellId.*13.*.*.*x.*.*.*']) ||
    ([CommandLine] =~ ['.*.*.*.*PSHome.*.*.*.*.*PSHOME.*.*.*.*.*']) || ([CommandLine]
    =~ ['.*.*.*.*env.*Public.*13.*.*.*env.*Public.*5.*.*.*x.*.*.*']) || ([CommandLine]
    =~ ['.*.*.*.*env.*ComSpec.*4.*.*.*25.*.*Join.*.*.*.*']) || ([CommandLine] =~ ['.*.*1.*3.*.*.*x.*.*Join.*.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,defense_evasion,t1027,005,t1086
  exttype: SIEM
- name: taidoor_rat_dll_load
  description: Detects specific process characteristics of Chinese TAIDOOR RAT malware
    load
  condition: (([CommandLine] =~ ['.*dll.*MyStart.*']) || ([CommandLine] =~ ['.*dll.*MyStart.*']))
    || (([CommandLine] =~ ['.*.*MyStart'])) && (([CommandLine] =~ ['.*rundll32.exe.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1055,001
  exttype: SIEM
- name: accesschk_usage_after_privilege_escalation
  description: Accesschk is an access and privilege audit tool developed by SysInternal
    and often being used by attacker to verify if a privilege escalation process successful
    or not
  condition: ([IntegrityLevel] == ['Medium']) && ([Product] =~ ['.*AccessChk']) ||
    ([Description] =~ ['.*Reports.*effective.*permissions.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,discovery,t1069,001
  exttype: SIEM
- name: dridex_process_pattern
  description: Detects typical Dridex process patterns
  condition: ([Image] =~ ['.*.*svchost.exe']) && ([CommandLine] =~ ['.*C.*.*Users.*.*.*'])
    && ([CommandLine] =~ ['.*.*Desktop.*.*.*']) || ([ParentImage] =~ ['.*.*svchost.exe'])
    && ([Image] =~ ['.*.*whoami.exe']) && ([CommandLine] =~ ['.*all.*']) || (([Image]
    =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine] =~ ['.*view.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055,discovery,t1135,t1033
  exttype: SIEM
- name: lazarus_activity
  description: Detects different process creation events as described in various threat
    reports on Lazarus group activity
  condition: (([CommandLine] =~ ['.*reg.exe.*save.*hklm.*sam.*.*temp.*.*.*reg.*sam.save.*'])
    || ([CommandLine] =~ ['.*1q2w3e4r.*.*.*.*.*.*.*.*.*.*']) || ([CommandLine] =~
    ['.*.*.*hp1q2w3e4.*.*']) || ([CommandLine] =~ ['.*.dat.*data03.*10000.*.*p.*.*']))
    || ([CommandLine] =~ ['.*process.*call.*create.*']) && ([CommandLine] =~ ['.*.*.*.*.*temp.*.*.*.*'])
    || ([CommandLine] =~ ['.*netstat.*.*aon.*.*.*find.*.*']) && ([CommandLine] =~
    ['.*.*.*.*.*temp.*.*.*.*']) || (([CommandLine] =~ ['.*.255.*10.*C.*.*ProgramData.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0032
  exttype: SIEM
- name: possible_applocker_bypass
  description: Detects execution of executables that can be used to bypass Applocker
    whitelisting
  condition: (([CommandLine] =~ ['.*.*msdt.exe.*']) || ([CommandLine] =~ ['.*.*installutil.exe.*'])
    || ([CommandLine] =~ ['.*.*regsvcs.exe.*']) || ([CommandLine] =~ ['.*.*regasm.exe.*'])
    || ([CommandLine] =~ ['.*.*msbuild.exe.*']) || ([CommandLine] =~ ['.*.*ieexec.exe.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1118,t1218,004,t1121,009,t1127,001,t1170,005
  exttype: SIEM
- name: bypass_uac_via_fodhelper_exe
  description: Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries
    use this technique to execute privileged processes.
  condition: ([ParentImage] =~ ['.*.*fodhelper.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548,002,t1088
  exttype: SIEM
- name: koadic_execution
  description: Detects command line parameters used by Koadic hack tool
  condition: ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine] =~ ['.*.*q.*']) && ([CommandLine]
    =~ ['.*.*c.*']) && ([CommandLine] =~ ['.*chcp.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,003,005,007,t1064
  exttype: SIEM
- name: winnti_pipemon_characteristics
  description: Detects specific process characteristics of Winnti Pipemon malware
    reported by ESET
  condition: (([CommandLine] =~ ['.*setup0.exe.*.*p.*'])) || ([CommandLine] =~ ['.*setup.exe.*'])
    && (([CommandLine] =~ ['.*.*x.*0']) || ([CommandLine] =~ ['.*.*x.*1']) || ([CommandLine]
    =~ ['.*.*x.*2']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1574,002,t1073,g0044
  exttype: SIEM
- name: local_accounts_discovery
  description: Local accounts, System Owner/User discovery using operating systems
    utilities
  condition: ([Image] =~ ['.*.*whoami.exe']) || ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine]
    =~ ['.*useraccount.*']) && ([CommandLine] =~ ['.*get.*']) || (([Image] =~ ['.*.*quser.exe'])
    || ([Image] =~ ['.*.*qwinsta.exe'])) || ([Image] =~ ['.*.*cmdkey.exe']) && ([CommandLine]
    =~ ['.*.*list.*']) || ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine] =~ ['.*.*c.*'])
    && ([CommandLine] =~ ['.*dir.*.*']) && ([CommandLine] =~ ['.*.*Users.*.*.*'])
    && (([CommandLine] !~ ['.*.*rmdir.*.*'])) || (([Image] =~ ['.*.*net.exe']) ||
    ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine] =~ ['.*user.*']) && (([CommandLine]
    !~ ['.*.*domain.*']) || ([CommandLine] !~ ['.*.*add.*']) || ([CommandLine] !~
    ['.*.*delete.*']) || ([CommandLine] !~ ['.*.*active.*']) || ([CommandLine] !~
    ['.*.*expires.*']) || ([CommandLine] !~ ['.*.*passwordreq.*']) || ([CommandLine]
    !~ ['.*.*scriptpath.*']) || ([CommandLine] !~ ['.*.*times.*']) || ([CommandLine]
    !~ ['.*.*workstations.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,discovery,t1033,t1087,001
  exttype: SIEM
- name: scheduled_task_creation
  description: Detects the creation of scheduled tasks in user session
  condition: ([Image] =~ ['.*.*schtasks.exe']) && ([CommandLine] =~ ['.*.*.*create.*.*'])
    && ([User] == ['NT AUTHORITY\SYSTEM'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,persistence,privilege_escalation,t1053,005,s0111,car,2013-08-001
  exttype: SIEM
- name: system_file_execution_location_anomaly
  description: Detects a Windows program executable started in a suspicious folder
  condition: (([Image] =~ ['.*.*svchost.exe']) || ([Image] =~ ['.*.*rundll32.exe'])
    || ([Image] =~ ['.*.*services.exe']) || ([Image] =~ ['.*.*powershell.exe']) ||
    ([Image] =~ ['.*.*regsvr32.exe']) || ([Image] =~ ['.*.*spoolsv.exe']) || ([Image]
    =~ ['.*.*lsass.exe']) || ([Image] =~ ['.*.*smss.exe']) || ([Image] =~ ['.*.*csrss.exe'])
    || ([Image] =~ ['.*.*conhost.exe']) || ([Image] =~ ['.*.*wininit.exe']) || ([Image]
    =~ ['.*.*lsm.exe']) || ([Image] =~ ['.*.*winlogon.exe']) || ([Image] =~ ['.*.*explorer.exe'])
    || ([Image] =~ ['.*.*taskhost.exe']) || ([Image] =~ ['.*.*Taskmgr.exe']) || ([Image]
    =~ ['.*.*sihost.exe']) || ([Image] =~ ['.*.*RuntimeBroker.exe']) || ([Image] =~
    ['.*.*smartscreen.exe']) || ([Image] =~ ['.*.*dllhost.exe']) || ([Image] =~ ['.*.*audiodg.exe'])
    || ([Image] =~ ['.*.*wlanext.exe'])) && (([Image] !~ ['C.*.*Windows.*System32.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*system32.*.*.*']) || ([Image] !~ ['C.*.*Windows.*SysWow64.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']) || ([Image] !~ ['C.*.*Windows.*winsxs.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*WinSxS.*.*.*']) || ([Image] !~ ['C.*.*avast.*.*sandbox.*']))
    || ([Image] !~ ['.*.*SystemRoot.*System32.*.*.*']) || ([Image] == ['C:\Windows\explorer.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: exploiting_cve_2019_1388
  description: Detects an exploitation attempt in which the UAC consent dialogue is
    used to invoke an Internet Explorer process running as LOCAL_SYSTEM
  condition: ([ParentImage] =~ ['.*.*consent.exe']) && ([Image] =~ ['.*.*iexplore.exe'])
    && ([CommandLine] =~ ['.*.*http.*']) && ([IntegrityLevel] == ['System']) || ([User]
    == ['NT AUTHORITY\SYSTEM'])
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1068
  exttype: SIEM
- name: sdclt_child_processes
  description: A General detection for sdclt spawning new processes. This could be
    an indicator of sdclt being used for bypass UAC techniques.
  condition: ([ParentImage] =~ ['.*.*sdclt.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548,002
  exttype: SIEM
- name: ke3chang_registry_key_modifications
  description: Detects Registry modifications performed by Ke3chang malware in campaigns
    running in 2019 and 2020
  condition: (([CommandLine] =~ ['.*.*Property.*DWORD.*.*name.*DisableFirstRunCustomize.*.*value.*2.*.*Force.*'])
    || ([CommandLine] =~ ['.*.*Property.*String.*.*name.*Check.*Associations.*.*value.*'])
    || ([CommandLine] =~ ['.*.*Property.*DWORD.*.*name.*IEHarden.*.*value.*0.*.*Force.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0004,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: exploit_for_cve_2017_0261
  description: Detects Winword starting uncommon sub process FLTLDR.exe as used in
    exploits for CVE-2017-0261 and CVE-2017-0262
  condition: ([ParentImage] =~ ['.*.*WINWORD.EXE']) && ([Image] =~ ['.*.*FLTLDR.exe.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1203,t1204,002,initial_access,t1566,001,t1193
  exttype: SIEM
- name: conti_volume_shadow_listing
  description: Detects a command used by conti to access volume shadow backups
  condition: ([CommandLine] =~ ['.*.*.*.*.*.*.*.*.*GLOBALROOT.*.*Device.*.*HarddiskVolumeShadowCopy.*'])
    && (([CommandLine] =~ ['.*.*.*NTDS.dit.*']) || ([CommandLine] =~ ['.*.*.*SYSTEM.*'])
    || ([CommandLine] =~ ['.*.*.*SECURITY.*']) || ([CommandLine] =~ ['.*C.*.*.*tmp.*.*log.*']))
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: suspicious_copy_from_or_to_system32
  description: Detects a suspicious copy command that copies a system program from
    System32 to another directory on disk - sometimes used to use LOLBINs like certutil
    or desktopimgdownldr to a different location with a different name
  condition: (([CommandLine] =~ ['.*.*.*c.*copy.*']) || ([CommandLine] =~ ['.*xcopy.*']))
    && ([CommandLine] =~ ['.*.*System32.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003
  exttype: SIEM
- name: execution_via_cl_invocation_ps1
  description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module
  condition: ([CommandLine] =~ ['.*CL.*Invocation.ps1.*']) && ([CommandLine] =~ ['.*SyncInvoke.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: unc2452_powershell_pattern
  description: Detects a specific PowerShell command line pattern used by the UNC2452
    actors as mentioned in Microsoft and Symantec reports
  condition: ([CommandLine] =~ ['.*Invoke.*WMIMethod.*win32.*process.*.*name.*create.*.*argumentlist.*'])
    && ([CommandLine] =~ ['.*rundll32.*c.*.*windows.*']) || ([CommandLine] =~ ['.*wmic.*.*node.*.*'])
    && ([CommandLine] =~ ['.*process.*call.*create.*.*rundll32.*c.*.*windows.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1047
  exttype: SIEM
- name: judgement_panda_exfil_activity
  description: Detects Judgement Panda activity as described in Global Threat Report
    2019 by Crowdstrike
  condition: ([CommandLine] =~ ['.*eprod.ldf']) || (([CommandLine] =~ ['.*.*ldifde.exe.*.*f.*.*n.*.*'])
    || ([CommandLine] =~ ['.*.*7za.exe.*a.*1.7z.*.*']) || ([CommandLine] =~ ['.*.*aaaa.*procdump64.exe.*'])
    || ([CommandLine] =~ ['.*.*aaaa.*netsess.exe.*']) || ([CommandLine] =~ ['.*.*aaaa.*7za.exe.*'])
    || ([CommandLine] =~ ['.*copy.*..*1.7z.*.*.*.*']) || ([CommandLine] =~ ['.*copy.*.*.*client.*c.*.*aaaa.*.*.*']))
    || ([Image] == ['C:\Users\Public\7za.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,lateral_movement,g0010,credential_access,t1003,001,exfiltration,t1002,t1560
  exttype: SIEM
- name: using_settingsynchost_exe_as_lolbin
  description: Detects using SettingSyncHost.exe to run hijacked binary
  condition: (([Image] !~ ['C.*.*Windows.*System32.*.*.*']) || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']))
    && ([ParentCommandLine] =~ ['.*cmd.exe.*.*c.*']) && ([ParentCommandLine] =~ ['.*RoamDiag.cmd.*'])
    && ([ParentCommandLine] =~ ['.*.*outputpath.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1574,008
  exttype: SIEM
- name: suspicious_csc_exe_source_file_folder
  description: Detects a suspicious execution of csc.exe, which uses a source in a
    suspicious folder (e.g. AppData)
  condition: ([Image] =~ ['.*.*csc.exe']) && (([CommandLine] =~ ['.*.*AppData.*.*.*'])
    || ([CommandLine] =~ ['.*.*Windows.*Temp.*.*.*'])) && ([ParentImage] !~ ['C.*.*Program.*Files.*'])
    || (([ParentImage] !~ ['.*.*sdiagnhost.exe']) || ([ParentImage] !~ ['.*.*w3wp.exe']))
    || (([ParentCommandLine] !~ ['.*.*ProgramData.*Microsoft.*Windows.*Defender.*Advanced.*Threat.*Protection.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1500,t1027,004
  exttype: SIEM
- name: remote_code_execute_via_winrm_vbs
  description: Detects an attempt to execute code or create service on remote host
    via winrm.vbs.
  condition: ([Image] =~ ['.*.*cscript.exe']) && ([CommandLine] =~ ['.*winrm.*'])
    && ([CommandLine] =~ ['.*invoke.*Create.*wmicimv2.*Win32.*.*']) && ([CommandLine]
    =~ ['.*.*r.*http.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: dumping_process_via_sqldumper_exe
  description: Detects process dump via legitimate sqldumper.exe binary
  condition: ([Image] =~ ['.*.*sqldumper.exe']) && (([CommandLine] =~ ['.*0x0110.*'])
    || ([CommandLine] =~ ['.*0x01100.*40.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: renamed_whoami_execution
  description: Detects the execution of whoami that has been renamed to a different
    name to avoid detection
  condition: ([OriginalFileName] == ['whoami.exe']) && ([Image] !~ ['.*.*whoami.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,discovery,t1033,car,2016-03-001
  exttype: SIEM
- name: default_powersploit_and_empire_schtasks_persistence
  description: Detects the creation of a schtask via PowerSploit or Empire Default
    Configuration.
  condition: ([ParentImage] =~ ['.*.*powershell.exe']) && ([Image] =~ ['.*.*schtasks.exe'])
    && ([CommandLine] =~ ['.*.*Create.*']) && ([CommandLine] =~ ['.*.*SC.*']) && (([CommandLine]
    =~ ['.*ONLOGON.*']) || ([CommandLine] =~ ['.*DAILY.*']) || ([CommandLine] =~ ['.*ONIDLE.*'])
    || ([CommandLine] =~ ['.*Updater.*'])) && ([CommandLine] =~ ['.*.*TN.*']) && ([CommandLine]
    =~ ['.*Updater.*']) && ([CommandLine] =~ ['.*.*TR.*']) && ([CommandLine] =~ ['.*powershell.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,persistence,privilege_escalation,t1053,t1086,s0111,g0022,g0060,car,2013-08-001,005,t1059,001
  exttype: SIEM
- name: suspicious_service_path_modification
  description: Detects service path modification to PowerShell or cmd.
  condition: ([Image] =~ ['.*.*sc.exe']) && ([CommandLine] =~ ['.*config.*']) && ([CommandLine]
    =~ ['.*binpath.*']) && (([CommandLine] =~ ['.*powershell.*']) || ([CommandLine]
    =~ ['.*cmd.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1543,003,t1031
  exttype: SIEM
- name: powershell_amsi_bypass_via__net_reflection
  description: Detects Request to amsiInitFailed that can be used to disable AMSI
    Scanning
  condition: (([CommandLine] =~ ['.*System.Management.Automation.AmsiUtils.*'])) &&
    (([CommandLine] =~ ['.*amsiInitFailed.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: script_event_consumer_spawning_process
  description: Detects a suspicious child process of Script Event Consumer (scrcons.exe).
  condition: (([ParentImage] =~ ['.*.*scrcons.exe'])) && (([Image] =~ ['.*.*svchost.exe'])
    || ([Image] =~ ['.*.*dllhost.exe']) || ([Image] =~ ['.*.*powershell.exe']) ||
    ([Image] =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe']) || ([Image]
    =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*regsvr32.exe']) || ([Image] =~ ['.*.*mshta.exe'])
    || ([Image] =~ ['.*.*rundll32.exe']) || ([Image] =~ ['.*.*msiexec.exe']) || ([Image]
    =~ ['.*.*msbuild.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047
  exttype: SIEM
- name: empire_powershell_uac_bypass
  description: Detects some Empire PowerShell UAC bypass methods
  condition: (([CommandLine] =~ ['.*.*.*NoP.*.*NonI.*.*w.*Hidden.*.*c.*.*x=.*.*.*gp.*HKCU.*Software.*.*Microsoft.*.*Windows.*Update.*.Update.*.*'])
    || ([CommandLine] =~ ['.*.*.*NoP.*.*NonI.*.*c.*.*x=.*.*.*gp.*HKCU.*Software.*.*Microsoft.*.*Windows.*Update.*.Update.*.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1548,002,t1088,car,2019-04-001
  exttype: SIEM
- name: dtrack_process_creation
  description: Detects specific process parameters as seen in DTRACK infections
  condition: ([CommandLine] =~ ['.*.*echo.*EEEE.*.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: unc2452_process_creation_patterns
  description: Detects a specific process creation patterns as seen used by UNC2452
    and provided by Microsoft as Microsoft Defender ATP queries
  condition: (([CommandLine] =~ ['.*7z.exe.*a.*.*v500m.*.*mx9.*.*r0.*.*p.*'])) ||
    ([ParentCommandLine] =~ ['.*wscript.exe.*']) && ([ParentCommandLine] =~ ['.*.vbs.*'])
    && ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*C.*.*Windows.*'])
    && ([CommandLine] =~ ['.*.dll.*Tk.*.*']) || ([ParentImage] =~ ['.*.*rundll32.exe'])
    && ([ParentCommandLine] =~ ['.*C.*.*Windows.*']) && ([CommandLine] =~ ['.*cmd.exe.*.*C.*.*'])
    || ([CommandLine] =~ ['.*rundll32.*c.*.*windows.*.*.*']) && ([CommandLine] =~
    ['.*.dll.*.*']) || ([ParentImage] =~ ['.*.*rundll32.exe']) && ([Image] =~ ['.*.*dllhost.exe'])
    && (([CommandLine] !~ ['.*']) || ([CommandLine] !~ ['']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: suspicious_double_extension
  description: Detects suspicious use of an .exe extension after a non-executable
    file extension like .pdf.exe, a set of spaces or underlines to cloak the executable
    file in spear phishing campaigns
  condition: (([Image] =~ ['.*.doc.exe']) || ([Image] =~ ['.*.docx.exe']) || ([Image]
    =~ ['.*.xls.exe']) || ([Image] =~ ['.*.xlsx.exe']) || ([Image] =~ ['.*.ppt.exe'])
    || ([Image] =~ ['.*.pptx.exe']) || ([Image] =~ ['.*.rtf.exe']) || ([Image] =~
    ['.*.pdf.exe']) || ([Image] =~ ['.*.txt.exe']) || ([Image] =~ ['.*.*.*.*.*.*.*.exe'])
    || ([Image] =~ ['.*.*.*.*.*.*.*.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1566,001,t1193
  exttype: SIEM
- name: suspicious_script_execution_from_temp_folder
  description: Detects a suspicious script executions from temporary folder
  condition: (([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*mshta.exe'])
    || ([Image] =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe'])) && (([CommandLine]
    =~ ['.*.*Windows.*Temp.*']) || ([CommandLine] =~ ['.*.*Temporary.*Internet.*'])
    || ([CommandLine] =~ ['.*.*AppData.*Local.*Temp.*']) || ([CommandLine] =~ ['.*.*AppData.*Roaming.*Temp.*'])
    || ([CommandLine] =~ ['.*.*TEMP.*.*']) || ([CommandLine] =~ ['.*.*TMP.*.*']) ||
    ([CommandLine] =~ ['.*.*LocalAppData.*.*Temp.*'])) && (([CommandLine] !~ ['.*.*.*.*'])
    || ([CommandLine] !~ ['.*Out.*File.*']) || ([CommandLine] !~ ['.*ConvertTo.*Json.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: proxy_execution_via_explorer_exe
  description: Attackers can use explorer.exe for evading defense mechanisms
  condition: (([Image] =~ ['.*.*explorer.exe'])) && (([ParentImage] =~ ['.*.*cmd.exe']))
    && (([CommandLine] =~ ['.*explorer.exe.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: renamed_procdump
  description: Detects the execution of a renamed ProcDump executable often used by
    attackers or malware
  condition: ([OriginalFileName] == ['procdump']) || ([CommandLine] =~ ['.*.*.*ma.*.*'])
    && ([CommandLine] =~ ['.*.*.*accepteula.*.*']) || ([CommandLine] =~ ['.*.*.*ma.*.*'])
    && ([CommandLine] =~ ['.*.dmp.*']) && (([Image] !~ ['.*.*procdump.exe']) || ([Image]
    !~ ['.*.*procdump64.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003
  exttype: SIEM
- name: adwind_rat___jrat
  description: Detects javaw.exe in AppData folder as used by Adwind / JRAT
  condition: ([CommandLine] =~ ['.*.*AppData.*Roaming.*Oracle.*']) && ([CommandLine]
    =~ ['.*.*java.*']) && ([CommandLine] =~ ['.*.exe.*.*']) || ([CommandLine] =~ ['.*cscript.exe.*'])
    && ([CommandLine] =~ ['.*Retrive.*']) && ([CommandLine] =~ ['.*.vbs.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,t1064
  exttype: SIEM
- name: adwind_rat___jrat
  description: Detects javaw.exe in AppData folder as used by Adwind / JRAT
  condition: ([TargetFilename] =~ ['.*.*AppData.*Roaming.*Oracle.*bin.*java.*']) &&
    ([TargetFilename] =~ ['.*.exe.*']) || ([TargetFilename] =~ ['.*.*Retrive.*'])
    && ([TargetFilename] =~ ['.*.vbs.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,t1064
  exttype: SIEM
- name: adwind_rat___jrat
  description: Detects javaw.exe in AppData folder as used by Adwind / JRAT
  condition: ([TargetObject] =~ ['HKLM.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*Run.*'])
    && ([Details] =~ ['.*AppData.*.*Roaming.*Oracle.*bin.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,t1064
  exttype: SIEM
- name: suspicious_call_by_ordinal
  description: Detects suspicious calls of DLLs in rundll32.dll exports by ordinal
  condition: ([CommandLine] =~ ['.*.*rundll32.exe.*']) && ([CommandLine] =~ ['.*.*.*.*'])
    && ([CommandLine] !~ ['.*EDGEHTML.dll.*']) && ([CommandLine] !~ ['.*.*141.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1218,011,t1085
  exttype: SIEM
- name: cobaltstrike_load_by_rundll32
  description: Rundll32 can be use by Cobalt Strike with StartW function to load DLLs
    from the command line.
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*.dll.*'])
    && ([CommandLine] =~ ['.*StartW.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011
  exttype: SIEM
- name: suspicious_powershell_mailbox_export_to_share
  description: Detects a PowerShell New-MailboxExportRequest that exports a mailbox
    to a local share, as used in ProxyShell exploitations
  condition: ([CommandLine] =~ ['.*New.*MailboxExport.*']) && ([CommandLine] =~ ['.*.*.*Mailbox.*.*'])
    && ([CommandLine] =~ ['.*.*.*FilePath.*.*.*127.0.0.1.*C.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: mshta_javascript_execution
  description: Identifies suspicious mshta.exe commands.
  condition: ([Image] =~ ['.*.*mshta.exe']) && ([CommandLine] =~ ['.*javascript.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1170,t1218,005
  exttype: SIEM
- name: tasks_folder_evasion
  description: The Tasks folder in system32 and syswow64 are globally writable paths.
    Adversaries can take advantage of this and load or influence any script hosts
    or ANY .NET Application in Tasks to load and execute a custom assembly into cscript,
    wscript, regsvr32, mshta, eventvwr
  condition: (([CommandLine] =~ ['.*echo.*.*']) || ([CommandLine] =~ ['.*copy.*.*'])
    || ([CommandLine] =~ ['.*type.*.*']) || ([CommandLine] =~ ['.*file.*createnew.*']))
    && (([CommandLine] =~ ['.*.*C.*.*Windows.*System32.*Tasks.*.*.*']) || ([CommandLine]
    =~ ['.*.*C.*.*Windows.*SysWow64.*Tasks.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,persistence,execution,t1574,002,t1059,t1064
  exttype: SIEM
- name: indirect_command_execution_by_program_compatibility_wizard
  description: Detect indirect command execution via Program Compatibility Assistant
    pcwrun.exe
  condition: ([ParentImage] =~ ['.*.*pcwrun.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,execution
  exttype: SIEM
- name: using_sticky_keys_to_obtain_unauthenticated__privileged_console_access
  description: By replacing the sticky keys executable with the local admins CMD executable,
    an attacker is able to access a privileged windows console session without authenticating
    to the system. When the sticky keys are "activated" the privilleged shell is launched.
  condition: (([CommandLine] =~ ['copy.*.*y.*C.*.*windows.*system32.*cmd.exe.*C.*.*windows.*system32.*sethc.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,t1015,t1546,008,privilege_escalation
  exttype: SIEM
- name: suspicious_wmi_execution_using_rundll32
  description: Detects WMI executing rundll32
  condition: ([CommandLine] =~ ['.*process.*call.*create.*']) && ([CommandLine] =~
    ['.*rundll32.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047
  exttype: SIEM
- name: network_sniffing
  description: Network sniffing refers to using the network interface on a system
    to monitor or capture information sent over a wired or wireless connection. An
    adversary may place a network interface into promiscuous mode to passively access
    data in transit over the network, or use span ports to capture a larger amount
    of data.
  condition: ([Image] =~ ['.*.*tshark.exe']) && ([CommandLine] =~ ['.*.*i.*']) ||
    ([Image] =~ ['.*.*windump.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,credential_access,discovery,t1040
  exttype: SIEM
- name: suspicious_splwow64_without_params
  description: Detects suspicious Splwow64.exe process without any command line parameters
  condition: ([Image] =~ ['.*.*splwow64.exe']) && ([CommandLine] !~ ['.*splwow64.exe'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: encoded_iex
  description: Detects a base64 encoded IEX command string in a process command line
  condition: (([CommandLine] =~ ['.*SUVYIChb.*']) || ([CommandLine] =~ ['.*lFWCAoW.*'])
    || ([CommandLine] =~ ['.*JRVggKF.*']) || ([CommandLine] =~ ['.*aWV4IChb.*']) ||
    ([CommandLine] =~ ['.*lleCAoW.*']) || ([CommandLine] =~ ['.*pZXggKF.*']) || ([CommandLine]
    =~ ['.*aWV4IChOZX.*']) || ([CommandLine] =~ ['.*lleCAoTmV3.*']) || ([CommandLine]
    =~ ['.*pZXggKE5ld.*']) || ([CommandLine] =~ ['.*SUVYIChOZX.*']) || ([CommandLine]
    =~ ['.*lFWCAoTmV3.*']) || ([CommandLine] =~ ['.*JRVggKE5ld.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: msiexec_web_install
  description: Detects suspicious msiexec process starts with web addresses as parameter
  condition: ([CommandLine] =~ ['.*.*msiexec.*']) && ([CommandLine] =~ ['.*.*.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,007,command_and_control,t1105
  exttype: SIEM
- name: suspicious_xor_encoded_powershell_command_line
  description: Detects suspicious powershell process which includes bxor command,
    alternative obfuscation method to b64 encoded commands.
  condition: ([Description] == ['Windows PowerShell']) || ([Product] == ['PowerShell
    Core 6']) && (([CommandLine] =~ ['.*bxor.*']) || ([CommandLine] =~ ['.*join.*'])
    || ([CommandLine] =~ ['.*char.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1086,t1059,001,t1140,t1027
  exttype: SIEM
- name: windows_processes_suspicious_parent_directory
  description: Detect suspicious parent processes of well-known Windows processes
  condition: (([Image] =~ ['.*.*svchost.exe']) || ([Image] =~ ['.*.*taskhost.exe'])
    || ([Image] =~ ['.*.*lsm.exe']) || ([Image] =~ ['.*.*lsass.exe']) || ([Image]
    =~ ['.*.*services.exe']) || ([Image] =~ ['.*.*lsaiso.exe']) || ([Image] =~ ['.*.*csrss.exe'])
    || ([Image] =~ ['.*.*wininit.exe']) || ([Image] =~ ['.*.*winlogon.exe'])) && ([ParentImage]
    !~ ['.*.*SavService.exe']) || (([ParentImage] !~ ['.*.*System32.*.*.*']) || ([ParentImage]
    !~ ['.*.*SysWOW64.*.*.*'])) && (([ParentImage] !~ ['.*.*Windows.*Defender.*.*.*'])
    || ([ParentImage] !~ ['.*.*Microsoft.*Security.*Client.*.*.*'])) && ([ParentImage]
    !~ ['.*.*MsMpEng.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003,005
  exttype: SIEM
- name: hh_exe_execution
  description: Identifies usage of hh.exe executing recently modified .chm files.
  condition: ([Image] =~ ['.*.*hh.exe']) && ([CommandLine] =~ ['.*.chm.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,001,execution,t1223
  exttype: SIEM
- name: renamed_sysinternals_debug_view
  description: Detects suspicious renamed SysInternals DebugView execution
  condition: (([Product] =~ ['Sysinternals.*DebugView']) || ([Product] =~ ['Sysinternals.*Debugview']))
    && ([OriginalFileName] == ['Dbgview.exe']) && ([Image] !~ ['.*.*Dbgview.exe'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: windows_update_client_lolbin
  description: Detects code execution via the Windows Update client (wuauclt)
  condition: ([ProcessCommandLine] =~ ['.*.*UpdateDeploymentProvider.*']) && ([ProcessCommandLine]
    =~ ['.*.*RunHandlerComServer.*']) && (([Image] =~ ['.*.*wuauclt.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,execution,t1105,t1218
  exttype: SIEM
- name: shimcache_flush
  description: Detects actions that clear the local ShimCache and remove forensic
    evidence
  condition: ([CommandLine] =~ ['.*rundll32.*']) && ([CommandLine] =~ ['.*apphelp.dll.*'])
    && (([CommandLine] =~ ['.*ShimFlushCache.*']) || ([CommandLine] =~ ['.*.*250.*']))
    || ([CommandLine] =~ ['.*kernel32.dll.*']) && (([CommandLine] =~ ['.*BaseFlushAppcompatCache.*'])
    || ([CommandLine] =~ ['.*.*46.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: conti_backup_database
  description: Detects a command used by conti to dump database
  condition: (([CommandLine] =~ ['.*sqlcmd.*.*']) || ([CommandLine] =~ ['.*sqlcmd.exe.*']))
    && ([CommandLine] =~ ['.*.*.*S.*localhost.*.*']) && (([CommandLine] =~ ['.*sys.sysprocesses.*'])
    || ([CommandLine] =~ ['.*master.dbo.sysdatabases.*']) || ([CommandLine] =~ ['.*BACKUP.*DATABASE.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,collection
  exttype: SIEM
- name: harvesting_of_wifi_credentials_using_netsh_exe
  description: Detect the harvesting of wifi credentials using netsh.exe
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*wlan.*']) &&
    ([CommandLine] =~ ['.*.*s.*']) && ([CommandLine] =~ ['.*.*p.*']) && ([CommandLine]
    =~ ['.*.*k.*']) && ([CommandLine] =~ ['.*=clear.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,credential_access,t1040
  exttype: SIEM
- name: always_install_elevated_msi_spawned_cmd_and_powershell
  description: This rule will looks for Windows Installer service (msiexec.exe) spawned
    command line and/or powershell
  condition: (([Image] =~ ['.*.*cmd.exe']) || ([Image] =~ ['.*.*powershell.exe']))
    && ([ParentImage] =~ ['.*.*Windows.*Installer.*.*.*']) && ([ParentImage] =~ ['.*msi.*'])
    && (([ParentImage] =~ ['.*tmp']))
  level: medium
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548,002
  exttype: SIEM
- name: bloodhound_and_sharphound_hack_tool
  description: Detects command line parameters used by Bloodhound and Sharphound hack
    tools
  condition: (([Image] =~ ['.*.*Bloodhound.exe.*']) || ([Image] =~ ['.*.*SharpHound.exe.*']))
    || (([CommandLine] =~ ['.*.*.*CollectionMethod.*All.*.*']) || ([CommandLine] =~
    ['.*.exe.*.*c.*All.*.*d.*.*']) || ([CommandLine] =~ ['.*Invoke.*Bloodhound.*'])
    || ([CommandLine] =~ ['.*Get.*BloodHoundData.*'])) || ([CommandLine] =~ ['.*.*.*JsonFolder.*.*'])
    && ([CommandLine] =~ ['.*.*.*ZipFileName.*.*']) || ([CommandLine] =~ ['.*.*DCOnly.*.*'])
    && ([CommandLine] =~ ['.*.*.*.*NoSaveCache.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,discovery,t1087,001,002,t1482,t1069,execution,t1059,t1086
  exttype: SIEM
- name: covenant_launcher_indicators
  description: Detects suspicious command lines used in Covenant luanchers
  condition: ([CommandLine] =~ ['.*.*Sta.*']) && ([CommandLine] =~ ['.*.*Nop.*'])
    && ([CommandLine] =~ ['.*.*Window.*']) && ([CommandLine] =~ ['.*Hidden.*']) &&
    (([CommandLine] =~ ['.*.*Command.*']) || ([CommandLine] =~ ['.*.*EncodedCommand.*']))
    || (([CommandLine] =~ ['.*sv.*o.*.*New.*Object.*IO.MemorySteam.*.*sv.*d.*.*'])
    || ([CommandLine] =~ ['.*mshta.*file.hta.*']) || ([CommandLine] =~ ['.*GruntHTTP.*'])
    || ([CommandLine] =~ ['.*.*EncodedCommand.*cwB2ACAAbwAgA.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1059,001,t1564,003,t1086
  exttype: SIEM
- name: execution_via_diskshadow_exe
  description: Detects using Diskshadow.exe to execute arbitrary code in text file
  condition: ([Image] =~ ['.*.*diskshadow.exe']) && (([CommandLine] =~ ['.*.*s.*'])
    || ([CommandLine] =~ ['.*.*s.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1218
  exttype: SIEM
- name: suspicious_vbscript_un2452_pattern
  description: Detects suspicious inline VBScript keywords as used by UNC2452
  condition: ([CommandLine] =~ ['.*Execute.*']) && ([CommandLine] =~ ['.*CreateObject.*'])
    && ([CommandLine] =~ ['.*RegRead.*']) && ([CommandLine] =~ ['.*window.close.*'])
    && ([CommandLine] =~ ['.*.*Microsoft.*Windows.*CurrentVersion.*']) && (([CommandLine]
    !~ ['.*.*Software.*Microsoft.*Windows.*CurrentVersion.*Run.*']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: detect_virtualbox_driver_installation_or_starting_of_vms
  description: Adversaries can carry out malicious operations using a virtual instance
    to avoid detection. This rule is built to detect the registration of the Virtualbox
    driver or start of a Virtualbox VM.
  condition: (([CommandLine] =~ ['.*VBoxRT.dll.*RTR3Init.*']) || ([CommandLine] =~
    ['.*VBoxC.dll.*']) || ([CommandLine] =~ ['.*VBoxDrv.sys.*'])) || (([CommandLine]
    =~ ['.*startvm.*']) || ([CommandLine] =~ ['.*controlvm.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1564,006
  exttype: SIEM
- name: highly_relevant_renamed_binary
  description: Detects the execution of a renamed binary often used by attackers or
    malware leveraging new Sysmon OriginalFileName datapoint.
  condition: (([OriginalFileName] =~ ['powershell.exe']) || ([OriginalFileName] =~
    ['powershell.*ise.exe']) || ([OriginalFileName] =~ ['psexec.exe']) || ([OriginalFileName]
    =~ ['psexec.c']) || ([OriginalFileName] =~ ['cscript.exe']) || ([OriginalFileName]
    =~ ['wscript.exe']) || ([OriginalFileName] =~ ['mshta.exe']) || ([OriginalFileName]
    =~ ['regsvr32.exe']) || ([OriginalFileName] =~ ['wmic.exe']) || ([OriginalFileName]
    =~ ['certutil.exe']) || ([OriginalFileName] =~ ['rundll32.exe']) || ([OriginalFileName]
    =~ ['cmstp.exe']) || ([OriginalFileName] =~ ['msiexec.exe'])) && (([Image] !~
    ['.*.*powershell.exe']) || ([Image] !~ ['.*.*powershell.*ise.exe']) || ([Image]
    !~ ['.*.*psexec.exe']) || ([Image] !~ ['.*.*psexec64.exe']) || ([Image] !~ ['.*.*cscript.exe'])
    || ([Image] !~ ['.*.*wscript.exe']) || ([Image] !~ ['.*.*mshta.exe']) || ([Image]
    !~ ['.*.*regsvr32.exe']) || ([Image] !~ ['.*.*wmic.exe']) || ([Image] !~ ['.*.*certutil.exe'])
    || ([Image] !~ ['.*.*rundll32.exe']) || ([Image] !~ ['.*.*cmstp.exe']) || ([Image]
    !~ ['.*.*msiexec.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003
  exttype: SIEM
- name: suspicious_rundll32_without_any_commandline_params
  description: Detects suspicious start of rundll32.exe without any parameters as
    found in CobaltStrike beacon activity
  condition: ([CommandLine] =~ ['.*.*rundll32.exe']) && ([ParentImage] !~ ['.*.*svchost.exe'])
    && (([ParentImage] !~ ['.*.*AppData.*Local.*.*.*']) || ([ParentImage] !~ ['.*.*Microsoft.*Edge.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: cmstp_uac_bypass_via_com_object_access
  description: Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile
    Installer Autoelevate-capable COM Objects
  condition: ([ParentCommandLine] =~ ['.*.*DllHost.exe.*.*']) && (([ParentCommandLine]
    =~ ['.*.*3E5FC7F9.*9A51.*4367.*9063.*A120244FBEC7.*']) || ([ParentCommandLine]
    =~ ['.*.*3E000D72.*A845.*4CD9.*BD83.*80C07C3B881F.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,privilege_escalation,t1548,002,t1088,t1218,003,t1191,g0069,car,2019-04-001
  exttype: SIEM
- name: control_panel_items
  description: Detects the malicious use of a control panel item
  condition: ([CommandLine] =~ ['.*.cpl']) && (([CommandLine] !~ ['.*.*System32.*.*.*'])
    || ([CommandLine] !~ ['.*.*System.*.*'])) || ([Image] =~ ['.*.*reg.exe']) && ([CommandLine]
    =~ ['.*add.*']) && (([CommandLine] =~ ['.*CurrentVersion.*.*Control.*Panel.*.*CPLs.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1218,002,t1196,persistence,t1546
  exttype: SIEM
- name: netsh_rdp_port_opening
  description: Detects netsh commands that opens the port 3389 used for RDP, used
    in Sarwent Malware
  condition: ([CommandLine] =~ ['.*netsh.*']) && ([CommandLine] =~ ['.*firewall.*add.*portopening.*'])
    && ([CommandLine] =~ ['.*tcp.*3389.*']) || ([CommandLine] =~ ['.*advfirewall.*firewall.*add.*rule.*'])
    && ([CommandLine] =~ ['.*action=allow.*']) && ([CommandLine] =~ ['.*protocol=TCP.*'])
    && ([CommandLine] =~ ['.*localport=3389.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,004
  exttype: SIEM
- name: abusing_findstr_for_defense_evasion
  description: Attackers can use findstr to hide their artifacts or search specific
    strings and evade defense mechanism
  condition: (([CommandLine] =~ ['.*findstr.*'])) && ([CommandLine] =~ ['.*.*V.*'])
    && ([CommandLine] =~ ['.*.*L.*']) || ([CommandLine] =~ ['.*.*S.*']) && ([CommandLine]
    =~ ['.*.*I.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: findstr_launching__lnk_file
  description: Detects usage of findstr to identify and execute a lnk file as seen
    within the HHS redirect attack
  condition: ([Image] =~ ['.*.*findstr.exe']) && ([CommandLine] =~ ['.*.lnk'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,t1202,t1027,003
  exttype: SIEM
- name: suspicious_calculator_usage
  description: Detects suspicious use of calc.exe with command line parameters or
    in a suspicious directory, which is likely caused by some PoC or detection evasion
  condition: ([CommandLine] =~ ['.*.*calc.exe.*.*']) || ([Image] =~ ['.*.*calc.exe'])
    && ([Image] !~ ['.*.*Windows.*Sys.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: suspicious_rundll32_invoking_inline_vbscript
  description: Detects suspicious process related to rundll32 based on command line
    that invokes inline VBScript as seen being used by UNC2452
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*Execute.*'])
    && ([CommandLine] =~ ['.*RegRead.*']) && ([CommandLine] =~ ['.*window.close.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: suspicious_use_of_procdump_on_lsass
  description: Detects suspicious uses of the SysInternals Procdump utility by using
    a special command line parameter in combination with the lsass.exe process. This
    way we're also able to catch cases in which the attacker has renamed the procdump
    executable.
  condition: ([CommandLine] =~ ['.*.*.*ma.*.*']) && ([CommandLine] =~ ['.*.*lsass.*'])
    || ([CommandLine] =~ ['.*.*ls.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,credential_access,t1003,001,car,2013-05-009
  exttype: SIEM
- name: suspicious_service_binary_directory
  description: Detects a service binary running in a suspicious directory
  condition: (([Image] =~ ['.*.*Users.*Public.*.*.*']) || ([Image] =~ ['.*.*.*Recycle.bin.*'])
    || ([Image] =~ ['.*.*Users.*All.*Users.*.*.*']) || ([Image] =~ ['.*.*Users.*Default.*.*.*'])
    || ([Image] =~ ['.*.*Users.*Contacts.*.*.*']) || ([Image] =~ ['.*.*Users.*Searches.*.*.*'])
    || ([Image] =~ ['.*C.*.*Perflogs.*.*.*']) || ([Image] =~ ['.*.*config.*systemprofile.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*Fonts.*.*.*']) || ([Image] =~ ['.*.*Windows.*IME.*.*.*'])
    || ([Image] =~ ['.*.*Windows.*addins.*.*.*'])) && (([ParentImage] =~ ['.*.*services.exe'])
    || ([ParentImage] =~ ['.*.*svchost.exe']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: execution_of_renamed_paexec
  description: Detects execution of renamed paexec via imphash and executable product
    string
  condition: (([Product] =~ ['.*PAExec.*'])) && (([Imphash] =~ ['11D40A7B7876288F919AB819CC2D9802'])
    || ([Imphash] =~ ['6444f8a34e99b8f7d9647de66aabe516']) || ([Imphash] =~ ['dfd6aa3f7b2b1035b76b718f1ddc689f'])
    || ([Imphash] =~ ['1a6cca4d5460b1710a12dea39e4a592c'])) && ([Image] !~ ['.*paexec.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003,g0046,car,2013-05-009
  exttype: SIEM
- name: impacket_tool_execution
  description: Detects the execution of different compiled Windows binaries of the
    impacket toolset (based on names or part of their names - could lead to false
    positives)
  condition: (([Image] =~ ['.*.*goldenPac.*']) || ([Image] =~ ['.*.*karmaSMB.*'])
    || ([Image] =~ ['.*.*kintercept.*']) || ([Image] =~ ['.*.*ntlmrelayx.*']) || ([Image]
    =~ ['.*.*rpcdump.*']) || ([Image] =~ ['.*.*samrdump.*']) || ([Image] =~ ['.*.*secretsdump.*'])
    || ([Image] =~ ['.*.*smbexec.*']) || ([Image] =~ ['.*.*smbrelayx.*']) || ([Image]
    =~ ['.*.*wmiexec.*']) || ([Image] =~ ['.*.*wmipersist.*'])) || (([Image] =~ ['.*.*atexec.*windows.exe'])
    || ([Image] =~ ['.*.*dcomexec.*windows.exe']) || ([Image] =~ ['.*.*dpapi.*windows.exe'])
    || ([Image] =~ ['.*.*findDelegation.*windows.exe']) || ([Image] =~ ['.*.*GetADUsers.*windows.exe'])
    || ([Image] =~ ['.*.*GetNPUsers.*windows.exe']) || ([Image] =~ ['.*.*getPac.*windows.exe'])
    || ([Image] =~ ['.*.*getST.*windows.exe']) || ([Image] =~ ['.*.*getTGT.*windows.exe'])
    || ([Image] =~ ['.*.*GetUserSPNs.*windows.exe']) || ([Image] =~ ['.*.*ifmap.*windows.exe'])
    || ([Image] =~ ['.*.*mimikatz.*windows.exe']) || ([Image] =~ ['.*.*netview.*windows.exe'])
    || ([Image] =~ ['.*.*nmapAnswerMachine.*windows.exe']) || ([Image] =~ ['.*.*opdump.*windows.exe'])
    || ([Image] =~ ['.*.*psexec.*windows.exe']) || ([Image] =~ ['.*.*rdp.*check.*windows.exe'])
    || ([Image] =~ ['.*.*sambaPipe.*windows.exe']) || ([Image] =~ ['.*.*smbclient.*windows.exe'])
    || ([Image] =~ ['.*.*smbserver.*windows.exe']) || ([Image] =~ ['.*.*sniffer.*windows.exe'])
    || ([Image] =~ ['.*.*sniff.*windows.exe']) || ([Image] =~ ['.*.*split.*windows.exe'])
    || ([Image] =~ ['.*.*ticketer.*windows.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1557,001
  exttype: SIEM
- name: dns_rce_cve_2020_1350
  description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the
    detection of suspicious sub process
  condition: ([ParentImage] =~ ['.*.*System32.*dns.exe']) && (([Image] !~ ['.*.*System32.*werfault.exe'])
    || ([Image] !~ ['.*.*System32.*conhost.exe']) || ([Image] !~ ['.*.*System32.*dnscmd.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190,execution,t1569,002
  exttype: SIEM
- name: suspect_svchost_activity
  description: It is extremely abnormal for svchost.exe to spawn without any CLI arguments
    and is normally observed when a malicious process spawns the process and injects
    code into the process memory space.
  condition: ([CommandLine] =~ ['.*svchost.exe']) && ([Image] =~ ['.*.*svchost.exe'])
    && (([ParentImage] !~ ['.*.*rpcnet.exe']) || ([ParentImage] !~ ['.*.*rpcnetp.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: execution_via_cl_mutexverifiers_ps1
  description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1
    module
  condition: ([CommandLine] =~ ['.*CL.*Mutexverifiers.ps1.*']) && ([CommandLine] =~
    ['.*runAfterCancelProcess.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: abused_debug_privilege_by_arbitrary_parent_processes
  description: Detection of unusual child processes by different system processes
  condition: (([ParentImage] =~ ['.*.*winlogon.exe']) || ([ParentImage] =~ ['.*.*services.exe'])
    || ([ParentImage] =~ ['.*.*lsass.exe']) || ([ParentImage] =~ ['.*.*csrss.exe'])
    || ([ParentImage] =~ ['.*.*smss.exe']) || ([ParentImage] =~ ['.*.*wininit.exe'])
    || ([ParentImage] =~ ['.*.*spoolsv.exe']) || ([ParentImage] =~ ['.*.*searchindexer.exe']))
    && (([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*cmd.exe'])) && ([User]
    == ['NT AUTHORITY\SYSTEM']) && ([CommandLine] !~ ['.*.*route.*.*']) && ([CommandLine]
    !~ ['.*.*ADD.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548
  exttype: SIEM
- name: visual_basic_command_line_compiler_usage
  description: Detects successful code compilation via Visual Basic Command Line Compiler
    that utilizes Windows Resource to Object Converter.
  condition: ([ParentImage] =~ ['.*.*vbc.exe']) && ([Image] =~ ['.*.*cvtres.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027,004
  exttype: SIEM
- name: powershell_downloadfile
  description: Detects the execution of powershell, a WebClient object creation and
    the invocation of DownloadFile in a single command line
  condition: ([CommandLine] =~ ['.*powershell.*']) && ([CommandLine] =~ ['.*.DownloadFile.*'])
    && ([CommandLine] =~ ['.*System.Net.WebClient.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086,command_and_control,t1104,t1105
  exttype: SIEM
- name: redmimicry_winnti_playbook_execute
  description: Detects actions caused by the RedMimicry Winnti playbook
  condition: (([Image] =~ ['.*rundll32.exe.*']) || ([Image] =~ ['.*cmd.exe.*'])) &&
    (([CommandLine] =~ ['.*gthread.*3.6.dll.*']) || ([CommandLine] =~ ['.*.*Windows.*Temp.*tmp.bat.*'])
    || ([CommandLine] =~ ['.*sigcmm.*2.4.dll.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1059,t1106,003,t1218,011
  exttype: SIEM
- name: xsl_script_processing
  description: Extensible Stylesheet Language (XSL) files are commonly used to describe
    the processing and rendering of data within XML files. Rule detects when adversaries
    abuse this functionality to execute arbitrary files while potentially bypassing
    application whitelisting defenses.
  condition: ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine] =~ ['.*.*format.*'])
    || ([Image] =~ ['.*.*msxsl.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1220,execution
  exttype: SIEM
- name: audio_capture_via_powershell
  description: Detects audio capture via PowerShell Cmdlet.
  condition: ([CommandLine] =~ ['.*WindowsAudioDevice.*Powershell.*Cmdlet.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1123
  exttype: SIEM
- name: awl_bypass_with_winrm_vbs_and_malicious_wsmpty_xsl_wsmtxt_xsl
  description: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via
    winrm.vbs and copied cscript.exe (can be renamed)
  condition: ([CommandLine] =~ ['.*winrm.*']) && (([CommandLine] =~ ['.*format.*pretty.*'])
    || ([CommandLine] =~ ['.*format.*.*pretty.*.*']) || ([CommandLine] =~ ['.*format.*.*text.*.*'])
    || ([CommandLine] =~ ['.*format.*text.*'])) && (([Image] !~ ['C.*.*Windows.*System32.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: awl_bypass_with_winrm_vbs_and_malicious_wsmpty_xsl_wsmtxt_xsl
  description: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via
    winrm.vbs and copied cscript.exe (can be renamed)
  condition: (([TargetFilename] =~ ['.*WsmPty.xsl']) || ([TargetFilename] =~ ['.*WsmTxt.xsl']))
    && (([TargetFilename] !~ ['C.*.*Windows.*System32.*.*.*']) || ([TargetFilename]
    !~ ['C.*.*Windows.*SysWOW64.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: suspicious_execution_from_outlook
  description: Detects EnableUnsafeClientMailRules used for Script Execution from
    Outlook
  condition: ([CommandLine] =~ ['.*EnableUnsafeClientMailRules.*']) || ([ParentImage]
    =~ ['.*.*outlook.exe']) && ([CommandLine] =~ ['.*.*.*.*.*.*.*']) && ([CommandLine]
    =~ ['.*.*.*.*.*']) && ([CommandLine] =~ ['.*.exe.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,t1202
  exttype: SIEM
- name: exploit_for_cve_2015_1641
  description: Detects Winword starting uncommon sub process MicroScMgmt.exe as used
    in exploits for CVE-2015-1641
  condition: ([ParentImage] =~ ['.*.*WINWORD.EXE']) && ([Image] =~ ['.*.*MicroScMgmt.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,005
  exttype: SIEM
- name: exfiltration_and_tunneling_tools_execution
  description: Execution of well known tools for data exfiltration and tunneling
  condition: (([Image] =~ ['.*.*plink.exe']) || ([Image] =~ ['.*.*socat.exe']) ||
    ([Image] =~ ['.*.*stunnel.exe']) || ([Image] =~ ['.*.*httptunnel.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,command_and_control,t1043,t1041,t1572,t1071,001
  exttype: SIEM
- name: conhost_parent_process_executions
  description: Detects the conhost execution as parent process. Can be used to evaded
    defense mechanism.
  condition: ([ParentImage] =~ ['.*.*conhost.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1202
  exttype: SIEM
- name: microsoft_office_product_spawning_windows_shell
  description: Detects a Windows command and scripting interpreter executable started
    from Microsoft Word, Excel, Powerpoint, Publisher and Visio
  condition: (([ParentImage] =~ ['.*.*WINWORD.EXE']) || ([ParentImage] =~ ['.*.*EXCEL.EXE'])
    || ([ParentImage] =~ ['.*.*POWERPNT.exe']) || ([ParentImage] =~ ['.*.*MSPUB.exe'])
    || ([ParentImage] =~ ['.*.*VISIO.exe']) || ([ParentImage] =~ ['.*.*OUTLOOK.EXE'])
    || ([ParentImage] =~ ['.*.*MSACCESS.EXE']) || ([ParentImage] =~ ['.*.*EQNEDT32.EXE']))
    && (([Image] =~ ['.*.*cmd.exe']) || ([Image] =~ ['.*.*powershell.exe']) || ([Image]
    =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*sh.exe'])
    || ([Image] =~ ['.*.*bash.exe']) || ([Image] =~ ['.*.*scrcons.exe']) || ([Image]
    =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*regsvr32.exe']) || ([Image] =~ ['.*.*hh.exe'])
    || ([Image] =~ ['.*.*wmic.exe']) || ([Image] =~ ['.*.*mshta.exe']) || ([Image]
    =~ ['.*.*rundll32.exe']) || ([Image] =~ ['.*.*msiexec.exe']) || ([Image] =~ ['.*.*forfiles.exe'])
    || ([Image] =~ ['.*.*scriptrunner.exe']) || ([Image] =~ ['.*.*mftrace.exe']) ||
    ([Image] =~ ['.*.*AppVLP.exe']) || ([Image] =~ ['.*.*svchost.exe']) || ([Image]
    =~ ['.*.*msbuild.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002
  exttype: SIEM
- name: f_secure_c3_load_by_rundll32
  description: F-Secure C3 produces DLLs with a default exported StartNodeRelay function.
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*.dll.*'])
    && ([CommandLine] =~ ['.*StartNodeRelay.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011
  exttype: SIEM
- name: gallium_artefacts
  description: Detects artefacts associated with activity group GALLIUM - Microsoft
    Threat Intelligence Center indicators released in December 2019.
  condition: (([sha1] =~ ['53a44c2396d15c3a03723fa5e5db54cafd527635']) || ([sha1]
    =~ ['9c5e496921e3bc882dc40694f1dcc3746a75db19']) || ([sha1] =~ ['aeb573accfd95758550cf30bf04f389a92922844'])
    || ([sha1] =~ ['79ef78a797403a4ed1a616c68e07fff868a8650a']) || ([sha1] =~ ['4f6f38b4cec35e895d91c052b1f5a83d665c2196'])
    || ([sha1] =~ ['1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d']) || ([sha1] =~ ['e841a63e47361a572db9a7334af459ddca11347a'])
    || ([sha1] =~ ['c28f606df28a9bc8df75a4d5e5837fc5522dd34d']) || ([sha1] =~ ['2e94b305d6812a9f96e6781c888e48c7fb157b6b'])
    || ([sha1] =~ ['dd44133716b8a241957b912fa6a02efde3ce3025']) || ([sha1] =~ ['8793bf166cb89eb55f0593404e4e933ab605e803'])
    || ([sha1] =~ ['a39b57032dbb2335499a51e13470a7cd5d86b138']) || ([sha1] =~ ['41cc2b15c662bc001c0eb92f6cc222934f0beeea'])
    || ([sha1] =~ ['d209430d6af54792371174e70e27dd11d3def7a7']) || ([sha1] =~ ['1c6452026c56efd2c94cea7e0f671eb55515edb0'])
    || ([sha1] =~ ['c6b41d3afdcdcaf9f442bbe772f5da871801fd5a']) || ([sha1] =~ ['4923d460e22fbbf165bbbaba168e5a46b8157d9f'])
    || ([sha1] =~ ['f201504bd96e81d0d350c3a8332593ee1c9e09de']) || ([sha1] =~ ['ddd2db1127632a2a52943a2fe516a2e7d05d70d2']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,command_and_control
  exttype: SIEM
- name: gallium_artefacts
  description: Detects artefacts associated with activity group GALLIUM - Microsoft
    Threat Intelligence Center indicators released in December 2019.
  condition: (([sha1] =~ ['e570585edc69f9074cb5e8a790708336bd45ca0f'])) && (([Image]
    !~ ['.*.*.*Program.*Files.*x86.*.*.*.*']) || ([Image] !~ ['.*.*.*Program.*Files.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,command_and_control
  exttype: SIEM
- name: lazarus_activity
  description: Detects different process creation events as described in Malwarebytes's
    threat report on Lazarus group activity
  condition: ([CommandLine] =~ ['.*mshta.*']) && ([CommandLine] =~ ['.*.zip.*']) ||
    (([ParentImage] =~ ['C.*.*Windows.*System32.*wbem.*wmiprvse.exe'])) && (([Image]
    =~ ['C.*.*Windows.*System32.*mshta.exe'])) || (([ParentImage] =~ ['.*.*.*Users.*Public.*.*.*']))
    && (([Image] =~ ['C.*.*Windows.*System32.*rundll32.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0032
  exttype: SIEM
- name: reg_disable_security_service
  description: Detects a suspicious reg.exe invocation that looks as if it would disable
    an important security service
  condition: ([CommandLine] =~ ['.*reg.*']) && ([CommandLine] =~ ['.*add.*']) && ([CommandLine]
    =~ ['.*.*.*d.*4.*']) && ([CommandLine] =~ ['.*.*.*v.*Start.*']) && (([CommandLine]
    =~ ['.*.*Sense.*.*']) || ([CommandLine] =~ ['.*.*WinDefend.*']) || ([CommandLine]
    =~ ['.*.*MsMpSvc.*']) || ([CommandLine] =~ ['.*.*NisSrv.*']) || ([CommandLine]
    =~ ['.*.*WdBoot.*.*']) || ([CommandLine] =~ ['.*.*WdNisDrv.*']) || ([CommandLine]
    =~ ['.*.*WdNisSvc.*']) || ([CommandLine] =~ ['.*.*wscsvc.*.*']) || ([CommandLine]
    =~ ['.*.*SecurityHealthService.*']) || ([CommandLine] =~ ['.*.*wuauserv.*']) ||
    ([CommandLine] =~ ['.*.*UsoSvc.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: powershell_download_from_url
  description: Detects a Powershell process that contains download commands in its
    command line string
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*new.*object.*'])
    && ([CommandLine] =~ ['.*net.webclient.*..*']) && ([CommandLine] =~ ['.*download.*'])
    && (([CommandLine] =~ ['.*string.*.*']) || ([CommandLine] =~ ['.*file.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,t1086,execution,t1059,001
  exttype: SIEM
- name: renamed_jusched_exe
  description: Detects renamed jusched.exe used by cobalt group
  condition: ([Description] == ['Java Update Scheduler']) || ([Description] == ['Java(TM)
    Update Scheduler']) && (([Image] !~ ['.*.*jusched.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1036,003
  exttype: SIEM
- name: mmc_spawning_windows_shell
  description: Detects a Windows command line executable started from MMC
  condition: ([ParentImage] =~ ['.*.*mmc.exe']) && (([Image] =~ ['.*.*cmd.exe']) ||
    ([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*wscript.exe']) || ([Image]
    =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~ ['.*.*bash.exe'])
    || ([Image] =~ ['.*.*reg.exe']) || ([Image] =~ ['.*.*regsvr32.exe'])) || (([Image]
    =~ ['.*.*BITSADMIN.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1175,t1021,003
  exttype: SIEM
- name: screenconnect_remote_access
  description: Detects ScreenConnect program starts that establish a remote access
    to that system (not meeting, not remote support)
  condition: ([CommandLine] =~ ['.*e=Access.*.*']) && ([CommandLine] =~ ['.*y=Guest.*.*'])
    && ([CommandLine] =~ ['.*.*p=.*']) && ([CommandLine] =~ ['.*.*c=.*']) && ([CommandLine]
    =~ ['.*.*k=.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: conti_volume_shadow_listing
  description: Detects a command used by conti to access volume shadow backups
  condition: ([CommandLine] =~ ['.*copy.*.*.*.*.*.*.*.*.*GLOBALROOT.*.*Device.*.*HarddiskVolumeShadowCopy.*'])
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: operation_wocao_activity
  description: Detects activity mentioned in Operation Wocao report
  condition: (([CommandLine] =~ ['.*checkadmin.exe.*127.0.0.1.*.*all.*']) || ([CommandLine]
    =~ ['.*netsh.*advfirewall.*firewall.*add.*rule.*name=powershell.*dir=in.*']) ||
    ([CommandLine] =~ ['.*cmd.*.*c.*powershell.exe.*.*ep.*bypass.*.*file.*c.*.*s.ps1.*'])
    || ([CommandLine] =~ ['.*.*tn.*win32times.*.*f.*']) || ([CommandLine] =~ ['.*create.*win32times.*binPath=.*'])
    || ([CommandLine] =~ ['.*.*c.*.*windows.*system32.*devmgr.dll.*']) || ([CommandLine]
    =~ ['.*.*.*exec.*bypass.*.*enc.*JgAg.*']) || ([CommandLine] =~ ['.*type.*.*keepass.*KeePass.config.xml.*'])
    || ([CommandLine] =~ ['.*iie.exe.*iie.txt.*']) || ([CommandLine] =~ ['.*reg.*query.*HKEY.*CURRENT.*USER.*Software.*.*.*.*PuTTY.*Sessions.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,discovery,t1012,defense_evasion,t1036,004,t1027,execution,t1053,005,t1059,001,t1086
  exttype: SIEM
- name: shadow_copies_creation_using_operating_systems_utilities
  description: Shadow Copies creation using operating systems utilities, possible
    credential access
  condition: (([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*wmic.exe'])
    || ([Image] =~ ['.*.*vssadmin.exe'])) && ([CommandLine] =~ ['.*shadow.*']) &&
    ([CommandLine] =~ ['.*create.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002,003
  exttype: SIEM
- name: zxshell_malware
  description: Detects a ZxShell start by the called and well-known function name
  condition: (([Image] =~ ['.*.*rundll32.exe'])) && (([CommandLine] =~ ['.*zxFunction.*'])
    || ([CommandLine] =~ ['.*RemoteDiskXXXXX.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,003,defense_evasion,t1218,011,t1085,s0412,g0001
  exttype: SIEM
- name: sysmon_driver_unload
  description: Detect possible Sysmon driver unload
  condition: ([Image] =~ ['.*.*fltmc.exe']) && ([CommandLine] =~ ['.*unload.*']) &&
    ([CommandLine] =~ ['.*sys.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070
  exttype: SIEM
- name: trickbot_malware_activity
  description: Detects Trickbot malware process tree pattern in which rundll32.exe
    is parent of wermgr.exe
  condition: (([Image] =~ ['.*.*wermgr.exe'])) && (([ParentImage] =~ ['.*.*rundll32.exe']))
    && (([ParentCommandLine] =~ ['.*DllRegisterServer.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: squirrel_lolbin
  description: Detects Possible Squirrel Packages Manager as Lolbin
  condition: ([Image] =~ ['.*.*update.exe']) && (([CommandLine] =~ ['.*.*.*processStart.*'])
    || ([CommandLine] =~ ['.*.*.*processStartAndWait.*']) || ([CommandLine] =~ ['.*.*.*createShortcut.*']))
    && ([CommandLine] =~ ['.*.exe.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1218
  exttype: SIEM
- name: suspicious_curl_usage_on_windows
  description: Detects a suspicious curl process start on Windows and outputs the
    requested document to a local file
  condition: ([Image] =~ ['.*.*curl.exe']) || ([Product] == ['The curl executable'])
    && ([CommandLine] =~ ['.*.*.*O.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,command_and_control,t1105
  exttype: SIEM
- name: suspicious_bitstransfer_via_powershell
  description: Detects transferring files from system on a server bitstransfer Powershell
    cmdlets
  condition: (([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*powershell.*ise.exe'])
    || ([Image] =~ ['.*.*pwsh.exe'])) && (([CommandLine] =~ ['.*Get.*BitsTransfer.*'])
    || ([CommandLine] =~ ['.*Add.*BitsFile.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,persistence,t1197
  exttype: SIEM
- name: possible_privilege_escalation_via_weak_service_permissions
  description: Detection of sc.exe utility spawning by user with Medium integrity
    level to change service ImagePath or FailureCommand
  condition: ([Image] =~ ['.*.*sc.exe']) && ([IntegrityLevel] == ['Medium']) && ([CommandLine]
    =~ ['.*config.*']) && ([CommandLine] =~ ['.*binPath.*']) || ([CommandLine] =~
    ['.*failure.*']) && ([CommandLine] =~ ['.*command.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,defense_evasion,privilege_escalation,t1574,011
  exttype: SIEM
- name: windows_defender_download_activity
  description: Detect the use of Windows Defender to download payloads
  condition: ([CommandLine] =~ ['.*MpCmdRun.exe.*']) || ([Description] == ['Microsoft
    Malware Protection Command Line Utility']) && ([CommandLine] =~ ['.*DownloadFile.*'])
    && ([CommandLine] =~ ['.*url.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,010,command_and_control,t1105
  exttype: SIEM
- name: dll_execution_via_register_cimprovider_exe
  description: Detects using register-cimprovider.exe to execute arbitrary dll file.
  condition: ([Image] =~ ['.*.*register.*cimprovider.exe']) && ([CommandLine] =~ ['.*.*path.*'])
    && ([CommandLine] =~ ['.*dll.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1574
  exttype: SIEM
- name: mavinject_process_injection
  description: Detects process injection using the signed Windows tool Mavinject32.exe
  condition: ([CommandLine] =~ ['.*.*.*INJECTRUNNING.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,t1055,001,t1218
  exttype: SIEM
- name: suspicious_printerports_creation__cve_2020_1048_
  description: Detects new commands that add new printer port which point to suspicious
    file
  condition: (([CommandLine] =~ ['.*Add.*PrinterPort.*.*Name.*'])) && (([CommandLine]
    =~ ['.*.exe.*']) || ([CommandLine] =~ ['.*.dll.*']) || ([CommandLine] =~ ['.*.bat.*']))
    || (([CommandLine] =~ ['.*Generic.*.*.*Text.*Only.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,execution,t1059,001,t1086
  exttype: SIEM
- name: code_execution_via_pcwutl_dll
  description: Detects launch of executable by calling the LaunchApplication function
    from pcwutl.dll library.
  condition: ([Image] =~ ['.*.*rundll32.exe']) && ([CommandLine] =~ ['.*pcwutl.*'])
    && ([CommandLine] =~ ['.*LaunchApplication.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011,execution
  exttype: SIEM
- name: service_execution
  description: Detects manual service execution (start) via system utilities.
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*.*start.*.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1035,t1569,002
  exttype: SIEM
- name: lsass_memory_dumping
  description: Detect creation of dump files containing the memory space of lsass.exe,
    which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe
    to export the memory space of lsass.exe which contains sensitive credentials.
  condition: ([CommandLine] =~ ['.*lsass.*']) && ([CommandLine] =~ ['.*.dmp.*']) &&
    ([Image] !~ ['.*.*werfault.exe']) || ([Image] =~ ['.*.*procdump.*']) && ([Image]
    =~ ['.*.exe']) && ([CommandLine] =~ ['.*lsass.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: wsl_execution
  description: Detects Possible usage of Windows Subsystem for Linux (WSL) binary
    as a LOLBIN
  condition: (([Image] =~ ['.*.*wsl.exe'])) && (([CommandLine] =~ ['.*.*.*e.*.*'])
    || ([CommandLine] =~ ['.*.*.*.*exec.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1218,t1202
  exttype: SIEM
- name: exports_registry_key_to_a_file
  description: Detects the export of the target Registry key to a file.
  condition: ([Image] =~ ['.*.*regedit.exe']) && ([CommandLine] =~ ['.*.*.*E.*.*'])
    && (([CommandLine] !~ ['.*hklm.*']) || ([CommandLine] !~ ['.*hkey.*local.*machine.*']))
    && (([CommandLine] !~ ['.*.*system']) || ([CommandLine] !~ ['.*.*sam']) || ([CommandLine]
    !~ ['.*.*security']))
  level: low
  ruletype: EVALUATE
  tags: attack,exfiltration,t1012
  exttype: SIEM
- name: chafer_activity
  description: Detects Chafer activity attributed to OilRig as reported in Nyotron
    report in March 2018
  condition: (([TargetObject] =~ ['.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*UMe'])
    || ([TargetObject] =~ ['.*SOFTWARE.*Microsoft.*Windows.*CurrentVersion.*UT']))
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,g0049,t1053,005,s0111,t1050,t1543,003,defense_evasion,t1112,command_and_control,t1071,004
  exttype: SIEM
- name: chafer_activity
  description: Detects Chafer activity attributed to OilRig as reported in Nyotron
    report in March 2018
  condition: ([CommandLine] =~ ['.*.*Service.exe.*']) && (([CommandLine] =~ ['.*i'])
    || ([CommandLine] =~ ['.*u'])) || ([CommandLine] =~ ['.*.*microsoft.*Taskbar.*autoit3.exe'])
    || ([CommandLine] =~ ['C.*.*wsc.exe.*']) || ([Image] =~ ['.*.*Windows.*Temp.*DB.*.*.*'])
    && ([Image] =~ ['.*.exe']) || ([CommandLine] =~ ['.*.*nslookup.exe.*']) && ([CommandLine]
    =~ ['.*.*q=TXT.*']) && ([ParentImage] =~ ['.*.*Autoit.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,g0049,t1053,005,s0111,t1050,t1543,003,defense_evasion,t1112,command_and_control,t1071,004
  exttype: SIEM
- name: bypass_uac_via_cmstp
  description: Detect child processes of automatically elevated instances of Microsoft
    Connection Manager Profile Installer (cmstp.exe).
  condition: ([Image] =~ ['.*.*cmstp.exe']) && (([CommandLine] =~ ['.*.*s.*']) ||
    ([CommandLine] =~ ['.*.*au.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,defense_evasion,t1548,002,t1218,003,t1191,t1088
  exttype: SIEM
- name: new_service_creation
  description: Detects creation of a new service.
  condition: ([Image] =~ ['.*.*sc.exe']) && ([CommandLine] =~ ['.*create.*']) && ([CommandLine]
    =~ ['.*binpath.*']) || ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~
    ['.*new.*service.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1050,t1543,003
  exttype: SIEM
- name: dll_injection_with_tracker_exe
  description: This rule detects DLL injection and execution via LOLBAS - Tracker.exe
  condition: (([Image] =~ ['.*.*tracker.exe'])) || (([Description] =~ ['Tracker']))
    && (([CommandLine] =~ ['.*.*.*d.*.*'])) && (([CommandLine] =~ ['.*.*.*c.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1055,001
  exttype: SIEM
- name: suspicious_runscripthelper_exe
  description: Detects execution of powershell scripts via Runscripthelper.exe
  condition: ([Image] =~ ['.*.*Runscripthelper.exe']) && ([CommandLine] =~ ['.*surfacecheck.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,defense_evasion,t1202
  exttype: SIEM
- name: suspicious_spool_service_child_process
  description: Detects suspicious print spool service (spoolsv.exe) child processes.
  condition: ([ParentImage] =~ ['.*.*.*spoolsv.exe']) && ([IntegrityLevel] == ['System'])
    && (([Image] =~ ['.*.*gpupdate.exe']) || ([Image] =~ ['.*.*whoami.exe']) || ([Image]
    =~ ['.*.*nltest.exe']) || ([Image] =~ ['.*.*taskkill.exe']) || ([Image] =~ ['.*.*wmic.exe'])
    || ([Image] =~ ['.*.*taskmgr.exe']) || ([Image] =~ ['.*.*sc.exe']) || ([Image]
    =~ ['.*.*findstr.exe']) || ([Image] =~ ['.*.*curl.exe']) || ([Image] =~ ['.*.*wget.exe'])
    || ([Image] =~ ['.*.*certutil.exe']) || ([Image] =~ ['.*.*bitsadmin.exe']) ||
    ([Image] =~ ['.*.*accesschk.exe']) || ([Image] =~ ['.*.*wevtutil.exe']) || ([Image]
    =~ ['.*.*bcdedit.exe']) || ([Image] =~ ['.*.*fsutil.exe']) || ([Image] =~ ['.*.*cipher.exe'])
    || ([Image] =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*write.exe']) || ([Image]
    =~ ['.*.*wuauclt.exe'])) || ([Image] =~ ['.*.*net.exe']) && ([CommandLine] !~
    ['.*start.*']) || ([Image] =~ ['.*.*cmd.exe']) && (([CommandLine] !~ ['.*.spl.*'])
    || ([CommandLine] !~ ['.*route.*add.*']) || ([CommandLine] !~ ['.*program.*files.*']))
    || ([Image] =~ ['.*.*netsh.exe']) && (([CommandLine] !~ ['.*add.*portopening.*'])
    || ([CommandLine] !~ ['.*rule.*name.*'])) || ([Image] =~ ['.*.*powershell.exe'])
    && ([CommandLine] !~ ['.*.spl.*']) || ([Image] =~ ['.*.*rundll32.exe']) && ([CommandLine]
    =~ ['.*rundll32.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1203,privilege_escalation,t1068
  exttype: SIEM
- name: file_or_folder_permissions_modifications
  description: Detects a file or folder's permissions being modified.
  condition: (([Image] =~ ['.*.*takeown.exe']) || ([Image] =~ ['.*.*cacls.exe']) ||
    ([Image] =~ ['.*.*icacls.exe'])) && ([CommandLine] =~ ['.*.*grant.*']) || ([Image]
    =~ ['.*.*attrib.exe']) && ([CommandLine] =~ ['.*.*r.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1222,001
  exttype: SIEM
- name: suspicious_service_dacl_modification
  description: Detects suspicious DACL modifications that can  be used to hide services
    or make them unstopable
  condition: (([Image] =~ ['.*.*sc.exe'])) && ([CommandLine] =~ ['.*sdset.*']) &&
    ([CommandLine] =~ ['.*D.*.*.*']) && (([CommandLine] =~ ['.*.*.*.*IU.*']) || ([CommandLine]
    =~ ['.*.*.*.*SU.*']) || ([CommandLine] =~ ['.*.*.*.*BA.*']) || ([CommandLine]
    =~ ['.*.*.*.*SY.*']) || ([CommandLine] =~ ['.*.*.*.*WD.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1543,003
  exttype: SIEM
- name: copying_sensitive_files_with_credential_data
  description: Files with well-known filenames (sensitive files with credential data)
    copying
  condition: ([Image] =~ ['.*.*esentutl.exe']) && (([CommandLine] =~ ['.*vss.*'])
    || ([CommandLine] =~ ['.*.*.*m.*.*']) || ([CommandLine] =~ ['.*.*.*y.*.*'])) ||
    (([CommandLine] =~ ['.*.*windows.*ntds.*ntds.dit.*']) || ([CommandLine] =~ ['.*.*config.*sam.*'])
    || ([CommandLine] =~ ['.*.*config.*security.*']) || ([CommandLine] =~ ['.*.*config.*system.*.*'])
    || ([CommandLine] =~ ['.*.*repair.*sam.*']) || ([CommandLine] =~ ['.*.*repair.*system.*'])
    || ([CommandLine] =~ ['.*.*repair.*security.*']) || ([CommandLine] =~ ['.*.*config.*RegBack.*sam.*'])
    || ([CommandLine] =~ ['.*.*config.*RegBack.*system.*']) || ([CommandLine] =~ ['.*.*config.*RegBack.*security.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002,003,car,2013-07-001,s0404
  exttype: SIEM
- name: snatch_ransomware
  description: Detects specific process characteristics of Snatch ransomware word
    document droppers
  condition: (([CommandLine] =~ ['.*shutdown.*.*r.*.*f.*.*t.*00.*']) || ([CommandLine]
    =~ ['.*net.*stop.*SuperBackupMan.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1204
  exttype: SIEM
- name: exploited_cve_2020_10189_zoho_manageengine
  description: Detects the exploitation of Zoho ManageEngine Desktop Central Java
    Deserialization vulnerability reported as CVE-2020-10189
  condition: ([ParentImage] =~ ['.*DesktopCentral.*Server.*jre.*bin.*java.exe']) &&
    (([Image] =~ ['.*.*cmd.exe']) || ([Image] =~ ['.*.*powershell.exe']) || ([Image]
    =~ ['.*.*bitsadmin.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190,execution,t1059,001,t1086,003,s0190
  exttype: SIEM
- name: non_privileged_usage_of_reg_or_powershell
  description: Search for usage of reg or Powershell by non-priveleged users to modify
    service configuration in registry
  condition: ([IntegrityLevel] == ['Medium']) && ([CommandLine] =~ ['.*reg.*']) &&
    ([CommandLine] =~ ['.*add.*']) || ([CommandLine] =~ ['.*powershell.*']) && (([CommandLine]
    =~ ['.*set.*itemproperty.*']) || ([CommandLine] =~ ['.*.*sp.*.*']) || ([CommandLine]
    =~ ['.*new.*itemproperty.*'])) && ([CommandLine] =~ ['.*ControlSet.*']) && ([CommandLine]
    =~ ['.*Services.*']) && (([CommandLine] =~ ['.*ImagePath.*']) || ([CommandLine]
    =~ ['.*FailureCommand.*']) || ([CommandLine] =~ ['.*ServiceDLL.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: suspicious_reconnaissance_activity
  description: Detects suspicious command line activity on Windows systems
  condition: (([CommandLine] =~ ['net.*group.*.*domain.*admins.*.*.*dom']) || ([CommandLine]
    =~ ['net.*localgroup.*administrators']) || ([CommandLine] =~ ['net.*group.*.*enterprise.*admins.*.*.*dom'])
    || ([CommandLine] =~ ['net.*accounts.*.*dom']))
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1087,001,002
  exttype: SIEM
- name: disable_of_etw_trace
  description: Detects a command that clears or disables any ETW trace log which could
    indicate a logging evasion.
  condition: ([CommandLine] =~ ['.*cl.*']) && ([CommandLine] =~ ['.*.*Trace.*']) ||
    ([CommandLine] =~ ['.*clear.*log.*']) && ([CommandLine] =~ ['.*.*Trace.*']) ||
    ([CommandLine] =~ ['.*sl.*']) && ([CommandLine] =~ ['.*.*e.*false.*']) || ([CommandLine]
    =~ ['.*set.*log.*']) && ([CommandLine] =~ ['.*.*e.*false.*']) || ([CommandLine]
    =~ ['.*Remove.*EtwTraceProvider.*']) && ([CommandLine] =~ ['.*EventLog.*Microsoft.*Windows.*WMI.*Activity.*Trace.*'])
    && ([CommandLine] =~ ['.*.*1418ef04.*b0b4.*4623.*bf7e.*d74ab47bbdaa.*.*']) ||
    ([CommandLine] =~ ['.*Set.*EtwTraceProvider.*']) && ([CommandLine] =~ ['.*.*1418ef04.*b0b4.*4623.*bf7e.*d74ab47bbdaa.*.*'])
    && ([CommandLine] =~ ['.*EventLog.*Microsoft.*Windows.*WMI.*Activity.*Trace.*'])
    && ([CommandLine] =~ ['.*0x11.*']) || ([CommandLine] =~ ['.*logman.*']) && ([CommandLine]
    =~ ['.*update.*']) && ([CommandLine] =~ ['.*trace.*']) && ([CommandLine] =~ ['.*.*.*p.*'])
    && ([CommandLine] =~ ['.*.*ets.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,t1562,006,car,2016-04-002
  exttype: SIEM
- name: renamed_binary
  description: Detects the execution of a renamed binary often used by attackers or
    malware leveraging new Sysmon OriginalFileName datapoint.
  condition: (([OriginalFileName] =~ ['cmd.exe']) || ([OriginalFileName] =~ ['powershell.exe'])
    || ([OriginalFileName] =~ ['powershell.*ise.exe']) || ([OriginalFileName] =~ ['psexec.exe'])
    || ([OriginalFileName] =~ ['psexec.c']) || ([OriginalFileName] =~ ['cscript.exe'])
    || ([OriginalFileName] =~ ['wscript.exe']) || ([OriginalFileName] =~ ['mshta.exe'])
    || ([OriginalFileName] =~ ['regsvr32.exe']) || ([OriginalFileName] =~ ['wmic.exe'])
    || ([OriginalFileName] =~ ['certutil.exe']) || ([OriginalFileName] =~ ['rundll32.exe'])
    || ([OriginalFileName] =~ ['cmstp.exe']) || ([OriginalFileName] =~ ['msiexec.exe'])
    || ([OriginalFileName] =~ ['7z.exe']) || ([OriginalFileName] =~ ['winrar.exe'])
    || ([OriginalFileName] =~ ['wevtutil.exe']) || ([OriginalFileName] =~ ['net.exe'])
    || ([OriginalFileName] =~ ['net1.exe']) || ([OriginalFileName] =~ ['netsh.exe']))
    && (([Image] !~ ['.*.*cmd.exe']) || ([Image] !~ ['.*.*powershell.exe']) || ([Image]
    !~ ['.*.*powershell.*ise.exe']) || ([Image] !~ ['.*.*psexec.exe']) || ([Image]
    !~ ['.*.*psexec64.exe']) || ([Image] !~ ['.*.*cscript.exe']) || ([Image] !~ ['.*.*wscript.exe'])
    || ([Image] !~ ['.*.*mshta.exe']) || ([Image] !~ ['.*.*regsvr32.exe']) || ([Image]
    !~ ['.*.*wmic.exe']) || ([Image] !~ ['.*.*certutil.exe']) || ([Image] !~ ['.*.*rundll32.exe'])
    || ([Image] !~ ['.*.*cmstp.exe']) || ([Image] !~ ['.*.*msiexec.exe']) || ([Image]
    !~ ['.*.*7z.exe']) || ([Image] !~ ['.*.*winrar.exe']) || ([Image] !~ ['.*.*wevtutil.exe'])
    || ([Image] !~ ['.*.*net.exe']) || ([Image] !~ ['.*.*net1.exe']) || ([Image] !~
    ['.*.*netsh.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,003
  exttype: SIEM
- name: emissary_panda_malware_sllauncher
  description: Detects the execution of DLL side-loading malware used by threat group
    Emissary Panda aka APT27
  condition: ([ParentImage] =~ ['.*.*sllauncher.exe']) && ([Image] =~ ['.*.*svchost.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1073,t1574,002
  exttype: SIEM
- name: ps_exe_renamed_sysinternals_tool
  description: Detects renamed SysInternals tool execution with a binary named ps.exe
    as used by Dragonfly APT group and documented in TA17-293A report
  condition: ([CommandLine] == ['ps.exe -accepteula'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,g0035,t1036,003,car,2013-05-009
  exttype: SIEM
- name: emotet_rundll32_process_creation
  description: Detecting Emotet DLL loading by looking for rundll32.exe processes
    with command lines ending in ,RunDLL or ,#1
  condition: (([Image] =~ ['.*.*rundll32.exe'])) && (([CommandLine] =~ ['.*.*RunDLL']))
    && (([ParentImage] !~ ['.*.*tracker.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011
  exttype: SIEM
- name: abusing_print_executable
  description: Attackers can use print.exe for remote file copy
  condition: (([Image] =~ ['.*.*print.exe'])) && (([CommandLine] =~ ['print.*']))
    && (([CommandLine] =~ ['.*.*D.*'])) && (([CommandLine] =~ ['.*.exe.*'])) && (([CommandLine]
    !~ ['.*print.exe.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: empire_monkey
  description: Detects EmpireMonkey APT reported Activity
  condition: (([CommandLine] =~ ['.*.*i.*.*APPDATA.*.*logs.txt.*scrobj.dll'])) &&
    (([Image] =~ ['.*.*cutil.exe'])) || (([Description] =~ ['Microsoft.*C.*.*Registerserver']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,010,t1117
  exttype: SIEM
- name: impacket_lateralization_detection
  description: Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework
  condition: ([CommandLine] =~ ['.*cmd.exe.*']) && ([CommandLine] =~ ['.*.*1.*'])
    && (([ParentImage] =~ ['.*.*wmiprvse.exe']) || ([ParentImage] =~ ['.*.*mmc.exe'])
    || ([ParentImage] =~ ['.*.*explorer.exe']) || ([ParentImage] =~ ['.*.*services.exe']))
    && ([CommandLine] =~ ['.*.*Q.*']) && ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine]
    =~ ['.*.*.*.*.*127.0.0.1.*.*.*']) || (([ParentCommandLine] =~ ['.*svchost.exe.*.*k.*netsvcs.*'])
    || ([ParentCommandLine] =~ ['.*taskeng.exe.*'])) && ([CommandLine] =~ ['.*.*C.*'])
    && ([CommandLine] =~ ['.*Windows.*Temp.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1047,lateral_movement,t1175,t1021,003
  exttype: SIEM
- name: modification_of_boot_configuration
  description: Identifies use of the bcdedit command to delete boot configuration
    data. This tactic is sometimes used as by malware or an attacker as a destructive
    technique.
  condition: ([Image] =~ ['.*.*bcdedit.exe']) && ([CommandLine] =~ ['.*set.*']) &&
    ([CommandLine] =~ ['.*bootstatuspolicy.*']) && ([CommandLine] =~ ['.*ignoreallfailures.*'])
    || ([CommandLine] =~ ['.*recoveryenabled.*']) && ([CommandLine] =~ ['.*no.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,impact,t1490
  exttype: SIEM
- name: suspicious_rundll32_setupapi_dll_activity
  description: setupapi.dll library provide InstallHinfSection function for processing
    INF files. INF file may contain instructions allowing to create values in the
    registry, modify files and install drivers. This technique could be used to obtain
    persistence via modifying one of Run or RunOnce registry keys, run process or
    use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll
    calls runonce.exe executable regardless of actual content of INF file.
  condition: ([Image] =~ ['.*.*runonce.exe']) && ([ParentImage] =~ ['.*.*rundll32.exe'])
    && ([ParentCommandLine] =~ ['.*setupapi.dll.*']) && ([ParentCommandLine] =~ ['.*InstallHinfSection.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011
  exttype: SIEM
- name: suspicious_control_panel_dll_load
  description: Detects suspicious Rundll32 execution from control.exe as used by Equation
    Group and Exploit Kits
  condition: ([ParentImage] =~ ['.*.*System32.*control.exe']) && ([Image] =~ ['.*.*rundll32.exe.*'])
    && ([CommandLine] !~ ['.*Shell32.dll.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1085,t1218,011
  exttype: SIEM
- name: maze_ransomware
  description: Detects specific process characteristics of Maze ransomware word document
    droppers
  condition: (([ParentImage] =~ ['.*.*WINWORD.exe'])) && (([Image] =~ ['.*.tmp']))
    || ([Image] =~ ['.*.*wmic.exe']) && ([ParentImage] =~ ['.*.*Temp.*.*.*']) && ([CommandLine]
    =~ ['.*shadowcopy.*delete']) || ([CommandLine] =~ ['.*shadowcopy.*delete']) &&
    ([CommandLine] =~ ['.*.*...*...*system32.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1204,002,t1047,impact,t1490
  exttype: SIEM
- name: advanced_ip_scanner
  description: Detects the use of Advanced IP Scanner. Seems to be a popular tool
    for ransomware groups.
  condition: ([Image] =~ ['.*.*advanced.*ip.*scanner.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1046
  exttype: SIEM
- name: advanced_ip_scanner
  description: Detects the use of Advanced IP Scanner. Seems to be a popular tool
    for ransomware groups.
  condition: ([TargetFilename] =~ ['.*.*AppData.*Local.*Temp.*Advanced.*IP.*Scanner.*2.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1046
  exttype: SIEM
- name: wsreset_uac_bypass
  description: Detects a method that uses Wsreset.exe tool that can be used to reset
    the Windows Store to bypass UAC
  condition: (([ParentImage] =~ ['.*.*WSreset.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,defense_evasion,t1548,002,t1088
  exttype: SIEM
- name: remove_windows_defender_definition_files
  description: Adversaries may disable security tools to avoid possible detection
    of their tools and activities by removing Windows Defender Definition Files
  condition: ([OriginalFileName] == ['MpCmdRun.exe']) && ([CommandLine] =~ ['.*.*.*RemoveDefinitions.*'])
    && ([CommandLine] =~ ['.*.*.*All.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: conti_volume_shadow_listing
  description: Detects a command used by conti to exfiltrate NTDS
  condition: ([CommandLine] =~ ['.*7za.exe.*']) && ([CommandLine] =~ ['.*.*.*C.*.*.*temp.*.*log.zip.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: trickbot_malware_recon_activity
  description: Trickbot enumerates domain/network topology and executes certain commands
    automatically every few minutes. This detectors attempts to identify that activity
    based off a command rarely observed in an enterprise network.
  condition: (([ParentImage] =~ ['.*.*cmd.exe'])) && (([Image] =~ ['.*.*nltest.exe']))
    && (([CommandLine] =~ ['.*.*domain.*trusts.*.*all.*trusts.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,discovery,t1482
  exttype: SIEM
- name: application_whitelisting_bypass_via_dxcap_exe
  description: Detects execution of of Dxcap.exe
  condition: ([Image] =~ ['.*.*dxcap.exe']) && ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine]
    =~ ['.*.exe.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,execution
  exttype: SIEM
- name: evilnum_golden_chickens_deployment_via_ocx_files
  description: Detects Golden Chickens deployment method as used by Evilnum in report
    published in July 2020
  condition: ([CommandLine] =~ ['.*regsvr32.*']) && ([CommandLine] =~ ['.*.*s.*'])
    && ([CommandLine] =~ ['.*.*i.*']) && ([CommandLine] =~ ['.*.*AppData.*Roaming.*.*.*'])
    && ([CommandLine] =~ ['.*.ocx.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1085,t1218,011
  exttype: SIEM
- name: encoded_powershell_command_line
  description: Detects specific combinations of encoding methods in the PowerShell
    command lines
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([CommandLine] =~ ['.*ToInt.*'])
    || ([CommandLine] =~ ['.*ToDecimal.*']) || ([CommandLine] =~ ['.*ToByte.*']) ||
    ([CommandLine] =~ ['.*ToUint.*']) || ([CommandLine] =~ ['.*ToSingle.*']) || ([CommandLine]
    =~ ['.*ToSByte.*'])) && (([CommandLine] =~ ['.*ToChar.*']) || ([CommandLine] =~
    ['.*ToString.*']) || ([CommandLine] =~ ['.*String.*'])) || ([CommandLine] =~ ['.*char.*'])
    && ([CommandLine] =~ ['.*join.*']) || ([CommandLine] =~ ['.*split.*']) && ([CommandLine]
    =~ ['.*join.*']) || ([CommandLine] =~ ['.*ForEach.*']) && ([CommandLine] =~ ['.*Xor.*'])
    || (([CommandLine] =~ ['.*cOnvErTTO.*SECUreStRIng.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027,execution,t1059,001
  exttype: SIEM
- name: suspicious_encoded_powershell_command_line
  description: Detects suspicious powershell process starts with base64 encoded commands
    (e.g. Emotet)
  condition: ([CommandLine] =~ ['.*.*.*e.*']) && ([CommandLine] =~ ['.*.*JAB.*'])
    && ([CommandLine] =~ ['.*.*.*w.*']) && ([CommandLine] =~ ['.*.*hidden.*.*']) ||
    ([CommandLine] =~ ['.*.*.*e.*']) && (([CommandLine] =~ ['.*.*BA.*J.*']) || ([CommandLine]
    =~ ['.*.*SUVYI.*']) || ([CommandLine] =~ ['.*.*SQBFAFgA.*']) || ([CommandLine]
    =~ ['.*.*aQBlAHgA.*']) || ([CommandLine] =~ ['.*.*aWV4I.*']) || ([CommandLine]
    =~ ['.*.*IAA.*']) || ([CommandLine] =~ ['.*.*IAB.*']) || ([CommandLine] =~ ['.*.*UwB.*'])
    || ([CommandLine] =~ ['.*.*cwB.*'])) || (([CommandLine] =~ ['.*.exe.*.*ENCOD.*.*']))
    && ([CommandLine] !~ ['.*.*.*ExecutionPolicy.*']) && ([CommandLine] !~ ['.*remotesigned.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: stop_windows_service
  description: Detects a windows service to be stopped
  condition: (([Image] =~ ['.*.*sc.exe']) || ([Image] =~ ['.*.*net.exe']) || ([Image]
    =~ ['.*.*net1.exe'])) && ([CommandLine] =~ ['.*stop.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,impact,t1489
  exttype: SIEM
- name: net_exe_user_account_creation
  description: Identifies creation of local users via the net.exe command.
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*user.*']) && ([CommandLine] =~ ['.*add.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1136,001
  exttype: SIEM
- name: execute_files_with_msdeploy_exe
  description: Detects file execution using the msdeploy.exe lolbin
  condition: ([CommandLine] =~ ['.*verb.*sync.*']) && ([CommandLine] =~ ['.*.*source.*RunCommand.*'])
    && ([CommandLine] =~ ['.*.*dest.*runCommand.*']) && (([Image] =~ ['.*.*msdeploy.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1218
  exttype: SIEM
- name: formbook_process_creation
  description: Detects Formbook like process executions that inject code into a set
    of files in the System32 folder, which executes a special command command line
    to delete the dropper from the AppData Temp folder. We avoid false positives by
    excluding all parent process with command line parameters.
  condition: (([ParentCommandLine] =~ ['C.*.*Windows.*System32.*.*.*']) || ([ParentCommandLine]
    =~ ['C.*.*Windows.*SysWOW64.*.*.*'])) && (([ParentCommandLine] =~ ['.*.exe']))
    && ([CommandLine] =~ ['.*C.*.*Users.*.*.*']) && ([CommandLine] =~ ['.*.*c.*'])
    && ([CommandLine] =~ ['.*del.*']) && ([CommandLine] =~ ['.*.*AppData.*Local.*Temp.*.*.*'])
    || ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine] =~ ['.*del.*']) && ([CommandLine]
    =~ ['.*.*Desktop.*.*.*']) || ([CommandLine] =~ ['.*.*C.*']) && ([CommandLine]
    =~ ['.*type.*nul.*.*.*']) && ([CommandLine] =~ ['.*.*Desktop.*.*.*']) && ([CommandLine]
    =~ ['.*.exe'])
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: bad_opsec_defaults_sacrificial_processes_with_improper_arguments
  description: Detects attackers using tooling with bad opsec defaults e.g. spawning
    a sacrificial process to inject a capability into the process without taking into
    account how the process is normally run, one trivial example of this is using
    rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted
    by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and
    other examples.
  condition: (([CommandLine] =~ ['.*.*WerFault.exe']) || ([CommandLine] =~ ['.*.*rundll32.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1085,t1218,011
  exttype: SIEM
- name: ryuk_ransomware
  description: Detects Ryuk ransomware activity
  condition: ([CommandLine] =~ ['.*Microsoft.*Windows.*CurrentVersion.*Run.*']) &&
    ([CommandLine] =~ ['.*C.*.*users.*Public.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1547,001,t1060
  exttype: SIEM
- name: protocolhandler_exe_downloaded_suspicious_file
  description: Emulates attack via documents through protocol handler in Microsoft
    Office. On successful execution you should see Microsoft Word launch a blank file.
  condition: ([Image] =~ ['.*.*protocolhandler.exe']) && ([CommandLine] =~ ['.*.*ms.*word.*'])
    && ([CommandLine] =~ ['.*.docx.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: securityxploded_tool
  description: Detects the execution of SecurityXploded Tools
  condition: ([Company] == ['SecurityXploded']) || ([Image] =~ ['.*PasswordDump.exe'])
    || ([OriginalFileName] =~ ['.*PasswordDump.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1555,t1003,t1503
  exttype: SIEM
- name: suspicious_file_characteristics_due_to_missing_fields
  description: Detects Executables in the Downloads folder without FileVersion,Description,Product,Company
    likely created with py2exe
  condition: ([Description] == ['\?']) && ([FileVersion] == ['\?']) || ([Product]
    == ['\?']) || ([Company] == ['\?']) && ([Image] =~ ['.*.*Downloads.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,006,defense_evasion,t1064
  exttype: SIEM
- name: psexec_paexec_flags
  description: Detects suspicious flags used by PsExec and PAExec but no usual program
    name in command line
  condition: ([CommandLine] =~ ['.*.*.*127.0.0.1.*']) && ([CommandLine] =~ ['.*.*.*s.*.*'])
    && ([CommandLine] =~ ['.*cmd.exe.*']) || ([CommandLine] =~ ['.*.*.*accepteula.*.*'])
    && ([CommandLine] =~ ['.*cmd.*.*c.*.*']) && ([CommandLine] =~ ['.*.*.*u.*.*'])
    && ([CommandLine] =~ ['.*.*.*p.*.*']) && (([CommandLine] !~ ['.*paexec.*']) ||
    ([CommandLine] !~ ['.*PsExec.*']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: equation_group_dll_u_load
  description: Detects a specific tool and export used by EquationGroup
  condition: ([Image] =~ ['.*.*rundll32.exe']) && ([CommandLine] =~ ['.*.*dll.*u'])
    || ([CommandLine] =~ ['.*.*.*export.*dll.*u.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,g0020,defense_evasion,t1085,t1218,011
  exttype: SIEM
- name: suspicious_code_page_switch
  description: Detects a code page switch in command line or batch scripts to a rare
    language
  condition: ([Image] =~ ['.*.*chcp.com']) && (([CommandLine] =~ ['.*.*936']) || ([CommandLine]
    =~ ['.*.*1258']))
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: lazarus_loaders
  description: Detects different loaders as described in various threat reports on
    Lazarus group activity
  condition: ([CommandLine] =~ ['.*cmd.exe.*.*c.*.*']) && ([CommandLine] =~ ['.*.*.*p.*0x.*'])
    && (([CommandLine] =~ ['.*C.*.*ProgramData.*.*.*']) || ([CommandLine] =~ ['.*C.*.*RECYCLER.*.*.*']))
    || ([CommandLine] =~ ['.*rundll32.exe.*.*']) && ([CommandLine] =~ ['.*C.*.*ProgramData.*.*.*'])
    && (([CommandLine] =~ ['.*.bin.*.*']) || ([CommandLine] =~ ['.*.tmp.*.*']) ||
    ([CommandLine] =~ ['.*.dat.*.*']) || ([CommandLine] =~ ['.*.io.*.*']) || ([CommandLine]
    =~ ['.*.ini.*.*']) || ([CommandLine] =~ ['.*.db.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0032
  exttype: SIEM
- name: possible_shim_database_persistence_via_sdbinst_exe
  description: Detects installation of a new shim using sdbinst.exe. A shim can be
    used to load malicious DLLs into applications.
  condition: ([Image] =~ ['.*.*sdbinst.exe']) && ([CommandLine] =~ ['.*.sdb.*']) &&
    (([CommandLine] !~ ['.*iisexpressshim.sdb.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,privilege_escalation,t1546,011,t1138
  exttype: SIEM
- name: hurricane_panda_activity
  description: Detects Hurricane Panda Activity
  condition: ([CommandLine] =~ ['.*localgroup.*']) && ([CommandLine] =~ ['.*admin.*'])
    && ([CommandLine] =~ ['.*.*add.*']) || (([CommandLine] =~ ['.*.*Win64.exe.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,g0009,t1068
  exttype: SIEM
- name: rclone_execution_via_command_line_or_powershell
  description: Detects Rclone which is commonly used by ransomware groups for exfiltration
  condition: (([CommandLine] =~ ['.*.*pass.*.*']) || ([CommandLine] =~ ['.*.*user.*.*'])
    || ([CommandLine] =~ ['.*.*copy.*.*']) || ([CommandLine] =~ ['.*.*mega.*.*'])
    || ([CommandLine] =~ ['.*.*sync.*.*']) || ([CommandLine] =~ ['.*.*config.*.*'])
    || ([CommandLine] =~ ['.*.*lsd.*.*']) || ([CommandLine] =~ ['.*.*remote.*.*'])
    || ([CommandLine] =~ ['.*.*ls.*.*'])) && ([Description] == ['Rsync for cloud storage'])
    || ([Image] =~ ['.*.*rclone.exe']) && (([ParentImage] =~ ['.*.*PowerShell.exe'])
    || ([ParentImage] =~ ['.*.*cmd.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1567,002
  exttype: SIEM
- name: proxy_execution_via_wuauclt
  description: Detects the use of the Windows Update Client binary (wuauclt.exe) to
    proxy execute code.
  condition: ([Image] =~ ['.*wuauclt.*']) || ([OriginalFileName] == ['wuauclt.exe'])
    && ([CommandLine] =~ ['.*UpdateDeploymentProvider.*']) && ([CommandLine] =~ ['.*.dll.*'])
    && ([CommandLine] =~ ['.*RunHandlerComServer.*']) && (([CommandLine] !~ ['.*.*.*UpdateDeploymentProvider.*UpdateDeploymentProvider.dll.*.*'])
    || ([CommandLine] !~ ['.*.*wuaueng.dll.*.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: process_dump_via_comsvcs_dll
  description: Detects process memory dump via comsvcs.dll and rundll32
  condition: ([Image] =~ ['.*.*rundll32.exe']) || ([OriginalFileName] == ['RUNDLL32.EXE'])
    && ([CommandLine] =~ ['.*comsvcs.*']) && ([CommandLine] =~ ['.*MiniDump.*']) &&
    ([CommandLine] =~ ['.*full.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011,credential_access,t1003,001
  exttype: SIEM
- name: taskmgr_as_local_system
  description: Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM
  condition: ([User] == ['NT AUTHORITY\SYSTEM']) && ([Image] =~ ['.*.*taskmgr.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: powershell_encoded_character_syntax
  description: Detects suspicious encoded character syntax often used for defense
    evasion
  condition: ([CommandLine] =~ ['.*.*WCHAR.*0x.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086,defense_evasion,t1027
  exttype: SIEM
- name: webshell_recon_detection_via_commandline___processes
  description: Looking for processes spawned by web server components that indicate
    reconnaissance by popular public domain webshells for whether perl, python or
    wget are installed.
  condition: (([ParentImage] =~ ['.*.*apache.*']) || ([ParentImage] =~ ['.*.*tomcat.*']))
    || (([ParentImage] =~ ['.*.*w3wp.exe']) || ([ParentImage] =~ ['.*.*php.*cgi.exe'])
    || ([ParentImage] =~ ['.*.*nginx.exe']) || ([ParentImage] =~ ['.*.*httpd.exe']))
    && (([Image] =~ ['.*.*cmd.exe'])) && (([CommandLine] =~ ['.*perl.*.*.*help.*'])
    || ([CommandLine] =~ ['.*python.*.*.*help.*']) || ([CommandLine] =~ ['.*wget.*.*.*help.*'])
    || ([CommandLine] =~ ['.*perl.*.*h.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003,privilege_escalation,t1100
  exttype: SIEM
- name: execute_code_with_pester_bat
  description: Detects code execution via Pester.bat (Pester - Powershell Modulte
    for testing)
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*Pester.*'])
    && ([CommandLine] =~ ['.*Get.*Help.*']) || ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine]
    =~ ['.*pester.*']) && ([CommandLine] =~ ['.*.*.*']) && (([CommandLine] =~ ['.*help.*'])
    || ([CommandLine] =~ ['.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,defense_evasion,t1216
  exttype: SIEM
- name: adcspwn_hack_tool
  description: Detects command line parameters used by ADCSPwn, a tool to escalate
    privileges in an active directory network by coercing authenticate from machine
    accounts and relaying to the certificate service
  condition: ([CommandLine] =~ ['.*.*.*.*adcs.*.*']) && ([CommandLine] =~ ['.*.*.*.*port.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1557,001
  exttype: SIEM
- name: compress_data_and_lock_with_password_for_exfiltration_with_7_zip
  description: An adversary may compress or encrypt data that is collected prior to
    exfiltration using 3rd party utilities
  condition: (([CommandLine] =~ ['.*7z.exe.*']) || ([CommandLine] =~ ['.*7za.exe.*']))
    && ([CommandLine] =~ ['.*.*.*p.*']) && (([CommandLine] =~ ['.*.*a.*.*']) || ([CommandLine]
    =~ ['.*.*u.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1560,001
  exttype: SIEM
- name: lazarus_session_highjacker
  description: Detects executables launched outside their default directories as used
    by Lazarus Group (Bluenoroff)
  condition: (([Image] =~ ['.*.*msdtc.exe']) || ([Image] =~ ['.*.*gpvc.exe'])) &&
    (([Image] !~ ['C.*.*Windows.*System32.*.*.*']) || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,005
  exttype: SIEM
- name: iis_native_code_module_command_line_installation
  description: Detects suspicious IIS native-code module installations via command
    line
  condition: ([Image] =~ ['.*.*appcmd.exe']) && ([CommandLine] =~ ['.*install.*'])
    && ([CommandLine] =~ ['.*module.*']) && ([CommandLine] =~ ['.*.*name.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003,t1100
  exttype: SIEM
- name: mounted_share_deleted
  description: Detects when when a mounted share is removed. Adversaries may remove
    share connections that are no longer useful in order to clean up traces of their
    operation
  condition: ([ParentImage] =~ ['.*.*net.exe']) && ([Image] =~ ['.*.*net1.exe']) &&
    ([CommandLine] =~ ['.*share.*']) && ([CommandLine] =~ ['.*.*delete.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,005
  exttype: SIEM
- name: renamed_powershell
  description: Detects the execution of a renamed PowerShell often used by attackers
    or malware
  condition: (([Description] =~ ['Windows.*PowerShell.*']) || ([Description] =~ ['pwsh.*']))
    && ([Company] == ['Microsoft Corporation']) && (([Image] !~ ['.*.*powershell.exe'])
    || ([Image] !~ ['.*.*powershell.*ise.exe']) || ([Image] !~ ['.*.*pwsh.exe']))
  level: critical
  ruletype: EVALUATE
  tags: car,2013-05-009,attack,defense_evasion,t1036,003
  exttype: SIEM
- name: syncappvpublishingserver_execution_to_bypass_powershell_restriction
  description: Detects SyncAppvPublishingServer process execution which usually utilized
    by adversaries to bypass PowerShell execution restrictions.
  condition: ([Image] =~ ['.*.*SyncAppvPublishingServer.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: mstsc_shadowing
  description: Detects RDP session hijacking by using MSTSC shadowing
  condition: ([CommandLine] =~ ['.*noconsentprompt.*']) && ([CommandLine] =~ ['.*shadow.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1563,002
  exttype: SIEM
- name: non_interactive_powershell
  description: Detects non-interactive PowerShell activity by looking at powershell.exe
    with not explorer.exe as a parent.
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([ParentImage] !~ ['.*.*explorer.exe'])
    || ([ParentImage] !~ ['.*.*CompatTelRunner.exe']))
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: invocation_of_active_directory_diagnostic_tool__ntdsutil_exe_
  description: Detects execution of ntdsutil.exe, which can be used for various attacks
    against the NTDS database (NTDS.DIT)
  condition: ([Image] =~ ['.*.*ntdsutil.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,003
  exttype: SIEM
- name: zoho_dctask64_process_injection
  description: Detects suspicious process injection using ZOHO's dctask64.exe
  condition: (([Image] =~ ['.*.*dctask64.exe'])) && (([CommandLine] !~ ['.*DesktopCentral.*Agent.*agent.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1055,001
  exttype: SIEM
- name: sofacy_trojan_loader_activity
  description: Detects Trojan loader acitivty as used by APT28
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*.*APPDATA.*.*.*.*'])
    && ([CommandLine] =~ ['.*.dat.*.*.*']) || ([CommandLine] =~ ['.*.dll.*.*.*1'])
  level: critical
  ruletype: EVALUATE
  tags: attack,g0007,execution,t1059,003,defense_evasion,t1085,car,2013-10-002,t1218,011
  exttype: SIEM
- name: dns_exfiltration_and_tunneling_tools_execution
  description: Well-known DNS Exfiltration tools execution
  condition: ([Image] =~ ['.*.*iodine.exe']) || ([Image] =~ ['.*.*dnscat2.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1048,001,command_and_control,t1071,004,t1132
  exttype: SIEM
- name: firewall_disabled_via_netsh
  description: Detects netsh commands that turns off the Windows firewall
  condition: (([CommandLine] =~ ['netsh.*firewall.*set.*opmode.*mode=disable']) ||
    ([CommandLine] =~ ['netsh.*advfirewall.*set.*.*.*state.*off']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,004,s0108
  exttype: SIEM
- name: cobaltstrike_process_patterns
  description: Detects process patterns found in Cobalt Strike beacon activity (see
    reference for more details)
  condition: ([CommandLine] =~ ['.*.*cmd.exe.*.*C.*whoami.*']) && ([ParentImage] =~
    ['C.*.*Temp.*']) || ([CommandLine] =~ ['.*conhost.exe.*0xffffffff.*.*ForceV1.*'])
    && (([ParentCommandLine] =~ ['.*.*C.*whoami.*']) || ([ParentCommandLine] =~ ['.*cmd.exe.*.*C.*echo.*'])
    || ([ParentCommandLine] =~ ['.*.*.*.*.*.*..*pipe.*'])) || (([CommandLine] =~ ['.*cmd.exe.*.*c.*echo.*'])
    || ([CommandLine] =~ ['.*.*.*.*.*..*pipe.*']) || ([CommandLine] =~ ['.*.*whoami.exe.*']))
    && ([ParentImage] =~ ['.*.*dllhost.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: logon_scripts__userinitmprlogonscript_
  description: Detects creation or execution of UserInitMprLogonScript persistence
    method
  condition: ([ParentImage] =~ ['.*.*userinit.exe']) && ([Image] !~ ['.*.*explorer.exe'])
    && (([CommandLine] !~ ['.*netlogon.bat.*']) || ([CommandLine] !~ ['.*UsrLogon.cmd.*']))
    || ([CommandLine] =~ ['.*UserInitMprLogonScript.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1037,001,persistence
  exttype: SIEM
- name: sysinternals_sdelete_delete_file
  description: Use of SDelete to erase a file not the free space
  condition: ([OriginalFileName] == ['sdelete.exe']) && (([CommandLine] !~ ['.*.*.*h.*'])
    || ([CommandLine] !~ ['.*.*.*c.*']) || ([CommandLine] !~ ['.*.*.*z.*']) || ([CommandLine]
    !~ ['.*.*.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,t1485
  exttype: SIEM
- name: turla_group_commands_may_2020
  description: Detects commands used by Turla group as reported by ESET in May 2020
  condition: (([CommandLine] =~ ['.*tracert.*.*h.*10.*yahoo.com.*']) || ([CommandLine]
    =~ ['.*.WSqmCons.*.*.*iex.*.*']) || ([CommandLine] =~ ['.*Fr.*omBa.*se6.*4Str.*ing.*']))
    || ([CommandLine] =~ ['.*net.*use.*https.*.*.*docs.live.net.*']) && ([CommandLine]
    =~ ['.*.*aol.co.uk.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,g0010,execution,t1086,t1059,001,t1053,005,t1027
  exttype: SIEM
- name: crackmapexec_command_execution
  description: Detect various execution methods of the CrackMapExec pentesting framework
  condition: (([CommandLine] =~ ['.*cmd.exe.*.*Q.*.*c.*.*.*1.*.*.*.*.*.*.*.*.*.*.*.*.*.*2.*.*1'])
    || ([CommandLine] =~ ['.*cmd.exe.*.*C.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*2.*.*1'])
    || ([CommandLine] =~ ['.*cmd.exe.*.*C.*.*.*.*.*.*.*.*Temp.*.*.*.*2.*.*1'])) &&
    (([CommandLine] =~ ['.*powershell.exe.*.*exec.*bypass.*.*noni.*.*nop.*.*w.*1.*.*C.*.*.*'])
    || ([CommandLine] =~ ['.*powershell.exe.*.*noni.*.*nop.*.*w.*1.*.*enc.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047,t1053,t1059,003,001,s0106,t1086
  exttype: SIEM
- name: fireball_archer_install
  description: Detects Archer malware invocation via rundll32
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && ([CommandLine] =~ ['.*InstallArcherSvc.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1218,011,t1085
  exttype: SIEM
- name: mshta_spwaned_by_svchost
  description: Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described
    in report
  condition: ([ParentImage] =~ ['.*.*svchost.exe']) && ([Image] =~ ['.*.*mshta.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,005,execution,t1170
  exttype: SIEM
- name: powershell_defender_exclusion
  description: Detects requests to exclude files, folders or processes from Antivirus
    scanning using PowerShell cmdlets
  condition: ([CommandLine] =~ ['.*Add.*MpPreference.*.*']) && (([CommandLine] =~
    ['.*.*.*ExclusionPath.*.*']) || ([CommandLine] =~ ['.*.*.*ExclusionExtension.*.*'])
    || ([CommandLine] =~ ['.*.*.*ExclusionProcess.*.*'])) || (([CommandLine] =~ ['.*QWRkLU1wUHJlZmVyZW5jZ.*'])
    || ([CommandLine] =~ ['.*FkZC1NcFByZWZlcmVuY2.*']) || ([CommandLine] =~ ['.*BZGQtTXBQcmVmZXJlbmNl.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: wmiprvse_spawning_process
  description: Detects wmiprvse spawning processes
  condition: ([ParentImage] =~ ['.*.*WmiPrvSe.exe']) && (([LogonId] !~ ['0x3e7'])
    || ([LogonId] !~ ['null'])) || (([SubjectLogonId] !~ ['0x3e7']) || ([SubjectLogonId]
    !~ ['null'])) || ([User] == ['NT AUTHORITY\SYSTEM']) || (([Image] !~ ['.*.*WmiPrvSE.exe'])
    || ([Image] !~ ['.*.*WerFault.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047
  exttype: SIEM
- name: use_of_clip
  description: Adversaries may collect data stored in the clipboard from users copying
    information within or between applications.
  condition: ([OriginalFileName] == ['clip.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,collection,t1115
  exttype: SIEM
- name: wmic_uninstall_security_product
  description: Detects deinstallation of security products using WMIC utility
  condition: ([CommandLine] =~ ['.*wmic.*']) && ([CommandLine] =~ ['.*product.*where.*name=.*'])
    && ([CommandLine] =~ ['.*call.*uninstall.*']) && ([CommandLine] =~ ['.*.*nointeractive.*'])
    && (([CommandLine] =~ ['.*Antivirus.*']) || ([CommandLine] =~ ['.*Endpoint.*Security.*'])
    || ([CommandLine] =~ ['.*Endpoint.*Detection.*']) || ([CommandLine] =~ ['.*Crowdstrike.*Sensor.*'])
    || ([CommandLine] =~ ['.*Windows.*Defender.*']) || ([CommandLine] =~ ['.*VirusScan.*'])
    || ([CommandLine] =~ ['.*Threat.*Protection.*']) || ([CommandLine] =~ ['.*Endpoint.*Sensor.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: grabbing_sensitive_hives_via_reg_utility
  description: Dump sam, system or security hives using REG.exe utility
  condition: ([Image] =~ ['.*.*reg.exe']) && (([CommandLine] =~ ['.*save.*']) || ([CommandLine]
    =~ ['.*export.*']) || ([CommandLine] =~ ['.*.*ave.*']) || ([CommandLine] =~ ['.*e.*port.*']))
    && (([CommandLine] =~ ['.*hklm.*']) || ([CommandLine] =~ ['.*hk.*m.*']) || ([CommandLine]
    =~ ['.*hkey.*local.*machine.*']) || ([CommandLine] =~ ['.*hkey.*.*ocal.*machine.*'])
    || ([CommandLine] =~ ['.*hkey.*loca.*.*machine.*']) || ([CommandLine] =~ ['.*hkey.*.*oca.*.*machine.*']))
    && (([CommandLine] =~ ['.*.*system']) || ([CommandLine] =~ ['.*.*sam']) || ([CommandLine]
    =~ ['.*.*security']) || ([CommandLine] =~ ['.*.*.*ystem']) || ([CommandLine] =~
    ['.*.*sy.*tem']) || ([CommandLine] =~ ['.*.*.*y.*tem']) || ([CommandLine] =~ ['.*.*.*am'])
    || ([CommandLine] =~ ['.*.*.*ecurity']))
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002,004,005,car,2013-07-001
  exttype: SIEM
- name: exchange_exploitation_activity
  description: Detects activity observed by different researchers to be HAFNIUM group
    activity (or related) on Exchange servers
  condition: ([CommandLine] =~ ['.*attrib.*']) && ([CommandLine] =~ ['.*.*.*h.*.*'])
    && ([CommandLine] =~ ['.*.*.*s.*.*']) && ([CommandLine] =~ ['.*.*.*r.*.*']) &&
    ([CommandLine] =~ ['.*.aspx.*']) || ([CommandLine] =~ ['.*schtasks.*']) && ([CommandLine]
    =~ ['.*VSPerfMon.*']) || ([CommandLine] =~ ['.*vssadmin.*list.*shadows.*']) &&
    ([CommandLine] =~ ['.*Temp.*.*.*output.*']) || ([CommandLine] =~ ['.*.*TEMP.*.*execute.bat.*'])
    || ([Image] =~ ['.*Users.*Public.*opera.*Opera.*browser.exe']) || ([Image] =~
    ['.*Opera.*browser.exe']) && (([ParentImage] =~ ['.*.*services.exe']) || ([ParentImage]
    =~ ['.*.*svchost.exe'])) || ([Image] =~ ['.*.*ProgramData.*VSPerfMon.*.*.*'])
    || ([CommandLine] =~ ['.*.*.*t7z.*.*']) && ([CommandLine] =~ ['.*C.*.*Programdata.*pst.*'])
    && ([CommandLine] =~ ['.*.*it.zip.*']) || ([Image] =~ ['.*.*makecab.exe']) &&
    (([CommandLine] =~ ['.*Microsoft.*Exchange.*Server.*.*.*']) || ([CommandLine]
    =~ ['.*inetpub.*wwwroot.*'])) || (([CommandLine] =~ ['.*.*Temp.*xx.bat.*']) ||
    ([CommandLine] =~ ['.*Windows.*WwanSvcdcs.*']) || ([CommandLine] =~ ['.*Windows.*Temp.*cw.exe.*']))
    || ([CommandLine] =~ ['.*.*comsvcs.dll.*']) && ([CommandLine] =~ ['.*Minidump.*'])
    && ([CommandLine] =~ ['.*.*inetpub.*wwwroot.*']) || ([CommandLine] =~ ['.*dsquery.*'])
    && ([CommandLine] =~ ['.*.*.*uco.*.*']) && ([CommandLine] =~ ['.*.*inetpub.*wwwroot.*'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: dll_execution_via_rasautou_exe
  description: Detects using Rasautou.exe for loading arbitrary .DLL specified in
    -d option and executes the export specified in -p.
  condition: ([Image] =~ ['.*.*rasautou.exe']) || ([OriginalFileName] == ['rasdlui.exe'])
    && ([CommandLine] =~ ['.*.*d.*']) && ([CommandLine] =~ ['.*.*p.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: powershell_used_to_disable_windows_defender_av_security_monitoring
  description: Detects attackers attempting to disable Windows Defender using Powershell
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([CommandLine] =~ ['.*.*DisableBehaviorMonitoring.*.*true.*'])
    || ([CommandLine] =~ ['.*.*DisableRuntimeMonitoring.*.*true.*'])) || ([CommandLine]
    =~ ['.*sc.*']) && ([CommandLine] =~ ['.*stop.*']) && ([CommandLine] =~ ['.*WinDefend.*'])
    || ([CommandLine] =~ ['.*sc.*']) && ([CommandLine] =~ ['.*config.*']) && ([CommandLine]
    =~ ['.*WinDefend.*']) && ([CommandLine] =~ ['.*start=disabled.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,001
  exttype: SIEM
- name: audio_capture_via_soundrecorder
  description: Detect attacker collecting audio via SoundRecorder application.
  condition: ([Image] =~ ['.*.*SoundRecorder.exe']) && ([CommandLine] =~ ['.*.*FILE.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1123
  exttype: SIEM
- name: psexec_accepteula_condition
  description: Detect ed user accept agreement execution in psexec commandline
  condition: ([Image] =~ ['.*.*psexec.exe']) && ([CommandLine] =~ ['.*accepteula.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1569,t1021
  exttype: SIEM
- name: suspicious_curl_file_upload
  description: Detects a suspicious curl process start the adds a file to a web request
  condition: ([Image] =~ ['.*.*curl.exe']) && ([CommandLine] =~ ['.*.*.*F.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,t1567
  exttype: SIEM
- name: capture_credentials_with_rpcping_exe
  description: Detects using Rpcping.exe to send a RPC test connection to the target
    server (-s) and force the NTLM hash to be sent in the process.
  condition: ([Image] =~ ['.*.*rpcping.exe']) && (([CommandLine] =~ ['.*.*s.*']) ||
    ([CommandLine] =~ ['.*.*s.*'])) && ([CommandLine] =~ ['.*.*u.*']) && ([CommandLine]
    =~ ['.*NTLM.*']) || ([CommandLine] =~ ['.*.*u.*']) && ([CommandLine] =~ ['.*NTLM.*'])
    || ([CommandLine] =~ ['.*.*t.*']) && ([CommandLine] =~ ['.*ncacn.*np.*']) || ([CommandLine]
    =~ ['.*.*t.*']) && ([CommandLine] =~ ['.*ncacn.*np.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003
  exttype: SIEM
- name: suspicious_razerinstaller_explorer_subprocess
  description: Detects a explorer.exe sub process of the RazerInstaller software which
    can be invoked from the installer to select a different installation folder but
    can also be exploited to escalate privileges to LOCAL SYSTEM
  condition: ([ParentImage] =~ ['.*.*RazerInstaller.exe']) && ([IntegrityLevel] ==
    ['System']) && ([Image] !~ ['C.*.*Windows.*Installer.*Razer.*Installer.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation
  exttype: SIEM
- name: wmi_spawning_windows_powershell
  description: Detects WMI spawning PowerShell
  condition: (([ParentImage] =~ ['.*.*wmiprvse.exe'])) && (([Image] =~ ['.*.*powershell.exe']))
    && ([CommandLine] == ['null'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1047,t1059,001,defense_evasion,t1064
  exttype: SIEM
- name: powershell_get_process_lsass
  description: Detects a Get-Process command on lsass process, which is in almost
    all cases a sign of malicious activity
  condition: (([CommandLine] =~ ['.*Get.*Process.*lsass.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1552,004
  exttype: SIEM
- name: suspicious_webdav_client_execution
  description: A General detection for svchost.exe spawning rundll32.exe with command
    arguments like C:\windows\system32\davclnt.dll,DavSetCookie. This could be an
    indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).
  condition: ([Image] =~ ['.*.*rundll32.exe']) && ([CommandLine] =~ ['.*C.*.*windows.*system32.*davclnt.dll.*DavSetCookie.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,exfiltration,t1048,003
  exttype: SIEM
- name: silenttrinity_stager_execution
  description: Detects SILENTTRINITY stager use
  condition: ([Description] =~ ['.*st2stager.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control
  exttype: SIEM
- name: silenttrinity_stager_execution
  description: Detects SILENTTRINITY stager use
  condition: ([Description] =~ ['.*st2stager.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control
  exttype: SIEM
- name: application_whitelisting_bypass_via_bginfo
  description: Execute VBscript code that is referenced within the *.bgi file.
  condition: ([Image] =~ ['.*.*bginfo.exe']) && ([CommandLine] =~ ['.*.*popup.*'])
    && ([CommandLine] =~ ['.*.*nolicprompt.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,defense_evasion,t1218,t1202
  exttype: SIEM
- name: renamed_psexec
  description: Detects the execution of a renamed PsExec often used by attackers or
    malware
  condition: ([Description] == ['Execute processes remotely']) && ([Product] == ['Sysinternals
    PsExec']) && (([Image] !~ ['.*.*PsExec.exe']) || ([Image] !~ ['.*.*PsExec64.exe']))
  level: high
  ruletype: EVALUATE
  tags: car,2013-05-009,attack,defense_evasion,t1036,003
  exttype: SIEM
- name: syncappvpublishingserver_execute_arbitrary_powershell_code
  description: Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe.
  condition: ([Image] =~ ['.*.*SyncAppvPublishingServer.exe']) && ([CommandLine] =~
    ['.*.*n.*.*.*']) && ([CommandLine] =~ ['.*.*Start.*Process.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: infdefaultinstall_exe__inf_execution
  description: Executes SCT script using scrobj.dll from a command in entered into
    a specially prepared INF file.
  condition: ([CommandLine] =~ ['.*InfDefaultInstall.exe.*.*']) && ([CommandLine]
    =~ ['.*.inf.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: systemnightmare_exploitation_script_execution
  description: Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM
  condition: (([CommandLine] =~ ['.*printnightmare.gentilkiwi.com.*']) || ([CommandLine]
    =~ ['.*.*.*user.*gentilguest.*.*']) || ([CommandLine] =~ ['.*Kiwi.*Legit.*Printer.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1068
  exttype: SIEM
- name: renamed_zoho_dctask64
  description: Detects a renamed dctask64.exe used for process injection, command
    execution, process creation with a signed binary by ZOHO Corporation
  condition: ([Imphash] == ['6834B1B94E49701D77CCB3C0895E1AFD']) && ([Image] !~ ['.*.*dctask64.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,t1055,001,t1202,t1218
  exttype: SIEM
- name: suspicious_auditpol_usage
  description: Threat actors can use auditpol binary to change audit policy configuration
    to impair detection capability. This can be carried out by selectively disabling/removing
    certain audit policies as well as restoring a custom policy owned by the threat
    actor.
  condition: ([Image] =~ ['.*.*auditpol.exe']) && (([CommandLine] =~ ['.*disable.*'])
    || ([CommandLine] =~ ['.*clear.*']) || ([CommandLine] =~ ['.*remove.*']) || ([CommandLine]
    =~ ['.*restore.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,002
  exttype: SIEM
- name: discovery_of_a_system_time
  description: Identifies use of various commands to query a systems time. This technique
    may be used before executing a scheduled task or to discover the time zone of
    a target system.
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*time.*']) || ([Image] =~ ['.*.*w32tm.exe']) && ([CommandLine] =~ ['.*tz.*'])
    || ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*Get.*Date.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,discovery,t1124
  exttype: SIEM
- name: remote_powershell_session_host_process__winrm_
  description: Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM
    host process) as a parent or child process (sign of an active PowerShell remote
    session).
  condition: ([Image] =~ ['.*.*wsmprovhost.exe']) || ([ParentImage] =~ ['.*.*wsmprovhost.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001,t1021,006
  exttype: SIEM
- name: suspicious_powershell_cmdline
  description: Detects the PowerShell command lines with reversed strings
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([CommandLine] =~ ['.*hctac.*'])
    || ([CommandLine] =~ ['.*kearb.*']) || ([CommandLine] =~ ['.*dnammoc.*']) || ([CommandLine]
    =~ ['.*ekovn.*']) || ([CommandLine] =~ ['.*eliFd.*']) || ([CommandLine] =~ ['.*rahc.*'])
    || ([CommandLine] =~ ['.*etirw.*']) || ([CommandLine] =~ ['.*golon.*']) || ([CommandLine]
    =~ ['.*tninon.*']) || ([CommandLine] =~ ['.*eddih.*']) || ([CommandLine] =~ ['.*tpircS.*'])
    || ([CommandLine] =~ ['.*ssecorp.*']) || ([CommandLine] =~ ['.*llehsrewop.*'])
    || ([CommandLine] =~ ['.*esnopser.*']) || ([CommandLine] =~ ['.*daolnwod.*'])
    || ([CommandLine] =~ ['.*tneilCbeW.*']) || ([CommandLine] =~ ['.*tneilc.*']) ||
    ([CommandLine] =~ ['.*ptth.*']) || ([CommandLine] =~ ['.*elifotevas.*']) || ([CommandLine]
    =~ ['.*46esab.*']) || ([CommandLine] =~ ['.*htaPpmeTteG.*']) || ([CommandLine]
    =~ ['.*tcejbO.*']) || ([CommandLine] =~ ['.*maerts.*']) || ([CommandLine] =~ ['.*hcaerof.*'])
    || ([CommandLine] =~ ['.*ekovni.*']) || ([CommandLine] =~ ['.*retupmoc.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027,execution,t1059,001
  exttype: SIEM
- name: interactive_at_job
  description: Detect an interactive AT job, which may be used as a form of privilege
    escalation.
  condition: ([Image] =~ ['.*.*at.exe']) && ([CommandLine] =~ ['.*interactive.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1053,002
  exttype: SIEM
- name: meterpreter_or_cobalt_strike_getsystem_service_start
  description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting
    a specific service starting
  condition: ([ParentImage] =~ ['.*.*services.exe']) && ([CommandLine] =~ ['.*cmd.*'])
    && ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine] =~ ['.*echo.*']) && ([CommandLine]
    =~ ['.*.*pipe.*.*.*']) || ([CommandLine] =~ ['.*.*COMSPEC.*.*']) && ([CommandLine]
    =~ ['.*.*c.*']) && ([CommandLine] =~ ['.*echo.*']) && ([CommandLine] =~ ['.*.*pipe.*.*.*'])
    || ([CommandLine] =~ ['.*cmd.exe.*']) && ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine]
    =~ ['.*echo.*']) && ([CommandLine] =~ ['.*.*pipe.*.*.*']) || ([CommandLine] =~
    ['.*rundll32.*']) && ([CommandLine] =~ ['.*.dll.*a.*']) && ([CommandLine] =~ ['.*.*p.*.*'])
    && ([CommandLine] !~ ['.*MpCmdRun.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1134,001,002
  exttype: SIEM
- name: malicious_windows_script_components_file_execution_by_taef_detection
  description: Windows Test Authoring and Execution Framework (TAEF) framework allows
    you to run automation by executing tests files written on different languages
    (C, C#, Microsoft COM Scripting interfaces). Adversaries may execute malicious
    code (such as WSC file with VBScript, dll and so on) directly by running te.exe
  condition: ([Image] =~ ['.*.*te.exe']) || ([ParentImage] =~ ['.*.*te.exe']) || ([OriginalFileName]
    == ['\te.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,t1218
  exttype: SIEM
- name: suspicious_msiexec_directory
  description: Detects suspicious msiexec process starts in an uncommon directory
  condition: ([Image] =~ ['.*.*msiexec.exe']) && (([Image] !~ ['C.*.*Windows.*System32.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']) || ([Image] !~ ['C.*.*Windows.*WinSxS.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,005
  exttype: SIEM
- name: malicious_payload_download_via_office_binaries
  description: Downloads payload from remote server
  condition: (([Image] =~ ['.*.*powerpnt.exe']) || ([Image] =~ ['.*.*winword.exe'])
    || ([Image] =~ ['.*.*excel.exe'])) && ([CommandLine] =~ ['.*http.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1105
  exttype: SIEM
- name: explorer_root_flag_process_tree_break
  description: Detects a command line process that uses explorer.exe /root, which
    is similar to cmd.exe /c, only it breaks the process tree and makes its parent
    a new instance of explorer
  condition: ([CommandLine] =~ ['.*explorer.exe.*']) && ([CommandLine] =~ ['.*.*.*root.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: netsh_program_allowed_with_suspcious_location
  description: Detects Netsh commands that allows a suspcious application location
    on Windows Firewall
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*firewall.*'])
    && ([CommandLine] =~ ['.*add.*']) && ([CommandLine] =~ ['.*allowedprogram.*'])
    || ([CommandLine] =~ ['.*advfirewall.*']) && ([CommandLine] =~ ['.*rule.*']) &&
    ([CommandLine] =~ ['.*action=allow.*']) && ([CommandLine] =~ ['.*program=.*'])
    && (([CommandLine] =~ ['.*.*TEMP.*.*']) || ([CommandLine] =~ ['.*.*.*RECYCLER.*.*.*'])
    || ([CommandLine] =~ ['.*C.*.*.*Recycle.bin.*.*.*']) || ([CommandLine] =~ ['.*.*.*SystemVolumeInformation.*.*.*'])
    || ([CommandLine] =~ ['.*C.*.*Windows.*Temp.*.*.*']) || ([CommandLine] =~ ['.*C.*.*Temp.*.*.*'])
    || ([CommandLine] =~ ['.*C.*.*Users.*Public.*.*.*']) || ([CommandLine] =~ ['.*C.*.*Users.*Default.*.*.*'])
    || ([CommandLine] =~ ['.*C.*.*Users.*Desktop.*.*.*']) || ([CommandLine] =~ ['.*.*Downloads.*.*.*'])
    || ([CommandLine] =~ ['.*.*Temporary.*Internet.*Files.*Content.Outlook.*.*.*'])
    || ([CommandLine] =~ ['.*.*Local.*Settings.*Temporary.*Internet.*Files.*.*.*']))
    || (([CommandLine] =~ ['C.*.*Windows.*Tasks.*.*.*']) || ([CommandLine] =~ ['C.*.*Windows.*debug.*.*.*'])
    || ([CommandLine] =~ ['C.*.*Windows.*fonts.*.*.*']) || ([CommandLine] =~ ['C.*.*Windows.*help.*.*.*'])
    || ([CommandLine] =~ ['C.*.*Windows.*drivers.*.*.*']) || ([CommandLine] =~ ['C.*.*Windows.*addins.*.*.*'])
    || ([CommandLine] =~ ['C.*.*Windows.*cursors.*.*.*']) || ([CommandLine] =~ ['C.*.*Windows.*system32.*tasks.*.*.*'])
    || ([CommandLine] =~ ['.*Public.*.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,004
  exttype: SIEM
- name: application_whitelisting_bypass_via_dll_loaded_by_odbcconf_exe
  description: Detects defence evasion attempt via odbcconf.exe execution to load
    DLL
  condition: ([Image] =~ ['.*.*odbcconf.exe']) && (([CommandLine] =~ ['.*.*f.*'])
    || ([CommandLine] =~ ['.*regsvr.*'])) || ([ParentImage] =~ ['.*.*odbcconf.exe'])
    && ([Image] =~ ['.*.*rundll32.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,008,execution
  exttype: SIEM
- name: curl_start_combination
  description: Adversaries can use curl to download payloads remotely and execute
    them. Curl is included by default in Windows 10 build 17063 and later.
  condition: ([CommandLine] =~ ['.*curl.*']) && ([CommandLine] =~ ['.*.*start.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1218,command_and_control,t1105
  exttype: SIEM
- name: stop_or_remove_antivirus_service
  description: Adversaries may disable security tools to avoid possible detection
    of their tools and activities by stopping antivirus service
  condition: (([CommandLine] =~ ['.*Stop.*Service.*.*']) || ([CommandLine] =~ ['.*Remove.*Service.*.*']))
    && (([CommandLine] =~ ['.*.*McAfeeDLPAgentService.*']) || ([CommandLine] =~ ['.*.*Trend.*Micro.*Deep.*Security.*Manager.*'])
    || ([CommandLine] =~ ['.*.*TMBMServer.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: mshta_spawning_windows_shell
  description: Detects a suspicious child process of a mshta.exe process
  condition: ([ParentImage] =~ ['.*.*mshta.exe']) && (([Image] =~ ['.*.*powershell.exe'])
    || ([Image] =~ ['.*.*cmd.exe']) || ([Image] =~ ['.*.*WScript.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1064,t1059,005,001,t1218
  exttype: SIEM
- name: compress_data_and_lock_with_password_for_exfiltration_with_winzip
  description: An adversary may compress or encrypt data that is collected prior to
    exfiltration using 3rd party utilities
  condition: (([CommandLine] =~ ['.*winzip.exe.*']) || ([CommandLine] =~ ['.*winzip64.exe.*']))
    && (([CommandLine] =~ ['.*.*s.*.*'])) && (([CommandLine] =~ ['.*.*.*min.*.*'])
    || ([CommandLine] =~ ['.*.*.*a.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1560,001
  exttype: SIEM
- name: suspicious_gup_usage
  description: Detects execution of the Notepad++ updater in a suspicious directory,
    which is often used in DLL side-loading attacks
  condition: ([Image] =~ ['.*.*GUP.exe']) && (([Image] !~ ['.*.*Users.*.*.*.*AppData.*Local.*Notepad.*.*.*updater.*GUP.exe'])
    || ([Image] !~ ['.*.*Users.*.*.*.*AppData.*Roaming.*Notepad.*.*.*updater.*GUP.exe'])
    || ([Image] !~ ['.*.*Program.*Files.*Notepad.*.*.*updater.*GUP.exe']) || ([Image]
    !~ ['.*.*Program.*Files.*.*x86.*.*Notepad.*.*.*updater.*GUP.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1574,002,t1073
  exttype: SIEM
- name: recon_activity_with_nltest
  description: Detects nltest commands that can be used for information discovery
  condition: ([Image] =~ ['.*.*nltest.exe']) && ([CommandLine] =~ ['.*.*server.*'])
    && ([CommandLine] =~ ['.*.*query.*']) || (([CommandLine] =~ ['.*.*dclist.*.*'])
    || ([CommandLine] =~ ['.*.*parentdomain.*']) || ([CommandLine] =~ ['.*.*domain.*trusts.*'])
    || ([CommandLine] =~ ['.*.*user.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1016,t1482
  exttype: SIEM
- name: malicious_pe_execution_by_microsoft_visual_studio_debugger
  description: There is an option for a MS VS Just-In-Time Debugger "vsjitdebugger.exe"
    to launch specified executable and attach a debugger. This option may be used
    adversaries to execute malicious code by signed verified binary. The debugger
    is installed alongside with Microsoft Visual Studio package.
  condition: ([ParentImage] =~ ['.*.*vsjitdebugger.exe']) && ([Image] !~ ['.*.*vsimmersiveactivatehelper.*.exe'])
    || ([Image] !~ ['.*.*devenv.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,t1218,defense_evasion
  exttype: SIEM
- name: powershell_sam_copy
  description: Detects suspicious PowerShell scripts accessing SAM hives
  condition: ([CommandLine] =~ ['.*.*HarddiskVolumeShadowCopy.*']) && ([CommandLine]
    =~ ['.*ystem32.*config.*sam.*']) && (([CommandLine] =~ ['.*Copy.*Item.*']) ||
    ([CommandLine] =~ ['.*cp.*.*.*..*']) || ([CommandLine] =~ ['.*cpi.*.*.*..*'])
    || ([CommandLine] =~ ['.*copy.*.*.*..*']) || ([CommandLine] =~ ['.*.File.*.*.*Copy.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,002
  exttype: SIEM
- name: ms_office_product_spawning_exe_in_user_dir
  description: Detects an executable in the users directory started from Microsoft
    Word, Excel, Powerpoint, Publisher or Visio
  condition: (([ParentImage] =~ ['.*.*WINWORD.EXE']) || ([ParentImage] =~ ['.*.*EXCEL.EXE'])
    || ([ParentImage] =~ ['.*.*POWERPNT.exe']) || ([ParentImage] =~ ['.*.*MSPUB.exe'])
    || ([ParentImage] =~ ['.*.*VISIO.exe'])) && ([Image] =~ ['C.*.*users.*.*.*'])
    && ([Image] =~ ['.*.exe']) && ([Image] !~ ['.*.*Teams.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002,g0046,car,2013-05-002
  exttype: SIEM
- name: run_whoami_as_system
  description: Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of
    a successful local privilege escalation.
  condition: ([User] == ['NT AUTHORITY\SYSTEM']) && ([Image] =~ ['.*.*whoami.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,discovery,t1033
  exttype: SIEM
- name: esentutl_gather_credentials
  description: Conti recommendation to its affiliates to use esentult to access NTDS
    dumped file. Trickbot also uses this utilities to get MSEdge info via its module
    pwgrab.
  condition: ([CommandLine] =~ ['.*esentutl.*']) && ([CommandLine] =~ ['.*.*.*p.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,003
  exttype: SIEM
- name: discover_private_keys
  description: Adversaries may search for private key certificate files on compromised
    systems for insecurely stored credential
  condition: (([CommandLine] =~ ['.*dir.*.*']) || ([CommandLine] =~ ['.*findstr.*.*']))
    && (([CommandLine] =~ ['.*.key.*']) || ([CommandLine] =~ ['.*.pgp.*']) || ([CommandLine]
    =~ ['.*.gpg.*']) || ([CommandLine] =~ ['.*.ppk.*']) || ([CommandLine] =~ ['.*.p12.*'])
    || ([CommandLine] =~ ['.*.pem.*']) || ([CommandLine] =~ ['.*.pfx.*']) || ([CommandLine]
    =~ ['.*.cer.*']) || ([CommandLine] =~ ['.*.p7b.*']) || ([CommandLine] =~ ['.*.asc.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1552,004
  exttype: SIEM
- name: suspicious_plink_remote_forwarding
  description: Detects suspicious Plink tunnel remote forarding to a local port
  condition: ([Description] == ['Command-line SSH, Telnet, and Rlogin client']) &&
    ([CommandLine] =~ ['.*.*.*R.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1572,lateral_movement,t1021,001
  exttype: SIEM
- name: dropping_of_password_filter_dll
  description: Detects dropping of dll files in system32 that may be used to retrieve
    user credentials from LSASS
  condition: ([CommandLine] =~ ['.*HKLM.*SYSTEM.*CurrentControlSet.*Control.*Lsa.*'])
    && ([CommandLine] =~ ['.*scecli.*0.*']) && ([CommandLine] =~ ['.*reg.*add.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1174,t1556,002
  exttype: SIEM
- name: suspicious_adfind_execution
  description: Detects the execution of a AdFind for Active Directory enumeration
  condition: (([CommandLine] =~ ['.*objectcategory.*']) || ([CommandLine] =~ ['.*trustdmp.*'])
    || ([CommandLine] =~ ['.*dcmodes.*']) || ([CommandLine] =~ ['.*dclist.*']) ||
    ([CommandLine] =~ ['.*computers.*pwdnotreqd.*'])) && ([Image] =~ ['.*.*adfind.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1018,t1087,002,t1482,t1069
  exttype: SIEM
- name: windows_credential_editor
  description: Detects the use of Windows Credential Editor (WCE)
  condition: (([Imphash] =~ ['a53a02b997935fd8eedcb5f7abab9b9f']) || ([Imphash] =~
    ['e96a73c7bf33a464c510ede582318bf2'])) || ([CommandLine] =~ ['.*.exe.*.*S']) &&
    ([ParentImage] =~ ['.*.*services.exe']) && ([Image] !~ ['.*.*clussvc.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,s0005
  exttype: SIEM
- name: execution_in_webserver_root_folder
  description: Detects a suspicious program execution in a web service root folder
    (filter out false positives)
  condition: (([Image] =~ ['.*.*wwwroot.*.*.*']) || ([Image] =~ ['.*.*wmpub.*.*.*'])
    || ([Image] =~ ['.*.*htdocs.*.*.*'])) && (([Image] !~ ['.*bin.*.*.*']) || ([Image]
    !~ ['.*.*Tools.*.*.*']) || ([Image] !~ ['.*.*SMSComponent.*.*.*'])) && (([ParentImage]
    !~ ['.*.*services.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003,t1100
  exttype: SIEM
- name: detection_of_powershell_execution_via_sqlps_exe
  description: This rule detects execution of a PowerShell code through the sqlps.exe
    utility, which is included in the standard set of utilities supplied with the
    MSSQL Server. Script blocks are not logged in this case, so this utility helps
    to bypass protection mechanisms based on the analysis of these logs.
  condition: ([Image] =~ ['.*.*sqlps.exe']) || ([ParentImage] =~ ['.*.*sqlps.exe'])
    || ([OriginalFileName] == ['\sqlps.exe']) && ([ParentImage] !~ ['.*.*sqlagent.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,defense_evasion,t1127
  exttype: SIEM
- name: suspicious_ftp_exe
  description: Detects renamed ftp.exe, ftp.exe script execution and child processes
    ran by ftp.exe
  condition: ([CommandLine] =~ ['.*.*s.*.*']) && ([Image] =~ ['.*ftp.exe']) || ([OriginalFileName]
    =~ ['.*ftp.exe.*']) || ([OriginalFileName] =~ ['.*ftp.exe.*']) && ([Image] !~
    ['.*ftp.exe']) || ([ParentImage] =~ ['.*ftp.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,defense_evasion,t1202
  exttype: SIEM
- name: application_whitelisting_bypass_via_dnx_exe
  description: Execute C# code located in the consoleapp folder
  condition: ([Image] =~ ['.*.*dnx.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,t1027,004,execution
  exttype: SIEM
- name: procdump_usage
  description: Detects uses of the SysInternals Procdump utility
  condition: (([Image] =~ ['.*.*procdump.exe']) || ([Image] =~ ['.*.*procdump64.exe']))
    || ([CommandLine] =~ ['.*.*.*ma.*.*']) && ([CommandLine] =~ ['.*.exe.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,t1003,001
  exttype: SIEM
- name: webshell_detection_with_command_line_keywords
  description: Detects certain command line parameters often used during reconnaissance
    activity via web shells
  condition: (([ParentImage] =~ ['.*.*w3wp.exe']) || ([ParentImage] =~ ['.*.*php.*cgi.exe'])
    || ([ParentImage] =~ ['.*.*nginx.exe']) || ([ParentImage] =~ ['.*.*httpd.exe']))
    || (([ParentImage] =~ ['.*.*apache.*']) || ([ParentImage] =~ ['.*.*tomcat.*']))
    && (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && (([CommandLine]
    =~ ['.*.*user.*.*']) || ([CommandLine] =~ ['.*.*use.*.*']) || ([CommandLine] =~
    ['.*.*group.*.*'])) || ([Image] =~ ['.*.*ping.exe']) && ([CommandLine] =~ ['.*.*.*n.*.*'])
    || (([CommandLine] =~ ['.*.*cd.*echo.*']) || ([CommandLine] =~ ['.*cd.*.*d.*.*']))
    || ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine] =~ ['.*.*.*node.*.*']) || (([Image]
    =~ ['.*.*whoami.exe']) || ([Image] =~ ['.*.*systeminfo.exe']) || ([Image] =~ ['.*.*quser.exe'])
    || ([Image] =~ ['.*.*ipconfig.exe']) || ([Image] =~ ['.*.*pathping.exe']) || ([Image]
    =~ ['.*.*tracert.exe']) || ([Image] =~ ['.*.*netstat.exe']) || ([Image] =~ ['.*.*schtasks.exe'])
    || ([Image] =~ ['.*.*vssadmin.exe']) || ([Image] =~ ['.*.*wevtutil.exe']) || ([Image]
    =~ ['.*.*tasklist.exe'])) || (([CommandLine] =~ ['.*.*Test.*NetConnection.*.*'])
    || ([CommandLine] =~ ['.*dir.*.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003,t1018,t1033,t1087,privilege_escalation,t1100
  exttype: SIEM
- name: disabled_volume_snapshots
  description: Detects commands that temporarily turn off Volume Snapshots
  condition: ([CommandLine] =~ ['.*reg.*']) && ([CommandLine] =~ ['.*.*add.*.*'])
    && ([CommandLine] =~ ['.*.*Services.*VSS.*Diag.*']) && ([CommandLine] =~ ['.*.*d.*Disabled.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: suspicious_wmic_activescripteventconsumer_creation
  description: Detects WMIC executions in which a event consumer gets created in order
    to establish persistence
  condition: ([CommandLine] =~ ['.*ActiveScriptEventConsumer.*']) && ([CommandLine]
    =~ ['.*.*CREATE.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1546,003
  exttype: SIEM
- name: suspicious_tscon_start
  description: Detects a tscon.exe start as LOCAL SYSTEM
  condition: ([User] == ['NT AUTHORITY\SYSTEM']) && ([Image] =~ ['.*.*tscon.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1219
  exttype: SIEM
- name: executable_used_by_plugx_in_uncommon_location
  description: Detects the execution of an executable that is typically used by PlugX
    for DLL side loading started from an uncommon location
  condition: ([Image] =~ ['.*.*CamMute.exe']) && (([Image] !~ ['.*.*Lenovo.*Communication.*Utility.*.*.*'])
    || ([Image] !~ ['.*.*Lenovo.*Communications.*Utility.*.*.*'])) || ([Image] =~
    ['.*.*chrome.*frame.*helper.exe']) && ([Image] !~ ['.*.*Google.*Chrome.*application.*.*.*'])
    || ([Image] =~ ['.*.*dvcemumanager.exe']) && ([Image] !~ ['.*.*Microsoft.*Device.*Emulator.*.*.*'])
    || ([Image] =~ ['.*.*Gadget.exe']) && ([Image] !~ ['.*.*Windows.*Media.*Player.*.*.*'])
    || ([Image] =~ ['.*.*hcc.exe']) && ([Image] !~ ['.*.*HTML.*Help.*Workshop.*.*.*'])
    || ([Image] =~ ['.*.*hkcmd.exe']) && (([Image] !~ ['.*.*System32.*.*.*']) || ([Image]
    !~ ['.*.*SysNative.*.*.*']) || ([Image] !~ ['.*.*SysWowo64.*.*.*'])) || ([Image]
    =~ ['.*.*Mc.exe']) && (([Image] !~ ['.*.*Microsoft.*Visual.*Studio.*']) || ([Image]
    !~ ['.*.*Microsoft.*SDK.*']) || ([Image] !~ ['.*.*Windows.*Kit.*'])) || ([Image]
    =~ ['.*.*MsMpEng.exe']) && (([Image] !~ ['.*.*Microsoft.*Security.*Client.*.*.*'])
    || ([Image] !~ ['.*.*Windows.*Defender.*.*.*']) || ([Image] !~ ['.*.*AntiMalware.*.*.*']))
    || ([Image] =~ ['.*.*msseces.exe']) && (([Image] !~ ['.*.*Microsoft.*Security.*Center.*.*.*'])
    || ([Image] !~ ['.*.*Microsoft.*Security.*Client.*.*.*']) || ([Image] !~ ['.*.*Microsoft.*Security.*Essentials.*.*.*']))
    || ([Image] =~ ['.*.*OInfoP11.exe']) && ([Image] !~ ['.*.*Common.*Files.*Microsoft.*Shared.*.*.*'])
    || ([Image] =~ ['.*.*OleView.exe']) && (([Image] !~ ['.*.*Microsoft.*Visual.*Studio.*'])
    || ([Image] !~ ['.*.*Microsoft.*SDK.*']) || ([Image] !~ ['.*.*Windows.*Kit.*'])
    || ([Image] !~ ['.*.*Windows.*Resource.*Kit.*.*.*'])) || ([Image] =~ ['.*.*rc.exe'])
    && (([Image] !~ ['.*.*Microsoft.*Visual.*Studio.*']) || ([Image] !~ ['.*.*Microsoft.*SDK.*'])
    || ([Image] !~ ['.*.*Windows.*Kit.*']) || ([Image] !~ ['.*.*Windows.*Resource.*Kit.*.*.*'])
    || ([Image] !~ ['.*.*Microsoft.NET.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,s0013,defense_evasion,t1073,t1574,002
  exttype: SIEM
- name: mshta_spawning_windows_shell
  description: Detects a Windows command line executable started from MSHTA
  condition: ([ParentImage] =~ ['.*.*mshta.exe']) && (([Image] =~ ['.*.*cmd.exe'])
    || ([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*wscript.exe']) ||
    ([Image] =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~
    ['.*.*bash.exe']) || ([Image] =~ ['.*.*reg.exe']) || ([Image] =~ ['.*.*regsvr32.exe']))
    || (([Image] =~ ['.*.*BITSADMIN.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1170,t1218,005,car,2013-02-003,2013-03-001,2014-04-003
  exttype: SIEM
- name: cmstp_execution_process_creation
  description: Detects various indicators of Microsoft Connection Manager Profile
    Installer execution
  condition: ([ParentImage] =~ ['.*.*cmstp.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1191,t1218,003,g0069,car,2019-04-001
  exttype: SIEM
- name: windows_network_enumeration
  description: Identifies attempts to enumerate hosts in a network using the built-in
    Windows net.exe tool.
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && ([CommandLine]
    =~ ['.*view.*']) && ([CommandLine] !~ ['.*.*.*.*.*.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,discovery,t1018
  exttype: SIEM
- name: whoami_execution_anomaly
  description: Detects the execution of whoami with suspicious parents or parameters
  condition: ([Image] =~ ['.*.*whoami.exe']) && (([ParentImage] !~ ['.*.*cmd.exe'])
    || ([ParentImage] !~ ['.*.*powershell.exe'])) || (([CommandLine] =~ ['.*whoami.*.*all.*'])
    || ([CommandLine] =~ ['.*whoami.*.*all.*']) || ([CommandLine] =~ ['.*whoami.exe.*.*all.*'])
    || ([CommandLine] =~ ['.*whoami.exe.*.*all.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,discovery,t1033,car,2016-03-001
  exttype: SIEM
- name: elise_backdoor
  description: Detects Elise backdoor acitivty as used by APT32
  condition: ([Image] == ['C:\Windows\SysWOW64\cmd.exe']) && ([CommandLine] =~ ['.*.*Windows.*Caches.*NavShExt.dll.*.*'])
    || ([CommandLine] =~ ['.*.*AppData.*Roaming.*MICROS.*1.*Windows.*Caches.*NavShExt.dll.*Setting'])
  level: critical
  ruletype: EVALUATE
  tags: attack,g0030,g0050,s0081,execution,t1059,003
  exttype: SIEM
- name: powershell_script_run_in_appdata
  description: Detects a suspicious command line execution that invokes PowerShell
    with reference to an AppData folder
  condition: ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine] =~ ['.*powershell.*'])
    && ([CommandLine] =~ ['.*.*AppData.*.*.*']) && (([CommandLine] =~ ['.*Local.*.*.*'])
    || ([CommandLine] =~ ['.*Roaming.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: run_powershell_script_from_ads
  description: Detects PowerShell script execution from Alternate Data Stream (ADS)
  condition: ([ParentImage] =~ ['.*.*powershell.exe']) && ([Image] =~ ['.*.*powershell.exe'])
    && ([CommandLine] =~ ['.*Get.*Content.*']) && ([CommandLine] =~ ['.*.*Stream.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1096,t1564,004
  exttype: SIEM
- name: rundll32_without_parameters
  description: Detects rundll32 execution without parameters as observed when running
    Metasploit windows/smb/psexec exploit module
  condition: ([CommandLine] == ['rundll32.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1021,002,t1570,execution,t1569
  exttype: SIEM
- name: reg_add_run_key
  description: Detects suspicious command line reg.exe tool adding key to RUN key
    in Registry
  condition: ([CommandLine] =~ ['.*reg.*']) && ([CommandLine] =~ ['.*.*ADD.*.*'])
    && ([CommandLine] =~ ['.*Software.*Microsoft.*Windows.*CurrentVersion.*Run.*'])
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: serv_u_exploitation_cve_2021_35211_by_dev_0322
  description: Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211
    vulnerability by threat group DEV-0322
  condition: ([CommandLine] =~ ['.*whoami.*']) && (([CommandLine] =~ ['.*..*Client.*Common.*.*'])
    || ([CommandLine] =~ ['.*..*Client.*Common.*.*.*'])) || ([CommandLine] =~ ['.*C.*.*Windows.*Temp.*Serv.*U.bat.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1136,001
  exttype: SIEM
- name: direct_autorun_keys_modification
  description: Detects direct modification of autostart extensibility point (ASEP)
    in registry using reg.exe.
  condition: ([Image] =~ ['.*.*reg.exe']) && ([CommandLine] =~ ['.*add.*']) && (([CommandLine]
    =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*Run.*']) || ([CommandLine]
    =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*RunOnce.*']) || ([CommandLine]
    =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*RunOnceEx.*']) || ([CommandLine]
    =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*RunServices.*']) || ([CommandLine]
    =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*RunServicesOnce.*']) ||
    ([CommandLine] =~ ['.*.*software.*Microsoft.*Windows.*NT.*CurrentVersion.*Winlogon.*Userinit.*'])
    || ([CommandLine] =~ ['.*.*software.*Microsoft.*Windows.*NT.*CurrentVersion.*Winlogon.*Shell.*'])
    || ([CommandLine] =~ ['.*.*software.*Microsoft.*Windows.*NT.*CurrentVersion.*Windows.*'])
    || ([CommandLine] =~ ['.*.*software.*Microsoft.*Windows.*CurrentVersion.*Explorer.*User.*Shell.*Folders.*'])
    || ([CommandLine] =~ ['.*.*system.*CurrentControlSet.*Control.*SafeBoot.*AlternateShell.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1547,001,t1060
  exttype: SIEM
- name: malicious_base64_encoded_powershell_keywords_in_command_lines
  description: Detects base64 encoded strings used in hidden malicious PowerShell
    command lines
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*.*hidden.*.*'])
    && (([CommandLine] =~ ['.*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA.*'])
    || ([CommandLine] =~ ['.*aXRzYWRtaW4gL3RyYW5zZmVy.*']) || ([CommandLine] =~ ['.*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA.*'])
    || ([CommandLine] =~ ['.*JpdHNhZG1pbiAvdHJhbnNmZX.*']) || ([CommandLine] =~ ['.*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg.*'])
    || ([CommandLine] =~ ['.*Yml0c2FkbWluIC90cmFuc2Zlc.*']) || ([CommandLine] =~ ['.*AGMAaAB1AG4AawBfAHMAaQB6AGUA.*'])
    || ([CommandLine] =~ ['.*JABjAGgAdQBuAGsAXwBzAGkAegBlA.*']) || ([CommandLine]
    =~ ['.*JGNodW5rX3Npem.*']) || ([CommandLine] =~ ['.*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ.*'])
    || ([CommandLine] =~ ['.*RjaHVua19zaXpl.*']) || ([CommandLine] =~ ['.*Y2h1bmtfc2l6Z.*'])
    || ([CommandLine] =~ ['.*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A.*']) || ([CommandLine]
    =~ ['.*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg.*']) || ([CommandLine] =~ ['.*lPLkNvbXByZXNzaW9u.*'])
    || ([CommandLine] =~ ['.*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA.*']) || ([CommandLine]
    =~ ['.*SU8uQ29tcHJlc3Npb2.*']) || ([CommandLine] =~ ['.*Ty5Db21wcmVzc2lvb.*'])
    || ([CommandLine] =~ ['.*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ.*']) || ([CommandLine]
    =~ ['.*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA.*']) || ([CommandLine] =~ ['.*lPLk1lbW9yeVN0cmVhb.*'])
    || ([CommandLine] =~ ['.*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A.*']) || ([CommandLine]
    =~ ['.*SU8uTWVtb3J5U3RyZWFt.*']) || ([CommandLine] =~ ['.*Ty5NZW1vcnlTdHJlYW.*'])
    || ([CommandLine] =~ ['.*4ARwBlAHQAQwBoAHUAbgBrA.*']) || ([CommandLine] =~ ['.*5HZXRDaHVua.*'])
    || ([CommandLine] =~ ['.*AEcAZQB0AEMAaAB1AG4Aaw.*']) || ([CommandLine] =~ ['.*LgBHAGUAdABDAGgAdQBuAGsA.*'])
    || ([CommandLine] =~ ['.*LkdldENodW5r.*']) || ([CommandLine] =~ ['.*R2V0Q2h1bm.*'])
    || ([CommandLine] =~ ['.*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A.*']) || ([CommandLine]
    =~ ['.*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA.*']) || ([CommandLine] =~ ['.*RIUkVBRF9JTkZPNj.*'])
    || ([CommandLine] =~ ['.*SFJFQURfSU5GTzY0.*']) || ([CommandLine] =~ ['.*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA.*'])
    || ([CommandLine] =~ ['.*VEhSRUFEX0lORk82N.*']) || ([CommandLine] =~ ['.*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA.*'])
    || ([CommandLine] =~ ['.*cmVhdGVSZW1vdGVUaHJlYW.*']) || ([CommandLine] =~ ['.*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA.*'])
    || ([CommandLine] =~ ['.*NyZWF0ZVJlbW90ZVRocmVhZ.*']) || ([CommandLine] =~ ['.*Q3JlYXRlUmVtb3RlVGhyZWFk.*'])
    || ([CommandLine] =~ ['.*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA.*'])
    || ([CommandLine] =~ ['.*0AZQBtAG0AbwB2AGUA.*']) || ([CommandLine] =~ ['.*1lbW1vdm.*'])
    || ([CommandLine] =~ ['.*AGUAbQBtAG8AdgBlA.*']) || ([CommandLine] =~ ['.*bQBlAG0AbQBvAHYAZQ.*'])
    || ([CommandLine] =~ ['.*bWVtbW92Z.*']) || ([CommandLine] =~ ['.*ZW1tb3Zl.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: ping_hex_ip
  description: Detects a ping command that uses a hex encoded IP address
  condition: ([Image] =~ ['.*.*ping.exe']) && ([CommandLine] =~ ['.*0x.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1140,t1027
  exttype: SIEM
- name: emotet_process_creation
  description: Detects all Emotet like process executions that are not covered by
    the more generic rules
  condition: (([CommandLine] =~ ['.*.*.*e.*.*PAA.*']) || ([CommandLine] =~ ['.*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ.*'])
    || ([CommandLine] =~ ['.*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA.*']) || ([CommandLine]
    =~ ['.*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA.*']) || ([CommandLine] =~ ['.*IgAoACcAKgAnACkAOwAkA.*'])
    || ([CommandLine] =~ ['.*IAKAAnACoAJwApADsAJA.*']) || ([CommandLine] =~ ['.*iACgAJwAqACcAKQA7ACQA.*'])
    || ([CommandLine] =~ ['.*JABGAGwAeAByAGgAYwBmAGQ.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086,defense_evasion,t1027
  exttype: SIEM
- name: gfxdownloadwrapper_exe_downloads_file_from_suspicious_url
  description: Detects when GfxDownloadWrapper.exe downloads file from non standard
    URL
  condition: ([Image] =~ ['.*.*GfxDownloadWrapper.exe']) && ([CommandLine] !~ ['.*gameplayapi.intel.com.*'])
    && ([ParentImage] !~ ['.*.*GfxDownloadWrapper.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,command_and_control,t1105
  exttype: SIEM
- name: notpetya_ransomware_activity
  description: Detects NotPetya ransomware activity in which the extracted passwords
    are passed back to the main module via named pipe, the file system journal of
    drive C is deleted and windows eventlogs are cleared using wevtutil
  condition: ([CommandLine] =~ ['.*.*AppData.*Local.*Temp.*.*.*']) && ([CommandLine]
    =~ ['.*.*.*..*pipe.*.*.*.*']) || ([Image] =~ ['.*.*rundll32.exe']) && ([CommandLine]
    =~ ['.*.dat.*.*1']) || message =~ '.*perfc.dat'
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011,execution,t1085,t1070,001,credential_access,t1003,car,2016-04-002
  exttype: SIEM
- name: execution_in_outlook_temp_folder
  description: Detects a suspicious program execution in Outlook temp folder
  condition: ([Image] =~ ['.*.*Temporary.*Internet.*Files.*Content.Outlook.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1566,001,t1193
  exttype: SIEM
- name: command_line_execution_with_suspicious_url_and_appdata_strings
  description: Detects a suspicious command line execution that includes an URL and
    AppData string in the command line parameters as used by several droppers (js/vbs
    > powershell)
  condition: ([Image] =~ ['.*.*cmd.exe']) && ([CommandLine] =~ ['.*http.*']) && ([CommandLine]
    =~ ['.*.*.*.*.*']) && ([CommandLine] =~ ['.*.*AppData.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,003,001,command_and_control,t1105
  exttype: SIEM
- name: netsh_port_forwarding
  description: Detects netsh commands that configure a port forwarding (PortProxy)
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*interface.*'])
    && ([CommandLine] =~ ['.*portproxy.*']) && ([CommandLine] =~ ['.*add.*']) && ([CommandLine]
    =~ ['.*v4tov4.*']) || ([CommandLine] =~ ['.*connectp.*']) && ([CommandLine] =~
    ['.*listena.*']) && ([CommandLine] =~ ['.*c=.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,lateral_movement,defense_evasion,command_and_control,t1090
  exttype: SIEM
- name: high_integrity_sdclt_process
  description: A General detection for sdclt being spawned as an elevated process.
    This could be an indicator of sdclt being used for bypass UAC techniques.
  condition: ([Image] =~ ['.*sdclt.exe']) && ([IntegrityLevel] == ['High'])
  level: medium
  ruletype: EVALUATE
  tags: attack,privilege_escalation,defense_evasion,t1548,002
  exttype: SIEM
- name: html_help_shell_spawn
  description: Detects a suspicious child process of a Microsoft HTML Help system
    when executing compiled HTML files (.chm)
  condition: ([ParentImage] == ['C:\Windows\hh.exe']) && (([Image] =~ ['.*.*cmd.exe'])
    || ([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*wscript.exe']) ||
    ([Image] =~ ['.*.*cscript.exe']) || ([Image] =~ ['.*.*regsvr32.exe']) || ([Image]
    =~ ['.*.*wmic.exe']) || ([Image] =~ ['.*.*rundll32.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,001,010,011,execution,t1223,t1059,003,005,007,t1047
  exttype: SIEM
- name: suspicious_compression_tool_parameters
  description: Detects suspicious command line arguments of common data compression
    tools
  condition: (([OriginalFileName] =~ ['7z.*.exe']) || ([OriginalFileName] =~ ['.*rar.exe'])
    || ([OriginalFileName] =~ ['.*Command.*Line.*RAR.*'])) && (([CommandLine] =~ ['.*.*.*p.*'])
    || ([CommandLine] =~ ['.*.*.*ta.*']) || ([CommandLine] =~ ['.*.*.*tb.*']) || ([CommandLine]
    =~ ['.*.*.*sdel.*']) || ([CommandLine] =~ ['.*.*.*dw.*']) || ([CommandLine] =~
    ['.*.*.*hp.*'])) && ([ParentImage] !~ ['C.*.*Program.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,collection,t1560,001,exfiltration,t1020,t1002
  exttype: SIEM
- name: shells_spawned_by_web_servers
  description: Web servers that spawn shell processes could be the result of a successfully
    placed web shell or an other attack
  condition: (([ParentImage] =~ ['.*.*w3wp.exe']) || ([ParentImage] =~ ['.*.*httpd.exe'])
    || ([ParentImage] =~ ['.*.*nginx.exe']) || ([ParentImage] =~ ['.*.*php.*cgi.exe'])
    || ([ParentImage] =~ ['.*.*tomcat.exe']) || ([ParentImage] =~ ['.*.*UMWorkerProcess.exe']))
    && (([Image] =~ ['.*.*cmd.exe']) || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~
    ['.*.*bash.exe']) || ([Image] =~ ['.*.*powershell.exe']) || ([Image] =~ ['.*.*bitsadmin.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003,privilege_escalation,t1190
  exttype: SIEM
- name: query_registry
  description: Adversaries may interact with the Windows Registry to gather information
    about the system, configuration, and installed software.
  condition: ([Image] =~ ['.*.*reg.exe']) && (([CommandLine] =~ ['.*query.*']) ||
    ([CommandLine] =~ ['.*save.*']) || ([CommandLine] =~ ['.*export.*'])) && (([CommandLine]
    =~ ['.*currentVersion.*windows.*']) || ([CommandLine] =~ ['.*currentVersion.*runServicesOnce.*'])
    || ([CommandLine] =~ ['.*currentVersion.*runServices.*']) || ([CommandLine] =~
    ['.*winlogon.*.*.*']) || ([CommandLine] =~ ['.*currentVersion.*shellServiceObjectDelayLoad.*'])
    || ([CommandLine] =~ ['.*currentVersion.*runOnce.*']) || ([CommandLine] =~ ['.*currentVersion.*runOnceEx.*'])
    || ([CommandLine] =~ ['.*currentVersion.*run.*']) || ([CommandLine] =~ ['.*currentVersion.*policies.*explorer.*run.*'])
    || ([CommandLine] =~ ['.*currentcontrolset.*services.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,discovery,t1012,t1007
  exttype: SIEM
- name: shadow_copies_deletion_using_operating_systems_utilities
  description: Shadow Copies deletion using operating systems utilities
  condition: ([CommandLine] =~ ['.*delete.*']) && (([Image] =~ ['.*.*powershell.exe'])
    || ([Image] =~ ['.*.*wmic.exe']) || ([Image] =~ ['.*.*vssadmin.exe']) || ([Image]
    =~ ['.*.*diskshadow.exe'])) && ([CommandLine] =~ ['.*shadow.*']) || (([Image]
    =~ ['.*.*wbadmin.exe'])) && ([CommandLine] =~ ['.*catalog.*']) && ([CommandLine]
    =~ ['.*quiet.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,impact,t1070,t1490
  exttype: SIEM
- name: suspicious_commandline_escape
  description: Detects suspicious process that use escape characters
  condition: (([CommandLine] =~ ['.*h.*t.*t.*p.*']) || ([CommandLine] =~ ['.*h.*t.*t.*p.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1140
  exttype: SIEM
- name: certutil_encode
  description: Detects suspicious a certutil command that used to encode files, which
    is sometimes used for data exfiltration
  condition: ([Image] =~ ['.*.*certutil.exe']) && ([CommandLine] =~ ['.*.*f.*']) &&
    ([CommandLine] =~ ['.*.*encode.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027
  exttype: SIEM
- name: suspicious_atbroker_execution
  description: Atbroker executing non-deafualt Assistive Technology applications
  condition: ([Image] =~ ['.*AtBroker.exe']) && ([CommandLine] =~ ['.*start.*']) &&
    (([CommandLine] !~ ['.*animations.*']) || ([CommandLine] !~ ['.*audiodescription.*'])
    || ([CommandLine] !~ ['.*caretbrowsing.*']) || ([CommandLine] !~ ['.*caretwidth.*'])
    || ([CommandLine] !~ ['.*colorfiltering.*']) || ([CommandLine] !~ ['.*cursorscheme.*'])
    || ([CommandLine] !~ ['.*filterkeys.*']) || ([CommandLine] !~ ['.*focusborderheight.*'])
    || ([CommandLine] !~ ['.*focusborderwidth.*']) || ([CommandLine] !~ ['.*highcontrast.*'])
    || ([CommandLine] !~ ['.*keyboardcues.*']) || ([CommandLine] !~ ['.*keyboardpref.*'])
    || ([CommandLine] !~ ['.*magnifierpane.*']) || ([CommandLine] !~ ['.*messageduration.*'])
    || ([CommandLine] !~ ['.*minimumhitradius.*']) || ([CommandLine] !~ ['.*mousekeys.*'])
    || ([CommandLine] !~ ['.*Narrator.*']) || ([CommandLine] !~ ['.*osk.*']) || ([CommandLine]
    !~ ['.*overlappedcontent.*']) || ([CommandLine] !~ ['.*showsounds.*']) || ([CommandLine]
    !~ ['.*soundsentry.*']) || ([CommandLine] !~ ['.*stickykeys.*']) || ([CommandLine]
    !~ ['.*togglekeys.*']) || ([CommandLine] !~ ['.*windowarranging.*']) || ([CommandLine]
    !~ ['.*windowtracking.*']) || ([CommandLine] !~ ['.*windowtrackingtimeout.*'])
    || ([CommandLine] !~ ['.*windowtrackingzorder.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: taskmgr_as_parent
  description: Detects the creation of a process from Windows task manager
  condition: ([ParentImage] =~ ['.*.*taskmgr.exe']) && (([Image] !~ ['.*.*resmon.exe'])
    || ([Image] !~ ['.*.*mmc.exe']) || ([Image] !~ ['.*.*taskmgr.exe']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036
  exttype: SIEM
- name: suspicious_rundll32_activity_invoking_sys_file
  description: Detects suspicious process related to rundll32 based on command line
    that includes a *.sys file as seen being used by UNC2452
  condition: ([CommandLine] =~ ['.*rundll32.exe.*']) && (([CommandLine] =~ ['.*.sys.*.*'])
    || ([CommandLine] =~ ['.*.sys.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,011
  exttype: SIEM
- name: indirect_command_execution
  description: Detect indirect command execution via Program Compatibility Assistant
    (pcalua.exe or forfiles.exe).
  condition: (([ParentImage] =~ ['.*.*pcalua.exe']) || ([ParentImage] =~ ['.*.*forfiles.exe']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1202
  exttype: SIEM
- name: suspicious_sysvol_domain_group_policy_access
  description: Detects Access to Domain Group Policies stored in SYSVOL
  condition: ([CommandLine] =~ ['.*.*SYSVOL.*.*.*']) && ([CommandLine] =~ ['.*.*policies.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1552,006,t1003
  exttype: SIEM
- name: terminal_service_process_spawn
  description: Detects a process spawned by the terminal service server process (this
    could be an indicator for an exploitation of CVE-2019-0708)
  condition: ([ParentCommandLine] =~ ['.*.*svchost.exe.*']) && ([ParentCommandLine]
    =~ ['.*termsvcs.*']) && ([Image] !~ ['.*.*rdpclip.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190,lateral_movement,t1210,car,2013-07-002
  exttype: SIEM
- name: wsf_jse_js_vba_vbe_file_execution
  description: Detects suspicious file execution by wscript and cscript
  condition: (([Image] =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe']))
    && (([CommandLine] =~ ['.*.jse.*']) || ([CommandLine] =~ ['.*.vbe.*']) || ([CommandLine]
    =~ ['.*.js.*']) || ([CommandLine] =~ ['.*.vba.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,t1064
  exttype: SIEM
- name: sourgum_actor_behaviours
  description: Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM
  condition: ([Image] =~ ['.*windows.*system32.*Physmem.sys.*']) || (([Image] =~ ['.*Windows.*system32.*ime.*SHARED.*WimBootConfigurations.ini.*'])
    || ([Image] =~ ['.*Windows.*system32.*ime.*IMEJP.*WimBootConfigurations.ini.*'])
    || ([Image] =~ ['.*Windows.*system32.*ime.*IMETC.*WimBootConfigurations.ini.*']))
    || (([Image] =~ ['.*windows.*system32.*filepath2.*']) || ([Image] =~ ['.*windows.*system32.*ime.*']))
    && (([CommandLine] =~ ['.*reg.*add.*'])) && (([CommandLine] =~ ['.*HKEY.*LOCAL.*MACHINE.*software.*classes.*clsid.*.*7c857801.*7381.*11cf.*884d.*00aa004b2e24.*.*inprocserver32.*'])
    || ([CommandLine] =~ ['.*HKEY.*LOCAL.*MACHINE.*software.*classes.*clsid.*.*cf4cc405.*e2c5.*4ddd.*b3ce.*5e7582d8c9fa.*.*inprocserver32.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1546,015,persistence,privilege_escalation
  exttype: SIEM
- name: openwith_exe_executes_specified_binary
  description: The OpenWith.exe executes other binary
  condition: ([Image] =~ ['.*.*OpenWith.exe']) && ([CommandLine] =~ ['.*.*c.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,execution
  exttype: SIEM
- name: psexec_service_start
  description: Detects a PsExec service start
  condition: ([CommandLine] == ['C:\Windows\PSEXESVC.exe'])
  level: low
  ruletype: EVALUATE
  tags: attack,execution,t1035,s0029,t1569,002
  exttype: SIEM
- name: suspicious_netsh_dll_persistence
  description: Detects persitence via netsh helper
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*add.*']) && ([CommandLine]
    =~ ['.*helper.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1546,007,s0108
  exttype: SIEM
- name: suspicious_userinit_child_process
  description: Detects a suspicious child process of userinit
  condition: ([ParentImage] =~ ['.*.*userinit.exe']) && ([CommandLine] !~ ['.*.*netlogon.*.*.*'])
    && ([Image] !~ ['.*.*explorer.exe'])
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: wscript_or_cscript_dropper
  description: Detects wscript/cscript executions of scripts located in user directories
  condition: (([Image] =~ ['.*.*wscript.exe']) || ([Image] =~ ['.*.*cscript.exe']))
    && (([CommandLine] =~ ['.*C.*.*Users.*.*.*']) || ([CommandLine] =~ ['.*C.*.*ProgramData.*.*.*']))
    && (([CommandLine] =~ ['.*.jse.*']) || ([CommandLine] =~ ['.*.vbe.*']) || ([CommandLine]
    =~ ['.*.js.*']) || ([CommandLine] =~ ['.*.vba.*']) || ([CommandLine] =~ ['.*.vbs.*']))
    && ([ParentImage] !~ ['.*.*winzip.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,defense_evasion,t1064
  exttype: SIEM
- name: finger_exe_suspicious_invocation
  description: Detects suspicious aged finger.exe tool execution often used in malware
    attacks nowadays
  condition: ([Image] =~ ['.*.*finger.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1105
  exttype: SIEM
- name: wannacry_ransomware
  description: Detects WannaCry ransomware activity
  condition: (([Image] =~ ['.*.*tasksche.exe']) || ([Image] =~ ['.*.*mssecsvc.exe'])
    || ([Image] =~ ['.*.*taskdl.exe']) || ([Image] =~ ['.*.*taskhsvc.exe']) || ([Image]
    =~ ['.*.*taskse.exe']) || ([Image] =~ ['.*.*111.exe']) || ([Image] =~ ['.*.*lhdfrgui.exe'])
    || ([Image] =~ ['.*.*diskpart.exe']) || ([Image] =~ ['.*.*linuxnew.exe']) || ([Image]
    =~ ['.*.*wannacry.exe'])) || ([Image] =~ ['.*WanaDecryptor.*']) || ([CommandLine]
    =~ ['.*icacls.*']) && ([CommandLine] =~ ['.*.*grant.*']) && ([CommandLine] =~
    ['.*Everyone.*F.*']) && ([CommandLine] =~ ['.*.*T.*']) && ([CommandLine] =~ ['.*.*C.*'])
    && ([CommandLine] =~ ['.*.*Q.*']) || ([CommandLine] =~ ['.*bcdedit.*']) && ([CommandLine]
    =~ ['.*.*set.*']) && ([CommandLine] =~ ['.*.*default.*.*']) && ([CommandLine]
    =~ ['.*recoveryenabled.*']) && ([CommandLine] =~ ['.*no.*']) || ([CommandLine]
    =~ ['.*wbadmin.*']) && ([CommandLine] =~ ['.*delete.*']) && ([CommandLine] =~
    ['.*catalog.*']) && ([CommandLine] =~ ['.*.*quiet.*']) || ([CommandLine] =~ ['.*.*Please.*Read.*Me.*.txt.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1210,discovery,t1083,defense_evasion,t1222,001,impact,t1486,t1490
  exttype: SIEM
- name: suspicious_wmi_execution
  description: Detects WMI executing suspicious commands
  condition: ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine] =~ ['.*process.*']) &&
    ([CommandLine] =~ ['.*call.*']) && ([CommandLine] =~ ['.*create.*.*']) || ([CommandLine]
    =~ ['.*.*path.*.*']) && (([CommandLine] =~ ['.*AntiVirus.*']) || ([CommandLine]
    =~ ['.*Firewall.*'])) && ([CommandLine] =~ ['.*Product.*']) && ([CommandLine]
    =~ ['.*.*get.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1047,car,2016-03-002
  exttype: SIEM
- name: netsh_port_or_application_allowed
  description: Allow Incoming Connections by Port or Application on Windows Firewall
  condition: ([Image] =~ ['.*.*netsh.exe']) && ([CommandLine] =~ ['.*firewall.*'])
    && ([CommandLine] =~ ['.*add.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1089,t1562,004
  exttype: SIEM
- name: change_default_file_association
  description: When a file is opened, the default program used to open the file (also
    called the file association or handler) is checked. File association selections
    are stored in the Windows Registry and can be edited by users, administrators,
    or programs that have Registry access or by administrators using the built-in
    assoc utility. Applications can modify the file association for a given file extension
    to call an arbitrary program when a file with the given extension is opened.
  condition: ([CommandLine] =~ ['.*cmd.*']) && ([CommandLine] =~ ['.*.*c.*']) && ([CommandLine]
    =~ ['.*assoc.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,persistence,t1546,001,t1042
  exttype: SIEM
- name: java_running_with_remote_debugging
  description: Detects a JAVA process running with remote debugging allowing more
    than just localhost to connect
  condition: ([CommandLine] =~ ['.*transport=dt.*socket.*address=.*']) && ([CommandLine]
    !~ ['.*address=127.0.0.1.*']) || ([CommandLine] !~ ['.*address=localhost.*'])
  level: medium
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: winword_exe_loads_suspicious_dll
  description: Detects Winword.exe loading of custmom dll via /l cmd switch
  condition: ([Image] =~ ['.*.*winword.exe']) && ([CommandLine] =~ ['.*.*l.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1202
  exttype: SIEM
- name: createminidump_hacktool
  description: Detects the use of CreateMiniDump hack tool used to dump the LSASS
    process memory for credential extraction on the attacker's machine
  condition: ([Image] =~ ['.*.*CreateMiniDump.exe.*']) || ([Imphash] == ['4a07f944a83e8a7c2525efa35dd30e2f'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: createminidump_hacktool
  description: Detects the use of CreateMiniDump hack tool used to dump the LSASS
    process memory for credential extraction on the attacker's machine
  condition: ([EventID] == 11) && ([TargetFilename] =~ ['.*.*lsass.dmp'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: suspicious_use_of_procdump
  description: Detects suspicious uses of the SysInternals Procdump utility by using
    a special command line parameter ' -ma ' and ' -accepteula' in a single step.
    This way we're also able to catch cases in which the attacker has renamed the
    procdump executable.
  condition: ([CommandLine] =~ ['.*.*.*ma.*.*']) && ([CommandLine] =~ ['.*.*.*accepteula.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,t1003,001
  exttype: SIEM
- name: monitoring_winget_for_lolbin_execution
  description: Adversaries can abuse winget to download payloads remotely and execute
    them without touching disk. Winget will be included by default in Windows 10 and
    is already available in Windows 10 insider programs. The manifest option enables
    you to install an application by passing in a YAML file directly to the client.
    Winget can be used to download and install exe's, msi, msix files later.
  condition: (([CommandLine] =~ ['.*..*.*.*i.*winget.*install.*.*.*.*m.*.*m.*..*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1059
  exttype: SIEM
- name: sysprep_on_appdata_folder
  description: Detects suspicious sysprep process start with AppData folder as target
    (as used by Trojan Syndicasec in Thrip report by Symantec)
  condition: (([Image] =~ ['.*.*sysprep.exe'])) && (([CommandLine] =~ ['.*.*AppData.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution
  exttype: SIEM
- name: suspicious_process_start_without_dll
  description: Detects suspicious start of program that usually requires a DLL as
    parameter, which can be a sign of process injection or hollowing activity
  condition: (([CommandLine] =~ ['.*.*rundll32.exe']) || ([CommandLine] =~ ['.*.*regsvcs.exe'])
    || ([CommandLine] =~ ['.*.*regasm.exe']) || ([CommandLine] =~ ['.*.*regsvr32.exe']))
    && (([ParentImage] !~ ['.*.*AppData.*Local.*.*.*']) || ([ParentImage] !~ ['.*.*Microsoft.*Edge.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: wmi_backdoor_exchange_transport_agent
  description: Detects a WMI backdoor in Exchange Transport Agents via WMI event filters
  condition: ([ParentImage] =~ ['.*.*EdgeTransport.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1546,003,t1084
  exttype: SIEM
- name: bypass_uac_via_wsreset_exe
  description: Identifies use of WSReset.exe to bypass User Account Control. Adversaries
    use this technique to execute privileged processes.
  condition: ([ParentImage] =~ ['.*.*wsreset.exe']) && ([Image] !~ ['.*.*conhost.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548,002,t1088
  exttype: SIEM
- name: disable_or_delete_windows_eventlog
  description: Detects command that is used to disable or delete Windows eventlog
    via logman Windows utility
  condition: (([CommandLine] =~ ['.*logman.*.*'])) && (([CommandLine] =~ ['.*stop.*.*'])
    || ([CommandLine] =~ ['.*delete.*.*'])) && (([CommandLine] =~ ['.*EventLog.*System.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001,t1070
  exttype: SIEM
- name: detection_of_powershell_execution_via_dll
  description: Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll
  condition: (([Image] =~ ['.*.*rundll32.exe'])) || (([Description] =~ ['.*Windows.*Hostprozess.*.*Rundll32.*.*']))
    && (([CommandLine] =~ ['.*Default.GetString.*']) || ([CommandLine] =~ ['.*FromBase64String.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1085,t1218,011
  exttype: SIEM
- name: possible_ransomware_or_unauthorized_mbr_modifications
  description: Detects, possibly, malicious unauthorized usage of bcdedit.exe
  condition: ([Image] =~ ['.*.*bcdedit.exe']) && (([CommandLine] =~ ['.*delete.*'])
    || ([CommandLine] =~ ['.*deletevalue.*']) || ([CommandLine] =~ ['.*import.*'])
    || ([CommandLine] =~ ['.*safeboot.*']) || ([CommandLine] =~ ['.*network.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,persistence,t1542,003,t1067
  exttype: SIEM
- name: net_exe_execution
  description: Detects execution of Net.exe, whether suspicious or benign.
  condition: (([Image] =~ ['.*.*net.exe']) || ([Image] =~ ['.*.*net1.exe'])) && (([CommandLine]
    =~ ['.*.*group.*']) || ([CommandLine] =~ ['.*.*localgroup.*']) || ([CommandLine]
    =~ ['.*.*user.*']) || ([CommandLine] =~ ['.*.*view.*']) || ([CommandLine] =~ ['.*.*share.*'])
    || ([CommandLine] =~ ['.*.*accounts.*']) || ([CommandLine] =~ ['.*.*stop.*.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,discovery,t1049,t1018,t1135,t1201,t1069,001,002,t1087,lateral_movement,t1021,t1077,s0039
  exttype: SIEM
- name: windows_10_scheduled_task_sandboxescaper_0_day
  description: Detects Task Scheduler .job import arbitrary DACL write\par
  condition: ([Image] =~ ['.*.*schtasks.exe']) && ([CommandLine] =~ ['.*.*change.*'])
    && ([CommandLine] =~ ['.*.*TN.*']) && ([CommandLine] =~ ['.*.*RU.*']) && ([CommandLine]
    =~ ['.*.*RP.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1053,005,car,2013-08-001
  exttype: SIEM
- name: uninstall_crowdstrike_falcon
  description: Adversaries may disable security tools to avoid possible detection
    of their tools and activities by uninstalling Crowdstrike Falcon
  condition: ([CommandLine] =~ ['.*.*WindowsSensor.exe.*']) && ([CommandLine] =~ ['.*.*.*uninstall.*'])
    && ([CommandLine] =~ ['.*.*.*quiet.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: whoami_execution
  description: Detects the execution of whoami, which is often used by attackers after
    exloitation / privilege escalation but rarely used by administrators
  condition: ([Image] =~ ['.*.*whoami.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1033,car,2016-03-001
  exttype: SIEM
- name: regedit_as_trusted_installer
  description: Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe
  condition: ([Image] =~ ['.*.*regedit.exe']) && (([ParentImage] =~ ['.*.*TrustedInstaller.exe'])
    || ([ParentImage] =~ ['.*.*ProcessHacker.exe']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: squiblytwo
  description: Detects WMI SquiblyTwo Attack with possible renamed WMI by looking
    for imphash
  condition: ([CommandLine] =~ ['.*http.*']) && (([Image] =~ ['.*.*wmic.exe'])) &&
    ([CommandLine] =~ ['.*wmic.*']) && ([CommandLine] =~ ['.*format.*']) || (([Imphash]
    =~ ['1B1A3F43BF37B5BFE60751F2EE2F326E']) || ([Imphash] =~ ['37777A96245A3C74EB217308F3546F4C'])
    || ([Imphash] =~ ['9D87C9D67CE724033C0B40CC4CA1B206'])) && ([CommandLine] =~ ['.*format.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1047,t1220,execution,t1059,005,007
  exttype: SIEM
- name: qbot_process_creation
  description: Detects QBot like process executions
  condition: ([ParentImage] =~ ['.*.*WinRAR.exe']) && ([Image] =~ ['.*.*wscript.exe'])
    || ([CommandLine] =~ ['.*.*.*c.*ping.exe.*.*n.*6.*127.0.0.1.*.*.*type.*.*']) ||
    ([CommandLine] =~ ['.*regsvr32.exe.*']) && ([CommandLine] =~ ['.*C.*.*ProgramData.*'])
    && ([CommandLine] =~ ['.*.tmp.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,defense_evasion,t1064
  exttype: SIEM
- name: run_once_task_execution_as_configured_in_registry
  description: This rule detects the execution of Run Once task as configured in the
    registry
  condition: (([Image] =~ ['.*.*runonce.exe'])) || (([Description] =~ ['Run.*Once.*Wrapper']))
    && (([CommandLine] =~ ['.*.*.*AlternateShellStartup.*']))
  level: low
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: verclsid_exe_runs_com_object
  description: Detects when verclsid.exe is used to run COM object via GUID
  condition: ([Image] =~ ['.*.*verclsid.exe']) && ([CommandLine] =~ ['.*.*C.*']) &&
    ([CommandLine] =~ ['.*.*S.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: msexchange_transport_agent_installation
  description: Detects the Installation of a Exchange Transport Agent
  condition: ([CommandLine] =~ ['.*Install.*TransportAgent.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,t1505,002
  exttype: SIEM
- name: dns_tunnel_technique_from_muddywater
  description: Detecting DNS tunnel activity for Muddywater actor
  condition: (([Image] =~ ['.*.*powershell.exe'])) && (([ParentImage] =~ ['.*.*excel.exe']))
    && (([CommandLine] =~ ['.*DataExchange.dll.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,command_and_control,t1071,004
  exttype: SIEM
- name: raccine_uninstall
  description: Detects commands that indicate a Raccine removal from an end system.
    Raccine is a free ransomware protection tool.
  condition: ([CommandLine] =~ ['.*taskkill.*.*']) && ([CommandLine] =~ ['.*RaccineSettings.exe.*'])
    || ([CommandLine] =~ ['.*reg.exe.*']) && ([CommandLine] =~ ['.*delete.*']) &&
    ([CommandLine] =~ ['.*Raccine.*Tray.*']) || ([CommandLine] =~ ['.*schtasks.*'])
    && ([CommandLine] =~ ['.*.*DELETE.*']) && ([CommandLine] =~ ['.*Raccine.*Rules.*Updater.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: suspicious_csi_exe_usage
  description: Csi.exe is a signed binary from Microsoft that comes with Visual Studio
    and provides C# interactive capabilities. It can be used to run C# code from a
    file passed as a parameter in command line. Early version of this utility provided
    with Microsoft â€œRoslynâ€ Community Technology Preview was named 'rcsi.exe'
  condition: ([Image] =~ ['.*.*csi.exe']) || ([Image] =~ ['.*.*rcsi.exe']) || ([OriginalFileName]
    == ['csi.exe']) || ([OriginalFileName] == ['rcsi.exe']) && ([Company] == ['Microsoft
    Corporation'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1072,defense_evasion,t1218
  exttype: SIEM
- name: cmd_exe_commandline_path_traversal
  description: detects the usage of path traversal in cmd.exe indicating possible
    command/argument confusion/hijacking
  condition: ([ParentCommandLine] =~ ['.*cmd.*']) && ([ParentCommandLine] =~ ['.*.*c.*'])
    && ([CommandLine] =~ ['.*.*...*...*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,003
  exttype: SIEM
- name: windows_shell_spawning_suspicious_program
  description: Detects a suspicious child process of a Windows shell
  condition: (([ParentImage] =~ ['.*.*mshta.exe']) || ([ParentImage] =~ ['.*.*powershell.exe'])
    || ([ParentImage] =~ ['.*.*rundll32.exe']) || ([ParentImage] =~ ['.*.*cscript.exe'])
    || ([ParentImage] =~ ['.*.*wscript.exe']) || ([ParentImage] =~ ['.*.*wmiprvse.exe']))
    && (([Image] =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*nslookup.exe']) ||
    ([Image] =~ ['.*.*certutil.exe']) || ([Image] =~ ['.*.*bitsadmin.exe']) || ([Image]
    =~ ['.*.*mshta.exe'])) && ([CurrentDirectory] !~ ['.*.*ccmcache.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,defense_evasion,t1064,t1059,005,001,t1218
  exttype: SIEM
- name: renamed_paexec
  description: Detects suspicious renamed PAExec execution as often used by attackers
  condition: ([Description] == ['PAExec Application']) || ([OriginalFileName] == ['PAExec.exe'])
    && (([Image] !~ ['.*.*PAexec.exe']) || ([Image] !~ ['.*.*paexec.exe']))
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: apt29
  description: This method detects a suspicious PowerShell command line combination
    as used by APT29 in a campaign against U.S. think tanks.
  condition: ([CommandLine] =~ ['.*.*noni.*']) && ([CommandLine] =~ ['.*.*ep.*'])
    && ([CommandLine] =~ ['.*bypass.*']) && ([CommandLine] =~ ['.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,g0016,t1086,t1059,001
  exttype: SIEM
- name: judgement_panda_credential_access_activity
  description: Detects Russian group activity as described in Global Threat Report
    2019 by Crowdstrike
  condition: ([Image] =~ ['.*.*xcopy.exe']) && ([CommandLine] =~ ['.*.*S.*']) && ([CommandLine]
    =~ ['.*.*E.*']) && ([CommandLine] =~ ['.*.*C.*']) && ([CommandLine] =~ ['.*.*Q.*'])
    && ([CommandLine] =~ ['.*.*H.*']) && ([CommandLine] =~ ['.*.*.*.*.*']) || ([Image]
    =~ ['.*.*adexplorer.exe']) && ([CommandLine] =~ ['.*.*snapshot.*']) && ([CommandLine]
    =~ ['.*.*.*.*']) && ([CommandLine] =~ ['.*c.*.*users.*.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1081,t1003,t1552,001,003
  exttype: SIEM
- name: revil_kaseya_incident_malware_patterns
  description: Detects process command line patterns and locations used by REvil group
    in Kaseya incident (can also match on other malware)
  condition: (([CommandLine] =~ ['.*C.*.*Windows.*cert.exe.*']) || ([CommandLine]
    =~ ['.*Set.*MpPreference.*.*DisableRealtimeMonitoring.*.*true.*.*DisableIntrusionPreventionSystem.*.*true.*.*DisableIOAVProtection.*.*true.*.*DisableScriptScanning.*.*true.*.*EnableControlledFolderAccess.*Disabled.*.*EnableNetworkProtection.*AuditMode.*.*Force.*.*MAPSReporting.*Disabled.*'])
    || ([CommandLine] =~ ['.*del.*.*q.*.*f.*c.*.*kworking.*agent.crt.*']) || ([CommandLine]
    =~ ['.*Kaseya.*VSA.*Agent.*Hot.*fix.*']) || ([CommandLine] =~ ['.*.*AppData.*Local.*Temp.*MsMpEng.exe.*'])
    || ([CommandLine] =~ ['.*rmdir.*.*s.*.*q.*.*SystemDrive.*.*inetpub.*logs.*'])
    || ([CommandLine] =~ ['.*del.*.*s.*.*q.*.*f.*.*SystemDrive.*.*.*.*.log.*']) ||
    ([CommandLine] =~ ['.*c.*.*kworking1.*agent.exe.*']) || ([CommandLine] =~ ['.*c.*.*kworking1.*agent.crt.*']))
    && (([Image] =~ ['C.*.*Windows.*MsMpEng.exe']) || ([Image] =~ ['C.*.*Windows.*cert.exe'])
    || ([Image] =~ ['C.*.*kworking.*agent.exe']) || ([Image] =~ ['C.*.*kworking1.*agent.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,g0115
  exttype: SIEM
- name: suspicious_bitsadmin_job_via_powershell
  description: Detect download by BITS jobs via PowerShell
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*Start.*BitsTransfer.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,persistence,t1197
  exttype: SIEM
- name: suspicious_eventlog_clear_or_configuration_using_wevtutil
  description: Detects clearing or configuration of eventlogs using wevtutil, powershell
    and wmic. Might be used by ransomwares during the attack (seen by NotPetya and
    others).
  condition: ([Image] =~ ['.*.*powershell.exe']) && (([CommandLine] =~ ['.*Clear.*EventLog.*'])
    || ([CommandLine] =~ ['.*Remove.*EventLog.*']) || ([CommandLine] =~ ['.*Limit.*EventLog.*']))
    || ([Image] =~ ['.*.*wmic.exe']) && ([CommandLine] =~ ['.*.*ClearEventLog.*.*'])
    || ([Image] =~ ['.*.*wevtutil.exe']) && (([CommandLine] =~ ['.*clear.*log.*'])
    || ([CommandLine] =~ ['.*.*cl.*.*']) || ([CommandLine] =~ ['.*set.*log.*']) ||
    ([CommandLine] =~ ['.*.*sl.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1070,001,car,2016-04-002
  exttype: SIEM
- name: mouse_lock_credential_gathering
  description: In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate
    tool "Mouse Lock" as being used for both credential access and collection in security
    incidents.
  condition: ([Product] =~ ['.*Mouse.*Lock.*']) || ([Company] =~ ['.*Misc314.*'])
    || ([CommandLine] =~ ['.*Mouse.*Lock.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,collection,t1056,002
  exttype: SIEM
- name: suspicious_powershell_parameter_substring
  description: Detects suspicious PowerShell invocation with a parameter substring
  condition: (([Image] =~ ['.*.*Powershell.exe'])) && (([CommandLine] =~ ['.*.*.*windowstyle.*h.*.*'])
    || ([CommandLine] =~ ['.*.*.*windowstyl.*h.*']) || ([CommandLine] =~ ['.*.*.*windowsty.*h.*'])
    || ([CommandLine] =~ ['.*.*.*windowst.*h.*']) || ([CommandLine] =~ ['.*.*.*windows.*h.*'])
    || ([CommandLine] =~ ['.*.*.*windo.*h.*']) || ([CommandLine] =~ ['.*.*.*wind.*h.*'])
    || ([CommandLine] =~ ['.*.*.*win.*h.*']) || ([CommandLine] =~ ['.*.*.*wi.*h.*'])
    || ([CommandLine] =~ ['.*.*.*win.*h.*.*']) || ([CommandLine] =~ ['.*.*.*win.*hi.*.*'])
    || ([CommandLine] =~ ['.*.*.*win.*hid.*.*']) || ([CommandLine] =~ ['.*.*.*win.*hidd.*.*'])
    || ([CommandLine] =~ ['.*.*.*win.*hidde.*.*']) || ([CommandLine] =~ ['.*.*.*NoPr.*.*'])
    || ([CommandLine] =~ ['.*.*.*NoPro.*.*']) || ([CommandLine] =~ ['.*.*.*NoProf.*.*'])
    || ([CommandLine] =~ ['.*.*.*NoProfi.*.*']) || ([CommandLine] =~ ['.*.*.*NoProfil.*.*'])
    || ([CommandLine] =~ ['.*.*.*nonin.*.*']) || ([CommandLine] =~ ['.*.*.*nonint.*.*'])
    || ([CommandLine] =~ ['.*.*.*noninte.*.*']) || ([CommandLine] =~ ['.*.*.*noninter.*.*'])
    || ([CommandLine] =~ ['.*.*.*nonintera.*.*']) || ([CommandLine] =~ ['.*.*.*noninterac.*.*'])
    || ([CommandLine] =~ ['.*.*.*noninteract.*.*']) || ([CommandLine] =~ ['.*.*.*noninteracti.*.*'])
    || ([CommandLine] =~ ['.*.*.*noninteractiv.*.*']) || ([CommandLine] =~ ['.*.*.*ec.*.*'])
    || ([CommandLine] =~ ['.*.*.*encodedComman.*.*']) || ([CommandLine] =~ ['.*.*.*encodedComma.*.*'])
    || ([CommandLine] =~ ['.*.*.*encodedComm.*.*']) || ([CommandLine] =~ ['.*.*.*encodedCom.*.*'])
    || ([CommandLine] =~ ['.*.*.*encodedCo.*.*']) || ([CommandLine] =~ ['.*.*.*encodedC.*.*'])
    || ([CommandLine] =~ ['.*.*.*encoded.*.*']) || ([CommandLine] =~ ['.*.*.*encode.*.*'])
    || ([CommandLine] =~ ['.*.*.*encod.*.*']) || ([CommandLine] =~ ['.*.*.*enco.*.*'])
    || ([CommandLine] =~ ['.*.*.*en.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: exploiting_setupcomplete_cmd_cve_2019_1378
  description: Detects exploitation attempt of privilege escalation vulnerability
    via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
  condition: ([ParentCommandLine] =~ ['.*.*cmd.exe.*']) && ([ParentCommandLine] =~
    ['.*.*c.*']) && ([ParentCommandLine] =~ ['.*C.*.*Windows.*Setup.*Scripts.*.*.*'])
    && (([ParentCommandLine] =~ ['.*SetupComplete.cmd']) || ([ParentCommandLine] =~
    ['.*PartnerSetupComplete.cmd'])) && (([Image] !~ ['C.*.*Windows.*System32.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*SysWOW64.*.*.*']) || ([Image] !~ ['C.*.*Windows.*WinSxS.*.*.*'])
    || ([Image] !~ ['C.*.*Windows.*Setup.*.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1068,execution,t1059,003,t1574
  exttype: SIEM
- name: suspicious_powershell_parent_process
  description: Detects a suspicious parents of powershell.exe
  condition: (([ParentImage] =~ ['.*.*mshta.exe']) || ([ParentImage] =~ ['.*.*rundll32.exe'])
    || ([ParentImage] =~ ['.*.*regsvr32.exe']) || ([ParentImage] =~ ['.*.*services.exe'])
    || ([ParentImage] =~ ['.*.*winword.exe']) || ([ParentImage] =~ ['.*.*wmiprvse.exe'])
    || ([ParentImage] =~ ['.*.*powerpnt.exe']) || ([ParentImage] =~ ['.*.*excel.exe'])
    || ([ParentImage] =~ ['.*.*msaccess.exe']) || ([ParentImage] =~ ['.*.*mspub.exe'])
    || ([ParentImage] =~ ['.*.*visio.exe']) || ([ParentImage] =~ ['.*.*outlook.exe'])
    || ([ParentImage] =~ ['.*.*amigo.exe']) || ([ParentImage] =~ ['.*.*chrome.exe'])
    || ([ParentImage] =~ ['.*.*firefox.exe']) || ([ParentImage] =~ ['.*.*iexplore.exe'])
    || ([ParentImage] =~ ['.*.*microsoftedgecp.exe']) || ([ParentImage] =~ ['.*.*microsoftedge.exe'])
    || ([ParentImage] =~ ['.*.*browser.exe']) || ([ParentImage] =~ ['.*.*vivaldi.exe'])
    || ([ParentImage] =~ ['.*.*safari.exe']) || ([ParentImage] =~ ['.*.*sqlagent.exe'])
    || ([ParentImage] =~ ['.*.*sqlserver.exe']) || ([ParentImage] =~ ['.*.*sqlservr.exe'])
    || ([ParentImage] =~ ['.*.*w3wp.exe']) || ([ParentImage] =~ ['.*.*httpd.exe'])
    || ([ParentImage] =~ ['.*.*nginx.exe']) || ([ParentImage] =~ ['.*.*php.*cgi.exe'])
    || ([ParentImage] =~ ['.*.*jbosssvc.exe']) || ([ParentImage] =~ ['.*MicrosoftEdgeSH.exe']))
    || ([ParentImage] =~ ['.*tomcat.*']) && (([CommandLine] =~ ['.*powershell.*'])
    || ([CommandLine] =~ ['.*pwsh.*'])) || ([Description] == ['Windows PowerShell'])
    || ([Product] == ['PowerShell Core 6'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: sql_client_tools_powershell_session_detection
  description: This rule detects execution of a PowerShell code through the sqltoolsps.exe
    utility, which is included in the standard set of utilities supplied with the
    Microsoft SQL Server Management studio. Script blocks are not logged in this case,
    so this utility helps to bypass protection mechanisms based on the analysis of
    these logs.
  condition: ([Image] =~ ['.*.*sqltoolsps.exe']) || ([ParentImage] =~ ['.*.*sqltoolsps.exe'])
    || ([OriginalFileName] == ['\sqltoolsps.exe']) && ([ParentImage] !~ ['.*.*smss.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,defense_evasion,t1127
  exttype: SIEM
- name: mustang_panda_dropper
  description: Detects specific process parameters as used by Mustang Panda droppers
  condition: (([CommandLine] =~ ['.*Temp.*wtask.exe.*.*create.*']) || ([CommandLine]
    =~ ['.*.*windir.*.*.*3.*1.*.*PUBLIC.*.*.*9.*1.*.*']) || ([CommandLine] =~ ['.*.*tn.*.*Security.*Script.*.*'])
    || ([CommandLine] =~ ['.*.*windir.*.*.*1.*1.*.*'])) || ([CommandLine] =~ ['.*.*E.*vbscript.*'])
    && ([CommandLine] =~ ['.*C.*.*Users.*.*.*']) && ([CommandLine] =~ ['.*.txt.*'])
    && ([CommandLine] =~ ['.*.*F.*']) || ([Image] =~ ['.*Temp.*winwsh.exe'])
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: automated_collection_command_prompt
  description: Once established within a system or network, an adversary may use automated
    techniques for collecting internal data.
  condition: (([CommandLine] =~ ['.*.doc.*']) || ([CommandLine] =~ ['.*.docx.*'])
    || ([CommandLine] =~ ['.*.xls.*']) || ([CommandLine] =~ ['.*.xlsx.*']) || ([CommandLine]
    =~ ['.*.ppt.*']) || ([CommandLine] =~ ['.*.pptx.*']) || ([CommandLine] =~ ['.*.rtf.*'])
    || ([CommandLine] =~ ['.*.pdf.*']) || ([CommandLine] =~ ['.*.txt.*'])) && ([CommandLine]
    =~ ['.*dir.*.*']) && ([CommandLine] =~ ['.*.*.*b.*.*']) && ([CommandLine] =~ ['.*.*.*s.*.*'])
    || ([OriginalFileName] == ['FINDSTR.EXE']) && ([CommandLine] =~ ['.*.*.*e.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,collection,t1119
  exttype: SIEM
- name: cve_2021_26857_exchange_exploitation
  description: Detects possible successful exploitation for vulnerability described
    in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange
    Serverâ€™s Unified Messaging service
  condition: ([ParentImage] =~ ['.*UMWorkerProcess.exe']) && (([Image] !~ ['.*wermgr.exe'])
    || ([Image] !~ ['.*WerFault.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,t1203,execution
  exttype: SIEM
- name: exports_critical_registry_keys_to_a_file
  description: Detects the export of a crital Registry key to a file.
  condition: ([Image] =~ ['.*.*regedit.exe']) && ([CommandLine] =~ ['.*.*.*E.*.*'])
    && (([CommandLine] =~ ['.*hklm.*']) || ([CommandLine] =~ ['.*hkey.*local.*machine.*']))
    && (([CommandLine] =~ ['.*.*system']) || ([CommandLine] =~ ['.*.*sam']) || ([CommandLine]
    =~ ['.*.*security']))
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1012
  exttype: SIEM
- name: suspicious_hwp_sub_processes
  description: Detects suspicious Hangul Word Processor (Hanword) sub processes that
    could indicate an exploitation
  condition: ([ParentImage] =~ ['.*.*Hwp.exe']) && ([Image] =~ ['.*.*gbb.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1566,001,t1193,execution,t1203,t1059,003,g0032
  exttype: SIEM
- name: suspicious_powershell_invocation_based_on_parent_process
  description: Detects suspicious powershell invocations from interpreters or unusual
    programs
  condition: (([ParentImage] =~ ['.*.*wscript.exe']) || ([ParentImage] =~ ['.*.*cscript.exe']))
    && ([Image] =~ ['.*.*powershell.exe']) && ([CurrentDirectory] !~ ['.*.*Health.*Service.*State.*.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1059,001,t1086
  exttype: SIEM
- name: powershell_base64_encoded_shellcode
  description: Detects Base64 encoded Shellcode
  condition: ([CommandLine] =~ ['.*AAAAYInlM.*']) && (([CommandLine] =~ ['.*OiCAAAAYInlM.*'])
    || ([CommandLine] =~ ['.*OiJAAAAYInlM.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027
  exttype: SIEM
- name: possible_spn_enumeration
  description: Detects Service Principal Name Enumeration used for Kerberoasting
  condition: ([Image] =~ ['.*.*setspn.exe']) || ([Description] =~ ['.*Query.*or.*reset.*the.*computer.*'])
    && ([Description] =~ ['.*SPN.*attribute.*']) && ([CommandLine] =~ ['.*.*q.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1558,003,t1208
  exttype: SIEM
- name: suspicious_process_start_locations
  description: Detects suspicious process run from unusual locations
  condition: (([Image] =~ ['.*.*.*RECYCLER.*.*.*']) || ([Image] =~ ['.*.*.*SystemVolumeInformation.*.*.*']))
    || (([Image] =~ ['C.*.*Windows.*Tasks.*.*.*']) || ([Image] =~ ['C.*.*Windows.*debug.*.*.*'])
    || ([Image] =~ ['C.*.*Windows.*fonts.*.*.*']) || ([Image] =~ ['C.*.*Windows.*help.*.*.*'])
    || ([Image] =~ ['C.*.*Windows.*drivers.*.*.*']) || ([Image] =~ ['C.*.*Windows.*addins.*.*.*'])
    || ([Image] =~ ['C.*.*Windows.*cursors.*.*.*']) || ([Image] =~ ['C.*.*Windows.*system32.*tasks.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1036,car,2013-05-002
  exttype: SIEM
- name: complus_etwenabled_command_line_arguments
  description: Potential adversaries stopping ETW providers recording loaded .NET
    assemblies.
  condition: ([CommandLine] =~ ['.*COMPlus.*ETWEnabled=0.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562
  exttype: SIEM
- name: suspicious_use_of_csharp_interactive_console
  description: Detects the execution of CSharp interactive console by PowerShell
  condition: ([Image] =~ ['.*.*csi.exe']) && ([ParentImage] =~ ['.*.*powershell.exe'])
    && ([OriginalFileName] == ['csi.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1127
  exttype: SIEM
- name: ncat_execution
  description: Adversaries may use a non-application layer protocol for communication
    between host and C2 server or among infected hosts within a network
  condition: (([Image] =~ ['.*.*ncat.exe'])) || (([CommandLine] =~ ['.*.*.*lvp.*.*'])
    || ([CommandLine] =~ ['.*.*.*l.*.*.*proxy.*type.*http.*.*']) || ([CommandLine]
    =~ ['.*.*.*.*exec.*cmd.exe.*.*']) || ([CommandLine] =~ ['.*.*.*vnl.*.*.*exec.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1095
  exttype: SIEM
- name: exploit_for_cve_2017_8759
  description: Detects Winword starting uncommon sub process csc.exe as used in exploits
    for CVE-2017-8759
  condition: ([ParentImage] =~ ['.*.*WINWORD.EXE']) && ([Image] =~ ['.*.*csc.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1203,t1204,002,initial_access,t1566,001,t1193
  exttype: SIEM
- name: powershell_downgrade_attack
  description: Detects PowerShell downgrade attack by comparing the host versions
    with the actually used engine version 2.0
  condition: (([CommandLine] =~ ['.*.*.*version.*2.*.*']) || ([CommandLine] =~ ['.*.*.*versio.*2.*.*'])
    || ([CommandLine] =~ ['.*.*.*versi.*2.*.*']) || ([CommandLine] =~ ['.*.*.*vers.*2.*.*'])
    || ([CommandLine] =~ ['.*.*.*ver.*2.*.*']) || ([CommandLine] =~ ['.*.*.*ve.*2.*.*']))
    && ([Image] =~ ['.*.*powershell.exe'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,execution,t1086,t1059,001
  exttype: SIEM
- name: suspicious_screensave_change_by_reg_exe
  description: |
    Adversaries may establish persistence by executing malicious content triggered by user inactivity.
    Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension
  condition: ([Image] =~ ['.*reg.exe']) && (([CommandLine] =~ ['.*HKEY.*CURRENT.*USER.*Control.*Panel.*Desktop.*'])
    || ([CommandLine] =~ ['.*HKCU.*Control.*Panel.*Desktop.*'])) && ([CommandLine]
    =~ ['.*.*t.*REG.*SZ.*']) && ([CommandLine] =~ ['.*.*f.*']) && ([CommandLine] =~
    ['.*.*v.*ScreenSaveActive.*']) && ([CommandLine] =~ ['.*.*d.*1.*']) || ([CommandLine]
    =~ ['.*.*v.*ScreenSaveTimeout.*']) && ([CommandLine] =~ ['.*.*d.*.*']) || ([CommandLine]
    =~ ['.*.*v.*ScreenSaverIsSecure.*']) && ([CommandLine] =~ ['.*.*d.*0.*']) || ([CommandLine]
    =~ ['.*.*v.*SCRNSAVE.EXE.*']) && ([CommandLine] =~ ['.*.*d.*.*']) && ([CommandLine]
    =~ ['.*.scr.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1546,002
  exttype: SIEM
- name: winnti_malware_hk_university_campaign
  description: Detects specific process characteristics of Winnti malware noticed
    in Dec/Jan 2020 in a campaign against Honk Kong universities
  condition: (([ParentImage] =~ ['.*C.*.*Windows.*Temp.*']) || ([ParentImage] =~ ['.*.*hpqhvind.exe.*']))
    && ([Image] =~ ['C.*.*ProgramData.*DRM.*']) || ([ParentImage] =~ ['C.*.*ProgramData.*DRM.*'])
    && ([Image] =~ ['.*.*wmplayer.exe']) || ([ParentImage] =~ ['.*.*Test.exe']) &&
    ([Image] =~ ['.*.*wmplayer.exe']) || ([Image] == ['C:\ProgramData\DRM\CLR\CLR.exe'])
    || ([ParentImage] =~ ['C.*.*ProgramData.*DRM.*Windows.*']) && ([Image] =~ ['.*.*SearchFilterHost.exe'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1574,002,t1073,g0044
  exttype: SIEM
- name: dotnet_exe_exec_dll_and_execute_unsigned_code_lolbin
  description: dotnet.exe will execute any DLL and execute unsigned code
  condition: (([CommandLine] =~ ['.*.dll']) || ([CommandLine] =~ ['.*.csproj'])) &&
    (([Image] =~ ['.*.*dotnet.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1218
  exttype: SIEM
- name: bluemashroom_dll_load
  description: Detects a suspicious DLL loading from AppData Local path as described
    in BlueMashroom report
  condition: ([CommandLine] =~ ['.*.*AppData.*Local.*.*.*']) && ([CommandLine] =~
    ['.*.*regsvr32.*']) || ([CommandLine] =~ ['.*.*DllEntry.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1117,t1218,010
  exttype: SIEM
- name: suspicious_certutil_command
  description: Detects a suspicious Microsoft certutil execution with sub commands
    like 'decode' sub command, which is sometimes used to decode malicious code with
    the built-in certutil utility
  condition: (([CommandLine] =~ ['.*.*.*decode.*.*']) || ([CommandLine] =~ ['.*.*.*decodehex.*.*'])
    || ([CommandLine] =~ ['.*.*.*urlcache.*.*']) || ([CommandLine] =~ ['.*.*.*verifyctl.*.*'])
    || ([CommandLine] =~ ['.*.*.*encode.*.*']) || ([CommandLine] =~ ['.*.*.*decode.*.*'])
    || ([CommandLine] =~ ['.*.*.*decodehex.*.*']) || ([CommandLine] =~ ['.*.*.*urlcache.*.*'])
    || ([CommandLine] =~ ['.*.*.*verifyctl.*.*']) || ([CommandLine] =~ ['.*.*.*encode.*.*']))
    || ([Image] =~ ['.*.*certutil.exe']) && (([CommandLine] =~ ['.*URL.*']) || ([CommandLine]
    =~ ['.*ping.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1140,command_and_control,t1105,s0160,g0007,g0010,g0045,g0049,g0075,g0096
  exttype: SIEM
- name: data_compressed___rar_exe
  description: An adversary may compress data (e.g., sensitive documents) that is
    collected prior to exfiltration in order to make it portable and minimize the
    amount of data sent over the network.
  condition: ([Image] =~ ['.*.*rar.exe']) && ([CommandLine] =~ ['.*.*a.*.*'])
  level: low
  ruletype: EVALUATE
  tags: attack,exfiltration,t1002,collection,t1560,001
  exttype: SIEM
- name: syncappvpublishingserver_vbs_execute_arbitrary_powershell_code
  description: Adversaries may use scripts signed with trusted certificates to proxy
    execution of malicious files.
  condition: ([CommandLine] =~ ['.*.*SyncAppvPublishingServer.vbs.*']) && ([CommandLine]
    =~ ['.*.*n.*.*']) && ([CommandLine] =~ ['.*Start.*Process.*.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1216
  exttype: SIEM
- name: suspicious_vboxdrvinst_exe_parameters
  description: Detect VBoxDrvInst.exe run with parameters allowing processing INF
    file. This allows to create values in the registry and install drivers. For example
    one could use this technique to obtain persistence via modifying one of Run or
    RunOnce registry keys
  condition: ([Image] =~ ['.*.*VBoxDrvInst.exe']) && ([CommandLine] =~ ['.*driver.*'])
    && ([CommandLine] =~ ['.*executeinf.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1112
  exttype: SIEM
- name: suspicious_parent_of_csc_exe
  description: Detects a suspicious parent of csc.exe, which could by a sign of payload
    delivery
  condition: ([Image] =~ ['.*.*csc.exe']) && (([ParentImage] =~ ['.*.*wscript.exe'])
    || ([ParentImage] =~ ['.*.*cscript.exe']) || ([ParentImage] =~ ['.*.*mshta.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,005,007,defense_evasion,t1500,t1218,t1027,004
  exttype: SIEM
- name: frombase64string_command_line
  description: Detects suspicious FromBase64String expressions in command line arguments
  condition: ([CommandLine] =~ ['.*.*.*FromBase64String.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,t1027,defense_evasion,t1140,t1059,001
  exttype: SIEM
- name: mavinject_inject_dll_into_running_process
  description: Injects arbitrary DLL into running process specified by process ID.
    Requires Windows 10.
  condition: ([CommandLine] =~ ['.*.*.*INJECTRUNNING.*']) && ([CommandLine] =~ ['.*.dll.*'])
    && ([OriginalFileName] =~ ['.*mavinject.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,collection,t1218,t1056,004
  exttype: SIEM
- name: defrag_deactivation
  description: Detects the deactivation and disabling of the Scheduled defragmentation
    task as seen by Slingshot APT group
  condition: ([Image] =~ ['.*.*schtasks.exe']) && (([CommandLine] =~ ['.*.*delete.*'])
    || ([CommandLine] =~ ['.*.*change.*'])) && ([CommandLine] =~ ['.*.*TN.*']) &&
    ([CommandLine] =~ ['.*.*Microsoft.*Windows.*Defrag.*ScheduledDefrag.*'])
  level: medium
  ruletype: EVALUATE
  tags: attack,persistence,s0111
  exttype: SIEM
- name: tropictrooper_campaign_november_2018
  description: Detects TropicTrooper activity, an actor who targeted high-profile
    organizations in the energy and food and beverage sectors in Asia
  condition: ([CommandLine] =~ ['.*abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: mimikatz_command_line
  description: Detection well-known mimikatz command line arguments
  condition: (([CommandLine] =~ ['.*DumpCreds.*']) || ([CommandLine] =~ ['.*invoke.*mimikatz.*']))
    || (([CommandLine] =~ ['.*rpc.*']) || ([CommandLine] =~ ['.*token.*']) || ([CommandLine]
    =~ ['.*crypto.*']) || ([CommandLine] =~ ['.*dpapi.*']) || ([CommandLine] =~ ['.*sekurlsa.*'])
    || ([CommandLine] =~ ['.*kerberos.*']) || ([CommandLine] =~ ['.*lsadump.*']) ||
    ([CommandLine] =~ ['.*privilege.*']) || ([CommandLine] =~ ['.*process.*'])) &&
    (([CommandLine] =~ ['.*.*.*.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,002,004,005,006
  exttype: SIEM
- name: always_install_elevated_windows_installer
  description: This rule will looks for Windows Installer service (msiexec.exe) when
    it tries to install MSI packages with SYSTEM privilege
  condition: ([User] == ['NT AUTHORITY\SYSTEM']) && ([Image] =~ ['.*.*Windows.*Installer.*.*.*'])
    && ([Image] =~ ['.*msi.*']) && (([Image] =~ ['.*tmp'])) || (([Image] =~ ['.*.*msiexec.exe']))
    && ([IntegrityLevel] == ['System'])
  level: medium
  ruletype: EVALUATE
  tags: attack,privilege_escalation,t1548,002
  exttype: SIEM
- name: wmiexec_vbs_script
  description: Detects suspicious file execution by wscript and cscript
  condition: ([Image] =~ ['.*.*cscript.exe']) && ([CommandLine] =~ ['.*.vbs.*']) &&
    ([CommandLine] =~ ['.*.*shell.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,g0045,t1064,t1059,005
  exttype: SIEM
- name: rclone_execution
  description: Detects execution of RClone utility for exfiltration as used by various
    ransomwares strains like REvil, Conti, FiveHands, etc
  condition: ([Description] == ['Rsync for cloud storage']) || ([CommandLine] =~ ['.*.*.*config.*.*'])
    && ([CommandLine] =~ ['.*.*.*no.*check.*certificate.*.*']) && ([CommandLine] =~
    ['.*.*copy.*.*']) || (([Image] =~ ['.*.*rclone.exe'])) && (([CommandLine] =~ ['.*mega.*'])
    || ([CommandLine] =~ ['.*pcloud.*']) || ([CommandLine] =~ ['.*ftp.*']) || ([CommandLine]
    =~ ['.*.*.*progress.*']) || ([CommandLine] =~ ['.*.*.*ignore.*existing.*']) ||
    ([CommandLine] =~ ['.*.*.*auto.*confirm.*']) || ([CommandLine] =~ ['.*.*.*transfers.*'])
    || ([CommandLine] =~ ['.*.*.*multi.*thread.*streams.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1567,002
  exttype: SIEM
- name: renamed_megasync
  description: Detects the execution of a renamed meg.exe of MegaSync during incident
    response engagements associated with ransomware families like Nefilim, Sodinokibi,
    Pysa, and Conti.
  condition: ([ParentImage] =~ ['.*.*explorer.exe']) && ([CommandLine] =~ ['.*C.*.*Windows.*Temp.*meg.exe.*'])
    || ([OriginalFileName] == ['meg.exe']) && ([Image] !~ ['.*.*meg.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218
  exttype: SIEM
- name: regsvr32_flags_anomaly
  description: Detects a flag anomaly in which regsvr32.exe uses a /i flag without
    using a /n flag at the same time
  condition: ([Image] =~ ['.*.*regsvr32.exe']) && ([CommandLine] =~ ['.*.*.*i.*.*'])
    && ([CommandLine] !~ ['.*.*.*n.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,010,t1117
  exttype: SIEM
- name: suspicious_scheduled_task_creation_involving_temp_folder
  description: Detects the creation of scheduled tasks that involves a temporary folder
    and runs only once
  condition: ([Image] =~ ['.*.*schtasks.exe']) && ([CommandLine] =~ ['.*.*.*create.*.*'])
    && ([CommandLine] =~ ['.*.*.*sc.*once.*.*']) && ([CommandLine] =~ ['.*.*Temp.*.*.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,persistence,t1053,005
  exttype: SIEM
- name: baby_shark_activity
  description: Detects activity that could be related to Baby Shark malware
  condition: (([CommandLine] =~ ['reg.*query.*.*HKEY.*CURRENT.*USER.*Software.*Microsoft.*Terminal.*Server.*Client.*Default.*'])
    || ([CommandLine] =~ ['powershell.exe.*mshta.exe.*http.*']) || ([CommandLine]
    =~ ['cmd.exe.*.*c.*taskkill.*.*im.*cmd.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1059,t1086,003,001,discovery,t1012,defense_evasion,t1170,t1218,005
  exttype: SIEM
- name: run_whoami_showing_privileges
  description: Detects a whoami.exe executed with the /priv command line flag instructing
    the tool to show all current user privieleges. This is often used after a privilege
    escalation attempt.
  condition: ([Image] =~ ['.*.*whoami.exe']) && ([CommandLine] =~ ['.*.*priv.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,privilege_escalation,discovery,t1033
  exttype: SIEM
- name: unidentified_attacker_november_2018
  description: A sigma rule detecting an unidetefied attacker who used phishing emails
    to target high profile orgs on November 2018. The Actor shares some TTPs with
    YYTRIUM/APT29 campaign in 2016.
  condition: ([CommandLine] =~ ['.*cyzfc.dat.*.*']) && ([CommandLine] =~ ['.*PointFunctionCall'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1218,011,t1085
  exttype: SIEM
- name: unidentified_attacker_november_2018
  description: A sigma rule detecting an unidetefied attacker who used phishing emails
    to target high profile orgs on November 2018. The Actor shares some TTPs with
    YYTRIUM/APT29 campaign in 2016.
  condition: (([TargetFilename] =~ ['.*ds7002.lnk.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1218,011,t1085
  exttype: SIEM
- name: dit_snapshot_viewer_use
  description: Detects the use of Ditsnap tool. Seems to be a tool for ransomware
    groups.
  condition: (([Image] =~ ['.*.*ditsnap.exe'])) || (([CommandLine] =~ ['.*ditsnap.exe.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,003
  exttype: SIEM
- name: ngrok_usage
  description: Detects the use of Ngrok, a utility used for port forwarding and tunneling,
    often used by threat actors to make local protected services publicly available.
    Involved domains are bin.equinox.io for download and *.ngrok.io for connections.
  condition: (([CommandLine] =~ ['.*.*tcp.*139.*']) || ([CommandLine] =~ ['.*.*tcp.*445.*'])
    || ([CommandLine] =~ ['.*.*tcp.*3389.*']) || ([CommandLine] =~ ['.*.*tcp.*5985.*'])
    || ([CommandLine] =~ ['.*.*tcp.*5986.*'])) || ([CommandLine] =~ ['.*.*start.*.*'])
    && ([CommandLine] =~ ['.*.*.*all.*']) && ([CommandLine] =~ ['.*.*.*config.*'])
    && ([CommandLine] =~ ['.*.yml.*']) || (([Image] =~ ['.*ngrok.exe'])) && (([CommandLine]
    =~ ['.*.*tcp.*.*']) || ([CommandLine] =~ ['.*.*http.*.*']) || ([CommandLine] =~
    ['.*.*authtoken.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,command_and_control,t1572
  exttype: SIEM
- name: turla_group_named_pipes
  description: Detects a named pipe used by Turla group samples
  condition: (([PipeName] =~ ['.*atctl']) || ([PipeName] =~ ['.*userpipe']) || ([PipeName]
    =~ ['.*iehelper']) || ([PipeName] =~ ['.*sdlrpc']) || ([PipeName] =~ ['.*comnap']))
  level: critical
  ruletype: EVALUATE
  tags: attack,g0010
  exttype: SIEM
- name: cobaltstrike_named_pipe
  description: Detects the creation of a named pipe as used by CobaltStrike
  condition: ([PipeName] =~ ['.*.*MSSE.*.*']) && ([PipeName] =~ ['.*.*server.*'])
    || ([PipeName] =~ ['.*postex.*.*']) || ([PipeName] =~ ['.*postex.*ssh.*.*']) ||
    ([PipeName] =~ ['.*status.*.*']) || ([PipeName] =~ ['.*msagent.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: t1086_powershell_execution
  description: Detects execution of PowerShell
  condition: ([PipeName] =~ ['.*PSHost.*'])
  level: informational
  ruletype: EVALUATE
  tags: attack,execution,t1059,001
  exttype: SIEM
- name: alternate_powershell_hosts_pipe
  description: Detects alternate PowerShell hosts potentially bypassing detections
    looking for powershell.exe
  condition: ([PipeName] =~ ['.*PSHost.*']) && (([Image] !~ ['.*.*powershell.exe'])
    || ([Image] !~ ['.*.*powershell.*ise.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001
  exttype: SIEM
- name: cobaltstrike_named_pipe_patterns
  description: Detects the creation of a named pipe with a pattern found in CobaltStrike
    malleable C2 profiles
  condition: (([PipeName] =~ ['.*mojo.5688.8052.183894939787088877.*']) || ([PipeName]
    =~ ['.*mojo.5688.8052.35780273329370473.*']) || ([PipeName] =~ ['.*mypipe.*f.*'])
    || ([PipeName] =~ ['.*mypipe.*h.*']) || ([PipeName] =~ ['.*ntsvcs.*.*']) || ([PipeName]
    =~ ['.*scerpc.*.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: cred_dump_tools_named_pipes
  description: Detects well-known credential dumping tools execution via specific
    named pipes
  condition: (([PipeName] =~ ['.*.*lsadump.*']) || ([PipeName] =~ ['.*.*cachedump.*'])
    || ([PipeName] =~ ['.*.*wceservicepipe.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,002,004,005
  exttype: SIEM
- name: malicious_named_pipe
  description: Detects the creation of a named pipe used by known APT malware
  condition: (([PipeName] =~ ['.*isapi.*http']) || ([PipeName] =~ ['.*isapi.*dg'])
    || ([PipeName] =~ ['.*isapi.*dg2']) || ([PipeName] =~ ['.*sdlrpc']) || ([PipeName]
    =~ ['.*ahexec']) || ([PipeName] =~ ['.*winsession']) || ([PipeName] =~ ['.*lsassw'])
    || ([PipeName] =~ ['.*46a676ab7f179e511e30dd2dc41bd388']) || ([PipeName] =~ ['.*9f81f59bc58452127884ce513865ed20'])
    || ([PipeName] =~ ['.*e710f28d59aa529d6792ca6ff0ca1b34']) || ([PipeName] =~ ['.*rpchlp.*3'])
    || ([PipeName] =~ ['.*NamePipe.*MoreWindows']) || ([PipeName] =~ ['.*pcheap.*reuse'])
    || ([PipeName] =~ ['.*gruntsvc']) || ([PipeName] =~ ['.*583da945.*62af.*10e8.*4902.*a8f205c72b2e'])
    || ([PipeName] =~ ['.*bizkaz']) || ([PipeName] =~ ['.*svcctl']) || ([PipeName]
    =~ ['.*Posh.*']) || ([PipeName] =~ ['.*jaccdpqnvbrrxlaf']) || ([PipeName] =~ ['.*csexecsvc']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: psexec_pipes_artifacts
  description: Detecting use PsExec via Pipe Creation/Access to pipes
  condition: (([PipeName] =~ ['psexec.*']) || ([PipeName] =~ ['paexec.*']) || ([PipeName]
    =~ ['remcom.*']) || ([PipeName] =~ ['csexec.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,lateral_movement,t1021,002
  exttype: SIEM
- name: efspotato_named_pipe
  description: Detects the pattern of a pipe name as used by the tool EfsPotato
  condition: (([PipeName] =~ ['.*.*pipe.*.*.*']) || ([PipeName] =~ ['.*.*pipe.*srvsvc.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: dns_query_for_mega_io_upload_domain
  description: Detects DNS queries for subdomains used for upload to MEGA.io
  condition: ([QueryName] =~ ['.*userstorage.mega.co.nz.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,exfiltration,t1567,002
  exttype: SIEM
- name: lsass_memory_dump_via_comsvcs_dll
  description: Detects adversaries leveraging the MiniDump export function from comsvcs.dll
    via rundll32 to perform a memory dump from lsass.
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([SourceImage] == ['C:\Windows\System32\rundll32.exe'])
    && ([CallTrace] =~ ['.*comsvcs.dll.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: direct_syscall_of_ntopenprocess
  description: Detects the usage of the direct syscall of NtOpenProcess which might
    be done from a CobaltStrike BOF.
  condition: ([CallTrace] =~ ['UNKNOWN.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1106
  exttype: SIEM
- name: svchost_credential_dump
  description: Detects when a process, such as mimikatz, accesses the memory of svchost
    to dump credentials
  condition: ([TargetImage] =~ ['.*.*svchost.exe']) && ([GrantedAccess] == ['0x143a'])
    && (([SourceImage] !~ ['.*.*services.exe']) || ([SourceImage] !~ ['.*.*msiexec.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,t1548
  exttype: SIEM
- name: credentials_dumping_tools_accessing_lsass_memory
  description: Detects process access LSASS memory which is typical for credentials
    dumping tools
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && (([GrantedAccess] =~ ['.*0x40.*'])
    || ([GrantedAccess] =~ ['.*0x1000.*']) || ([GrantedAccess] =~ ['.*0x1400.*'])
    || ([GrantedAccess] =~ ['.*0x100000.*']) || ([GrantedAccess] =~ ['.*0x1410.*'])
    || ([GrantedAccess] =~ ['.*0x1010.*']) || ([GrantedAccess] =~ ['.*0x1438.*'])
    || ([GrantedAccess] =~ ['.*0x143a.*']) || ([GrantedAccess] =~ ['.*0x1418.*'])
    || ([GrantedAccess] =~ ['.*0x1f0fff.*']) || ([GrantedAccess] =~ ['.*0x1f1fff.*'])
    || ([GrantedAccess] =~ ['.*0x1f2fff.*']) || ([GrantedAccess] =~ ['.*0x1f3fff.*']))
    && (([ProcessName] !~ ['.*.*wmiprvse.exe']) || ([ProcessName] !~ ['.*.*taskmgr.exe'])
    || ([ProcessName] !~ ['.*.*procexp64.exe']) || ([ProcessName] !~ ['.*.*procexp.exe'])
    || ([ProcessName] !~ ['.*.*lsm.exe']) || ([ProcessName] !~ ['.*.*MsMpEng.exe'])
    || ([ProcessName] !~ ['.*.*csrss.exe']) || ([ProcessName] !~ ['.*.*wininit.exe'])
    || ([ProcessName] !~ ['.*.*vmtoolsd.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,s0002,car,2019-04-004
  exttype: SIEM
- name: malware_shellcode_in_verclsid_target_process
  description: Detects a process access to verclsid.exe that injects shellcode from
    a Microsoft Office application / VBA macro
  condition: ([TargetImage] =~ ['.*.*verclsid.exe']) && ([GrantedAccess] == ['0x1FFFFF'])
    && ([CallTrace] =~ ['.*.*UNKNOWN.*.*']) && ([CallTrace] =~ ['.*VBE7.DLL.*']) ||
    ([SourceImage] =~ ['.*.*Microsoft.*Office.*.*.*']) && ([CallTrace] =~ ['.*.*UNKNOWN.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1055
  exttype: SIEM
- name: cmstp_execution_process_access
  description: Detects various indicators of Microsoft Connection Manager Profile
    Installer execution
  condition: ([CallTrace] =~ ['.*cmlua.dll.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1218,003,t1191,execution,t1559,001,t1175,g0069,g0080,car,2019-04-001
  exttype: SIEM
- name: credential_dumping_by_lazagne
  description: Detects LSASS process access by LaZagne for credential dumping.
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([CallTrace] =~ ['.*C.*.*.*Windows.*.*SYSTEM32.*.*ntdll.dll.*.*'])
    && ([CallTrace] =~ ['.*.*C.*.*.*Windows.*.*System32.*.*KERNELBASE.dll.*.*']) &&
    ([CallTrace] =~ ['.*.*ctypes.pyd.*.*']) && ([CallTrace] =~ ['.*python27.dll.*.*'])
    && ([GrantedAccess] == ['0x1FFFFF'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,s0349
  exttype: SIEM
- name: load_undocumented_autoelevated_com_interface
  description: COM interface (EditionUpgradeManager) that is not used by standard
    executables.
  condition: ([CallTrace] =~ ['.*editionupgrademanagerobj.dll.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,privilege_escalation,t1548,002
  exttype: SIEM
- name: suspicious_in_memory_module_execution
  description: Detects the access to processes by other suspicious processes which
    have reflectively loaded libraries in their memory space. An example is SilentTrinity
    C2 behaviour. Generally speaking, when Sysmon EventID 10 cannot reference a stack
    call to a dll loaded from disk (the standard way), it will display "UNKNOWN" as
    the module name. Usually this means the stack call points to a module that was
    reflectively loaded in memory. Adding to this, it is not common to see such few
    calls in the stack (ntdll.dll --> kernelbase.dll --> unknown) which essentially
    means that most of the functions required by the process to execute certain routines
    are already present in memory, not requiring any calls to external libraries.
    The latter should also be considered suspicious.
  condition: ([CallTrace] =~ ['.*C.*.*.*Windows.*.*SYSTEM32.*.*ntdll.dll.*.*']) &&
    ([CallTrace] =~ ['.*.*C.*.*.*Windows.*.*System32.*.*KERNELBASE.dll.*.*']) && ([CallTrace]
    =~ ['.*.*UNKNOWN.*.*']) && ([CallTrace] =~ ['.*.*.*']) || ([CallTrace] =~ ['.*UNKNOWN.*.*'])
    && ([CallTrace] =~ ['.*.*.*UNKNOWN.*.*']) && ([CallTrace] =~ ['.*.*']) || ([CallTrace]
    =~ ['.*UNKNOWN.*']) && (([GrantedAccess] =~ ['0x1F0FFF']) || ([GrantedAccess]
    =~ ['0x1F1FFF']) || ([GrantedAccess] =~ ['0x143A']) || ([GrantedAccess] =~ ['0x1410'])
    || ([GrantedAccess] =~ ['0x1010']) || ([GrantedAccess] =~ ['0x1F2FFF']) || ([GrantedAccess]
    =~ ['0x1F3FFF']) || ([GrantedAccess] =~ ['0x1FFFFF'])) && (([SourceImage] !~ ['.*.*Windows.*System32.*sdiagnhost.exe']))
  level: critical
  ruletype: EVALUATE
  tags: attack,privilege_escalation,defense_evasion,t1055,001,002
  exttype: SIEM
- name: lsass_memory_dump
  description: Detects process LSASS memory dump using procdump or taskmgr based on
    the CallTrace pointing to dbghelp.dll or dbgcore.dll for win10
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([GrantedAccess] == ['0x1fffff'])
    && (([CallTrace] =~ ['.*dbghelp.dll.*']) || ([CallTrace] =~ ['.*dbgcore.dll.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001,s0002
  exttype: SIEM
- name: suspicious_shells_spawn_by_winrm
  description: Detects suspicious shell spawn from WinRM host process
  condition: ([ParentImage] =~ ['.*.*wsmprovhost.exe']) && (([Image] =~ ['.*.*cmd.exe'])
    || ([Image] =~ ['.*.*sh.exe']) || ([Image] =~ ['.*.*bash.exe']) || ([Image] =~
    ['.*.*powershell.exe']) || ([Image] =~ ['.*.*schtasks.exe']) || ([Image] =~ ['.*.*certutil.exe'])
    || ([Image] =~ ['.*.*whoami.exe']) || ([Image] =~ ['.*.*bitsadmin.exe']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1190,initial_access,persistence,privilege_escalation
  exttype: SIEM
- name: littlecorporal_generated_maldoc_injection
  description: Detects the process injection of a LittleCorporal generated Maldoc.
  condition: ([SourceImage] =~ ['.*winword.exe']) && ([CallTrace] =~ ['.*.*.*Windows.*Microsoft.NET.*Framework64.*v2..*'])
    && ([CallTrace] =~ ['.*UNKNOWN.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1204,002,t1055,003
  exttype: SIEM
- name: suspect_svchost_memory_asccess
  description: Detects suspect access to svchost process memory such as that used
    by Invoke-Phantom to kill the winRM windows event logging service.
  condition: ([TargetImage] =~ ['.*.*windows.*system32.*svchost.exe']) && ([GrantedAccess]
    == ['0x1f3fff']) && (([CallTrace] =~ ['.*unknown.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,002,t1089
  exttype: SIEM
- name: credential_dumping_by_pypykatz
  description: Detects LSASS process access by pypykatz for credential dumping.
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([CallTrace] =~ ['.*C.*.*Windows.*SYSTEM32.*ntdll.dll.*.*'])
    && ([CallTrace] =~ ['.*C.*.*Windows.*System32.*KERNELBASE.dll.*.*']) && ([CallTrace]
    =~ ['.*libffi.*7.dll.*']) && ([CallTrace] =~ ['.*.*ctypes.pyd.*.*']) && ([CallTrace]
    =~ ['.*python3.*.dll.*.*']) && ([GrantedAccess] == ['0x1FFFFF'])
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1003,001
  exttype: SIEM
- name: mimikatz_through_windows_remote_management
  description: Detects usage of mimikatz through WinRM protocol by monitoring access
    to lsass process by wsmprovhost.exe.
  condition: ([TargetImage] =~ ['.*.*lsass.exe']) && ([SourceImage] == ['C:\Windows\system32\wsmprovhost.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,credential_access,execution,t1003,001,t1059,t1086,lateral_movement,t1021,006,t1028,s0002
  exttype: SIEM
- name: executable_in_ads
  description: Detects the creation of an ADS data stream that contains an executable
    (non-empty imphash)
  condition: ([Imphash] == ['00000000000000000000000000000000'])
  level: critical
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1027,s0139,t1564,004
  exttype: SIEM
- name: exports_registry_key_to_an_alternate_data_stream
  description: Exports the target Registry key and hides it in the specified alternate
    data stream.
  condition: ([Image] =~ ['.*.*regedit.exe'])
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1564,004
  exttype: SIEM
- name: pingback_backdoor
  description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2
    as described in the trustwave report
  condition: ([Image] =~ ['.*updata.exe']) && ([TargetFilename] == ['C:\Windows\oci.dll'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1574,001
  exttype: SIEM
- name: pingback_backdoor
  description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2
    as described in the trustwave report
  condition: ([Image] =~ ['.*msdtc.exe']) && ([ImageLoaded] == ['C:\Windows\oci.dll'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1574,001
  exttype: SIEM
- name: pingback_backdoor
  description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2
    as described in the trustwave report
  condition: ([ParentImage] =~ ['.*updata.exe']) && ([CommandLine] =~ ['.*config.*'])
    && ([CommandLine] =~ ['.*msdtc.*']) && ([CommandLine] =~ ['.*start.*']) && ([CommandLine]
    =~ ['.*auto.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1574,001
  exttype: SIEM
- name: cve_2021_31979_cve_2021_33771_exploits_by_sourgum
  description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979
    CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum
  condition: (([TargetFilename] =~ ['.*C.*.*Windows.*system32.*physmem.sys.*']) ||
    ([TargetFilename] =~ ['.*C.*.*Windows.*System32.*IME.*IMEJP.*imjpueact.dll.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*ime.*IMETC.*IMTCPROT.DLL.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*ime.*SHARED.*imecpmeid.dll.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*config.*spp.*ServiceState.*Recovery.*pac.dat.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*config.*cy.*GB.*Setup.*SKB.*InputMethod.*TupTask.dat.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*config.*config.*startwus.dat.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*ime.*SHARED.*WimBootConfigurations.ini.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*ime.*IMEJP.*WimBootConfigurations.ini.*'])
    || ([TargetFilename] =~ ['.*C.*.*Windows.*system32.*ime.*IMETC.*WimBootConfigurations.ini.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1566,t1203
  exttype: SIEM
- name: cve_2021_31979_cve_2021_33771_exploits_by_sourgum
  description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979
    CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum
  condition: (([TargetObject] =~ ['.*.*Software.*Classes.*CLSID.*.*CF4CC405.*E2C5.*4DDD.*B3CE.*5E7582D8C9FA.*.*InprocServer32.*'])
    || ([TargetObject] =~ ['.*.*SOFTWARE.*Classes.*CLSID.*.*7C857801.*7381.*11CF.*884D.*00AA004B2E24.*.*InProcServer32.*']))
    && message =~ 'IMJPUEXP.DLL'
  level: critical
  ruletype: EVALUATE
  tags: attack,credential_access,t1566,t1203
  exttype: SIEM
- name: dns_hybridconnectionmanager_service_bus
  description: Detects Azure Hybrid Connection Manager services querying the Azure
    service bus service
  condition: ([QueryName] =~ ['.*servicebus.windows.net.*']) && ([Image] =~ ['.*HybridConnectionManager.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence
  exttype: SIEM
- name: sysmon_configuration_modification
  description: Someone try to hide from Sysmon
  condition: ([State] == ['Stopped']) || message =~ 'Sysmon.*config.*state.*changed'
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1564
  exttype: SIEM
- name: sysmon_configuration_modification
  description: Someone try to hide from Sysmon
  condition: (([Description] =~ ['.*Failed.*to.*open.*service.*configuration.*with.*error.*'])
    || ([Description] =~ ['.*Failed.*to.*connect.*to.*the.*driver.*to.*update.*configuration.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1564
  exttype: SIEM
- name: wmiprvse_wbemcomn_dll_hijack
  description: Detects a threat actor creating a file named `wbemcomn.dll` in the
    `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI
    DLL Hijack scenario.
  condition: ([Image] == ['System']) && ([TargetFilename] =~ ['.*.*wbem.*wbemcomn.dll'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1047,lateral_movement,t1021,002
  exttype: SIEM
- name: wmiprvse_wbemcomn_dll_hijack
  description: Detects a threat actor creating a file named `wbemcomn.dll` in the
    `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI
    DLL Hijack scenario.
  condition: ([Image] =~ ['.*.*wmiprvse.exe']) && ([ImageLoaded] =~ ['.*.*wbem.*wbemcomn.dll'])
  level: critical
  ruletype: EVALUATE
  tags: attack,execution,t1047,lateral_movement,t1021,002
  exttype: SIEM
- name: suspicious_dns_query_for_ipify_api
  description: Detects DNS queries for api.ipify.org not originating from a browser
    process.
  condition: ([QueryName] == ['api.ipify.org']) && (([Image] !~ ['.*.*chrome.exe'])
    || ([Image] !~ ['.*.*iexplore.exe']) || ([Image] !~ ['.*.*firefox.exe']))
  level: medium
  ruletype: EVALUATE
  tags: attack,reconnaissance,t1590
  exttype: SIEM
- name: proxylogon_reset_virtual_directories_based_on_iis_log
  description: When exploiting this vulnerability with CVE-2021â€“26858, an SSRF attack
    is used to manipulate virtual directories
  condition: ([cs-method] == ['POST']) && ([sc-status] == 200) && ([cs-uri-stem] ==
    ['/ecp/DDI/DDIService.svc/SetObject']) && ([cs-uri-query] =~ ['.*schema=Reset.*'])
    && ([cs-uri-query] =~ ['.*VirtualDirectory.*']) && ([cs-username] =~ ['.*.*'])
    || message =~ 'POST' && message =~ '200' && message =~ '.*ecp.*DDI.*DDIService.svc.*SetObject'
    && message =~ 'schema=Reset' && message =~ 'VirtualDirectory' && message =~ '.*'
  level: critical
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: exchange_powershell_snap_ins_used_by_hafnium
  description: Detects adding and using Exchange PowerShell snap-ins to export mailbox
    data by HAFNIUM
  condition: ([Image] =~ ['.*.*powershell.exe']) && ([CommandLine] =~ ['.*add.*pssnapin.*microsoft.exchange.powershell.snapin.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,execution,t1086,t1059,001,collection,t1114
  exttype: SIEM
