name: AzureActivity
applications: ""
definitions:
- name: granting_of_permissions_to_an_account
  description: Identifies IPs from which users grant access to other users on azure
    resources and alerts when a previously unseen source IP address is used.
  condition: message =~ 'Microsoft.Authorization.*roleAssignments.*write'
  level: medium
  ruletype: EVALUATE
  tags: attack,t1098
  exttype: SIEM
- name: number_of_resource_creation_or_deployment_activities
  description: Number of VM creations or deployment activities occur in Azure via
    the AzureActivity log.
  condition: message =~ 'Microsoft.Compute.*virtualMachines.*write' || message =~
    'Microsoft.Resources.*deployments.*write'
  level: medium
  ruletype: EVALUATE
  tags: attack,t1098
  exttype: SIEM
- name: rare_subscription_level_operations_in_azure
  description: Identifies IPs from which users grant access to other users on azure
    resources and alerts when a previously unseen source IP address is used.
  condition: message =~ 'Microsoft.DocumentDB.*databaseAccounts.*listKeys.*action'
    || message =~ 'Microsoft.Maps.*accounts.*listKeys.*action' || message =~ 'Microsoft.Media.*mediaservices.*listKeys.*action'
    || message =~ 'Microsoft.CognitiveServices.*accounts.*listKeys.*action' || message
    =~ 'Microsoft.Storage.*storageAccounts.*listKeys.*action' || message =~ 'Microsoft.Compute.*snapshots.*write'
    || message =~ 'Microsoft.Network.*networkSecurityGroups.*write'
  level: medium
  ruletype: EVALUATE
  tags: attack,t1003
  exttype: SIEM
