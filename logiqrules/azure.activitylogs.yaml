name: azure.activitylogs
applications: ""
definitions:
- name: azure_kubernetes_sensitive_role_access
  description: Identifies when ClusterRoles/Roles are being modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLES.*BIND.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLES.*ESCALATE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLES.*BIND.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLES.*ESCALATE.*ACTION']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_secret_or_config_object_access
  description: Identifies when a Kubernetes account access a sensitive objects such
    as configmaps or secrets.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*CONFIGMAPS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*CONFIGMAPS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*SECRETS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*SECRETS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_firewall_modified_or_deleted
  description: Identifies when a firewall is created, modified, or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_keyvault_secrets_modified_or_deleted
  description: Identifies when secrets are modified or deleted in Azure.
  condition: (([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*DELETE']) ||
    ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*BACKUP.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*PURGE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*UPDATE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*RECOVER.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*RESTORE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*SECRETS.*SETSECRET.*ACTION']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,credential_access,t1552,001
  exttype: SIEM
- name: azure_firewall_rule_collection_modified_or_deleted
  description: Identifies when Rule Collections (Application, NAT, and Network) is
    being modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*APPLICATIONRULECOLLECTIONS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*APPLICATIONRULECOLLECTIONS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*NATRULECOLLECTIONS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*NATRULECOLLECTIONS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*NETWORKRULECOLLECTIONS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*AZUREFIREWALLS.*NETWORKRULECOLLECTIONS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_dns_zone_modified_or_deleted
  description: Identifies when DNS zone is modified or deleted.
  condition: ([properties.message] =~ ['MICROSOFT.NETWORK.*DNSZONES.*']) && (([properties.message]
    =~ ['.*.*WRITE']) || ([properties.message] =~ ['.*.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_application_gateway_modified_or_deleted
  description: Identifies when a application gateway is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*APPLICATIONGATEWAYS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*APPLICATIONGATEWAYS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_events_deleted
  description: Detects when Events are deleted in Azure Kubernetes. An adversary may
    delete events in Azure Kubernetes in an attempt to evade detection.
  condition: ([properties.message] == ['MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE'])
  level: medium
  ruletype: EVALUATE
  tags: attack,defense_evasion,t1562,001
  exttype: SIEM
- name: azure_key_vault_modified_or_deleted_
  description: Identifies when a key vault is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*WRITE']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*DELETE']) || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*DEPLOY.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*ACCESSPOLICIES.*WRITE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,credential_access,t1552,001
  exttype: SIEM
- name: azure_virtual_network_device_modified_or_deleted
  description: Identifies when a virtual network device is being modified or deleted.
    This can be a network interface, network virtual appliance, virtual hub, or virtual
    router.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKINTERFACES.*TAPCONFIGURATIONS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKINTERFACES.*TAPCONFIGURATIONS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKINTERFACES.*WRITE']) ||
    ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKINTERFACES.*JOIN.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKINTERFACES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKVIRTUALAPPLIANCES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKVIRTUALAPPLIANCES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*VIRTUALHUBS.*DELETE']) || ([properties.message]
    =~ ['MICROSOFT.NETWORK.*VIRTUALHUBS.*WRITE']) || ([properties.message] =~ ['MICROSOFT.NETWORK.*VIRTUALROUTERS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*VIRTUALROUTERS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_container_registry_created_or_deleted
  description: Detects when a Container Registry is created or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.CONTAINERREGISTRY.*REGISTRIES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.CONTAINERREGISTRY.*REGISTRIES.*DELETE']))
  level: low
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_firewall_rule_configuration_modified_or_deleted
  description: Identifies when a Firewall Rule Configuration is Modified or Deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*FIREWALLPOLICIES.*RULECOLLECTIONGROUPS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*FIREWALLPOLICIES.*RULECOLLECTIONGROUPS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*FIREWALLPOLICIES.*RULEGROUPS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*FIREWALLPOLICIES.*RULEGROUPS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_vpn_connection_modified_or_deleted
  description: Identifies when a VPN connection is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*VPNGATEWAYS.*VPNCONNECTIONS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*VPNGATEWAYS.*VPNCONNECTIONS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_network_security_configuration_modified_or_deleted
  description: Identifies when a network security configuration is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*SECURITYRULES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*SECURITYRULES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*JOIN.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*NETWORKSECURITYGROUPS.*PROVIDERS.*MICROSOFT.INSIGHTS.*DIAGNOSTICSETTINGS.*WRITE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_service_account_modified_or_deleted
  description: Identifies when a service account is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*SERVICEACCOUNTS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*SERVICEACCOUNTS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*SERVICEACCOUNTS.*IMPERSONATE.*ACTION']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_point_to_site_vpn_modified_or_deleted
  description: Identifies when a Point-to-site VPN is Modified or Deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*DELETE']) ||
    ([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*RESET.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*GENERATEVPNPROFILE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*DISCONNECTP2SVPNCONNECTIONS.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*P2SVPNGATEWAYS.*PROVIDERS.*MICROSOFT.INSIGHTS.*DIAGNOSTICSETTINGS.*WRITE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_network_policy_change
  description: Identifies when a Azure Kubernetes network policy is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*NETWORKING.K8S.IO.*NETWORKPOLICIES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*NETWORKING.K8S.IO.*NETWORKPOLICIES.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*EXTENSIONS.*NETWORKPOLICIES.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*EXTENSIONS.*NETWORKPOLICIES.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,credential_access
  exttype: SIEM
- name: azure_keyvault_key_modified_or_deleted
  description: Identifies when a Keyvault Key is modified or deleted in Azure.
  condition: (([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*UPDATE.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*CREATE']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*CREATE.*ACTION']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*IMPORT.*ACTION']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*RECOVER.*ACTION']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*RESTORE.*ACTION']) || ([properties.message]
    =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*DELETE']) || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*BACKUP.*ACTION'])
    || ([properties.message] =~ ['MICROSOFT.KEYVAULT.*VAULTS.*KEYS.*PURGE.*ACTION']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,credential_access,t1552,001
  exttype: SIEM
- name: azure_suppression_rule_created
  description: Identifies when a suppression rule is created in Azure. Adversary's
    could attempt this to evade detection.
  condition: (([properties.message] =~ ['MICROSOFT.SECURITY.*ALERTSSUPPRESSIONRULES.*WRITE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_cluster_created_or_deleted
  description: Detects when a Azure Kubernetes Cluster is created or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*DELETE']))
  level: low
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_pods_deleted
  description: Identifies the deletion of Azure Kubernetes Pods.
  condition: ([properties.message] == ['MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE'])
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_kubernetes_rolebinding_clusterrolebinding_modified_and_deleted
  description: Detects the creation or patching of potential malicious RoleBinding/ClusterRoleBinding.
  condition: (([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLEBINDINGS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*CLUSTERROLEBINDINGS.*DELETE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLEBINDINGS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.KUBERNETES.*CONNECTEDCLUSTERS.*RBAC.AUTHORIZATION.K8S.IO.*ROLEBINDINGS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact,credential_access
  exttype: SIEM
- name: azure_virtual_network_modified_or_deleted
  description: Identifies when a Virtual Network is modified or deleted in Azure.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*VIRTUALNETWORKGATEWAYS.*.*'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*VIRTUALNETWORKS.*.*'])) && (([properties.message]
    =~ ['.*.*WRITE']) || ([properties.message] =~ ['.*.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
- name: azure_application_security_group_modified_or_deleted
  description: Identifies when a application security group is modified or deleted.
  condition: (([properties.message] =~ ['MICROSOFT.NETWORK.*APPLICATIONSECURITYGROUPS.*WRITE'])
    || ([properties.message] =~ ['MICROSOFT.NETWORK.*APPLICATIONSECURITYGROUPS.*DELETE']))
  level: medium
  ruletype: EVALUATE
  tags: attack,impact
  exttype: SIEM
