name: webserver
applications: ""
definitions:
- name: exchange_exploitation_used_by_hafnium
  description: Detects exploitation attempts in Exchange server logs as described
    in blog posts reporting on HAFNIUM group activity
  condition: ([cs-method] == ['POST']) && ([c-uri] =~ ['.*.*owa.*auth.*Current.*themes.*resources.*.*'])
    || ([c-uri] =~ ['.*.*owa.*auth.*Current.*.*']) && (([c-useragent] =~ ['DuckDuckBot.*1.0.*.*.*.*http.*.*.*duckduckgo.com.*duckduckbot.html.*'])
    || ([c-useragent] =~ ['facebookexternalhit.*1.1.*.*.*http.*.*.*www.facebook.com.*externalhit.*uatext.php.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Baiduspider.*2.0.*.*.*http.*.*.*www.baidu.com.*search.*spider.html.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Bingbot.*2.0.*.*.*http.*.*.*www.bing.com.*bingbot.htm.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Googlebot.*2.1.*.*.*http.*.*.*www.google.com.*bot.html'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Konqueror.*3.5.*.*Linux.*.*KHTML.*3.5.5.*.*like.*Gecko.*.*.*Exabot.*Thumbnails.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Yahoo.*.*Slurp.*.*http.*.*.*help.yahoo.com.*help.*us.*ysearch.*slurp.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*YandexBot.*3.0.*.*.*http.*.*.*yandex.com.*bots.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*X11.*.*Linux.*x86.*64.*.*AppleWebKit.*537.36.*.*KHTML.*.*like.*Gecko.*.*Chrome.*51.0.2704.103.*Safari.*537.36']))
    || ([c-uri] =~ ['.*.*ecp.*.*']) && (([c-useragent] =~ ['ExchangeServicesClient.*0.0.0.0'])
    || ([c-useragent] =~ ['python.*requests.*2.19.1']) || ([c-useragent] =~ ['python.*requests.*2.25.1']))
    || (([c-uri] =~ ['.*.*aspnet.*client.*.*']) || ([c-uri] =~ ['.*.*owa.*.*'])) &&
    (([c-useragent] =~ ['antSword.*v2.1']) || ([c-useragent] =~ ['Googlebot.*2.1.*.*.*http.*.*.*www.googlebot.com.*bot.html.*'])
    || ([c-useragent] =~ ['Mozilla.*5.0.*.*compatible.*.*Baiduspider.*2.0.*.*.*http.*.*.*www.baidu.com.*search.*spider.html.*']))
    || (([c-uri] =~ ['.*.*owa.*auth.*Current.*.*']) || ([c-uri] =~ ['.*.*ecp.*default.flt.*'])
    || ([c-uri] =~ ['.*.*ecp.*main.css.*'])) || ([c-uri] =~ ['.*.*ecp.*.*']) && ([c-uri]
    =~ ['.*.js.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: webshell_detection_by_keyword
  description: Detects webshells that use GET requests by keyword searches in URL
    strings
  condition: message =~ '=whoami' || message =~ '=net.*20user' || message =~ '=cmd.*20.*c.*20'
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1100,t1505,003
  exttype: SIEM
- name: successful_exchange_proxyshell_attack
  description: Detects URP patterns and status codes that indicate a successful ProxyShell
    exploitation attack against Exchange servers
  condition: ([c-uri] =~ ['.*.*autodiscover.json.*']) && (([c-uri] =~ ['.*.*powershell.*'])
    || ([c-uri] =~ ['.*.*mapi.*nspi.*']) || ([c-uri] =~ ['.*.*EWS.*']) || ([c-uri]
    =~ ['.*X.*Rps.*CAT.*'])) && (([sc-status] == 200) || ([sc-status] == 301))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access
  exttype: SIEM
- name: exchange_exploitation_cve_2021_28480
  description: Detects successful exploitation of Exchange vulnerability as reported
    in CVE-2021-28480
  condition: ([c-uri] =~ ['.*.*owa.*calendar.*a.*']) && ([cs-method] == ['POST'])
    && ([sc-status] == 503)
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: terramaster_tos_cve_2020_28188
  description: Detects the exploitation of the TerraMaster TOS vulnerability described
    in CVE-2020-28188
  condition: ([cs-method] == ['GET']) && ([c-uri] =~ ['.*.*include.*makecvs.php.*'])
    && ([c-uri] =~ ['.*.*Event=.*']) && (([c-uri] =~ ['.*curl.*']) || ([c-uri] =~
    ['.*wget.*']) || ([c-uri] =~ ['.*.py.*']) || ([c-uri] =~ ['.*.sh.*']) || ([c-uri]
    =~ ['.*chmod.*']) || ([c-uri] =~ ['.*.*GET.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,t1190,initial_access
  exttype: SIEM
- name: cisco_asa_ftd_exploit_cve_2020_3452
  description: Detects exploitation attempts on Cisco ASA FTD systems exploiting CVE-2020-3452
    with a status code of 200 (sccessful exploitation)
  condition: (([c-uri] =~ ['.*.*CSCOT.*.*translation.*table.*']) || ([c-uri] =~ ['.*.*CSCOT.*.*oem.*customization.*']))
    && (([c-uri] =~ ['.*.*textdomain=.*.*']) || ([c-uri] =~ ['.*.*textdomain=.*.*'])
    || ([c-uri] =~ ['.*.*name=.*.*']) || ([c-uri] =~ ['.*.*name=.*.*'])) && ([sc-status]
    == 200)
  level: high
  ruletype: EVALUATE
  tags: attack,t1100,t1190,initial_access
  exttype: SIEM
- name: exchange_proxyshell_pattern
  description: Detects URL patterns that could be found in ProxyShell exploitation
    attempts against Exchange servers (failed and successful)
  condition: ([c-uri] =~ ['.*.*autodiscover.json.*']) && (([c-uri] =~ ['.*.*powershell.*'])
    || ([c-uri] =~ ['.*.*mapi.*nspi.*']) || ([c-uri] =~ ['.*.*EWS.*']) || ([c-uri]
    =~ ['.*X.*Rps.*CAT.*'])) || (([c-uri] =~ ['.*autodiscover.json.*.*.*']) || ([c-uri]
    =~ ['.*autodiscover.json.*3f.*.*']) || ([c-uri] =~ ['.*.*3f.*foo.com.*']) || ([c-uri]
    =~ ['.*Email=autodiscover.*autodiscover.json.*']) || ([c-uri] =~ ['.*json.*.*foo.com.*']))
  level: medium
  ruletype: EVALUATE
  tags: attack,initial_access
  exttype: SIEM
- name: detect_xss_attempts_by_keywords
  description: Detects XSS that use GET requests by keyword searches in URL strings
  condition: message =~ '=cookie' || message =~ '=script' || message =~ '=onload'
    || message =~ '=onmouseover'
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: dewmode_webshell_access
  description: Detects access to DEWMODE webshell as described in FIREEYE report
  condition: ([c-uri] =~ ['.*.html.*.*']) && ([c-uri] =~ ['.*.*dwn=.*']) && ([c-uri]
    =~ ['.*.*fn=.*']) || ([c-uri] =~ ['.*.*dwn=.*']) && ([c-uri] =~ ['.*.*fn=.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003
  exttype: SIEM
- name: cve_2021_21972_vsphere_exploitation
  description: Detects the exploitation of VSphere Remote Code Execution vulnerability
    as described in CVE-2021-21972
  condition: ([cs-method] == ['POST']) && ([c-uri] == ['/ui/vropspluginui/rest/services/uploadova'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: source_code_enumeration_detection_by_keyword
  description: Detects source code enumeration that use GET requests by keyword searches
    in URL strings
  condition: message =~ '.*.git.*.*'
  level: medium
  ruletype: EVALUATE
  tags: attack,discovery,t1083
  exttype: SIEM
- name: pulse_connect_secure_rce_attack_cve_2021_22893
  description: This rule detects exploitation attempts using Pulse Connect Secure(PCS)
    vulnerability (CVE-2021-22893)
  condition: (([c-uri] =~ ['.*.*dana.*na.*auth.*.*']) || ([c-uri] =~ ['.*.*dana.*ws.*.*'])
    || ([c-uri] =~ ['.*.*dana.*cached.*.*'])) && (([c-uri] =~ ['.*.*id=.*']) || ([c-uri]
    =~ ['.*.*token=.*']) || ([c-uri] =~ ['.*Secid.*canceltoken.cgi.*']) || ([c-uri]
    =~ ['.*CGI.*.*param.*']) || ([c-uri] =~ ['.*meeting.*']) || ([c-uri] =~ ['.*smb.*'])
    || ([c-uri] =~ ['.*namedusers.*']) || ([c-uri] =~ ['.*metric.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: sonicwall_ssl_vpn_jarrewrite_exploit
  description: Detects exploitation attempts of the SonicWall Jarrewrite Exploit
  condition: ([c-uri] =~ ['.*.*cgi.*bin.*jarrewrite.sh.*']) && (([c-useragent] =~
    ['.*.*.*.*']) || ([c-useragent] =~ ['.*.*.*.*.*.*']) || ([c-useragent] =~ ['.*.*bin.*bash.*.*c.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1190,initial_access
  exttype: SIEM
- name: cve_2020_0688_exchange_exploitation_via_web_log
  description: Detects the exploitation of Microsoft Exchange vulnerability as described
    in CVE-2020-0688
  condition: ([cs-method] == ['GET']) && (([c-uri] =~ ['.*.*ecp.*.*']) || ([c-uri]
    =~ ['.*.*owa.*.*'])) && ([c-uri] =~ ['.*.*.*VIEWSTATE=.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: pulse_secure_attack_cve_2019_11510
  description: Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole
  condition: ([c-uri] =~ ['.*.*.*dana.*html5acc.*guacamole.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: arcadyan_router_exploitations
  description: Detects exploitation of vulnerabilities in Arcadyan routers as reported
    in CVE-2021-20090 and CVE-2021-20091.
  condition: (([c-uri] =~ ['.*...*2f.*'])) || ([c-uri] =~ ['.*...*2f.*']) && ([c-uri]
    =~ ['.*apply.*abstract.cgi.*']) && (([c-uri] =~ ['.*.*images.*.*']) || ([c-uri]
    =~ ['.*.*js.*.*']) || ([c-uri] =~ ['.*.*css.*.*']) || ([c-uri] =~ ['.*.*setup.*top.*login.htm.*'])
    || ([c-uri] =~ ['.*.*login.html.*']) || ([c-uri] =~ ['.*.*loginerror.html.*'])
    || ([c-uri] =~ ['.*.*loginexclude.html.*']) || ([c-uri] =~ ['.*.*loginlock.html.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: cve_2020_0688_exploitation_attempt
  description: Detects CVE-2020-0688 Exploitation attempts
  condition: ([c-uri] =~ ['.*.*ecp.*default.aspx.*']) && ([c-uri] =~ ['.*.*.*VIEWSTATEGENERATOR=.*'])
    && ([c-uri] =~ ['.*.*.*VIEWSTATE=.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: citrix_netscaler_attack_cve_2019_19781
  description: Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler,
    Application Delivery Controller and Citrix Gateway Attack
  condition: (([c-uri] =~ ['.*.*...*vpns.*.*']) || ([c-uri] =~ ['.*.*vpns.*cfg.*smb.conf'])
    || ([c-uri] =~ ['.*.*vpns.*portal.*scripts.*.*.pl.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: cve_2020_10148_solarwinds_orion_api_auth_bypass
  description: Detects CVE-2020-10148 SolarWinds Orion API authentication bypass attempts
  condition: (([c-uri] =~ ['.*WebResource.axd.*']) || ([c-uri] =~ ['.*ScriptResource.axd.*'])
    || ([c-uri] =~ ['.*i18n.ashx.*']) || ([c-uri] =~ ['.*Skipi18n.*'])) && ([c-uri]
    !~ ['.*Orion.*Skipi18n.*Profiler.*.*']) && (([c-uri] !~ ['.*css.i18n.ashx.*'])
    || ([c-uri] !~ ['.*js.i18n.ashx.*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: citrix_ads_exploitation_cve_2020_8193_cve_2020_8195
  description: Detects exploitation attempt against Citrix Netscaler, Application
    Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported
    as CVE-2020-8193 and CVE-2020-8195
  condition: ([c-uri] =~ ['.*.*rapi.*filedownload.*filter=path.*.*2F.*']) || ([c-uri]
    =~ ['.*.*pcidss.*report.*']) && ([c-uri] =~ ['.*type=all.*signatures.*']) && ([c-uri]
    =~ ['.*sig.*name=.*default.*signature.*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: oracle_weblogic_exploit_cve_2021_2109
  description: Detects the exploitation of the WebLogic server vulnerability described
    in CVE-2021-2109
  condition: ([cs-method] == ['GET']) && ([c-uri] =~ ['.*com.bea.console.handles.JndiBindingHandle.*'])
    && ([c-uri] =~ ['.*ldap.*.*.*.*']) && ([c-uri] =~ ['.*AdminServer.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,t1190,initial_access
  exttype: SIEM
- name: solarwinds_supernova_webshell_access
  description: Detects access to SUPERNOVA webshell as described in Guidepoint report
  condition: ([c-uri] =~ ['.*logoimagehandler.ashx.*']) && ([c-uri] =~ ['.*clazz.*'])
    || ([sc-status] == 500)
  level: critical
  ruletype: EVALUATE
  tags: attack,persistence,t1505,003
  exttype: SIEM
- name: exploitation_of_cve_2021_26814_in_wazuh
  description: Detects the exploitation of the Wazuh RCE vulnerability described in
    CVE-2021-26814
  condition: ([c-uri] =~ ['.*.*manager.*files.*path=etc.*lists.*...*...*...*...*...*'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: oracle_weblogic_exploit_cve_2020_14882
  description: Detects exploitation attempts on WebLogic servers
  condition: (([c-uri] =~ ['.*.*console.*images.*.*252E.*252E.*252Fconsole.portal.*'])
    || ([c-uri] =~ ['.*.*console.*css.*.*2e.*']))
  level: high
  ruletype: EVALUATE
  tags: attack,t1100,t1190,initial_access
  exttype: SIEM
- name: fortinet_cve_2018_13379_exploitation
  description: Detects CVE-2018-13379 exploitation attempt against Fortinet SSL VPNs
  condition: ([c-uri] =~ ['.*lang=.*...*...*.*']) && ([c-uri] =~ ['.*.*dev.*cmdb.*sslvpn.*websession.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: detect_sql_injection_by_keywords
  description: Detects sql injection that use GET requests by keyword searches in
    URL strings
  condition: message =~ '=select' || message =~ '=union' || message =~ '=concat'
  level: high
  ruletype: EVALUATE
  tags: ""
  exttype: SIEM
- name: cve_2020_5902_f5_big_ip_exploitation_attempt
  description: Detects the exploitation attempt of the vulnerability found in F5 BIG-IP
    and described in CVE-2020-5902
  condition: (([c-uri] =~ ['.*.*tmui.*.*']) || ([c-uri] =~ ['.*.*hsqldb.*'])) && (([c-uri]
    =~ ['.*...*.*.*']) || ([c-uri] =~ ['.*.jsp.*...*']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: cve_2021_21978_exploitation_attempt
  description: Detects the exploitation of the VMware View Planner vulnerability described
    in CVE-2021-21978
  condition: ([cs-method] == ['POST']) && ([c-uri] =~ ['.*logupload.*']) && ([c-uri]
    =~ ['.*logMetaData.*']) && ([c-uri] =~ ['.*wsgi.*log.*upload.py.*'])
  level: high
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: fortinet_cve_2021_22123_exploitation
  description: Detects CVE-2021-22123 exploitation attempt against Fortinet WAFs
  condition: (([c-uri] =~ ['.*.*api.*v2.0.*user.*remoteserver.saml.*'])) && (([cs-method]
    =~ ['POST'])) && ([cs-referer] !~ ['.*.*root.*user.*remote.*user.*saml.*user.*.*'])
    && (([cs-referer] !~ ['None']))
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: confluence_exploitation_cve_2019_3398
  description: Detects the exploitation of the Confluence vulnerability described
    in CVE-2019-3398
  condition: ([cs-method] == ['POST']) && ([c-uri] =~ ['.*.*upload.action.*']) &&
    ([c-uri] =~ ['.*filename=...*...*...*...*.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,initial_access,t1190
  exttype: SIEM
- name: oracle_weblogic_exploit
  description: Detects access to a webshell dropped into a keystore folder on the
    WebLogic server
  condition: ([c-uri] =~ ['.*.*config.*keystore.*.*.js.*'])
  level: critical
  ruletype: EVALUATE
  tags: attack,t1100,t1190,initial_access,persistence,t1505,003
  exttype: SIEM
- name: webshell_regeorg_detection_via_web_logs
  description: Certain strings in the uri_query field when combined with null referer
    and null user agent can indicate activity associated with the webshell ReGeorg.
  condition: (([uri_query] =~ ['.*cmd=read.*']) || ([uri_query] =~ ['.*connect.*target.*'])
    || ([uri_query] =~ ['.*cmd=connect.*']) || ([uri_query] =~ ['.*cmd=disconnect.*'])
    || ([uri_query] =~ ['.*cmd=forward.*'])) && ([method] == ['POST'])
  level: high
  ruletype: EVALUATE
  tags: attack,persistence,t1100,t1505,003
  exttype: SIEM
